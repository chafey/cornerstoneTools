/*! cornerstoneTools - 0.8.4 - 2017-31-28 | (c) 2017 Chris Hafey | https://github.com/chafey/cornerstoneTools */
var cornerstoneTools=function(e){function t(n){if(o[n])return o[n].exports;var a=o[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var o={};return t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,o,n){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=103)}([function(e,t,o){"use strict";function n(e){var t=cornerstone.getEnabledElement(e);return void 0===t.toolStateManager&&(t.toolStateManager=globalImageIdSpecificToolStateManager),t.toolStateManager}function a(e,t,o){n(e).add(e,t,o);var a={toolType:t,element:e,measurementData:o};$(e).trigger("CornerstoneToolsMeasurementAdded",a)}function r(e,t){return n(e).get(e,t)}function i(e,t,o){for(var a=n(e),r=a.get(e,t),i=-1,s=0;s<r.data.length;s++)r.data[s]===o&&(i=s);if(-1!==i){r.data.splice(i,1);var l={toolType:t,element:e,measurementData:o};$(e).trigger("CornerstoneToolsMeasurementRemoved",l)}}function s(e,t){var o=n(e),a=o.get(e,t);void 0!==a&&(a.data=[])}function l(e,t){cornerstone.getEnabledElement(e).toolStateManager=t}Object.defineProperty(t,"__esModule",{value:!0}),t.addToolState=a,t.getToolState=r,t.removeToolState=i,t.clearToolState=s,t.setElementToolStateManager=l,t.getElementToolStateManager=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(e){s=e}function t(){return s}function o(e){r=e}function n(){return r}function a(e){return e?i:r}var r="white",i="greenyellow",s="transparent";return{setFillColor:e,getFillColor:t,setToolColor:o,getToolColor:n,setActiveColor:setActiveColor,getActiveColor:getActiveColor,getColorIfActive:a}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(t){var r=t.element,i=e.createNewMeasurement(t);if(i){var s={mouseButtonMask:t.which};addToolState(t.element,e.toolType,i),$(r).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||n),$(r).off("CornerstoneToolsMouseDown",e.mouseDownCallback||a),$(r).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||o),e.mouseDoubleClickCallback&&$(r).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),cornerstone.updateImage(r);var l;l=1===Object.keys(i.handles).length?moveHandle:moveNewHandle;var c;c=!(!e.options||void 0===e.options.preventHandleOutsideImage)&&e.options.preventHandleOutsideImage,l(t,e.toolType,i,i.handles.end,function(){i.active=!1,i.invalidated=!0,anyHandlesOutsideImage(t,i.handles)&&removeToolState(r,e.toolType,i),$(r).on("CornerstoneToolsMouseMove",s,e.mouseMoveCallback||n),$(r).on("CornerstoneToolsMouseDown",s,e.mouseDownCallback||a),$(r).on("CornerstoneToolsMouseDownActivate",s,e.mouseDownActivateCallback||o),e.mouseDoubleClickCallback&&$(r).on("CornerstoneToolsMouseDoubleClick",s,e.mouseDoubleClickCallback),cornerstone.updateImage(r)},c)}}function o(o,n){if(isMouseButtonEnabled(n.which,o.data.mouseButtonMask))return e.addNewMeasurement?e.addNewMeasurement(n):t(n),!1}function n(t,o){if(toolCoordinates.setCoords(o),0===o.which){var n=getToolState(o.element,e.toolType);if(n){for(var a=!1,r=0;r<n.data.length;r++){var i=o.currentPoints.canvas,s=n.data[r];!0===handleActivator(o.element,s.handles,i)&&(a=!0),(e.pointNearTool(o.element,s,i)&&!s.active||!e.pointNearTool(o.element,s,i)&&s.active)&&(s.active=!s.active,a=!0)}!0===a&&cornerstone.updateImage(o.element)}}}function a(t,o){function a(){r.invalidated=!0,anyHandlesOutsideImage(o,r.handles)&&removeToolState(i,e.toolType,r),cornerstone.updateImage(i),$(i).on("CornerstoneToolsMouseMove",o,e.mouseMoveCallback||n)}var r,i=o.element;if(isMouseButtonEnabled(o.which,t.data.mouseButtonMask)){var s=o.startPoints.canvas,l=getToolState(t.currentTarget,e.toolType);if(l){var c,u;for(u=!(!e.options||void 0===e.options.preventHandleOutsideImage)&&e.options.preventHandleOutsideImage,c=0;c<l.data.length;c++){r=l.data[c];var d=getHandleNearImagePoint(i,r.handles,s,6);if(d)return $(i).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||n),r.active=!0,moveHandle(o,e.toolType,r,d,a,u),t.stopImmediatePropagation(),!1}if(e.pointNearTool){var f=e.options||{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1};for(c=0;c<l.data.length;c++)if(r=l.data[c],r.active=!1,e.pointNearTool(i,r,s))return r.active=!0,$(i).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||n),moveAllHandles(t,r,l,e.toolType,f,a),t.stopImmediatePropagation(),!1}}}}function r(t){t.removeEventListener("CornerstoneImageRendered",e.onImageRendered),$(t).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||n),$(t).off("CornerstoneToolsMouseDown",e.mouseDownCallback||a),$(t).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||o),e.mouseDoubleClickCallback&&$(t).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),cornerstone.updateImage(t)}function i(t){t.removeEventListener("CornerstoneImageRendered",e.onImageRendered),$(t).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||n),$(t).off("CornerstoneToolsMouseDown",e.mouseDownCallback||a),$(t).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||o),e.mouseDoubleClickCallback&&$(t).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),t.addEventListener("CornerstoneImageRendered",e.onImageRendered),cornerstone.updateImage(t)}function s(t,r){var i={mouseButtonMask:r};t.removeEventListener("CornerstoneImageRendered",e.onImageRendered),$(t).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||n),$(t).off("CornerstoneToolsMouseDown",e.mouseDownCallback||a),$(t).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||o),t.addEventListener("CornerstoneImageRendered",e.onImageRendered),$(t).on("CornerstoneToolsMouseMove",i,e.mouseMoveCallback||n),$(t).on("CornerstoneToolsMouseDown",i,e.mouseDownCallback||a),$(t).on("CornerstoneToolsMouseDownActivate",i,e.mouseDownActivateCallback||o),e.mouseDoubleClickCallback&&($(t).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),$(t).on("CornerstoneToolsMouseDoubleClick",i,e.mouseDoubleClickCallback)),cornerstone.updateImage(t)}function l(t,r){var i={mouseButtonMask:r},s="CornerstoneToolsToolDeactivated",l={mouseButtonMask:r,toolType:e.toolType,type:s},c=$.Event(s,l);$(t).trigger(c,l),t.removeEventListener("CornerstoneImageRendered",e.onImageRendered),$(t).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||n),$(t).off("CornerstoneToolsMouseDown",e.mouseDownCallback||a),$(t).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||o),t.addEventListener("CornerstoneImageRendered",e.onImageRendered),$(t).on("CornerstoneToolsMouseMove",i,e.mouseMoveCallback||n),$(t).on("CornerstoneToolsMouseDown",i,e.mouseDownCallback||a),e.mouseDoubleClickCallback&&($(t).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),$(t).on("CornerstoneToolsMouseDoubleClick",i,e.mouseDoubleClickCallback)),cornerstone.updateImage(t)}function c(){return d}function u(e){d=e}var d={},f={enable:i,disable:r,activate:s,deactivate:l,getConfiguration:c,setConfiguration:u,mouseDownCallback:a,mouseMoveCallback:n,mouseDownActivateCallback:o};return e.pointNearTool&&(f.pointNearTool=e.pointNearTool),e.mouseDoubleClickCallback&&(f.mouseDoubleClickCallback=e.mouseDoubleClickCallback),e.addNewMeasurement&&(f.addNewMeasurement=e.addNewMeasurement),f}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,a,r){"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);var i=textStyle.getFont(),s=textStyle.getFontSize(),l=textStyle.getBackgroundColor();e.save(),e.font=i,e.textBaseline="top",e.strokeStyle=a;var c=0;t.forEach(function(t){var o=e.measureText(t).width;c=Math.max(c,o)}),e.fillStyle=l;var u={width:c+10,height:5+t.length*(s+5)};return r&&r.centering&&!0===r.centering.x&&(o-=u.width/2),r&&r.centering&&!0===r.centering.y&&(n-=u.height/2),u.left=o,u.top=n,r&&!0===r.debug&&(e.fillStyle="#FF0000"),e.fillRect(u.left,u.top,u.width,u.height),t.forEach(function(t,r){e.fillStyle=a;e.fillText(t,o+5,n+5+r*(s+5))}),e.restore(),u}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return 0!=(t&1<<e-1)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={};return{disable:function(t){t.removeEventListener("CornerstoneImageRendered",e)},enable:function(t){t.removeEventListener("CornerstoneImageRendered",e),t.addEventListener("CornerstoneImageRendered",e),cornerstone.updateImage(t)},getConfiguration:function(){return t},setConfiguration:function(e){t=e}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{activate:function(t){$(t).off("CornerstoneToolsMouseWheel",e);var o={};$(t).on("CornerstoneToolsMouseWheel",o,e)},disable:function(t){$(t).off("CornerstoneToolsMouseWheel",e)},enable:function(t){$(t).off("CornerstoneToolsMouseWheel",e)},deactivate:function(t){$(t).off("CornerstoneToolsMouseWheel",e)}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={};return{activate:function(t,o,n){$(t).off("CornerstoneToolsMouseDownActivate",e);var a={mouseButtonMask:o,options:n};$(t).on("CornerstoneToolsMouseDownActivate",a,e)},disable:function(t){$(t).off("CornerstoneToolsMouseDownActivate",e)},enable:function(t){$(t).off("CornerstoneToolsMouseDownActivate",e)},deactivate:function(t){$(t).off("CornerstoneToolsMouseDownActivate",e)},getConfiguration:function(){return t},setConfiguration:function(e){t=e}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o="CornerstoneToolsTouchDrag";return t&&!0===t.fireOnTouchStart&&(o+=" CornerstoneToolsTouchStart"),{activate:function(n){$(n).off(o,e),t&&t.eventData?$(n).on(o,t.eventData,e):$(n).on(o,e),t&&t.activateCallback&&t.activateCallback(n)},disable:function(n){$(n).off(o,e),t&&t.disableCallback&&t.disableCallback(n)},enable:function(n){$(n).off(o,e),t&&t.enableCallback&&t.enableCallback(n)},deactivate:function(n){$(n).off(o,e),t&&t.deactivateCallback&&t.deactivateCallback(n)}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{activate:function(t){$(t).off("CornerstoneToolsTouchPinch",e);var o={};$(t).on("CornerstoneToolsTouchPinch",o,e)},disable:function(t){$(t).off("CornerstoneToolsTouchPinch",e)},enable:function(t){$(t).off("CornerstoneToolsTouchPinch",e)},deactivate:function(t){$(t).off("CornerstoneToolsTouchPinch",e)}}}},function(e,t){throw new Error("Module build failed: SyntaxError: Unexpected token, expected { (369:7)\n\n[0m [90m 367 | [39m}\n [90m 368 | [39m\n[31m[1m>[22m[39m[90m 369 | [39m[36mexport[39m touchTool[33m;[39m\n [90m     | [39m       [31m[1m^[22m[39m[0m\n")},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o=e.image,n={left:0,top:0,width:o.width,height:o.height},a=!1;return Object.keys(t).forEach(function(e){var o=t[e];!0!==o.allowedOutsideImage&&!1===cornerstoneMath.point.insideRect(o,n)&&(a=!0)}),a}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.metaData=cornerstone.metaData},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.orientation=void 0;var a=o(104),r=n(a),i=o(105),s=n(i);t.orientation={getOrientationString:r.default,invertOrientationString:s.default}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(e){s=e}function t(){return s}function o(e){i=e}function n(){return i}function a(e){l=e}function r(){return l}var i=15,s=i+"px Arial",l="transparent";return{setFont:e,getFont:t,setFontSize:o,getFontSize:n,setBackgroundColor:a,getBackgroundColor:r}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(e){a=e}function t(){return a}function o(e){r=e}function n(){return r}var a=1,r=2;return{setToolWidth:e,getToolWidth:t,setActiveWidth:o,getActiveWidth:n}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,a){if(!e)throw"getLuminance: parameter element must not be undefined";t=Math.round(t),o=Math.round(o);var r,i,s,l=cornerstone.getEnabledElement(e),c=l.image,u=[],d=0,f=c.getPixelData();if(c.color)for(i=0;i<a;i++)for(s=0;s<n;s++){r=4*((i+o)*c.columns+(s+t));var g=f[r],m=f[r+1],v=f[r+2];u[d++]=.2126*g+.7152*m+.0722*v}else for(i=0;i<a;i++)for(s=0;s<n;s++)r=(i+o)*c.columns+(s+t),u[d++]=f[r]*c.slope+c.intercept;return u}},function(e,t,o){"use strict";function n(){var e,t=navigator.userAgent,o=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(o[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],"IE "+(e[1]||"")):"Chrome"===o[1]&&null!==(e=t.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(o=o[2]?[o[1],o[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(e=t.match(/version\/(\d+)/i))&&o.splice(1,1,e[1]),o.join(" "))}function a(){var e=stackPrefetch.getConfiguration();return e.maxSimultaneousRequests?e.maxSimultaneousRequests:r()}function r(){var e=n(),t=e.split(" "),o=t[0],a=t[1],r=s[o];return r?r[a]?r[a]:r.default:s.default}function i(){return!!new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini").test(navigator.userAgent)}Object.defineProperty(t,"__esModule",{value:!0});var s={default:6,IE:{9:6,10:8,default:8},Firefox:{default:6},Opera:{10:8,11:6,12:6,default:6},Chrome:{default:6},Safari:{default:6}};t.getDefaultSimultaneousRequests=r,t.getMaxSimultaneousRequests=a,t.getBrowserInfo=n,t.isMobileDevice=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.boundingBox)return cornerstoneMath.point.insideRect(t,e.boundingBox)}},function(e,t,o){"use strict";function n(e,t){var o=e.clone().sub(t.imagePositionPatient);return{x:t.rowCosines.dot(o)/t.columnPixelSpacing,y:t.columnCosines.dot(o)/t.rowPixelSpacing}}function a(e,t){var o=t.rowCosines.clone().multiplyScalar(e.x);o.multiplyScalar(t.columnPixelSpacing);var n=t.columnCosines.clone().multiplyScalar(e.y);n.multiplyScalar(t.rowPixelSpacing);var a=o.add(n);return a.add(t.imagePositionPatient),a}function r(e){var t=a({x:0,y:0},e),o=a({x:e.columns,y:0},e),n=a({x:0,y:e.rows},e),r=a({x:e.columns,y:e.rows},e);return{top:new cornerstoneMath.Line3(t,o),left:new cornerstoneMath.Line3(t,n),right:new cornerstoneMath.Line3(o,r),bottom:new cornerstoneMath.Line3(n,r)}}function i(e,t){var o=[];return Object.keys(t).forEach(function(n){var a=t[n],r=e.intersectLine(a);r&&o.push(r)}),o}function s(e,t){var o=e.rowCosines.clone().cross(e.columnCosines),n=new cornerstoneMath.Plane;n.setFromNormalAndCoplanarPoint(o,e.imagePositionPatient);var s=t.rowCosines.clone().cross(t.columnCosines),l=new cornerstoneMath.Plane;l.setFromNormalAndCoplanarPoint(s,t.imagePositionPatient);var c=l.clone().intersectPlane(n),u=c.origin,d=c.direction,f=a({x:t.columns,y:t.rows},t),g=t.imagePositionPatient.distanceTo(f),m=new cornerstoneMath.Line3;m.start=u,m.end=u.clone().add(d.multiplyScalar(g));var v=r(t),h=i(m,v);if(2===h.length)return{start:h[0],end:h[1]}}Object.defineProperty(t,"__esModule",{value:!0}),t.projectPatientPointToImagePlane=n,t.imagePointToPatientPoint=a,t.planePlaneIntersection=s},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o=Math.pow(10,t);return Math.round(e*o)/o}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){function o(o){if(r.currentImageIdIndex===t){try{cornerstone.getEnabledElement(e)}catch(e){return}cornerstone.displayImage(e,o,c),s&&s(e,o)}}function n(o){var n=r.imageIds[t];l&&l(e,n,o)}var a=getToolState(e,"stack");if(a&&a.data&&a.data.length){var r=a.data[0];t<0&&(t+=r.imageIds.length);var i=loadHandlerManager.getStartLoadHandler(),s=loadHandlerManager.getEndLoadHandler(),l=loadHandlerManager.getErrorLoadingHandler(),c=cornerstone.getViewport(e);if(t!==r.currentImageIdIndex){i&&i(e);var u={newImageIdIndex:t,direction:t-r.currentImageIdIndex};r.currentImageIdIndex=t;var d=r.imageIds[t],f=stackScroll.getConfiguration();if(f&&!0===f.retryLoadOnScroll){var g=cornerstone.imageCache.getImagePromise(d);g&&"rejected"===g.state()&&cornerstone.imageCache.removeImagePromise(d)}var m,v=!!r.preventCache;m=v?cornerstone.loadImage(d):cornerstone.loadAndCacheImage(d),m.then(o,n),requestPoolManager.startGrabbing(),$(e).trigger("CornerstoneStackScroll",u)}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o=(0,n.planePlaneIntersection)(e,t);if(o)return{start:(0,n.projectPatientPointToImagePlane)(o.start,e),end:(0,n.projectPatientPointToImagePlane)(o.end,e)}};var n=o(19)},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n){var a=cornerstone.getEnabledElement(o).image,i=cornerstone.getEnabledElement(n).image;if(a&&i){var l=cornerstone.metaData.get("imagePlane",a.imageId),u=cornerstone.metaData.get("imagePlane",i.imageId);if(l&&u&&l.rowCosines&&l.columnCosines&&l.imagePositionPatient&&u.rowCosines&&u.columnCosines&&u.imagePositionPatient&&l.frameOfReferenceUID===u.frameOfReferenceUID){var d=l.rowCosines.clone().cross(l.columnCosines),f=u.rowCosines.clone().cross(u.columnCosines),g=d.angleTo(f);if(!((g=Math.abs(g))<.5)){var m=(0,r.default)(l,u);if(m){var v=cornerstone.pixelToCanvas(t.element,m.start),h=cornerstone.pixelToCanvas(t.element,m.end),p=s.default.getActiveColor(),T=c.default.getToolWidth();e.setTransform(1,0,0,1,0,0),e.save(),e.beginPath(),e.strokeStyle=p,e.lineWidth=T,e.moveTo(v.x,v.y),e.lineTo(h.x,h.y),e.stroke(),e.restore()}}}}};var a=o(22),r=n(a),i=o(1),s=n(i),l=o(15),c=n(l)},function(e,t,o){"use strict";function n(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x-20,y:e.currentPoints.image.y+10,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x-20,y:e.currentPoints.image.y+10,highlight:!0,active:!1},end2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y+20,highlight:!0,active:!1}}}}function a(e,t,o){var n={start:cornerstone.pixelToCanvas(e,t.handles.start),end:cornerstone.pixelToCanvas(e,t.handles.end)},a=cornerstoneMath.lineSegment.distanceToPoint(n,o);return a<5||(n.start=cornerstone.pixelToCanvas(e,t.handles.start2),n.end=cornerstone.pixelToCanvas(e,t.handles.end2),(a=cornerstoneMath.lineSegment.distanceToPoint(n,o))<5)}function r(e){var t=e.detail,o=getToolState(e.currentTarget,i);if(void 0!==o){var n=t.canvasContext.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0);for(var a,r=toolStyle.getToolWidth(),s=textStyle.getFont(),l=p.getConfiguration(),c=0;c<o.data.length;c++){n.save(),l&&l.shadow&&(n.shadowColor=l.shadowColor||"#000000",n.shadowOffsetX=l.shadowOffsetX||1,n.shadowOffsetY=l.shadowOffsetY||1);var u=o.data[c];a=u.active?toolColors.getActiveColor():toolColors.getToolColor(),n.beginPath(),n.strokeStyle=a,n.lineWidth=r;var d=cornerstone.pixelToCanvas(t.element,u.handles.start),f=cornerstone.pixelToCanvas(t.element,u.handles.end);n.moveTo(d.x,d.y),n.lineTo(f.x,f.y),d=cornerstone.pixelToCanvas(t.element,u.handles.start2),f=cornerstone.pixelToCanvas(t.element,u.handles.end2),n.moveTo(d.x,d.y),n.lineTo(f.x,f.y),n.stroke(),drawHandles(n,t,u.handles),n.fillStyle=a;var g=(Math.ceil(u.handles.start.x)-Math.ceil(u.handles.end.x))*t.image.columnPixelSpacing,m=(Math.ceil(u.handles.start.y)-Math.ceil(u.handles.end.y))*t.image.rowPixelSpacing,v=(Math.ceil(u.handles.start2.x)-Math.ceil(u.handles.end2.x))*t.image.columnPixelSpacing,h=(Math.ceil(u.handles.start2.y)-Math.ceil(u.handles.end2.y))*t.image.rowPixelSpacing,p=Math.acos(Math.abs((g*v+m*h)/(Math.sqrt(g*g+m*m)*Math.sqrt(v*v+h*h))));p*=180/Math.PI;var T=roundToDecimal(p,2),y=T.toString()+String.fromCharCode(parseInt("00B0",16)),C=(d.x+f.x)/2,x=(d.y+f.y)/2;n.font=s,drawTextBox(n,y,C,x,a),n.restore()}}}Object.defineProperty(t,"__esModule",{value:!0});var i="angle",s=mouseButtonTool({createNewMeasurement:n,onImageRendered:r,pointNearTool:a,toolType:i}),l=touchTool({createNewMeasurement:n,onImageRendered:r,pointNearTool:a,toolType:i});t.angle=s,t.angleTouch=l},function(e,t,o){"use strict";function n(e){e(prompt("Enter your annotation:"))}function a(e,t,o){o(prompt("Change your annotation:"))}function r(e){function t(t){null!==t?o.text=t:removeToolState(e.element,f,o),o.active=!1,cornerstone.updateImage(e.element),$(e.element).on("CornerstoneToolsMouseMove",n,m.mouseMoveCallback),$(e.element).on("CornerstoneToolsMouseDown",n,m.mouseDownCallback),$(e.element).on("CornerstoneToolsMouseDownActivate",n,m.mouseDownActivateCallback),$(e.element).on("CornerstoneToolsMouseDoubleClick",n,m.mouseDoubleClickCallback)}var o=i(e),n={mouseButtonMask:e.which};addToolState(e.element,f,o),$(e.element).off("CornerstoneToolsMouseMove",m.mouseMoveCallback),$(e.element).off("CornerstoneToolsMouseDown",m.mouseDownCallback),$(e.element).off("CornerstoneToolsMouseDownActivate",m.mouseDownActivateCallback),$(e.element).off("CornerstoneToolsMouseDoubleClick",m.mouseDoubleClickCallback),cornerstone.updateImage(e.element),moveNewHandle(e,f,o,o.handles.end,function(){anyHandlesOutsideImage(e,o.handles)&&removeToolState(e.element,f,o);var n=m.getConfiguration();void 0===o.text&&n.getTextCallback(t),cornerstone.updateImage(e.element)})}function i(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function s(e,t,o){var n={start:cornerstone.pixelToCanvas(e,t.handles.start),end:cornerstone.pixelToCanvas(e,t.handles.end)};return cornerstoneMath.lineSegment.distanceToPoint(n,o)<25}function l(e){var t=e.detail,o=getToolState(e.currentTarget,f);if(o){var n=t.enabledElement,a=t.canvasContext.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);for(var r,i=toolStyle.getToolWidth(),s=textStyle.getFont(),l=m.getConfiguration(),c=0;c<o.data.length;c++){a.save(),l&&l.shadow&&(a.shadowColor=l.shadowColor||"#000000",a.shadowOffsetX=l.shadowOffsetX||1,a.shadowOffsetY=l.shadowOffsetY||1);var u=o.data[c];r=u.active?toolColors.getActiveColor():toolColors.getToolColor();var d=cornerstone.pixelToCanvas(t.element,u.handles.start),g=cornerstone.pixelToCanvas(t.element,u.handles.end);l.arrowFirst?drawArrow(a,g,d,r,i):drawArrow(a,d,g,r,i);var v={drawHandlesIfActive:l&&l.drawHandlesOnHover};if(l.drawHandles&&drawHandles(a,t,u.handles,r,v),u.text&&""!==u.text){a.font=s;var h=a.measureText(u.text).width+10,p=textStyle.getFontSize()+10,T=Math.max(h,p)/2+5;g.x<d.x&&(T=-T);var y;if(!u.handles.textBox.hasMoved){y=l.arrowFirst?{x:g.x-h/2+T,y:g.y-p/2}:{x:d.x-h/2-T,y:d.y-p/2};var C=cornerstone.internal.getTransform(n);C.invert();var x=C.transformPoint(y.x,y.y);u.handles.textBox.x=x.x,u.handles.textBox.y=x.y}y=cornerstone.pixelToCanvas(t.element,u.handles.textBox);var M=drawTextBox(a,u.text,y.x,y.y,r);if(u.handles.textBox.boundingBox=M,u.handles.textBox.hasMoved){var b={start:{},end:{}},P={x:(d.x+g.x)/2,y:(d.y+g.y)/2},w=[d,g,P];b.end.x=y.x,b.end.y=y.y,b.start=cornerstoneMath.point.findClosestPoint(w,b.end);var S=[{x:M.left+M.width/2,y:M.top},{x:M.left,y:M.top+M.height/2},{x:M.left+M.width/2,y:M.top+M.height},{x:M.left+M.width,y:M.top+M.height/2}];b.end=cornerstoneMath.point.findClosestPoint(S,b.start),a.beginPath(),a.strokeStyle=r,a.lineWidth=i,a.setLineDash([2,3]),a.moveTo(b.start.x,b.start.y),a.lineTo(b.end.x,b.end.y),a.stroke()}}a.restore()}}}function c(e){function t(e){null!==e?n.text=e:removeToolState(o,f,n),n.active=!1,cornerstone.updateImage(o),$(o).on("CornerstoneToolsTouchPress",v.pressCallback),$(o).on("CornerstoneToolsTouchStartActive",v.touchDownActivateCallback),$(o).on("CornerstoneToolsTap",v.tapCallback)}var o=e.element,n=i(e);addToolState(o,f,n),$(o).off("CornerstoneToolsTouchPress",v.pressCallback),$(o).off("CornerstoneToolsTouchStartActive",v.touchDownActivateCallback),$(o).off("CornerstoneToolsTap",v.tapCallback),cornerstone.updateImage(o),moveNewHandleTouch(e,f,n,n.handles.end,function(){cornerstone.updateImage(o),anyHandlesOutsideImage(e,n.handles)&&removeToolState(o,f,n);var a=m.getConfiguration();void 0===n.text&&a.getTextCallback(t)})}function u(e,t){function o(e,t,o){!0===o?removeToolState(a,f,e):e.text=t,e.active=!1,cornerstone.updateImage(a)}var n,a=t.element;if(!e.data||!e.data.mouseButtonMask||isMouseButtonEnabled(t.which,e.data.mouseButtonMask)){var r=m.getConfiguration(),i=t.currentPoints.canvas,l=getToolState(a,f);if(l)for(var c=0;c<l.data.length;c++)if(n=l.data[c],s(a,n,i)||pointInsideBoundingBox(n.handles.textBox,i))return n.active=!0,cornerstone.updateImage(a),r.changeTextCallback(n,t,o),e.stopImmediatePropagation(),!1}}function d(e,t){function o(e,t,o){console.log("pressCallback doneChangingTextCallback"),!0===o?removeToolState(a,f,e):e.text=t,e.active=!1,cornerstone.updateImage(a),$(a).on("CornerstoneToolsTouchStart",v.touchStartCallback),$(a).on("CornerstoneToolsTouchStartActive",v.touchDownActivateCallback),$(a).on("CornerstoneToolsTap",v.tapCallback)}var n,a=t.element;if(!e.data||!e.data.mouseButtonMask||isMouseButtonEnabled(t.which,e.data.mouseButtonMask)){var r=m.getConfiguration(),i=t.currentPoints.canvas,l=getToolState(a,f);if(l){if(t.handlePressed)return $(a).off("CornerstoneToolsTouchStart",v.touchStartCallback),$(a).off("CornerstoneToolsTouchStartActive",v.touchDownActivateCallback),$(a).off("CornerstoneToolsTap",v.tapCallback),r.changeTextCallback(t.handlePressed,t,o),e.stopImmediatePropagation(),!1;for(var c=0;c<l.data.length;c++)if(n=l.data[c],s(a,n,i)||pointInsideBoundingBox(n.handles.textBox,i))return n.active=!0,cornerstone.updateImage(a),$(a).off("CornerstoneToolsTouchStart",v.touchStartCallback),$(a).off("CornerstoneToolsTouchStartActive",v.touchDownActivateCallback),$(a).off("CornerstoneToolsTap",v.tapCallback),r.changeTextCallback(n,t,o),e.stopImmediatePropagation(),!1;return!1}}}Object.defineProperty(t,"__esModule",{value:!0});var f="arrowAnnotate",g={getTextCallback:n,changeTextCallback:a,drawHandles:!1,drawHandlesOnHover:!0,arrowFirst:!0},m=mouseButtonTool({addNewMeasurement:r,createNewMeasurement:i,onImageRendered:l,pointNearTool:s,toolType:f,mouseDoubleClickCallback:u});m.setConfiguration(g);var v=touchTool({addNewMeasurement:c,createNewMeasurement:i,onImageRendered:l,pointNearTool:s,toolType:f,pressCallback:d});t.arrowAnnotate=m,t.arrowAnnotateTouch=v},function(e,t,o){"use strict";function n(e,t){e.stopImmediatePropagation();var o=getToolState(e.currentTarget,m);if(o){var n=e.currentTarget,a=cornerstone.getEnabledElement(n),r=a.image.imageId,i=metaData.get("imagePlane",r),s=t.currentPoints.image,l=imagePointToPatientPoint(s,i),c=o.data[0].synchronizationContext,u=c.getSourceElements();$.each(u,function(e,t){if(t!==n){var o=Number.MAX_VALUE,a=-1,r=getToolState(t,"stack");if(void 0!==r){var i=r.data[0];if($.each(i.imageIds,function(e,t){var n=metaData.get("imagePlane",t),r=n.imagePositionPatient,i=n.rowCosines.clone(),s=n.columnCosines.clone(),c=s.clone().cross(i.clone()),u=Math.abs(c.clone().dot(r)-c.clone().dot(l));u<o&&(o=u,a=e)}),a!==i.currentImageIdIndex&&-1!==a&&void 0!==i.imageIds[a]){var s=loadHandlerManager.getStartLoadHandler(),c=loadHandlerManager.getEndLoadHandler(),u=loadHandlerManager.getErrorLoadingHandler();s&&s(t);var d;d=!0===i.preventCache?cornerstone.loadImage(i.imageIds[a]):cornerstone.loadAndCacheImage(i.imageIds[a]),d.then(function(e){var o=cornerstone.getViewport(t);i.currentImageIdIndex=a,cornerstone.displayImage(t,e,o),c&&c(t,e)},function(e){var o=i.imageIds[a];u&&u(t,o,e)})}}}})}}function a(e,t){$(t.element).off("CornerstoneToolsMouseDrag",i),$(t.element).off("CornerstoneToolsMouseUp",a)}function r(e,t){if(isMouseButtonEnabled(t.which,e.data.mouseButtonMask))return $(t.element).on("CornerstoneToolsMouseDrag",i),$(t.element).on("CornerstoneToolsMouseUp",a),n(e,t),!1}function i(e,t){return n(e,t),!1}function s(e,t,o){var n={mouseButtonMask:t};getToolState(e,m);addToolState(e,m,{synchronizationContext:o}),$(e).off("CornerstoneToolsMouseDown",r),$(e).on("CornerstoneToolsMouseDown",n,r)}function l(e){$(e).off("CornerstoneToolsMouseDown",r)}function c(e,t){$(t.element).off("CornerstoneToolsTouchDrag",d),$(t.element).off("CornerstoneToolsDragEnd",c)}function u(e,t){return $(t.element).on("CornerstoneToolsTouchDrag",d),$(t.element).on("CornerstoneToolsDragEnd",c),n(e,t),!1}function d(e,t){return n(e,t),!1}function f(e,t){getToolState(e,m);addToolState(e,m,{synchronizationContext:t}),$(e).off("CornerstoneToolsTouchStart",u),$(e).on("CornerstoneToolsTouchStart",u)}function g(e){$(e).off("CornerstoneToolsTouchStart",u)}Object.defineProperty(t,"__esModule",{value:!0});var m="crosshairs",v={activate:s,deactivate:l,enable:s,disable:l},h={activate:f,deactivate:g,enable:f,disable:g};t.crosshairs=v,t.crosshairsTouch=h},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{activate:function(t){$(t).off("CornerstoneToolsDoubleTap",e);var o={};$(t).on("CornerstoneToolsDoubleTap",o,e)},disable:function(t){$(t).off("CornerstoneToolsDoubleTap",e)},enable:function(t){$(t).off("CornerstoneToolsDoubleTap",e)},deactivate:function(t){$(t).off("CornerstoneToolsDoubleTap",e)}}}},function(e,t,o){"use strict";function n(e){cornerstone.fitToWindow(e.element)}function a(e,t){return r.strategy(t),!1}Object.defineProperty(t,"__esModule",{value:!0});var r=doubleTapTool(a);r.strategies={default:n},r.strategy=n,t.default=r},function(e,t,o){"use strict";function n(e){var t=cornerstone.getEnabledElement(e.element),o=t.canvas.getContext("2d");o.setTransform(1,0,0,1,0,0);var n=toolColors.getActiveColor(),a=textStyle.getFont(),r=textStyle.getFontSize(),i=u.getConfiguration();o.save(),i&&i.shadow&&(o.shadowColor=i.shadowColor||"#000000",o.shadowOffsetX=i.shadowOffsetX||1,o.shadowOffsetY=i.shadowOffsetY||1);var s,l,c,d=Math.round(e.currentPoints.image.x),f=Math.round(e.currentPoints.image.y);if(!(d<0||f<0||d>=e.image.columns||f>=e.image.rows)){if(e.image.color)s=getRGBPixels(e.element,d,f,1,1),l=d+", "+f,c="R: "+s[0]+" G: "+s[1]+" B: "+s[2]+" A: "+s[3];else{s=cornerstone.getStoredPixels(e.element,d,f,1,1);var g=s[0],m=g*e.image.slope+e.image.intercept,v=calculateSUV(e.image,g);l=d+", "+f,c="SP: "+g+" MO: "+parseFloat(m.toFixed(3)),v&&(c+=" SUV: "+parseFloat(v.toFixed(3)))}var h={x:e.currentPoints.image.x+3,y:e.currentPoints.image.y-3},p=cornerstone.pixelToCanvas(e.element,h);o.font=a,o.fillStyle=n,drawTextBox(o,c,p.x,p.y+r+5,n),drawTextBox(o,l,p.x,p.y,n),o.restore()}}function a(e){var t=e.element,o=cornerstone.getEnabledElement(t),n=o.image,a=o.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);var r=toolColors.getActiveColor(),i=textStyle.getFont(),s=u.getConfiguration();a.save(),s&&s.shadow&&(a.shadowColor=s.shadowColor||"#000000",a.shadowOffsetX=s.shadowOffsetX||1,a.shadowOffsetY=s.shadowOffsetY||1);var l,c=cornerstone.metaData.get("generalSeriesModule",n.imageId);c&&(l=c.modality);var d;d=!0===e.isTouchEvent?cornerstone.pageToPixel(t,e.currentPoints.page.x,e.currentPoints.page.y-4*textStyle.getFontSize()):cornerstone.pageToPixel(t,e.currentPoints.page.x,e.currentPoints.page.y-textStyle.getFontSize()/2);var f,g="";if(!(d.x<0||d.y<0||d.x>=n.columns||d.y>=n.rows)){if(n.color)f=getRGBPixels(t,d.x,d.y,1,1),g="R: "+f[0]+" G: "+f[1]+" B: "+f[2];else{f=cornerstone.getStoredPixels(t,d.x,d.y,1,1);var m=f[0],v=m*e.image.slope+e.image.intercept,h=parseFloat(v.toFixed(2));if("CT"===l)g+="HU: "+h;else if("PT"===l){g+=h;var p=calculateSUV(e.image,m);p&&(g+=" SUV: "+parseFloat(p.toFixed(2)))}else g+=h}var T=cornerstone.pixelToCanvas(t,d);a.font=i,a.fillStyle=r;var y,C=a.measureText(g).width;y=!0===e.isTouchEvent?{x:-C/2-5,y:-textStyle.getFontSize()-10-12}:{x:12,y:-(textStyle.getFontSize()+10)/2},a.beginPath(),a.strokeStyle=r,a.arc(T.x,T.y,6,0,2*Math.PI),a.stroke(),drawTextBox(a,g,T.x+y.x,T.y+y.y,r),a.restore()}}function r(e,t){var o=t.element;o.removeEventListener("CornerstoneImageRendered",s),$(o).off("CornerstoneToolsMouseDrag",l),$(o).off("CornerstoneToolsMouseUp",r),$(o).off("CornerstoneToolsMouseClick",r),cornerstone.updateImage(t.element)}function i(e,t){var o=t.element;if(isMouseButtonEnabled(t.which,e.data.mouseButtonMask))return o.addEventListener("CornerstoneImageRendered",s),$(o).on("CornerstoneToolsMouseDrag",l),$(o).on("CornerstoneToolsMouseUp",r),$(o).on("CornerstoneToolsMouseClick",r),u.strategy(t),!1}function s(){c&&(u.strategy(c),c=null)}function l(e,t){var o=t.element;return c=t,cornerstone.updateImage(o),!1}Object.defineProperty(t,"__esModule",{value:!0});var c,u=simpleMouseButtonTool(i);u.strategies={default:n,minimal:a},u.strategy=n;var d={fireOnTouchStart:!0},f=touchDragTool(l,d);t.dragProbe=u,t.dragProbeTouch=f},function(e,t,o){"use strict";function n(e){return{visible:!0,active:!0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function a(e,t,o,n){var a=cornerstone.pixelToCanvas(e,t.handles.start),r=cornerstone.pixelToCanvas(e,t.handles.end),i={left:Math.min(a.x,r.x)+n/2,top:Math.min(a.y,r.y)+n/2,width:Math.abs(a.x-r.x)-n,height:Math.abs(a.y-r.y)-n},s={left:Math.min(a.x,r.x)-n/2,top:Math.min(a.y,r.y)-n/2,width:Math.abs(a.x-r.x)+n,height:Math.abs(a.y-r.y)+n},l=pointInEllipse(i,o);return!(!pointInEllipse(s,o)||l)}function r(e,t,o){return a(e,t,o,15)}function i(e,t,o){return a(e,t,o,25)}function s(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function l(e){var t=e.detail,o=getToolState(e.currentTarget,c);if(o){var n,a=t.image,r=t.element,i=toolStyle.getToolWidth(),l=u.getConfiguration(),d=t.canvasContext.canvas.getContext("2d"),f=cornerstone.metaData.get("generalSeriesModule",a.imageId);f&&(n=f.modality),d.setTransform(1,0,0,1,0,0);for(var g=0;g<o.data.length;g++){d.save();var m=o.data[g];l&&l.shadow&&(d.shadowColor=l.shadowColor||"#000000",d.shadowOffsetX=l.shadowOffsetX||1,d.shadowOffsetY=l.shadowOffsetY||1);var v=toolColors.getColorIfActive(m.active),h=cornerstone.pixelToCanvas(r,m.handles.start),p=cornerstone.pixelToCanvas(r,m.handles.end),T=Math.min(h.x,p.x),y=Math.min(h.y,p.y),C=Math.abs(h.x-p.x),x=Math.abs(h.y-p.y);if(d.beginPath(),d.strokeStyle=v,d.lineWidth=i,drawEllipse(d,T,y,C,x),d.closePath(),l&&l.drawHandlesOnHover)if(!0===m.active)drawHandles(d,t,m.handles,v);else{var M={drawHandlesIfActive:!0};drawHandles(d,t,m.handles,v,M)}else drawHandles(d,t,m.handles,v);var b,P,w;if(m.invalidated){var S={left:Math.round(Math.min(m.handles.start.x,m.handles.end.x)),top:Math.round(Math.min(m.handles.start.y,m.handles.end.y)),width:Math.round(Math.abs(m.handles.start.x-m.handles.end.x)),height:Math.round(Math.abs(m.handles.start.y-m.handles.end.y))};if(!a.color){var I=cornerstone.getPixels(r,S.left,S.top,S.width,S.height);P=calculateEllipseStatistics(I,S),"PT"===n&&(w={mean:calculateSUV(a,(P.mean-a.intercept)/a.slope),stdDev:calculateSUV(a,(P.stdDev-a.intercept)/a.slope)}),P&&!isNaN(P.mean)&&(m.meanStdDev=P,m.meanStdDevSUV=w)}var k=a.columnPixelSpacing||1,$=a.rowPixelSpacing||1;b=Math.PI*(S.width*k/2)*(S.height*$/2),isNaN(b)||(m.area=b),m.invalidated=!1}else P=m.meanStdDev,w=m.meanStdDevSUV,b=m.area;var O=[];if(P&&void 0!==P.mean){var D="";"CT"===n&&(D=" HU");var E="Mean: "+s(P.mean.toFixed(2))+D,j="StdDev: "+s(P.stdDev.toFixed(2))+D;if(w&&void 0!==w.mean){E+=" SUV: "+s(w.mean.toFixed(2)),j+=" SUV: "+s(w.stdDev.toFixed(2))}O.push(E),O.push(j)}if(b){var _=" mm"+String.fromCharCode(178);a.rowPixelSpacing&&a.columnPixelSpacing||(_=" pixels"+String.fromCharCode(178));var B="Area: "+s(b.toFixed(2))+_;O.push(B)}m.handles.textBox.hasMoved||(m.handles.textBox.x=Math.max(m.handles.start.x,m.handles.end.x),m.handles.textBox.y=(m.handles.start.y+m.handles.end.y)/2);var R=cornerstone.pixelToCanvas(r,m.handles.textBox),H={centering:{x:!1,y:!0}},A=drawTextBox(d,O,R.x,R.y,v,H);if(m.handles.textBox.boundingBox=A,m.handles.textBox.hasMoved){var L={start:{},end:{x:R.x,y:R.y}},N=[{x:T+C/2,y:y},{x:T,y:y+x/2},{x:T+C/2,y:y+x},{x:T+C,y:y+x/2}];L.start=cornerstoneMath.point.findClosestPoint(N,L.end);var V=[{x:A.left+A.width/2,y:A.top},{x:A.left,y:A.top+A.height/2},{x:A.left+A.width/2,y:A.top+A.height},{x:A.left+A.width,y:A.top+A.height/2}];L.end=cornerstoneMath.point.findClosestPoint(V,L.start),d.beginPath(),d.strokeStyle=v,d.lineWidth=i,d.setLineDash([2,3]),d.moveTo(L.start.x,L.start.y),d.lineTo(L.end.x,L.end.y),d.stroke()}d.restore()}}}Object.defineProperty(t,"__esModule",{value:!0});var c="ellipticalRoi",u=mouseButtonTool({createNewMeasurement:n,onImageRendered:l,pointNearTool:r,toolType:c}),d=touchTool({createNewMeasurement:n,onImageRendered:l,pointNearTool:i,toolType:c});t.ellipticalRoi=u,t.ellipticalRoiTouch=d},function(e,t,o){"use strict";function n(e){var t=getToolState(e.element,T);if(void 0!==t){var o=C.getConfiguration(),n=t.data[o.currentTool],a={x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,lines:[]};n.handles.length&&n.handles[o.currentHandle-1].lines.push(e.currentPoints.image),n.handles.push(a),o.currentHandle+=1,o.freehand=!1,cornerstone.updateImage(e.element)}}function a(e,t){var o=getToolState(e.element,T);if(void 0!==o){var n=o.data[t];if(void 0!==n.handles)for(var a=e.currentPoints.canvas,r=0;r<n.handles.length;r++){var i=cornerstone.pixelToCanvas(e.element,n.handles[r]);if(cornerstoneMath.point.distance(i,a)<5)return r}}}function r(e){var t=getToolState(e.element,T);if(t)for(var o,n=0;n<t.data.length;n++)if(void 0!==(o=a(e,n)))return{handleNearby:o,toolIndex:n}}function i(e,t){if($(t.element).off("CornerstoneToolsMouseUp",i),void 0!==getToolState(t.element,T)){var o=C.getConfiguration();t.event.shiftKey||(o.freehand=!1),cornerstone.updateImage(t.element)}}function s(e,t){var o=getToolState(t.element,T);if(o){var n=C.getConfiguration(),r=o.data[n.currentTool],i=Math.max(t.currentPoints.image.x,0);i=Math.min(i,t.image.width),n.mouseLocation.handles.start.x=i;var s=Math.max(t.currentPoints.image.y,0);s=Math.min(s,t.image.height),n.mouseLocation.handles.start.y=s;var l=n.currentHandle;if(n.modifying&&(r.active=!0,r.highlight=!0,r.handles[l].x=n.mouseLocation.handles.start.x,r.handles[l].y=n.mouseLocation.handles.start.y,l)){var c=r.handles[l-1].lines.length-1,u=r.handles[l-1].lines[c];u.x=n.mouseLocation.handles.start.x,u.y=n.mouseLocation.handles.start.y}if(n.freehand)r.handles[l-1].lines.push(t.currentPoints.image);else{var d=a(t,n.currentTool);void 0!==d&&d<r.handles.length-1&&(n.mouseLocation.handles.start.x=r.handles[d].x,n.mouseLocation.handles.start.y=r.handles[d].y)}cornerstone.updateImage(t.element)}}function l(e){$(e.element).on("CornerstoneToolsMouseMove",s),$(e.element).on("CornerstoneToolsMouseUp",i);var t={visible:!0,active:!0,handles:[]},o=C.getConfiguration();o.mouseLocation.handles.start.x=e.currentPoints.image.x,o.mouseLocation.handles.start.y=e.currentPoints.image.y,addToolState(e.element,T,t);var n=getToolState(e.element,T);o.currentTool=n.data.length-1}function c(e,t){var o=getToolState(e.element,T);if(o){var n=C.getConfiguration(),a=o.data[n.currentTool];a.active=!1,a.highlight=!1,void 0!==t&&a.handles[n.currentHandle-1].lines.push({x:a.handles[t].x,y:a.handles[t].y}),n.modifying&&(n.modifying=!1),n.currentHandle=0,n.currentTool=-1,$(e.element).off("CornerstoneToolsMouseMove",s),cornerstone.updateImage(e.element)}}function u(e,t){if(isMouseButtonEnabled(t.which,e.data.mouseButtonMask)){var o,u,d=getToolState(t.element,T),f=C.getConfiguration(),g=f.currentTool;if(f.modifying)return void c(t);if(g<0){var m=r(t);m?(o=m.handleNearby,u=m.toolIndex,void 0!==o&&($(t.element).on("CornerstoneToolsMouseMove",s),$(t.element).on("CornerstoneToolsMouseUp",i),f.modifying=!0,f.currentHandle=o,f.currentTool=u)):(l(t),n(t))}else g>=0&&d.data[g].active&&(o=a(t,g),void 0!==o?c(t,o):t.event.shiftKey?f.freehand=!0:n(t));return!1}}function d(e){var t=e.detail,o=getToolState(e.currentTarget,T);if(void 0!==o){var n=C.getConfiguration(),a=t.canvasContext.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);for(var r,i=toolStyle.getToolWidth(),s=toolColors.getFillColor(),l=0;l<o.data.length;l++){a.save();var c=o.data[l];c.active?(r=toolColors.getActiveColor(),s=toolColors.getFillColor()):(r=toolColors.getToolColor(),s=toolColors.getToolColor());var u;if(c.handles.length)for(var d=0;d<c.handles.length;d++){u=c.handles[d];var f=cornerstone.pixelToCanvas(t.element,u);a.beginPath(),a.strokeStyle=r,a.lineWidth=i,a.moveTo(f.x,f.y);for(var g=0;g<c.handles[d].lines.length;g++){var m=cornerstone.pixelToCanvas(t.element,c.handles[d].lines[g]);a.lineTo(m.x,m.y),a.stroke()}var v=cornerstone.pixelToCanvas(t.element,n.mouseLocation.handles.start);d===c.handles.length-1&&(!c.active||n.freehand||n.modifying||(a.lineTo(v.x,v.y),a.stroke()))}var h={fill:s};c.active&&drawHandles(a,t,n.mouseLocation.handles,r,h),drawHandles(a,t,c.handles,r,h),a.restore()}}}function f(e){$(e).off("CornerstoneToolsMouseDown",u),$(e).off("CornerstoneToolsMouseUp",i),$(e).off("CornerstoneToolsMouseMove",s),e.removeEventListener("CornerstoneImageRendered",d),e.addEventListener("CornerstoneImageRendered",d),cornerstone.updateImage(e)}function g(e){$(e).off("CornerstoneToolsMouseDown",u),$(e).off("CornerstoneToolsMouseUp",i),$(e).off("CornerstoneToolsMouseMove",s),e.removeEventListener("CornerstoneImageRendered",d),cornerstone.updateImage(e)}function m(e,t){var o={mouseButtonMask:t};$(e).off("CornerstoneToolsMouseDown",o,u),$(e).off("CornerstoneToolsMouseUp",i),$(e).off("CornerstoneToolsMouseMove",s),e.removeEventListener("CornerstoneImageRendered",d),e.addEventListener("CornerstoneImageRendered",d),$(e).on("CornerstoneToolsMouseDown",o,u),cornerstone.updateImage(e)}function v(e){$(e).off("CornerstoneToolsMouseDown",u),$(e).off("CornerstoneToolsMouseUp",i),$(e).off("CornerstoneToolsMouseMove",s),e.removeEventListener("CornerstoneImageRendered",d),e.addEventListener("CornerstoneImageRendered",d),cornerstone.updateImage(e)}function h(){return y}function p(e){y=e}Object.defineProperty(t,"__esModule",{value:!0});var T="freehand",y={mouseLocation:{handles:{start:{highlight:!0,active:!0}}},freehand:!1,modifying:!1,currentHandle:0,currentTool:-1},C={enable:f,disable:g,activate:m,deactivate:v,getConfiguration:h,setConfiguration:p};t.freehand=C},function(e,t,o){"use strict";function n(e){var t=getToolState(e.event.currentTarget,s);if(!(t&&t.data&&t.data.length>0)){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}}function a(e,t,o){var n=cornerstone.pixelToCanvas(e,t.handles.start),a=cornerstone.pixelToCanvas(e,t.handles.end),r={left:Math.min(n.x,a.x),top:Math.min(n.y,a.y),width:Math.abs(n.x-a.x),height:Math.abs(n.y-a.y)},i=!1;return o.x>=r.left&&o.x<=r.left+r.width&&o.y>=r.top&&o.y<=r.top+r.height&&(i=!0),i}function r(e,t,o){var n=cornerstone.pixelToCanvas(e,t.handles.start),a=cornerstone.pixelToCanvas(e,t.handles.end),r={left:Math.min(n.x,a.x),top:Math.min(n.y,a.y),width:Math.abs(n.x-a.x),height:Math.abs(n.y-a.y)};return cornerstoneMath.rect.distanceToPoint(r,o)<5}function i(e){var t=e.detail,o=getToolState(e.currentTarget,s);if(void 0!==o){var n=t.canvasContext.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0);var a,r=toolStyle.getToolWidth();n.save();var i=o.data[0];if(i){a=i.active?toolColors.getActiveColor():toolColors.getToolColor();var l=cornerstone.pixelToCanvas(t.element,i.handles.start),c=cornerstone.pixelToCanvas(t.element,i.handles.end),u={left:Math.min(l.x,c.x),top:Math.min(l.y,c.y),width:Math.abs(l.x-c.x),height:Math.abs(l.y-c.y)};n.beginPath(),n.strokeStyle="transparent",n.rect(0,0,n.canvas.clientWidth,n.canvas.clientHeight),n.rect(u.width+u.left,u.top,-u.width,u.height),n.stroke(),n.fillStyle="rgba(0,0,0,0.7)",n.fill(),n.closePath(),n.beginPath(),n.strokeStyle=a,n.lineWidth=r,n.setLineDash([4]),n.strokeRect(u.left,u.top,u.width,u.height),n.setLineDash([]),drawHandles(n,t,i.handles,a),n.restore()}}}Object.defineProperty(t,"__esModule",{value:!0});var s="highlight",l=mouseButtonRectangleTool({createNewMeasurement:n,onImageRendered:i,pointNearTool:r,pointInsideRect:a,toolType:s},!0),c=touchTool({createNewMeasurement:n,onImageRendered:i,pointNearTool:r,pointInsideRect:a,toolType:s},!0);t.highlight=l,t.highlightTouch=c},function(e,t,o){"use strict";function n(e){var t=e.detail,o=t.image,n=o.stats,a=t.canvasContext.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);var r=[];Object.keys(n).forEach(function(e){var t=e+" : "+n[e];r.push(t)}),drawTextBox(a,r,0,0,"orange"),r.forEach(function(e){console.log(e)})}Object.defineProperty(t,"__esModule",{value:!0});var a=displayTool(n);t.default=a},function(e,t,o){"use strict";function n(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function a(e,t,o){var n={start:cornerstone.pixelToCanvas(e,t.handles.start),end:cornerstone.pixelToCanvas(e,t.handles.end)};return cornerstoneMath.lineSegment.distanceToPoint(n,o)<25}function r(e){var t=e.detail,o=getToolState(e.currentTarget,i);if(o){var n=t.canvasContext.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0);for(var a=toolStyle.getToolWidth(),r=v.getConfiguration(),s=0;s<o.data.length;s++){n.save(),r&&r.shadow&&(n.shadowColor=r.shadowColor||"#000000",n.shadowOffsetX=r.shadowOffsetX||1,n.shadowOffsetY=r.shadowOffsetY||1);var l=o.data[s],c=toolColors.getColorIfActive(l.active),u=cornerstone.pixelToCanvas(t.element,l.handles.start),d=cornerstone.pixelToCanvas(t.element,l.handles.end);n.beginPath(),n.strokeStyle=c,n.lineWidth=a,n.moveTo(u.x,u.y),n.lineTo(d.x,d.y),n.stroke();var f={drawHandlesIfActive:r&&r.drawHandlesOnHover};drawHandles(n,t,l.handles,c,f),n.fillStyle=c;var g=(l.handles.end.x-l.handles.start.x)*(t.image.columnPixelSpacing||1),m=(l.handles.end.y-l.handles.start.y)*(t.image.rowPixelSpacing||1),v=Math.sqrt(g*g+m*m);l.length=v;var h=" mm";t.image.rowPixelSpacing&&t.image.columnPixelSpacing||(h=" pixels");var p=""+v.toFixed(2)+h;if(!l.handles.textBox.hasMoved){var T={x:Math.max(l.handles.start.x,l.handles.end.x)};T.x===l.handles.start.x?T.y=l.handles.start.y:T.y=l.handles.end.y,l.handles.textBox.x=T.x,l.handles.textBox.y=T.y}var y=cornerstone.pixelToCanvas(t.element,l.handles.textBox);y.x+=10;var C={centering:{x:!1,y:!0}},x=drawTextBox(n,p,y.x,y.y,c,C);if(l.handles.textBox.boundingBox=x,l.handles.textBox.hasMoved){var M={start:{},end:{}},b={x:(u.x+d.x)/2,y:(u.y+d.y)/2},P=[u,d,b];M.end.x=y.x,M.end.y=y.y,M.start=cornerstoneMath.point.findClosestPoint(P,M.end);var w=[{x:x.left+x.width/2,y:x.top},{x:x.left,y:x.top+x.height/2},{x:x.left+x.width/2,y:x.top+x.height},{x:x.left+x.width,y:x.top+x.height/2}];M.end=cornerstoneMath.point.findClosestPoint(w,M.start),n.beginPath(),n.strokeStyle=c,n.lineWidth=a,n.setLineDash([2,3]),n.moveTo(M.start.x,M.start.y),n.lineTo(M.end.x,M.end.y),n.stroke()}n.restore()}}}Object.defineProperty(t,"__esModule",{value:!0});var i="length",s=mouseButtonTool({createNewMeasurement:n,onImageRendered:r,pointNearTool:a,toolType:i}),l=touchTool({createNewMeasurement:n,onImageRendered:r,pointNearTool:a,toolType:i});t.length=s,t.lengthTouch=l},function(e,t,o){"use strict";function n(e,t){var o=t.element;$(o).off("CornerstoneToolsMouseDrag",l),$(o).off("CornerstoneToolsMouseUp",n),$(o).off("CornerstoneToolsMouseClick",n),o.removeEventListener("CornerstoneNewImage",i),a(t)}function a(e){$(e.element).find(".magnifyTool").hide(),document.body.style.cursor="default"}function r(e,t){var o=t.element;if(isMouseButtonEnabled(t.which,e.data.mouseButtonMask))return $(t.element).on("CornerstoneToolsMouseDrag",t,l),$(t.element).on("CornerstoneToolsMouseUp",t,n),$(t.element).on("CornerstoneToolsMouseClick",t,n),T=t.currentPoints,o.addEventListener("CornerstoneNewImage",t,i),c(t),!1}function i(e){var t=e.detail;t.currentPoints=T,c(t)}function s(e,t){var o=t.element;$(t.element).off("CornerstoneToolsDragEnd",s),$(t.element).off("CornerstoneToolsTouchEnd",s),o.removeEventListener("CornerstoneNewImage",i),a(t)}function l(e,t){return T=t.currentPoints,c(t),!0===t.isTouchEvent&&($(t.element).on("CornerstoneToolsDragEnd",s),$(t.element).on("CornerstoneToolsTouchEnd",s)),!1}function c(e){var t=$(e.element).find(".magnifyTool").get(0);t||u(e.element);var o=t.getConfiguration(),n=o.magnifySize,a=o.magnificationLevel,r=$(e.element).find("canvas").not(".magnifyTool").get(0);r.getContext("2d").setTransform(1,0,0,1,0,0);var i=t.getContext("2d");i.setTransform(1,0,0,1,0,0);var s=n/a,l=cornerstone.pixelToCanvas(e.element,e.currentPoints.image);!0===e.isTouchEvent&&(l.y-=1.25*s),l.x=Math.max(l.x,0),l.x=Math.min(l.x,r.width),l.y=Math.max(l.y,0),l.y=Math.min(l.y,r.height),i.clearRect(0,0,n,n),i.fillStyle="transparent",i.fillRect(0,0,n,n);var c={x:l.x-.5*s,y:l.y-.5*s};"Safari"===p&&(c.x=Math.max(c.x,0),c.y=Math.max(c.y,0)),c.x=Math.min(c.x,r.width),c.y=Math.min(c.y,r.height);var d={x:(r.width-c.x)*a,y:(r.height-c.y)*a};i.drawImage(r,c.x,c.y,r.width-c.x,r.height-c.y,0,0,d.x,d.y),t.style.top=l.y-.5*n+"px",t.style.left=l.x-.5*n+"px",t.style.display="block",document.body.style.cursor="none"}function u(e){if(0===$(e).find(".magnifyTool").length){var t=document.createElement("canvas");t.classList.add("magnifyTool");var o=t.getConfiguration();t.width=o.magnifySize,t.height=o.magnifySize,t.style.position="absolute",e.appendChild(t)}}function d(e){$(e).find(".magnifyTool").remove()}function f(e){$(e).off("CornerstoneToolsMouseDown",r),d(e)}function g(e){var t=C.getConfiguration(t);if(!p){var o=getBrowserInfo(),n=o.split(" ");p=n[0]}u(e)}function m(e,t){var o={mouseButtonMask:t};$(e).off("CornerstoneToolsMouseDown",r),$(e).on("CornerstoneToolsMouseDown",o,r),u(e)}function v(){return y}function h(e){y=e}Object.defineProperty(t,"__esModule",{value:!0});var p,T,y={magnifySize:100,magnificationLevel:2},C={enable:g,activate:m,deactivate:f,disable:f,getConfiguration:v,setConfiguration:h},x={fireOnTouchStart:!0,activateCallback:u,disableCallback:d},M=touchDragTool(l,x);t.magnify=C,t.magnifyTouchDrag=M},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){function o(o){var n=e.createNewMeasurement(o);n&&(addToolState(o.element,e.toolType,n),$(o.element).off("CornerstoneToolsMouseMove",a),moveHandle(o,e.toolType,n,n.handles.end,function(){n.active=!1,anyHandlesOutsideImage(o,n.handles)&&removeToolState(o.element,e.toolType,n),$(o.element).on("CornerstoneToolsMouseMove",a)},t))}function n(e,t){if(isMouseButtonEnabled(t.which,e.data.mouseButtonMask))return o(t),!1}function a(t,o){if(toolCoordinates.setCoords(o),0===o.which){var n=getToolState(o.element,e.toolType);if(void 0!==n){for(var a=!1,r=o.currentPoints.canvas,i=0;i<n.data.length;i++){var s=n.data[i];!0===handleActivator(o.element,s.handles,r)&&(a=!0),(e.pointInsideRect(o.element,s,r)&&!s.active||!e.pointInsideRect(o.element,s,r)&&s.active)&&(s.active=!s.active,a=!0)}!0===a&&cornerstone.updateImage(o.element)}}}function r(o,n){function r(){i.active=!1,anyHandlesOutsideImage(n,i.handles)&&removeToolState(n.element,e.toolType,i),cornerstone.updateImage(n.element),$(n.element).on("CornerstoneToolsMouseMove",a)}var i;if(isMouseButtonEnabled(n.which,o.data.mouseButtonMask)){var s,l=n.startPoints.canvas,c=getToolState(o.currentTarget,e.toolType);if(void 0!==c)for(s=0;s<c.data.length;s++){i=c.data[s];var u=getHandleNearImagePoint(n.element,i.handles,l,25);if(void 0!==u)return $(n.element).off("CornerstoneToolsMouseMove",a),i.active=!0,moveHandle(n,e.toolType,i,u,r,t),o.stopImmediatePropagation(),!1}var d={deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:t};if(void 0!==c&&void 0!==e.pointInsideRect)for(s=0;s<c.data.length;s++)if(i=c.data[s],e.pointInsideRect(n.element,i,l))return $(n.element).off("CornerstoneToolsMouseMove",a),moveAllHandles(o,i,c,e.toolType,d,r),$(n.element).on("CornerstoneToolsMouseMove",a),o.stopImmediatePropagation(),!1}}function i(t){t.removeEventListener("CornerstoneImageRendered",e.onImageRendered),$(t).off("CornerstoneToolsMouseMove",a),$(t).off("CornerstoneToolsMouseDown",r),$(t).off("CornerstoneToolsMouseDownActivate",n),cornerstone.updateImage(t)}function s(t){t.removeEventListener("CornerstoneImageRendered",e.onImageRendered),$(t).off("CornerstoneToolsMouseMove",a),$(t).off("CornerstoneToolsMouseDown",r),$(t).off("CornerstoneToolsMouseDownActivate",n),t.addEventListener("CornerstoneImageRendered",e.onImageRendered),cornerstone.updateImage(t)}function l(t,o){var i={mouseButtonMask:o};t.removeEventListener("CornerstoneImageRendered",e.onImageRendered),$(t).off("CornerstoneToolsMouseMove",a),$(t).off("CornerstoneToolsMouseDown",r),$(t).off("CornerstoneToolsMouseDownActivate",n),t.addEventListener("CornerstoneImageRendered",e.onImageRendered),$(t).on("CornerstoneToolsMouseMove",i,a),$(t).on("CornerstoneToolsMouseDown",i,r),$(t).on("CornerstoneToolsMouseDownActivate",i,n),cornerstone.updateImage(t)}function c(t,o){var i={mouseButtonMask:o};t.removeEventListener("CornerstoneImageRendered",e.onImageRendered),$(t).off("CornerstoneToolsMouseMove",a),$(t).off("CornerstoneToolsMouseDown",r),$(t).off("CornerstoneToolsMouseDownActivate",n),t.addEventListener("CornerstoneImageRendered",e.onImageRendered),$(t).on("CornerstoneToolsMouseMove",i,a),$(t).on("CornerstoneToolsMouseDown",i,r),cornerstone.updateImage(t)}return{enable:s,disable:i,activate:l,deactivate:c}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o={},n="CornerstoneToolsMultiTouchDrag";return t&&!0===t.fireOnTouchStart&&(n+=" CornerstoneToolsMultiTouchStart"),{activate:function(o){$(o).off(n,e),t&&t.eventData?$(o).on(n,t.eventData,e):$(o).on(n,e),t&&t.activateCallback&&t.activateCallback(o)},disable:function(o){$(o).off(n,e),t&&t.disableCallback&&t.disableCallback(o)},enable:function(o){$(o).off(n,e),t&&t.enableCallback&&t.enableCallback(o)},deactivate:function(o){$(o).off(n,e),t&&t.deactivateCallback&&t.deactivateCallback(o)},getConfiguration:function(){return o},setConfiguration:function(e){o=e}}}},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=cornerstone.getEnabledElement(e),o=d.metaData.get("imagePlane",t.image.imageId);if(o&&o.rowCosines&&o.columnCosines){var n=l.default.getOrientationString(o.rowCosines),a=l.default.getOrientationString(o.columnCosines),r=l.default.invertOrientationString(n);return{top:l.default.invertOrientationString(a),bottom:a,left:r,right:n}}}function r(e){var t,o=cornerstone.getEnabledElement(e);t={x:o.image.width/2,y:5};var n=cornerstone.pixelToCanvas(e,t);t={x:o.image.width/2,y:o.image.height-5};var a=cornerstone.pixelToCanvas(e,t);t={x:5,y:o.image.height/2};var r=cornerstone.pixelToCanvas(e,t);return t={x:o.image.width-10,y:o.image.height/2},{top:n,bottom:a,left:r,right:cornerstone.pixelToCanvas(e,t)}}function i(e){var t=e.detail,o=t.element,n=a(o);if(n){var i=r(o,n),s=t.canvasContext.canvas.getContext("2d");s.setTransform(1,0,0,1,0,0);var l=toolColors.getToolColor(),c={top:s.measureText(n.top).width,left:s.measureText(n.left).width,right:s.measureText(n.right).width,bottom:s.measureText(n.bottom).width};drawTextBox(s,n.top,i.top.x-c.top/2,i.top.y,l),drawTextBox(s,n.left,i.left.x-c.left/2,i.left.y,l);var u=f.getConfiguration();u&&u.drawAllMarkers&&(drawTextBox(s,n.right,i.right.x-c.right/2,i.right.y,l),drawTextBox(s,n.bottom,i.bottom.x-c.bottom/2,i.bottom.y,l))}}Object.defineProperty(t,"__esModule",{value:!0});var s=o(13),l=n(s),c=o(5),u=n(c),d=o(12),f=(0,u.default)(i);t.default=f},function(e,t,o){"use strict";function n(e,t){$(t.element).off("CornerstoneToolsMouseDrag",r),$(t.element).off("CornerstoneToolsMouseUp",n),$(t.element).off("CornerstoneToolsMouseClick",n)}function a(e,t){if(isMouseButtonEnabled(t.which,e.data.mouseButtonMask))return $(t.element).on("CornerstoneToolsMouseDrag",r),$(t.element).on("CornerstoneToolsMouseUp",n),$(t.element).on("CornerstoneToolsMouseClick",n),!1}function r(e,t){var o=t.viewport.scale,n=t.viewport.scale;return t.image.rowPixelSpacing<t.image.columnPixelSpacing?o*=t.image.columnPixelSpacing/t.image.rowPixelSpacing:t.image.columnPixelSpacing<t.image.rowPixelSpacing&&(n*=t.image.rowPixelSpacing/t.image.columnPixelSpacing),t.viewport.translation.x+=t.deltaPoints.page.x/o,t.viewport.translation.y+=t.deltaPoints.page.y/n,cornerstone.setViewport(t.element,t.viewport),!1}Object.defineProperty(t,"__esModule",{value:!0});var i=simpleMouseButtonTool(a),s=touchDragTool(r);t.pan=i,t.panTouchDrag=s},function(e,t,o){"use strict";function n(e,t){var o=r.getConfiguration();if(o&&o.testPointers(t))return t.viewport.translation.x+=t.deltaPoints.page.x/t.viewport.scale,t.viewport.translation.y+=t.deltaPoints.page.y/t.viewport.scale,cornerstone.setViewport(t.element,t.viewport),!1}Object.defineProperty(t,"__esModule",{value:!0});var a={testPointers:function(e){return e.numPointers>=2}},r=multiTouchDragTool(n);r.setConfiguration(a),t.default=r},function(e,t,o){"use strict";function n(e){return{visible:!0,active:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}function a(e,t,o){var n=cornerstone.pixelToCanvas(e,t.handles.end);return cornerstoneMath.point.distance(n,o)<5}function r(e){var t=e.detail,o=getToolState(e.currentTarget,i);if(o){var n=t.canvasContext.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0);for(var a,r=textStyle.getFont(),s=textStyle.getFontSize(),l=0;l<o.data.length;l++){n.save();var c=o.data[l];a=c.active?toolColors.getActiveColor():toolColors.getToolColor(),drawHandles(n,t,c.handles,a);var u,d,f,g=Math.round(c.handles.end.x),m=Math.round(c.handles.end.y);if(g<0||m<0||g>=t.image.columns||m>=t.image.rows)return;if(t.image.color)d=g+", "+m,u=getRGBPixels(t.element,g,m,1,1),f="R: "+u[0]+" G: "+u[1]+" B: "+u[2];else{u=cornerstone.getStoredPixels(t.element,g,m,1,1);var v=u[0],h=v*t.image.slope+t.image.intercept,p=calculateSUV(t.image,v);d=g+", "+m,f="SP: "+v+" MO: "+parseFloat(h.toFixed(3)),p&&(f+=" SUV: "+parseFloat(p.toFixed(3)))}var T={x:c.handles.end.x+3,y:c.handles.end.y-3},y=cornerstone.pixelToCanvas(t.element,T);n.font=r,n.fillStyle=a,drawTextBox(n,f,y.x,y.y+s+5,a),drawTextBox(n,d,y.x,y.y,a),n.restore()}}}Object.defineProperty(t,"__esModule",{value:!0});var i="probe",s=mouseButtonTool({createNewMeasurement:n,onImageRendered:r,pointNearTool:a,toolType:i}),l=touchTool({createNewMeasurement:n,onImageRendered:r,pointNearTool:a,toolType:i});t.probe=s,t.probeTouch=l},function(e,t,o){"use strict";function n(e){return{visible:!0,active:!0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function a(e,t,o){var n=cornerstone.pixelToCanvas(e,t.handles.start),a=cornerstone.pixelToCanvas(e,t.handles.end),r={left:Math.min(n.x,a.x),top:Math.min(n.y,a.y),width:Math.abs(n.x-a.x),height:Math.abs(n.y-a.y)};return cornerstoneMath.rect.distanceToPoint(r,o)<5}function r(e,t){for(var o=0,n=0,a=0,r=0,i=t.top;i<t.top+t.height;i++)for(var s=t.left;s<t.left+t.width;s++)o+=e[r],n+=e[r]*e[r],a++,r++;if(0===a)return{count:a,mean:0,variance:0,stdDev:0};var l=o/a,c=n/a-l*l;return{count:a,mean:l,variance:c,stdDev:Math.sqrt(c)}}function i(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function s(e){var t=e.detail,o=getToolState(e.currentTarget,l);if(o){var n,a=t.image,s=t.element,c=toolStyle.getToolWidth(),u=rectangleRoi.getConfiguration(),d=t.canvasContext.canvas.getContext("2d"),f=cornerstone.metaData.get("generalSeriesModule",a.imageId);f&&(n=f.modality),d.setTransform(1,0,0,1,0,0);for(var g=0;g<o.data.length;g++){d.save();var m=o.data[g];u&&u.shadow&&(d.shadowColor=u.shadowColor||"#000000",d.shadowOffsetX=u.shadowOffsetX||1,d.shadowOffsetY=u.shadowOffsetY||1);var v=toolColors.getColorIfActive(m.active),h=cornerstone.pixelToCanvas(s,m.handles.start),p=cornerstone.pixelToCanvas(s,m.handles.end),T=Math.min(h.x,p.x),y=Math.min(h.y,p.y),C=Math.abs(h.x-p.x),x=Math.abs(h.y-p.y);if(d.beginPath(),d.strokeStyle=v,d.lineWidth=c,d.rect(T,y,C,x),d.stroke(),u&&u.drawHandlesOnHover)if(!0===m.active)drawHandles(d,t,m.handles,v);else{var M={drawHandlesIfActive:!0};drawHandles(d,t,m.handles,v,M)}else drawHandles(d,t,m.handles,v);var b,P,w;if(m.invalidated){var S={left:Math.min(m.handles.start.x,m.handles.end.x),top:Math.min(m.handles.start.y,m.handles.end.y),width:Math.abs(m.handles.start.x-m.handles.end.x),height:Math.abs(m.handles.start.y-m.handles.end.y)};if(!a.color){P=r(cornerstone.getPixels(s,S.left,S.top,S.width,S.height),S),"PT"===n&&(w={mean:calculateSUV(a,(P.mean-a.intercept)/a.slope),stdDev:calculateSUV(a,(P.stdDev-a.intercept)/a.slope)}),P&&!isNaN(P.mean)&&(m.meanStdDev=P,m.meanStdDevSUV=w)}b=S.width*(a.columnPixelSpacing||1)*(S.height*(a.rowPixelSpacing||1)),isNaN(b)||(m.area=b),m.invalidated=!1}else P=m.meanStdDev,w=m.meanStdDevSUV,b=m.area;var I=[];if(P&&P.mean){var k="";"CT"===n&&(k=" HU");var $="Mean: "+i(P.mean.toFixed(2))+k,O="StdDev: "+i(P.stdDev.toFixed(2))+k;if(w&&void 0!==w.mean){$+=" SUV: "+i(w.mean.toFixed(2)),O+=" SUV: "+i(w.stdDev.toFixed(2))}I.push($),I.push(O)}if(b){var D=" mm"+String.fromCharCode(178);a.rowPixelSpacing&&a.columnPixelSpacing||(D=" pixels"+String.fromCharCode(178));var E="Area: "+i(b.toFixed(2))+D;I.push(E)}m.handles.textBox.hasMoved||(m.handles.textBox.x=Math.max(m.handles.start.x,m.handles.end.x),m.handles.textBox.y=(m.handles.start.y+m.handles.end.y)/2);var j=cornerstone.pixelToCanvas(s,m.handles.textBox),_={centering:{x:!1,y:!0}},B=drawTextBox(d,I,j.x,j.y,v,_);if(m.handles.textBox.boundingBox=B,m.handles.textBox.hasMoved){var R={start:{},end:{x:j.x,y:j.y}},H=[{x:T+C/2,y:y},{x:T,y:y+x/2},{x:T+C/2,y:y+x},{x:T+C,y:y+x/2}];R.start=cornerstoneMath.point.findClosestPoint(H,R.end);var A=[{x:B.left+B.width/2,y:B.top},{x:B.left,y:B.top+B.height/2},{x:B.left+B.width/2,y:B.top+B.height},{x:B.left+B.width,y:B.top+B.height/2}];R.end=cornerstoneMath.point.findClosestPoint(A,R.start),d.beginPath(),d.strokeStyle=v,d.lineWidth=c,d.setLineDash([2,3]),d.moveTo(R.start.x,R.start.y),d.lineTo(R.end.x,R.end.y),d.stroke()}d.restore()}}}Object.defineProperty(t,"__esModule",{value:!0});var l="rectangleRoi";t.rectangleRoi=rectangleRoi=mouseButtonTool({createNewMeasurement:n,onImageRendered:s,pointNearTool:a,toolType:l}),t.rectangleRoiTouch=rectangleRoiTouch=touchTool({createNewMeasurement:n,onImageRendered:s,pointNearTool:a,toolType:l}),t.rectangleRoi=rectangleRoi,t.rectangleRoiTouch=rectangleRoiTouch},function(e,t,o){"use strict";function n(e){var t=e.element.getBoundingClientRect(e.element),o={x:e.currentPoints.client.x,y:e.currentPoints.client.y},n=e.element.clientWidth,a=e.element.clientHeight,r={x:o.x-t.left-n/2,y:-1*(o.y-t.top-a/2)},i=Math.atan2(r.y,r.x),s=i*(180/Math.PI),l=-1*s+90;e.viewport.rotation=l,cornerstone.setViewport(e.element,e.viewport)}function a(e){e.viewport.rotation+=e.deltaPoints.page.x/e.viewport.scale,cornerstone.setViewport(e.element,e.viewport)}function r(e){e.viewport.rotation+=e.deltaPoints.page.y/e.viewport.scale,cornerstone.setViewport(e.element,e.viewport)}function i(e,t){$(t.element).off("CornerstoneToolsMouseDrag",l),$(t.element).off("CornerstoneToolsMouseUp",i),$(t.element).off("CornerstoneToolsMouseClick",i)}function s(e,t){if(isMouseButtonEnabled(t.which,e.data.mouseButtonMask))return $(t.element).on("CornerstoneToolsMouseDrag",l),$(t.element).on("CornerstoneToolsMouseUp",i),$(t.element).on("CornerstoneToolsMouseClick",i),!1}function l(e,t){return c.strategy(t),cornerstone.setViewport(t.element,t.viewport),!1}Object.defineProperty(t,"__esModule",{value:!0});var c=simpleMouseButtonTool(s);c.strategies={default:n,horizontal:a,vertical:r},c.strategy=n;var u=touchDragTool(l);t.rotate=c,t.rotateTouchDrag=u},function(e,t,o){"use strict";function n(e,t){return t.viewport.rotation+=t.rotation,cornerstone.setViewport(t.element,t.viewport),!1}function a(e){$(e).off("CornerstoneToolsTouchRotate",n)}function r(e){$(e).off("CornerstoneToolsTouchRotate",n),$(e).on("CornerstoneToolsTouchRotate",n)}Object.defineProperty(t,"__esModule",{value:!0});var i={activate:r,disable:a};t.default=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o=$(e).find("canvas").get(0),n=document.createElement("a");if(n.download=t,n.href=o.toDataURL(),document.createEvent){var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(a)}else n.fireEvent&&n.fireEvent("onclick")}},function(e,t,o){"use strict";function n(e){e(prompt("Enter your annotation:"))}function a(e,t,o){o(prompt("Change your annotation:"))}function r(e){function t(e){null!==e?a.text=e:(0,f.removeToolState)(o,g,a),a.active=!1,cornerstone.updateImage(o)}var o=e.element,n=v.getConfiguration(),a=i(e);(0,f.addToolState)(o,g,a),cornerstone.updateImage(o),moveHandle(e,g,a,a.handles.end,function(){anyHandlesOutsideImage(e,a.handles)&&(0,f.removeToolState)(o,g,a),void 0===a.text&&n.getTextCallback(t),cornerstone.updateImage(o)})}function i(e){return{visible:!0,active:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function s(e,t,o){if(t.handles.end){var n=cornerstone.pixelToCanvas(e,t.handles.end);return cornerstoneMath.point.distance(n,o)<25}}function l(e){var t=e.detail,o=(0,f.getToolState)(e.currentTarget,g);if(o){var n=t.enabledElement,a=t.canvasContext.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);for(var r,i=t.canvasContext.canvas.width,s=toolStyle.getToolWidth(),l=textStyle.getFont(),c=v.getConfiguration(),u=0;u<o.data.length;u++){a.save(),c&&c.shadow&&(a.shadowColor=c.shadowColor||"#000000",a.shadowOffsetX=c.shadowOffsetX||1,a.shadowOffsetY=c.shadowOffsetY||1);var d=o.data[u];r=d.active?toolColors.getActiveColor():toolColors.getToolColor();var m=cornerstone.pixelToCanvas(t.element,d.handles.end);drawCircle(a,m,r,s);var h={drawHandlesIfActive:c&&c.drawHandlesOnHover};if(c.drawHandles&&drawHandles(a,t,m,r,h),d.text&&""!==d.text){a.font=l;var p="";p=c.showCoordinates?d.text+" x: "+Math.round(d.handles.end.x)+" y: "+Math.round(d.handles.end.y):d.text;var T=a.measureText(p).width+10,y=textStyle.getFontSize()+10,C=Math.max(T,y)/2+5;m.x>i/2&&(C=-C);var x;if(!d.handles.textBox.hasMoved){x={x:m.x-T/2+C,y:m.y-y/2};var M=cornerstone.internal.getTransform(n);M.invert();var b=M.transformPoint(x.x,x.y);d.handles.textBox.x=b.x,d.handles.textBox.y=b.y}x=cornerstone.pixelToCanvas(t.element,d.handles.textBox);var P=drawTextBox(a,p,x.x,x.y,r);if(d.handles.textBox.boundingBox=P,d.handles.textBox.hasMoved){var w={start:{},end:{}};w.end.x=x.x,w.end.y=x.y,w.start=m;var S=[{x:P.left+P.width/2,y:P.top},{x:P.left,y:P.top+P.height/2},{x:P.left+P.width/2,y:P.top+P.height},{x:P.left+P.width,y:P.top+P.height/2}];w.end=cornerstoneMath.point.findClosestPoint(S,w.start),a.beginPath(),a.strokeStyle=r,a.lineWidth=s,a.setLineDash([2,3]),a.moveTo(w.start.x,w.start.y),a.lineTo(w.end.x,w.end.y),a.stroke()}}a.restore()}}}function c(e){function t(e){null!==e?a.text=e:(0,f.removeToolState)(o,g,a),a.active=!1,cornerstone.updateImage(o)}var o=e.element,n=v.getConfiguration(),a=i(e);(0,f.addToolState)(o,g,a),cornerstone.updateImage(o),moveHandle(e,g,a,a.handles.end,function(){anyHandlesOutsideImage(e,a.handles)&&(0,f.removeToolState)(o,g,a),void 0===a.text&&n.getTextCallback(t),cornerstone.updateImage(o)})}function u(e,t){function o(e,t,o){!0===o?(0,f.removeToolState)(a,g,e):e.text=t,e.active=!1,cornerstone.updateImage(a)}var n,a=t.element;if(!e.data||!e.data.mouseButtonMask||isMouseButtonEnabled(t.which,e.data.mouseButtonMask)){var r=v.getConfiguration(),i=t.currentPoints.canvas,l=(0,f.getToolState)(a,g);if(l){for(var c=0;c<l.data.length;c++)if(n=l.data[c],s(a,n,i)||pointInsideBoundingBox(n.handles.textBox,i))return n.active=!0,cornerstone.updateImage(a),r.changeTextCallback(n,t,o),e.stopImmediatePropagation(),!1;return!1}}}function d(e,t){function o(e,t,o){console.log("pressCallback doneChangingTextCallback"),!0===o?(0,f.removeToolState)(a,g,e):e.text=t,e.active=!1,cornerstone.updateImage(a),$(a).on("CornerstoneToolsTouchStart",h.touchStartCallback),$(a).on("CornerstoneToolsTouchStartActive",h.touchDownActivateCallback),$(a).on("CornerstoneToolsTap",h.tapCallback)}var n,a=t.element;if(e.data&&e.data.mouseButtonMask&&!isMouseButtonEnabled(t.which,e.data.mouseButtonMask))return!1;var r=v.getConfiguration(),i=t.currentPoints.canvas,l=(0,f.getToolState)(a,g);if(!l)return!1;if(t.handlePressed)return $(a).off("CornerstoneToolsTouchStart",h.touchStartCallback),$(a).off("CornerstoneToolsTouchStartActive",h.touchDownActivateCallback),$(a).off("CornerstoneToolsTap",h.tapCallback),r.changeTextCallback(t.handlePressed,t,o),e.stopImmediatePropagation(),!1;for(var c=0;c<l.data.length;c++)if(n=l.data[c],s(a,n,i)||pointInsideBoundingBox(n.handles.textBox,i))return n.active=!0,cornerstone.updateImage(a),$(a).off("CornerstoneToolsTouchStart",h.touchStartCallback),$(a).off("CornerstoneToolsTouchStartActive",h.touchDownActivateCallback),$(a).off("CornerstoneToolsTap",h.tapCallback),r.changeTextCallback(n,t,o),e.stopImmediatePropagation(),!1;return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.seedAnnotateTouch=t.seedAnnotate=void 0;var f=o(0),g="seedAnnotate",m={getTextCallback:n,changeTextCallback:a,drawHandles:!1,drawHandlesOnHover:!0,currentLetter:"A",currentNumber:0,showCoordinates:!0,countUp:!0},v=mouseButtonTool({addNewMeasurement:r,createNewMeasurement:i,onImageRendered:l,pointNearTool:s,toolType:g,mouseDoubleClickCallback:u});v.setConfiguration(m);var h=touchTool({addNewMeasurement:c,createNewMeasurement:i,onImageRendered:l,pointNearTool:s,toolType:g,pressCallback:d});t.seedAnnotate=v,t.seedAnnotateTouch=h},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function r(e,t,o){var n={start:cornerstone.pixelToCanvas(e,t.handles.start),end:cornerstone.pixelToCanvas(e,t.handles.middle)},a=cornerstoneMath.lineSegment.distanceToPoint(n,o);return a<25||(n.start=cornerstone.pixelToCanvas(e,t.handles.middle),n.end=cornerstone.pixelToCanvas(e,t.handles.end),(a=cornerstoneMath.lineSegment.distanceToPoint(n,o))<25)}function i(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function s(e){var t=e.detail,o=(0,M.getToolState)(e.currentTarget,b);if(o){var n=t.enabledElement,a=t.canvasContext.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);for(var r,s=toolStyle.getToolWidth(),l=p.default.getFont(),c=P.getConfiguration(),u=0;u<o.data.length;u++){a.save(),c&&c.shadow&&(a.shadowColor=c.shadowColor||"#000000",a.shadowOffsetX=c.shadowOffsetX||1,a.shadowOffsetY=c.shadowOffsetY||1);var d=o.data[u];r=d.active?y.default.getActiveColor():y.default.getToolColor();var f=cornerstone.pixelToCanvas(t.element,d.handles.start),m=cornerstone.pixelToCanvas(t.element,d.handles.middle),h=cornerstone.pixelToCanvas(t.element,d.handles.end);a.beginPath(),a.strokeStyle=r,a.lineWidth=s,a.moveTo(f.x,f.y),a.lineTo(m.x,m.y),a.lineTo(h.x,h.y),a.stroke();var T={drawHandlesIfActive:c&&c.drawHandlesOnHover};drawHandles(a,t,d.handles,r,T),a.fillStyle=r;var C=t.image.columnPixelSpacing||1,x=t.image.rowPixelSpacing||1,w="";t.image.rowPixelSpacing&&t.image.columnPixelSpacing||(w=" (isotropic)");var S={x:(Math.ceil(d.handles.middle.x)-Math.ceil(d.handles.start.x))*C,y:(Math.ceil(d.handles.middle.y)-Math.ceil(d.handles.start.y))*x},I={x:(Math.ceil(d.handles.end.x)-Math.ceil(d.handles.middle.x))*C,y:(Math.ceil(d.handles.end.y)-Math.ceil(d.handles.middle.y))*x},k={x:(Math.ceil(d.handles.end.x)-Math.ceil(d.handles.start.x))*C,y:(Math.ceil(d.handles.end.y)-Math.ceil(d.handles.start.y))*x},$=i(S),O=i(I),D=i(k),E=Math.acos((Math.pow($,2)+Math.pow(O,2)-Math.pow(D,2))/(2*$*O));E*=180/Math.PI;var j=(0,v.default)(E,2);if(j){var _,B=j.toString()+String.fromCharCode(parseInt("00B0",16))+w;if(d.handles.textBox.hasMoved)_=cornerstone.pixelToCanvas(t.element,d.handles.textBox);else{_={x:m.x,y:m.y},a.font=l;var R=a.measureText(B).width;m.x<f.x?_.x-=15+R+10:_.x+=15;var H=cornerstone.internal.getTransform(n);H.invert();var A=H.transformPoint(_.x,_.y);d.handles.textBox.x=A.x,d.handles.textBox.y=A.y}var L={centering:{x:!1,y:!0}},N=(0,g.default)(a,B,_.x,_.y,r,L);if(d.handles.textBox.boundingBox=N,d.handles.textBox.hasMoved){var V={start:{},end:{}},W=[f,h,m];V.end.x=_.x,V.end.y=_.y,V.start=cornerstoneMath.point.findClosestPoint(W,V.end);var z=[{x:N.left+N.width/2,y:N.top},{x:N.left,y:N.top+N.height/2},{x:N.left+N.width/2,y:N.top+N.height},{x:N.left+N.width,y:N.top+N.height/2}];V.end=cornerstoneMath.point.findClosestPoint(z,V.start),a.beginPath(),a.strokeStyle=r,a.lineWidth=s,a.setLineDash([2,3]),a.moveTo(V.start.x,V.start.y),a.lineTo(V.end.x,V.end.y),a.stroke()}}a.restore()}}}function l(e){var t=a(e),o=e.element,n={mouseButtonMask:e.which};(0,M.addToolState)(o,b,t),$(o).off("CornerstoneToolsMouseMove",P.mouseMoveCallback),$(o).off("CornerstoneToolsMouseDrag",P.mouseMoveCallback),$(o).off("CornerstoneToolsMouseDown",P.mouseDownCallback),$(o).off("CornerstoneToolsMouseDownActivate",P.mouseDownActivateCallback),cornerstone.updateImage(o),moveNewHandle(e,b,t,t.handles.middle,function(){if(t.active=!1,(0,x.default)(e,t.handles))return(0,M.removeToolState)(o,b,t),$(o).on("CornerstoneToolsMouseMove",P.mouseMoveCallback),$(o).on("CornerstoneToolsMouseDrag",P.mouseMoveCallback),$(o).on("CornerstoneToolsMouseDown",n,P.mouseDownCallback),$(o).on("CornerstoneToolsMouseDownActivate",n,P.mouseDownActivateCallback),void cornerstone.updateImage(o);t.handles.end.active=!0,cornerstone.updateImage(o),moveNewHandle(e,b,t,t.handles.end,function(){t.active=!1,(0,x.default)(e,t.handles)&&(0,M.removeToolState)(o,b,t),$(o).on("CornerstoneToolsMouseMove",P.mouseMoveCallback),$(o).on("CornerstoneToolsMouseDrag",P.mouseMoveCallback),$(o).on("CornerstoneToolsMouseDown",n,P.mouseDownCallback),$(o).on("CornerstoneToolsMouseDownActivate",n,P.mouseDownActivateCallback),cornerstone.updateImage(o)})})}function c(e){var t=a(e),o=e.element;(0,M.addToolState)(o,b,t),$(o).off("CornerstoneToolsTouchDrag",w.touchMoveCallback),$(o).off("CornerstoneToolsTouchStartActive",w.touchDownActivateCallback),$(o).off("CornerstoneToolsTouchStart",w.touchStartCallback),$(o).off("CornerstoneToolsTap",w.tapCallback),cornerstone.updateImage(o),moveNewHandleTouch(e,b,t,t.handles.middle,function(){if((0,x.default)(e,t.handles))return(0,M.removeToolState)(o,b,t),$(o).on("CornerstoneToolsTouchDrag",w.touchMoveCallback),$(o).on("CornerstoneToolsTouchStart",w.touchStartCallback),$(o).on("CornerstoneToolsTouchStartActive",w.touchDownActivateCallback),$(o).on("CornerstoneToolsTap",w.tapCallback),void cornerstone.updateImage(o);moveNewHandleTouch(e,b,t,t.handles.end,function(){(0,x.default)(e,t.handles)&&((0,M.removeToolState)(o,b,t),cornerstone.updateImage(o)),$(o).on("CornerstoneToolsTouchDrag",w.touchMoveCallback),$(o).on("CornerstoneToolsTouchStart",w.touchStartCallback),$(o).on("CornerstoneToolsTouchStartActive",w.touchDownActivateCallback),$(o).on("CornerstoneToolsTap",w.tapCallback)})})}Object.defineProperty(t,"__esModule",{value:!0}),t.simpleAngleTouch=t.simpleAngle=void 0;var u=o(2),d=n(u),f=o(3),g=n(f),m=o(20),v=n(m),h=o(14),p=n(h),T=o(1),y=n(T),C=o(11),x=n(C),M=o(0),b="simpleAngle",P=(0,d.default)({createNewMeasurement:a,addNewMeasurement:l,onImageRendered:s,pointNearTool:r,toolType:b}),w=touchTool({createNewMeasurement:a,addNewMeasurement:c,onImageRendered:s,pointNearTool:r,toolType:b});t.simpleAngle=P,t.simpleAngleTouch=w},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=b.getConfiguration();if(t.current){var o={visible:!0,active:!0,text:t.current,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,hasBoundingBox:!0}}},n={left:0,top:0,width:e.image.width,height:e.image.height};if(cornerstoneMath.point.insideRect(o.handles.end,n)){var a=t.markers.indexOf(t.current);return t.ascending?(a+=1)>=t.markers.length&&(t.loop?a-=t.markers.length:a=-1):(a-=1)<0&&(t.loop?a+=t.markers.length:a=-1),t.current=t.markers[a],o}}}function r(e,t,o){if(t.handles.end.boundingBox){var n=cornerstoneMath.rect.distanceToPoint(t.handles.end.boundingBox,o),a=(0,m.default)(t.handles.end,o);return n<10||a}}function i(e){var t=e.detail,o=(0,x.getToolState)(t.element,M);if(o){var n=t.canvasContext.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0);for(var a=b.getConfiguration(),r=0;r<o.data.length;r++){var i=o.data[r],s=h.default.getToolColor();i.active&&(s=h.default.getActiveColor()),n.save(),a&&a.shadow&&(n.shadowColor=a.shadowColor||"#000000",n.shadowOffsetX=a.shadowOffsetX||1,n.shadowOffsetY=a.shadowOffsetY||1),n.fillStyle=s;var l=n.measureText(i.text);i.textWidth=l.width+10;var c=cornerstone.pixelToCanvas(t.element,i.handles.end),u={centering:{x:!0,y:!0}},d=(0,C.default)(n,i.text,c.x,c.y-10,s,u);i.handles.end.boundingBox=d,n.restore()}}}function s(e,t){function o(t,o,n){!0===n?(0,x.removeToolState)(a,M,t):t.text=o,t.active=!1,cornerstone.updateImage(a);var r={mouseButtonMask:e.data.mouseButtonMask};$(a).on("CornerstoneToolsMouseMove",r,b.mouseMoveCallback),$(a).on("CornerstoneToolsMouseDown",r,b.mouseDownCallback),$(a).on("CornerstoneToolsMouseDownActivate",r,b.mouseDownActivateCallback),$(a).on("CornerstoneToolsMouseDoubleClick",r,b.mouseDoubleClickCallback)}var n,a=t.element;if(!e.data||!e.data.mouseButtonMask||(0,T.default)(t.which,e.data.mouseButtonMask)){var i=b.getConfiguration(),s=t.currentPoints.canvas,l=(0,x.getToolState)(a,M);if(l){for(var c=0;c<l.data.length;c++)if(n=l.data[c],r(a,n,s))return n.active=!0,cornerstone.updateImage(a),$(a).off("CornerstoneToolsMouseMove",b.mouseMoveCallback),$(a).off("CornerstoneToolsMouseDown",b.mouseDownCallback),$(a).off("CornerstoneToolsMouseDownActivate",b.mouseDownActivateCallback),$(a).off("CornerstoneToolsMouseDoubleClick",b.mouseDoubleClickCallback),i.changeTextCallback(n,t,o),e.stopImmediatePropagation(),!1;return!1}}}function l(e,t){function o(e,t,o){!0===o?(0,x.removeToolState)(a,M,e):e.text=t,e.active=!1,cornerstone.updateImage(a),$(a).on("CornerstoneToolsTouchDrag",P.touchMoveCallback),$(a).on("CornerstoneToolsTouchStartActive",P.touchDownActivateCallback),$(a).on("CornerstoneToolsTouchStart",P.touchStartCallback),$(a).on("CornerstoneToolsTap",P.tapCallback),$(a).on("CornerstoneToolsTouchPress",P.pressCallback)}var n,a=t.element,i=b.getConfiguration(),s=t.currentPoints.canvas,l=(0,x.getToolState)(a,M);if(!l)return!1;if(t.handlePressed)return t.handlePressed.active=!0,cornerstone.updateImage(a),$(a).off("CornerstoneToolsTouchDrag",P.touchMoveCallback),$(a).off("CornerstoneToolsTouchStartActive",P.touchDownActivateCallback),$(a).off("CornerstoneToolsTouchStart",P.touchStartCallback),$(a).off("CornerstoneToolsTap",P.tapCallback),$(a).off("CornerstoneToolsTouchPress",P.pressCallback),i.changeTextCallback(t.handlePressed,t,o),e.stopImmediatePropagation(),!1;for(var c=0;c<l.data.length;c++)if(n=l.data[c],r(a,n,s))return n.active=!0,cornerstone.updateImage(a),$(a).off("CornerstoneToolsTouchDrag",P.touchMoveCallback),$(a).off("CornerstoneToolsTouchStartActive",P.touchDownActivateCallback),$(a).off("CornerstoneToolsTouchStart",P.touchStartCallback),$(a).off("CornerstoneToolsTap",P.tapCallback),$(a).off("CornerstoneToolsTouchPress",P.pressCallback),i.changeTextCallback(n,t,o),e.stopImmediatePropagation(),!1;return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.textMarkerTouch=t.textMarker=void 0;var c=o(2),u=n(c),d=o(10),f=n(d),g=o(18),m=n(g),v=o(1),h=n(v),p=o(4),T=n(p),y=o(3),C=n(y),x=o(0),M="textMarker",b=(0,u.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:M,mouseDoubleClickCallback:s}),P=(0,f.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:M,pressCallback:l});t.textMarker=b,t.textMarkerTouch=P},function(e,t,o){"use strict";function n(e,t){$(t.element).off("CornerstoneToolsMouseDrag",i),$(t.element).off("CornerstoneToolsMouseUp",n),$(t.element).off("CornerstoneToolsMouseClick",n)}function a(e,t){if(isMouseButtonEnabled(t.which,e.data.mouseButtonMask))return $(t.element).on("CornerstoneToolsMouseDrag",i),$(t.element).on("CornerstoneToolsMouseUp",n),$(t.element).on("CornerstoneToolsMouseClick",n),!1}function r(e){var t=e.image.maxPixelValue*e.image.slope+e.image.intercept,o=e.image.minPixelValue*e.image.slope+e.image.intercept,n=t-o,a=n/1024,r=e.deltaPoints.page.x*a,i=e.deltaPoints.page.y*a;e.viewport.voi.windowWidth+=r,e.viewport.voi.windowCenter+=i}function i(e,t){return l.strategy(t),cornerstone.setViewport(t.element,t.viewport),!1}function s(e,t){e.stopImmediatePropagation();var o=t,n=o.image.maxPixelValue*o.image.slope+o.image.intercept,a=o.image.minPixelValue*o.image.slope+o.image.intercept,r=n-a,i=r/1024,s=o.deltaPoints.page.x*i,c=o.deltaPoints.page.y*i,u=l.getConfiguration();u.orientation?0===u.orientation?(o.viewport.voi.windowWidth+=s,o.viewport.voi.windowCenter+=c):(o.viewport.voi.windowWidth+=c,o.viewport.voi.windowCenter+=s):(o.viewport.voi.windowWidth+=s,o.viewport.voi.windowCenter+=c),cornerstone.setViewport(o.element,o.viewport)}Object.defineProperty(t,"__esModule",{value:!0});var l=simpleMouseButtonTool(a);l.strategies={default:r},l.strategy=r;var c=touchDragTool(s);t.wwwc=l,t.wwwcTouchDrag=c},function(e,t,o){"use strict";function n(e,t,o){var n=e.length;if(n<2)return{min:t,max:o,mean:(t+o)/2};for(var a=o,r=t,i=0,s=0;s<n;s++){var l=e[s];a=Math.min(a,l),r=Math.max(r,l),i+=l}return{min:a,max:r,mean:i/n}}function a(e){var t=e.detail,o=(0,y.getToolState)(t.element,M);o&&o.data&&(o.data=[]),$(t.element).off("CornerstoneToolsMouseMove",u),$(t.element).off("CornerstoneToolsMouseDrag",u),$(t.element).off("CornerstoneToolsMouseUp",r),$(t.element).off("CornerstoneToolsMouseClick",r);var n={mouseButtonMask:T};$(t.element).on("CornerstoneToolsMouseDown",n,l)}function r(e,t){$(t.element).off("CornerstoneToolsMouseMove",u),$(t.element).off("CornerstoneToolsMouseDrag",u),$(t.element).off("CornerstoneToolsMouseUp",r),$(t.element).off("CornerstoneToolsMouseClick",r);var o={mouseButtonMask:T};$(t.element).on("CornerstoneToolsMouseDown",o,l);var n=(0,y.getToolState)(t.element,M);n&&n.data&&n.data.length&&(n.data[0].endPoint={x:t.currentPoints.image.x,y:t.currentPoints.image.y},i(t))}function i(e){var t=(0,y.getToolState)(e.element,M);if(t&&t.data&&t.data.length){var o=t.data[0].startPoint,a=t.data[0].endPoint,r=Math.abs(o.x-a.x),i=Math.abs(o.y-a.y),s=Math.min(o.x,a.x),l=Math.min(o.y,a.y);s=Math.max(s,0),s=Math.min(s,e.image.width),l=Math.max(l,0),l=Math.min(l,e.image.height),r=Math.floor(Math.min(r,Math.abs(e.image.width-s))),i=Math.floor(Math.min(i,Math.abs(e.image.height-l)));var c=(0,x.default)(e.element,s,l,r,i),u=n(c,e.image.minPixelValue,e.image.maxPixelValue),d=P.getConfiguration(),f=cornerstone.getViewport(e.element);void 0===d.minWindowWidth&&(d.minWindowWidth=10),f.voi.windowWidth=Math.max(Math.abs(u.max-u.min),d.minWindowWidth),f.voi.windowCenter=u.mean,cornerstone.setViewport(e.element,f),t.data=[],cornerstone.updateImage(e.element)}}function s(e,t){var o=t.element;$(o).off("CornerstoneToolsMouseMove"),$(o).off("CornerstoneToolsMouseDrag"),$(o).on("CornerstoneToolsMouseMove",u),$(o).on("CornerstoneToolsMouseDrag",u),$(o).on("CornerstoneToolsMouseClick",r),"CornerstoneToolsMouseDrag"===e.type&&$(o).on("CornerstoneToolsMouseUp",r)}function l(e,t){if(isMouseButtonEnabled(t.which,e.data.mouseButtonMask))return $(t.element).on("CornerstoneToolsMouseDrag",t,s),$(t.element).on("CornerstoneToolsMouseMove",t,s),$(t.element).off("CornerstoneToolsMouseDown",l),c(t),!1}function c(e){var t=(0,y.getToolState)(e.element,M);t&&t.data&&(t.data=[]);var o={startPoint:{x:e.currentPoints.image.x,y:e.currentPoints.image.y}};(0,y.addToolState)(e.element,M,o)}function u(e,t){var o=(0,y.getToolState)(t.element,M);if(o&&o.data&&o.data.length){var n={x:t.currentPoints.image.x,y:t.currentPoints.image.y};o.data[0].endPoint=n,cornerstone.updateImage(t.element)}}function d(e){var t=e.detail,o=(0,y.getToolState)(t.element,M);if(o&&o.data&&o.data.length){var n=o.data[0].startPoint,a=o.data[0].endPoint;if(n&&a){var r=$(t.element).find("canvas").get(0),i=r.getContext("2d");i.setTransform(1,0,0,1,0,0);var s=toolColors.getActiveColor(),l=cornerstone.pixelToCanvas(t.element,n),c=cornerstone.pixelToCanvas(t.element,a),u=Math.min(l.x,c.x),d=Math.min(l.y,c.y),f=Math.abs(l.x-c.x),g=Math.abs(l.y-c.y),m=toolStyle.getToolWidth(),v=P.getConfiguration();i.save(),v&&v.shadow&&(i.shadowColor=v.shadowColor||"#000000",i.shadowOffsetX=v.shadowOffsetX||1,i.shadowOffsetY=v.shadowOffsetY||1),i.beginPath(),i.strokeStyle=s,i.lineWidth=m,i.rect(u,d,f,g),i.stroke(),i.restore()}}}function f(e){$(e).off("CornerstoneToolsMouseDown",l),$(e).off("CornerstoneToolsMouseUp",r),$(e).off("CornerstoneToolsMouseClick",r),$(e).off("CornerstoneToolsMouseDrag",u),$(e).off("CornerstoneToolsMouseMove",u),e.removeEventListener("CornerstoneImageRendered",d),e.removeEventListener("CornerstoneNewImage",a),cornerstone.updateImage(e)}function g(e,t){var o={mouseButtonMask:t};if(T=t,!(0,y.getToolState)(e,M)){var n=[];(0,y.addToolState)(e,M,n)}$(e).off("CornerstoneToolsMouseDown",l),$(e).off("CornerstoneToolsMouseUp",r),$(e).off("CornerstoneToolsMouseClick",r),$(e).off("CornerstoneToolsMouseDrag",u),$(e).off("CornerstoneToolsMouseMove",u),e.removeEventListener("CornerstoneImageRendered",d),e.removeEventListener("CornerstoneNewImage",a),$(e).on("CornerstoneToolsMouseDown",o,l),e.addEventListener("CornerstoneImageRendered",d),e.addEventListener("CornerstoneNewImage",a),cornerstone.updateImage(e)}function m(e){$(e).off("CornerstoneToolsTouchDrag",u),$(e).off("CornerstoneToolsTouchStart",c),$(e).off("CornerstoneToolsDragEnd",i),e.removeEventListener("CornerstoneImageRendered",d)}function v(e){if(!(0,y.getToolState)(e,M)){var t=[];(0,y.addToolState)(e,M,t)}$(e).off("CornerstoneToolsTouchDrag",u),$(e).off("CornerstoneToolsTouchStart",c),$(e).off("CornerstoneToolsDragEnd",i),e.removeEventListener("CornerstoneImageRendered",d),$(e).on("CornerstoneToolsTouchDrag",u),$(e).on("CornerstoneToolsTouchStart",c),$(e).on("CornerstoneToolsDragEnd",i),e.addEventListener("CornerstoneImageRendered",d)}function h(){return b}function p(e){b=e}Object.defineProperty(t,"__esModule",{value:!0}),t.wwwcRegionTouch=t.wwwcRegion=void 0;var T,y=o(0),C=o(16),x=function(e){return e&&e.__esModule?e:{default:e}}(C),M="wwwcRegion",b={minWindowWidth:10},P={activate:g,deactivate:f,disable:f,setConfiguration:p,getConfiguration:h},w={activate:v,deactivate:m,disable:m};t.wwwcRegion=P,t.wwwcRegionTouch=w},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var o=S.getConfiguration(),n=Math.log(e.scale)/Math.log(1.7),a=n+t,r=Math.pow(1.7,a);return o.maxScale&&r>o.maxScale?e.scale=o.maxScale:o.minScale&&r<o.minScale?e.scale=o.minScale:e.scale=r,e}function r(e,t,o){return e.x=Math.max(e.x,0),e.y=Math.max(e.y,0),e.x=Math.min(e.x,t),e.y=Math.min(e.y,o),e}function i(e,t){if(t.hflip&&(e.x*=-1),t.vflip&&(e.y*=-1),0!==t.rotation){var o=t.rotation*Math.PI/180,n=Math.cos(o),a=Math.sin(o),r=e.x*n-e.y*a,i=e.x*a+e.y*n;e.x=r,e.y=i}return e}function s(e,t){var o=e.element,n=a(e.viewport,t);cornerstone.setViewport(o,n);var r=cornerstone.pageToPixel(o,e.startPoints.page.x,e.startPoints.page.y),s={x:e.startPoints.image.x-r.x,y:e.startPoints.image.y-r.y};s=i(s,n),n.translation.x-=s.x,n.translation.y-=s.y,cornerstone.setViewport(o,n)}function l(e,t){var o=e.element,n=e.image,s=S.getConfiguration(),l=a(e.viewport,t),c={x:0,y:0};if(t<0)l.scale<3&&(Math.abs(l.translation.x)<.01?l.translation.x=0:c.x=l.translation.x/8,Math.abs(l.translation.y)<.01?l.translation.y=0:c.y=l.translation.y/8);else{s&&s.preventZoomOutsideImage&&(v.image=r(v.image,n.width,n.height));var u={x:n.width/2-v.image.x,y:n.height/2-v.image.y};u=i(u,l);var d={x:l.translation.x-u.x,y:l.translation.y-u.y};Math.abs(d.x)<.01?l.translation.x=u.x:c.x=d.x/8,Math.abs(d.y)<.01?l.translation.y=u.y:c.y=d.y/8}l.translation.x-=c.x,l.translation.y-=c.y,cornerstone.setViewport(o,l)}function c(e,t){var o=e.element,n=a(e.viewport,t);cornerstone.setViewport(o,n)}function u(e,t){$(t.element).off("CornerstoneToolsMouseDrag",f),$(t.element).off("CornerstoneToolsMouseUp",u),$(t.element).off("CornerstoneToolsMouseClick",u)}function d(e,t){if((0,y.default)(t.which,e.data.mouseButtonMask))return v=t.startPoints,$(t.element).on("CornerstoneToolsMouseDrag",f),$(t.element).on("CornerstoneToolsMouseUp",u),$(t.element).on("CornerstoneToolsMouseClick",u),!1}function f(e,t){if(!t.deltaPoints.page.y)return!1;var o=t.deltaPoints.page.y/100;return S.strategy(t,o),!1}function g(e,t){var o=-t.direction/4,n=S.getConfiguration();n&&n.invert&&(o*=-1);var r=a(t.viewport,o);cornerstone.setViewport(t.element,r)}function m(e,t){var o=S.getConfiguration(),n=t.viewport,a=t.element;n.scale+=t.scaleChange*n.scale,o.maxScale&&n.scale>o.maxScale?n.scale=o.maxScale:o.minScale&&n.scale<o.minScale&&(n.scale=o.minScale),cornerstone.setViewport(a,n);var r=cornerstone.pageToPixel(a,t.startPoints.page.x,t.startPoints.page.y),s={x:t.startPoints.image.x-r.x,y:t.startPoints.image.y-r.y};s=i(s,n),n.translation.x-=s.x,n.translation.y-=s.y,cornerstone.setViewport(a,n)}Object.defineProperty(t,"__esModule",{value:!0}),t.zoomTouchDrag=t.zoomTouchPinch=t.zoomWheel=t.zoom=void 0;var v,h=o(7),p=n(h),T=o(4),y=n(T),C=o(6),x=n(C),M=o(9),b=n(M),P=o(8),w=n(P),S=(0,p.default)(d);S.strategies={default:s,translate:l,zoomToCenter:c},S.strategy=s;var I=(0,x.default)(g),k=(0,b.default)(m),O=(0,w.default)(f);t.zoom=S,t.zoomWheel=I,t.zoomTouchPinch=k,t.zoomTouchDrag=O},function(e,t,o){"use strict";function n(e){var t=e.currentTarget,o={event:window.event||e,element:t,viewport:cornerstone.getViewport(t),image:cornerstone.getEnabledElement(t).image,currentPoints:{page:{x:s,y:l},image:cornerstone.pageToPixel(t,s,l)},keyCode:e.keyCode,which:e.which};o.currentPoints.canvas=cornerstone.pixelToCanvas(t,o.currentPoints.image);var n={keydown:"CornerstoneToolsKeyDown",keypress:"CornerstoneToolsKeyPress",keyup:"CornerstoneToolsKeyUp"};$(t).trigger(n[e.type],o)}function a(e){s=e.pageX||e.originalEvent.pageX,l=e.pageY||e.originalEvent.pageY}function r(e){i(e),$(e).on(c,n),$(e).on("mousemove",a)}function i(e){$(e).off(c,n),$(e).off("mousemove",a)}Object.defineProperty(t,"__esModule",{value:!0});var s,l,c="keydown keypress keyup",u={enable:r,disable:i};t.default=u},function(e,t,o){"use strict";function n(){d=!1}function a(e){$(e.element).trigger("CornerstoneToolsMouseDownActivate",e)}function r(e){var t=e.currentTarget,o="CornerstoneToolsMouseDoubleClick",n={page:cornerstoneMath.point.pageToPoint(e),image:cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};n.canvas=cornerstone.pixelToCanvas(t,n.image);var a=copyPoints(n),r={event:e,which:e.which,viewport:cornerstone.getViewport(t),image:cornerstone.getEnabledElement(t).image,element:t,startPoints:n,lastPoints:a,currentPoints:n,deltaPoints:{x:0,y:0},type:o},i=$.Event(o,r);$(r.element).trigger(i,r)}function i(e){function t(e){var t={page:cornerstoneMath.point.pageToPoint(e),image:cornerstone.pageToPixel(r,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};t.canvas=cornerstone.pixelToCanvas(r,t.image);var o={page:cornerstoneMath.point.subtract(t.page,l.page),image:cornerstoneMath.point.subtract(t.image,l.image),client:cornerstoneMath.point.subtract(t.client,l.client),canvas:cornerstoneMath.point.subtract(t.canvas,l.canvas)},n={which:m,viewport:cornerstone.getViewport(r),image:cornerstone.getEnabledElement(r).image,element:r,startPoints:i,lastPoints:l,currentPoints:t,deltaPoints:o,type:"CornerstoneToolsMouseDrag"};return $(n.element).trigger("CornerstoneToolsMouseDrag",n),l=copyPoints(t),pauseEvent(e)}function o(e){clearTimeout(u);var n="CornerstoneToolsMouseUp";d&&(n="CornerstoneToolsMouseClick");var a={page:cornerstoneMath.point.pageToPoint(e),image:cornerstone.pageToPixel(r,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};a.canvas=cornerstone.pixelToCanvas(r,a.image);var c={page:cornerstoneMath.point.subtract(a.page,l.page),image:cornerstoneMath.point.subtract(a.image,l.image),client:cornerstoneMath.point.subtract(a.client,l.client),canvas:cornerstoneMath.point.subtract(a.canvas,l.canvas)},f={event:e,which:m,viewport:cornerstone.getViewport(r),image:cornerstone.getEnabledElement(r).image,element:r,startPoints:i,lastPoints:l,currentPoints:a,deltaPoints:c,type:n},g=$.Event(n,f);$(f.element).trigger(g,f),$(document).off("mousemove",t),$(document).off("mouseup",o),$(f.element).on("mousemove",s),d=!0}u=setTimeout(n,f);var r=e.currentTarget;$(r).off("mousemove",s);var i={page:cornerstoneMath.point.pageToPoint(e),image:cornerstone.pageToPixel(r,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};i.canvas=cornerstone.pixelToCanvas(r,i.image);var l=copyPoints(i),c={event:e,which:e.which,viewport:cornerstone.getViewport(r),image:cornerstone.getEnabledElement(r).image,element:r,startPoints:i,lastPoints:l,currentPoints:i,deltaPoints:{x:0,y:0},type:"CornerstoneToolsMouseDown"},g=$.Event("CornerstoneToolsMouseDown",c);if($(c.element).trigger(g,c),!1===g.isImmediatePropagationStopped()&&!0===a(c))return pauseEvent(e);var m=e.which;return $(document).on("mousemove",t),$(document).on("mouseup",o),pauseEvent(e)}function s(e){var t=e.currentTarget,o={page:cornerstoneMath.point.pageToPoint(e),image:cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};o.canvas=cornerstone.pixelToCanvas(t,o.image);var n=copyPoints(o),a=e.which,r={page:cornerstoneMath.point.pageToPoint(e),image:cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=cornerstone.pixelToCanvas(t,r.image);var i={page:cornerstoneMath.point.subtract(r.page,n.page),image:cornerstoneMath.point.subtract(r.image,n.image),client:cornerstoneMath.point.subtract(r.client,n.client),canvas:cornerstoneMath.point.subtract(r.canvas,n.canvas)},s={which:a,viewport:cornerstone.getViewport(t),image:cornerstone.getEnabledElement(t).image,element:t,startPoints:o,lastPoints:n,currentPoints:r,deltaPoints:i,type:"CornerstoneToolsMouseMove"};$(t).trigger("CornerstoneToolsMouseMove",s),n=copyPoints(r)}function l(e){$(e).off("mousedown",i),$(e).off("mousemove",s),$(e).off("dblclick",r)}function c(e){l(e),$(e).on("mousedown",i),$(e).on("mousemove",s),$(e).on("dblclick",r)}Object.defineProperty(t,"__esModule",{value:!0});var u,d=!0,f=200,g={enable:c,disable:l};t.default=g},function(e,t,o){"use strict";function n(e){if(!("mousewheel"===e.originalEvent.type&&0===e.originalEvent.wheelDeltaY||"DOMMouseScroll"===e.originalEvent.type&&1===e.originalEvent.axis)){e.preventDefault();var t,o,n=e.currentTarget;void 0!==e.pageX&&void 0!==e.pageY?(t=e.pageX,o=e.pageY):e.originalEvent&&void 0!==e.originalEvent.pageX&&void 0!==e.originalEvent.pageY?(t=e.originalEvent.pageX,o=e.originalEvent.pageY):(t=e.x,o=e.y);var a=cornerstone.pageToPixel(n,t,o);e=window.event||e;var r;r=e.originalEvent&&e.originalEvent.wheelDelta?-e.originalEvent.wheelDelta:e.originalEvent&&e.originalEvent.deltaY?-e.originalEvent.deltaY:e.originalEvent&&e.originalEvent.detail?-e.originalEvent.detail:e.wheelDelta;var i=r<0?-1:1,s={element:n,viewport:cornerstone.getViewport(n),image:cornerstone.getEnabledElement(n).image,direction:i,pageX:t,pageY:o,imageX:a.x,imageY:a.y};$(n).trigger("CornerstoneToolsMouseWheel",s)}}function a(e){r(e),$(e).on(i,n)}function r(e){$(e).unbind(i,n)}Object.defineProperty(t,"__esModule",{value:!0});var i="mousewheel DOMMouseScroll",s={enable:a,disable:r};t.default=s},function(e,t,o){"use strict";function n(e,t){var o=Date.now();if(e!==l){if(o-c<=u)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1;l=e}c=o}function a(e,t,o){var n=o?f:g;t.forEach(function(t){e.addEventListener(t,n,!0)})}function r(e,t,o){var n=o?f:g;t.forEach(function(t){e.removeEventListener(t,n,!0)})}function i(e){r(e,m,d.mouse),r(e,v,d.touch)}function s(e){i(e),a(e,m,d.mouse),a(e,v,d.touch)}Object.defineProperty(t,"__esModule",{value:!0});var l,c,u=2e3,d={mouse:0,touch:1},f=n.bind(null,d.mouse),g=n.bind(null,d.touch),m=["mousedown","mouseup"],v=["touchstart","touchend"],h={enable:s,disable:i};t.default=h},function(e,t,o){"use strict";function n(e){var t,o,n=e.currentTarget||e.srcEvent.currentTarget;switch(e.preventDefault(),(e.pointers&&e.pointers.length>1||e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches.length>1)&&(T=!1,clearTimeout(f)),e.type){case"tap":T=!1,clearTimeout(f),s={page:cornerstoneMath.point.pageToPoint(e.pointers[0]),image:cornerstone.pageToPixel(n,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},s.canvas=cornerstone.pixelToCanvas(n,s.image),o="CornerstoneToolsTap",u={event:e,viewport:cornerstone.getViewport(n),image:cornerstone.getEnabledElement(n).image,element:n,currentPoints:s,type:o,isTouchEvent:!0},t=$.Event(o,u),$(n).trigger(t,u);break;case"doubletap":T=!1,clearTimeout(f),s={page:cornerstoneMath.point.pageToPoint(e.pointers[0]),image:cornerstone.pageToPixel(n,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},s.canvas=cornerstone.pixelToCanvas(n,s.image),o="CornerstoneToolsDoubleTap",u={event:e,viewport:cornerstone.getViewport(n),image:cornerstone.getEnabledElement(n).image,element:n,currentPoints:s,type:o,isTouchEvent:!0},t=$.Event(o,u),$(n).trigger(t,u);break;case"pinchstart":T=!1,clearTimeout(f),v=1;break;case"pinchmove":if(T=!1,clearTimeout(f),!0===C){v=e.scale,C=!1;break}var a=(e.scale-v)/v;i={page:e.center,image:cornerstone.pageToPixel(n,e.center.x,e.center.y)},i.canvas=cornerstone.pixelToCanvas(n,i.image),o="CornerstoneToolsTouchPinch",u={event:e,startPoints:i,viewport:cornerstone.getViewport(n),image:cornerstone.getEnabledElement(n).image,element:n,direction:e.scale<1?1:-1,scaleChange:a,type:o,isTouchEvent:!0},t=$.Event(o,u),$(n).trigger(t,u),v=e.scale;break;case"touchstart":v=1,clearTimeout(f),clearTimeout(d),d=setTimeout(function(){i={page:cornerstoneMath.point.pageToPoint(e.originalEvent.touches[0]),image:cornerstone.pageToPixel(n,e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY),client:{x:e.originalEvent.touches[0].clientX,y:e.originalEvent.touches[0].clientY}},i.canvas=cornerstone.pixelToCanvas(n,i.image),o="CornerstoneToolsTouchStart",e.originalEvent.touches.length>1&&(o="CornerstoneToolsMultiTouchStart"),u={event:e,viewport:cornerstone.getViewport(n),image:cornerstone.getEnabledElement(n).image,element:n,startPoints:i,currentPoints:i,type:o,isTouchEvent:!0},t=$.Event(o,u),$(n).trigger(t,u),!1===t.isImmediatePropagationStopped()&&(o="CornerstoneToolsTouchStartActive",e.originalEvent.touches.length>1&&(o="CornerstoneToolsMultiTouchStartActive"),u.type=o,$(n).trigger(o,u)),l=copyPoints(i)},50),T=!0,g=0,f=setTimeout(function(){T&&(s={page:cornerstoneMath.point.pageToPoint(e.originalEvent.touches[0]),image:cornerstone.pageToPixel(n,e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY),client:{x:e.originalEvent.touches[0].clientX,y:e.originalEvent.touches[0].clientY}},s.canvas=cornerstone.pixelToCanvas(n,i.image),o="CornerstoneToolsTouchPress",u={event:e,viewport:cornerstone.getViewport(n),image:cornerstone.getEnabledElement(n).image,element:n,currentPoints:s,type:o,isTouchEvent:!0},t=$.Event(o,u),$(n).trigger(t,u))},p);break;case"touchend":v=1,T=!1,clearTimeout(f),setTimeout(function(){i={page:cornerstoneMath.point.pageToPoint(e.originalEvent.changedTouches[0]),image:cornerstone.pageToPixel(n,e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY),client:{x:e.originalEvent.changedTouches[0].clientX,y:e.originalEvent.changedTouches[0].clientY}},i.canvas=cornerstone.pixelToCanvas(n,i.image),o="CornerstoneToolsTouchEnd",u={event:e,viewport:cornerstone.getViewport(n),image:cornerstone.getEnabledElement(n).image,element:n,startPoints:i,currentPoints:i,type:o,isTouchEvent:!0},t=$.Event(o,u),$(n).trigger(t,u)},50);break;case"panmove":var r={x:e.deltaX-m.x,y:e.deltaY-m.y};m={x:e.deltaX,y:e.deltaY},s={page:{x:l.page.x+r.x,y:l.page.y+r.y},image:cornerstone.pageToPixel(n,l.page.x+r.x,l.page.y+r.y),client:{x:l.client.x+r.x,y:l.client.y+r.y}},s.canvas=cornerstone.pixelToCanvas(n,s.image),c={page:cornerstoneMath.point.subtract(s.page,l.page),image:cornerstoneMath.point.subtract(s.image,l.image),client:cornerstoneMath.point.subtract(s.client,l.client),canvas:cornerstoneMath.point.subtract(s.canvas,l.canvas)},g+=Math.sqrt(c.page.x*c.page.x+c.page.y*c.page.y),g>y&&(T=!1,clearTimeout(f)),o="CornerstoneToolsTouchDrag",e.pointers.length>1&&(o="CornerstoneToolsMultiTouchDrag"),u={viewport:cornerstone.getViewport(n),image:cornerstone.getEnabledElement(n).image,element:n,startPoints:i,lastPoints:l,currentPoints:s,deltaPoints:c,numPointers:e.pointers.length,type:o,isTouchEvent:!0},t=$.Event(o,u),$(n).trigger(t,u),l=copyPoints(s);break;case"panstart":m={x:e.deltaX,y:e.deltaY},s={page:cornerstoneMath.point.pageToPoint(e.pointers[0]),image:cornerstone.pageToPixel(n,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},s.canvas=cornerstone.pixelToCanvas(n,s.image),l=copyPoints(s);break;case"panend":if(T=!1,clearTimeout(f),!l)return!1;s={page:cornerstoneMath.point.pageToPoint(e.pointers[0]),image:cornerstone.pageToPixel(n,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},s.canvas=cornerstone.pixelToCanvas(n,s.image),c={page:cornerstoneMath.point.subtract(s.page,l.page),image:cornerstoneMath.point.subtract(s.image,l.image),client:cornerstoneMath.point.subtract(s.client,l.client),canvas:cornerstoneMath.point.subtract(s.canvas,l.canvas)},o="CornerstoneToolsDragEnd",u={event:e.srcEvent,viewport:cornerstone.getViewport(n),image:cornerstone.getEnabledElement(n).image,element:n,startPoints:i,lastPoints:l,currentPoints:s,deltaPoints:c,type:o,isTouchEvent:!0},t=$.Event(o,u),$(n).trigger(t,u);return 2===e.pointers.length-e.changedPointers.length&&(C=!0),pauseEvent(e);case"rotatemove":T=!1,clearTimeout(f);var x=e.rotation-h;h=e.rotation,o="CornerstoneToolsTouchRotate",u={event:e.srcEvent,viewport:cornerstone.getViewport(n),image:cornerstone.getEnabledElement(n).image,element:n,rotation:x,type:o},t=$.Event(o,u),$(n).trigger(t,u)}return!1}function a(e){r(e);var t={inputClass:Hammer.SUPPORT_POINTER_EVENTS?Hammer.PointerEventInput:Hammer.TouchInput},o=new Hammer.Manager(e,t),a={pointers:0,direction:Hammer.DIRECTION_ALL,threshold:0},i=new Hammer.Pan(a),s=new Hammer.Pinch({threshold:0}),l=new Hammer.Rotate({threshold:0});s.recognizeWith(i),s.recognizeWith(l),l.recognizeWith(i);var c=new Hammer.Tap({event:"doubletap",taps:2,interval:1500,threshold:50,posThreshold:50});c.recognizeWith(i),o.add([c,i,l,s]),o.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",n),preventGhostClick.enable(e),$(e).on("touchstart touchend",n),$(e).data("hammer",o)}function r(e){preventGhostClick.disable(e),$(e).off("touchstart touchend",n);var t=$(e).data("hammer");t&&t.off("tap doubletap panstart panmove panend pinchmove rotatemove",n)}Object.defineProperty(t,"__esModule",{value:!0});var i,s,l,c,u,d,f,g,m,v=1,h=0,p=700,T=!1,y=5,C=!1,x={enable:a,disable:r};t.default=x},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,a,r){e.strokeStyle=a,Object.keys(o).forEach(function(a){var i=o[a];if(!0!==i.drawnIndependently&&(!r||!0!==r.drawHandlesIfActive||i.active)){e.beginPath(),i.active?e.lineWidth=toolStyle.getActiveWidth():e.lineWidth=toolStyle.getToolWidth();var s=cornerstone.pixelToCanvas(t.element,i);e.arc(s.x,s.y,n,0,2*Math.PI),r&&r.fill&&(e.fillStyle=r.fill,e.fill()),e.stroke()}})};var n=6},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n){var a;if(t)return Object.keys(t).forEach(function(r){var i=t[r];if(i.hasOwnProperty("pointNearHandle")){if(i.pointNearHandle(e,i,o))return void(a=i)}else if(!0===i.hasBoundingBox){if(pointInsideBoundingBox(i,o))return void(a=i)}else{var s=cornerstone.pixelToCanvas(e,i),l=cornerstoneMath.point.distance(s,o);if(l<=n)return void(a=i)}}),a}},function(e,t,o){"use strict";function n(e){var t;return Object.keys(e).forEach(function(o){var n=e[o];if(!0===n.active)return void(t=n)}),t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,a){a||(a=6);var r=n(t),i=getHandleNearImagePoint(e,t,o,a);return r!==i&&(void 0!==i&&(i.active=!0),void 0!==r&&(r.active=!1),!0)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,a,r){function i(e,o){t.active=!0,Object.keys(t.handles).forEach(function(e){var n=t.handles[e];!0!==n.movesIndependently&&(n.x+=o.deltaPoints.image.x,n.y+=o.deltaPoints.image.y,!0===a.preventHandleOutsideImage&&(n.x=Math.max(n.x,0),n.x=Math.min(n.x,o.image.width),n.y=Math.max(n.y,0),n.y=Math.min(n.y,o.image.height)))}),cornerstone.updateImage(l);var r={toolType:n,element:l,measurementData:t};return $(l).trigger("CornerstoneToolsMeasurementModified",r),!1}function s(e,o){t.invalidated=!0,$(l).off("CornerstoneToolsMouseDrag",i),$(l).off("CornerstoneToolsMouseUp",s),$(l).off("CornerstoneToolsMouseClick",s),!0===a.deleteIfHandleOutsideImage&&anyHandlesOutsideImage(o,t.handles)&&removeToolState(l,n,t),cornerstone.updateImage(l),"function"==typeof r&&r()}var l=e.element;return $(l).on("CornerstoneToolsMouseDrag",i),$(l).on("CornerstoneToolsMouseUp",s),$(l).on("CornerstoneToolsMouseClick",s),!0}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,a,r){function i(e,a){!1===n.hasMoved&&(n.hasMoved=!0),n.active=!0,n.x=a.currentPoints.image.x+c.x,n.y=a.currentPoints.image.y+c.y,r&&(n.x=Math.max(n.x,0),n.x=Math.min(n.x,a.image.width),n.y=Math.max(n.y,0),n.y=Math.min(n.y,a.image.height)),cornerstone.updateImage(l);var i={toolType:t,element:l,measurementData:o};$(l).trigger("CornerstoneToolsMeasurementModified",i)}function s(){n.active=!1,$(l).off("CornerstoneToolsMouseDrag",i),$(l).off("CornerstoneToolsMouseUp",s),$(l).off("CornerstoneToolsMouseClick",s),cornerstone.updateImage(l),"function"==typeof a&&a()}var l=e.element,c={x:n.x-e.currentPoints.image.x,y:n.y-e.currentPoints.image.y};$(l).on("CornerstoneToolsMouseDrag",i),$(l).on("CornerstoneToolsMouseUp",s),$(l).on("CornerstoneToolsMouseClick",s)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,a,r){function i(e,a){n.active=!0,n.x=a.currentPoints.image.x,n.y=a.currentPoints.image.y,r&&(n.x=Math.max(n.x,0),n.x=Math.min(n.x,a.image.width),n.y=Math.max(n.y,0),n.y=Math.min(n.y,a.image.height)),cornerstone.updateImage(d);var i={toolType:t,element:d,measurementData:o};$(d).trigger("CornerstoneToolsMeasurementModified",i)}function s(e){$(d).off("CornerstoneToolsMouseMove"),$(d).off("CornerstoneToolsMouseDrag"),$(d).on("CornerstoneToolsMouseMove",i),$(d).on("CornerstoneToolsMouseDrag",i),$(d).on("CornerstoneToolsMouseClick",u),"CornerstoneToolsMouseDrag"===e.type&&$(d).on("CornerstoneToolsMouseUp",u)}function l(e,t){t.measurementData===o&&u()}function c(e,o){o.toolType===t&&($(d).off("CornerstoneToolsMouseMove",i),$(d).off("CornerstoneToolsMouseDrag",i),$(d).off("CornerstoneToolsMouseClick",u),$(d).off("CornerstoneToolsMouseUp",u),$(d).off("CornerstoneToolsMeasurementRemoved",l),$(d).off("CornerstoneToolsToolDeactivated",c),n.active=!1,cornerstone.updateImage(d))}function u(){$(d).off("CornerstoneToolsMouseMove",i),$(d).off("CornerstoneToolsMouseDrag",i),$(d).off("CornerstoneToolsMouseClick",u),$(d).off("CornerstoneToolsMouseUp",u),$(d).off("CornerstoneToolsMeasurementRemoved",l),$(d).off("CornerstoneToolsToolDeactivated",c),n.active=!1,cornerstone.updateImage(d),"function"==typeof a&&a()}var d=e.element;$(d).on("CornerstoneToolsMouseDrag",s),$(d).on("CornerstoneToolsMouseMove",s),$(d).on("CornerstoneToolsMeasurementRemoved",l),$(d).on("CornerstoneToolsToolDeactivated",c)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,a,r){function i(e,a){n.x=a.currentPoints.image.x+f.x,n.y=a.currentPoints.image.y+f.y,r&&(n.x=Math.max(n.x,0),n.x=Math.min(n.x,a.image.width),n.y=Math.max(n.y,0),n.y=Math.min(n.y,a.image.height)),cornerstone.updateImage(u);var i={toolType:t,element:u,measurementData:o};$(u).trigger("CornerstoneToolsMeasurementModified",i)}function s(e,t){if($(u).off("CornerstoneToolsTouchDrag",i),$(u).off("CornerstoneToolsTouchPinch",s),$(u).off("CornerstoneToolsTouchEnd",s),$(u).off("CornerstoneToolsTap",s),$(u).off("CornerstoneToolsTouchStart",l),$(u).off("CornerstoneToolsToolDeactivated",c),"CornerstoneToolsTouchPinch"===e.type||"CornerstoneToolsTouchPress"===e.type)return n.active=!1,cornerstone.updateImage(u),void a();n.active=!1,o.active=!1,n.x=t.currentPoints.image.x+f.x,n.y=t.currentPoints.image.y+f.y,r&&(n.x=Math.max(n.x,0),n.x=Math.min(n.x,t.image.width),n.y=Math.max(n.y,0),n.y=Math.min(n.y,t.image.height)),cornerstone.updateImage(u),"function"==typeof a&&a()}function l(e){return e.stopImmediatePropagation(),!1}function c(){$(u).off("CornerstoneToolsTouchDrag",i),$(u).off("CornerstoneToolsTouchPinch",s),$(u).off("CornerstoneToolsTouchEnd",s),$(u).off("CornerstoneToolsTap",s),$(u).off("CornerstoneToolsTouchStart",l),$(u).off("CornerstoneToolsToolDeactivated",c),n.active=!1,o.active=!1,n.x=e.currentPoints.image.x+f.x,n.y=e.currentPoints.image.y+f.y,r&&(n.x=Math.max(n.x,0),n.x=Math.min(n.x,e.image.width),n.y=Math.max(n.y,0),n.y=Math.min(n.y,e.image.height)),cornerstone.updateImage(u)}var u=e.element,d=cornerstone.pageToPixel(u,e.currentPoints.page.x,e.currentPoints.page.y+50),f={x:n.x-d.x,y:n.y-d.y};n.active=!0,o.active=!0,$(u).on("CornerstoneToolsTouchDrag",i),$(u).on("CornerstoneToolsTouchPinch",s),$(u).on("CornerstoneToolsTouchEnd",s),$(u).on("CornerstoneToolsTap",s),$(u).on("CornerstoneToolsTouchStart",l),$(u).on("CornerstoneToolsToolDeactivated",c)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,a,r){function i(e,o){t.active=!0,Object.keys(t.handles).forEach(function(e){var n=t.handles[e];!0!==n.movesIndependently&&(n.x+=o.deltaPoints.image.x,n.y+=o.deltaPoints.image.y)}),cornerstone.updateImage(l);var a={toolType:n,element:l,measurementData:t};return $(l).trigger("CornerstoneToolsMeasurementModified",a),!1}function s(e,o){t.active=!1,t.invalidated=!1,$(l).off("CornerstoneToolsTouchDrag",i),$(l).off("CornerstoneToolsTouchPinch",s),$(l).off("CornerstoneToolsTouchPress",s),$(l).off("CornerstoneToolsTouchEnd",s),$(l).off("CornerstoneToolsDragEnd",s),$(l).off("CornerstoneToolsTap",s),!0===a&&anyHandlesOutsideImage(o,t.handles)&&toolState.removeToolState(l,n,t),cornerstone.updateImage(l),"function"==typeof r&&r(e,o)}var l=e.element;return $(l).on("CornerstoneToolsTouchDrag",i),$(l).on("CornerstoneToolsTouchPinch",s),$(l).on("CornerstoneToolsTouchPress",s),$(l).on("CornerstoneToolsTouchEnd",s),$(l).on("CornerstoneToolsDragEnd",s),$(l).on("CornerstoneToolsTap",s),!0}},function(e,t,o){"use strict";function n(e,t,o,a,r){if(o.value){var i=(new Date).getTime(),s=Math.abs(t.y-r.y),l=s/10;if(console.log("distanceRemaining: "+s),s<1)return t.y=r.y,void(o.value=!1);t.y>r.y?t.y-=l:t.y<r.y&&(t.y+=l),cornerstone.updateImage(a.element),cornerstone.requestAnimationFrame(function(){n(i,t,o,a,r)})}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,i,s){function l(e,n){a.value=!1,!1===i.hasMoved&&(i.hasMoved=!0),i.active=!0;var r=n.currentPoints,s={x:r.page.x,y:r.page.y+g};v=cornerstone.pageToPixel(u,s.x,s.y),i.x=v.x,i.y=v.y,cornerstone.updateImage(u);var l={toolType:t,element:u,measurementData:o};$(u).trigger("CornerstoneToolsMeasurementModified",l)}function c(t,n){a.value=!1,i.active=!1,$(u).off("CornerstoneToolsTouchDrag",l),$(u).off(r,c),cornerstone.updateImage(u),"CornerstoneToolsTouchPress"===t.type&&(n.handlePressed=o,i.x=e.currentPoints.image.x,i.y=e.currentPoints.image.y),"function"==typeof s&&s(t,n)}a.value=!0;var u=e.element,d=cornerstone.getEnabledElement(u),f=(new Date).getTime(),g=-57,m={x:e.currentPoints.page.x,y:e.currentPoints.page.y+g},v=cornerstone.pageToPixel(u,m.x,m.y);$(u).on("CornerstoneToolsTouchDrag",l),$(u).on(r,c),n(f,i,a,d,v)};var a={value:!1},r=["CornerstoneToolsTouchEnd","CornerstoneToolsDragEnd","CornerstoneToolsTouchPinch","CornerstoneToolsTouchPress","CornerstoneToolsTap"].join(" ")},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.referenceLines=void 0;var a=o(22),r=n(a),i=o(106),s=n(i),l=o(23),c=n(l);t.referenceLines={calculateReferenceLine:r.default,tool:s.default,renderActiveReferenceLine:c.default}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(e,t,o,n,r,i){if(!a.hasOwnProperty(o))throw"Request type must be one of interaction, thumbnail, or prefetch";if(e&&t){var s={type:o,imageId:t,preventCache:n,doneCallback:r,failCallback:i},l=cornerstone.imageCache.getImagePromise(t);if(l)return void l.then(function(e){r(e)},function(e){i(e)});a[o].push(s)}}function t(e){if(!a.hasOwnProperty(e))throw"Request type must be one of interaction, thumbnail, or prefetch";a[e]=[]}function o(){s&&setTimeout(function(){u()},l)}function c(e){var t=e.type;r[t]++,s=!0;var n=e.imageId,a=e.doneCallback,i=e.failCallback,l=cornerstone.imageCache.getImagePromise(n);if(l)return void l.then(function(e){r[t]--,a(e),o()},function(e){r[t]--,i(e),o()});var c,u=function(e){return"prefetch"===e.type?-5:"interactive"===e.type?0:"thumbnail"===e.type?5:void 0}(e);c=!0===e.preventCache?cornerstone.loadImage(n,{priority:u,type:e.type}):cornerstone.loadAndCacheImage(n,{priority:u,type:e.type}),c.then(function(e){r[t]--,a(e),o()},function(e){r[t]--,i(e),o()})}function u(){var e=(0,n.getMaxSimultaneousRequests)();i={interaction:Math.max(e,1),thumbnail:Math.max(e-2,1),prefetch:Math.max(e-1,1)};for(var t=r.interaction+r.thumbnail+r.prefetch,o=e-t,a=0;a<o;a++){var s=d();s&&c(s)}}function d(){return a.interaction.length&&r.interaction<i.interaction?a.interaction.shift():a.thumbnail.length&&r.thumbnail<i.thumbnail?a.thumbnail.shift():a.prefetch.length&&r.prefetch<i.prefetch?a.prefetch.shift():(a.interaction.length||a.thumbnail.length||a.prefetch.length||(s=!1),!1)}function f(){return a}return{addRequest:e,clearRequestStack:t,startGrabbing:u,getRequestPool:f}};var n=o(17),a={interaction:[],thumbnail:[],prefetch:[]},r={interaction:0,thumbnail:0,prefetch:0},i={interaction:6,thumbnail:6,prefetch:5},s=!1,l=20},function(e,t,o){"use strict";function n(e,t){var o,n,a,r=0,i=e.length,s=[];for(s.isTimeVarying=!1,("number"!=typeof t||t<=0)&&(t=1),o=1;o<i;o++)a=+e[o]/t|0,s.push(a),1===o?n=a:a!==n&&(s.isTimeVarying=!0),r+=a;return s.length>0&&(a=s.isTimeVarying?r/s.length|0:s[0],s.push(a)),s}function a(e){var t=e.intervalId;void 0!==t&&(e.intervalId=void 0,e.usingFrameTimeVector?clearTimeout(t):clearInterval(t))}function r(e){var t,o={element:e};t=$.Event("CornerstoneToolsClipStopped",o),$(e).trigger(t,o)}function i(e,t){var o,i,s,c,u,d;if(void 0===e)throw"playClip: element must not be undefined";(o=getToolState(e,"stack"))&&o.data&&o.data.length&&(i=o.data[0],s=getToolState(e,l),s&&s.data&&s.data.length?(c=s.data[0],a(c)):(c={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,frameRate:0,frameTimeVector:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,speed:1,reverse:!1,loop:!0},addToolState(e,l,c)),(t<0||t>0)&&(c.framesPerSecond=+t,c.reverse=c.framesPerSecond<0,c.ignoreFrameTimeVector=!0),!0!==c.ignoreFrameTimeVector&&c.frameTimeVector&&c.frameTimeVector.length===i.imageIds.length&&(u=n(c.frameTimeVector,c.speed)),d=function(){var t,o,n,s,l,u=i.currentImageIdIndex,d=i.imageIds.length;if(c.reverse?u--:u++,!c.loop&&(u<0||u>=d))return a(c),void r(e);u>=d&&(u=0),u<0&&(u=d-1),u!==i.currentImageIdIndex&&(n=loadHandlerManager.getStartLoadHandler(),s=loadHandlerManager.getEndLoadHandler(),l=loadHandlerManager.getErrorLoadingHandler(),n&&n(e),o=cornerstone.getViewport(e),t=!0===i.preventCache?cornerstone.loadImage(i.imageIds[u]):cornerstone.loadAndCacheImage(i.imageIds[u]),t.then(function(t){i.currentImageIdIndex=u,cornerstone.displayImage(e,t,o),s&&s(e,t)},function(t){var o=i.imageIds[u];l&&l(e,o,t)}))},u&&u.length>0&&u.isTimeVarying?(c.usingFrameTimeVector=!0,c.intervalId=setTimeout(function e(){c.intervalId=setTimeout(e,u[i.currentImageIdIndex]),d()},0)):(c.usingFrameTimeVector=!1,c.intervalId=setInterval(d,1e3/Math.abs(c.framesPerSecond))))}function s(e){var t=getToolState(e,l);t&&t.data&&t.data.length&&a(t.data[0])}Object.defineProperty(t,"__esModule",{value:!0});var l="playClip";t.playClip=i,t.stopClip=s},function(e,t,o){"use strict";function n(e){var t=e.detail,o=t.element,n=t.enabledElement.canvas.width,r=t.enabledElement.canvas.height;if(!n||!r)return!1;var s=t.enabledElement.canvas.getContext("2d");s.setTransform(1,0,0,1,0,0),s.save();var l=i.getConfiguration();s.fillStyle=l.backgroundColor,"horizontal"===l.orientation?s.fillRect(0,r-a,n,a):s.fillRect(0,0,a,r);var c=getToolState(o,"stack");if(c&&c.data&&c.data.length){var u=c.data[0].imageIds,d=c.data[0].currentImageIdIndex,f=n/u.length,g=r/u.length,m=f*d,v=g*d;s.fillStyle=l.fillColor,"horizontal"===l.orientation?s.fillRect(m,r-a,f,a):s.fillRect(0,v,a,g),s.restore()}}Object.defineProperty(t,"__esModule",{value:!0});var a=6,r={backgroundColor:"rgb(19, 63, 141)",fillColor:"white",orientation:"horizontal"},i=displayTool(n);i.setConfiguration(r),t.default=i},function(e,t,o){"use strict";function n(e,t){return e-t}function a(e,t){e=Math.round(e)||0,t=Math.round(t)||0;var o=[],n=t-e+1;if(n<=0)return o;for(;n--;)o[n]=t--;return o}function r(e,t){var o=[],n=[];return e.forEach(function(e){e<t?o.push(e):e>t&&n.push(e)}),{low:e.indexOf(T(o)),high:e.indexOf(y(n))}}function i(e){function t(e){var t=c.indicesToRequest.indexOf(e);t>-1&&c.indicesToRequest.splice(t,1)}function o(e){t(s.imageIds.indexOf(e.imageId))}function a(t){console.log("prefetch errored: "+t),h&&h(e,d,t,"stackPrefetch")}var i=getToolState(e,"stack");if(i&&i.data&&i.data.length){var s=i.data[0],l=getToolState(e,m);if(l){var c=l.data[0];if(c&&c.indicesToRequest&&c.indicesToRequest.length||(c.enabled=!1),!1!==c.enabled){l.data[0].indicesToRequest.sort(n);if(c.indicesToRequest.slice().forEach(function(e){var o=s.imageIds[e];if(o){var n=cornerstone.imageCache.getImagePromise(o);n&&"resolved"===n.state()&&t(e)}}),c.indicesToRequest.length){var u=u;u.clearRequestStack(v);for(var d,f,g=r(c.indicesToRequest,s.currentImageIdIndex),h=loadHandlerManager.getErrorLoadingHandler(),p=g.low,T=g.high;p>0||T<c.indicesToRequest.length;)p>=0&&(f=c.indicesToRequest[p--],d=s.imageIds[f],u.addRequest(e,d,v,!1,o,a)),T<c.indicesToRequest.length&&(f=c.indicesToRequest[T++],d=s.imageIds[f],u.addRequest(e,d,v,!1,o,a));u.startGrabbing()}}}}}function s(e){var t,o=e.detail,n=e.data.element;try{t=getToolState(n,"stack")}catch(e){return}if(t&&t.data&&t.data.length){var a=t.data[0],r=a.imageIds.indexOf(o.imageId);if(!(r<0)){var i=getToolState(n,m);i&&i.data&&i.data.length&&i.data[0].indicesToRequest.push(r)}}}function l(e){clearTimeout(g),g=setTimeout(function(){var t=e.target;try{i(t)}catch(e){return}},p)}function c(e){getToolState(e,m).data=[];var t=getToolState(e,"stack");if(t&&t.data&&t.data.length){var o=t.data[0];if(!0===o.preventCache)return void console.warn("A stack that should not be cached was given the stackPrefetch");var n={indicesToRequest:a(0,o.imageIds.length-1),enabled:!0,direction:1},r=n.indicesToRequest.indexOf(o.currentImageIdIndex);n.indicesToRequest.splice(r,1),addToolState(e,m,n),i(e),e.removeEventListener("CornerstoneNewImage",l),e.addEventListener("CornerstoneNewImage",l),cornerstone.removeEventListener("CornerstoneImageCachePromiseRemoved",s),cornerstone.addEventListener("CornerstoneImageCachePromiseRemoved",{element:e},s)}}function u(e){clearTimeout(g),e.removeEventListener("CornerstoneNewImage",l),cornerstone.removeEventListener("CornerstoneImageCachePromiseRemoved",s);var t=getToolState(e,m);t&&t.data.length&&(t.data[0].enabled=!1,requestPoolManager.clearRequestStack(v))}function d(){return h}function f(e){h=e}Object.defineProperty(t,"__esModule",{value:!0});var g,m="stackPrefetch",v="prefetch",h={},p=300,T=function(e){return Math.max.apply(null,e)},y=function(e){return Math.min.apply(null,e)},C={enable:c,disable:u,getConfiguration:d,setConfiguration:f};t.default=C},function(e,t,o){"use strict";function n(e,t){$(t.element).off("CornerstoneToolsMouseDrag",i),$(t.element).off("CornerstoneToolsMouseUp",n),$(t.element).off("CornerstoneToolsMouseClick",n)}function a(e,t){if(isMouseButtonEnabled(t.which,e.data.mouseButtonMask)){var o={deltaY:0};return $(t.element).on("CornerstoneToolsMouseDrag",o,i),$(t.element).on("CornerstoneToolsMouseUp",n),$(t.element).on("CornerstoneToolsMouseClick",n),e.stopImmediatePropagation(),!1}}function r(e,t){var o=-t.direction;scroll(t.element,o)}function i(e,t){var o=t.element,n=getToolState(o,"stack");if(n&&n.data&&n.data.length){var a=n.data[0],r=l.getConfiguration(),i=$(o).height()/Math.max(a.imageIds.length,8);if(r&&r.stackScrollSpeed&&(i=r.stackScrollSpeed),e.data.deltaY=e.data.deltaY||0,e.data.deltaY+=t.deltaPoints.page.y,Math.abs(e.data.deltaY)>=i){var s=e.data.deltaY/i,c=Math.round(s),u=e.data.deltaY%i;e.data.deltaY=u,scroll(o,c)}return!1}}function s(e,t){var o=g.getConfiguration();o&&o.testPointers(t)&&i(e,t)}Object.defineProperty(t,"__esModule",{value:!0});var l=simpleMouseButtonTool(a),c=mouseWheelTool(r),u={eventData:{deltaY:0}},d=touchDragTool(i,u),f={testPointers:function(e){return e.numPointers>=3}},g=multiTouchDragTool(s,u);g.setConfiguration(f),t.stackScroll=l,t.stackScrollWheel=c,t.stackScrollTouchDrag=d,t.stackScrollMultiTouch=g},function(e,t,o){"use strict";function n(e,t){var o=t.keyCode;if(o===a.UP||o===a.DOWN){var n=1;o===a.DOWN&&(n=-1),scroll(t.element,n)}}Object.defineProperty(t,"__esModule",{value:!0});var a={UP:38,DOWN:40},r=keyboardTool(n);t.default=r},function(e,t,o){"use strict";function n(e){var t={imageIdToolState:globalImageIdSpecificToolStateManager.saveToolState(),elementToolState:{},elementViewport:{}};return e.forEach(function(e){var o=getElementToolStateManager(e);o!==globalImageIdSpecificToolStateManager&&(t.elementToolState[e.id]=o.saveToolState(),t.elementViewport[e.id]=cornerstone.getViewport(e))}),t}function a(e){if(e.hasOwnProperty("imageIdToolState")&&e.hasOwnProperty("elementToolState")&&e.hasOwnProperty("elementViewport"))return globalImageIdSpecificToolStateManager.restoreToolState(e.imageIdToolState),Object.keys(e.elementViewport).forEach(function(t){var o=document.getElementById(t);if(o&&e.elementToolState.hasOwnProperty(t)){var n=getElementToolStateManager(o);if(n!==globalImageIdSpecificToolStateManager){n.restoreToolState(e.elementToolState[t]);var a=e.elementViewport[t];cornerstone.setViewport(o,a),cornerstone.updateImage(o)}}}),e}Object.defineProperty(t,"__esModule",{value:!0});var r={save:n,restore:a};t.default=r},function(e,t,o){"use strict";function n(){function e(e,t,o){!1===n.hasOwnProperty(e)&&(n[e]={});var a=n[e];!1===a.hasOwnProperty(t)&&(a[t]={data:[]}),a[t].data.push(o)}function t(e,t){if(!1!==n.hasOwnProperty(e)){var o=n[e];if(!1!==o.hasOwnProperty(t)){return o[t]}}}function o(e,t,o){if(!1!==n.hasOwnProperty(e)){var a=n[e];if(!1!==a.hasOwnProperty(t)){for(var r=a[t],i=-1,s=0;s<r.data.length;s++)r.data[s]===o&&(i=s);-1!==i&&r.data.splice(i,1)}}}var n={};return{get:t,add:e,remove:o}}Object.defineProperty(t,"__esModule",{value:!0});var a=n();t.newFrameOfReferenceSpecificToolStateManager=n,t.globalFrameOfReferenceSpecificToolStateManager=a},function(e,t,o){"use strict";function n(){function e(e){return s[e]}function t(e,t){s[e]=t}function o(){return s}function n(e){s=e}function a(e,t,o){var n=cornerstone.getEnabledElement(e);n.image&&!1!==s.hasOwnProperty(n.image.imageId)||(s[n.image.imageId]={});var a=s[n.image.imageId];!1===a.hasOwnProperty(t)&&(a[t]={data:[]}),a[t].data.push(o)}function r(e,t){var o=cornerstone.getEnabledElement(e);if(o.image&&!1!==s.hasOwnProperty(o.image.imageId)){var n=s[o.image.imageId];if(!1!==n.hasOwnProperty(t)){return n[t]}}}function i(e){var t=cornerstone.getEnabledElement(e);t.image&&!1!==s.hasOwnProperty(t.image.imageId)&&delete s[t.image.imageId]}var s={};return{get:r,add:a,clear:i,saveImageIdToolState:e,restoreImageIdToolState:t,saveToolState:o,restoreToolState:n,toolState:s}}Object.defineProperty(t,"__esModule",{value:!0});var a=n();t.newImageIdSpecificToolStateManager=n,t.globalImageIdSpecificToolStateManager=a},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(e){i=e}function t(){return i}function o(e){s=e}function n(){return s}function a(e){l=e}function r(){return l}var i,s,l;return{setStartLoadHandler:e,getStartLoadHandler:t,setEndLoadHandler:o,getEndLoadHandler:n,setErrorLoadingHandler:a,getErrorLoadingHandler:r}}},function(e,t,o){"use strict";function n(e,t){function o(){return i}function n(e){i=e}function a(o,n,a){if(!(e.indexOf(n)>=0))return t.add(o,n,a);!1===i.hasOwnProperty(n)&&(i[n]={data:[]}),i[n].data.push(a)}function r(o,n){if(e.indexOf(n)>=0){!1===i.hasOwnProperty(n)&&(i[n]={data:[]});return i[n]}return t.get(o,n)}var i={};return{get:r,add:a,saveToolState:o,restoreToolState:n,toolState:i}}function a(e,t){var o=getElementToolStateManager(e);o||(o=globalImageIdSpecificToolStateManager);var a=["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs"];t&&(a=a.concat(t));var i=n(a,o);r.push(i),setElementToolStateManager(e,i)}Object.defineProperty(t,"__esModule",{value:!0});var r=[];t.newStackSpecificToolStateManager=n,t.addStackStateManager=a},function(e,t,o){"use strict";function n(e,t){function o(o,n,r){if(!(e.indexOf(n)>=0))return t.add(o,n,r);!1===a.hasOwnProperty(n)&&(a[n]={data:[]}),a[n].data.push(r)}function n(o,n){if(e.indexOf(n)>=0){!1===a.hasOwnProperty(n)&&(a[n]={data:[]});return a[n]}return t.get(o,n)}var a={};return{get:n,add:o}}function a(e,t){t=t||["timeSeries"];var o=getElementToolStateManager(e);void 0===o&&(o=globalImageIdSpecificToolStateManager);var a=n(t,o);r.push(a),setElementToolStateManager(e,a)}Object.defineProperty(t,"__esModule",{value:!0});var r=[];t.addTimeSeriesStateManager=a,t.newTimeSeriesSpecificToolStateManager=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function e(e){o=e.currentPoints.canvas}function t(){return o}var o="";return{setCoords:e,getCoords:t}}},function(e,t,o){"use strict";function n(e,t){function o(e,t){i.length&&s.length&&(l=!0,s.forEach(function(o){var n=s.indexOf(o);if(-1!==n){var a=c.imageIds.targetElements[n],l=i.indexOf(e);if(-1!==l){var d,f=c.imageIds.sourceElements[l];d=f===a?0:c.distances[f][a],u(r,e,o,t,d)}}}),l=!1)}function n(e,t){!0!==l&&o(e.currentTarget,t)}function a(e){var t=e.detail,o=t.element;r.remove(o)}var r=this,i=[],s=[],l=!1,c={},u=t;this.setHandler=function(e){u=e},this.getHandler=function(){return u},this.getDistances=function(){i.length&&s.length&&(c.distances={},c.imageIds={sourceElements:[],targetElements:[]},i.forEach(function(e){var t=cornerstone.getEnabledElement(e);if(t&&t.image){var o=t.image.imageId,n=metaData.get("imagePlane",o);if(n&&n.imagePositionPatient){var a=n.imagePositionPatient;c.hasOwnProperty(t)||(c.distances[o]={},c.imageIds.sourceElements.push(o),s.forEach(function(t){var n=cornerstone.getEnabledElement(t);if(n&&n.image){var r=n.image.imageId;if(c.imageIds.targetElements.push(r),e!==t&&o!==r&&!c.distances[o].hasOwnProperty(r)){var i=metaData.get("imagePlane",r);if(i&&i.imagePositionPatient){var s=i.imagePositionPatient;c.distances[o][r]=s.clone().sub(a)}}}}),Object.keys(c.distances[o]).length||delete c.distances[o])}}}))},this.addSource=function(t){-1===i.indexOf(t)&&(i.push(t),$(t).on(e,n),r.getDistances(),r.updateDisableHandlers())},this.addTarget=function(e){-1===s.indexOf(e)&&(s.push(e),r.getDistances(),u(r,e,e,0),r.updateDisableHandlers())},this.add=function(e){r.addSource(e),r.addTarget(e)},this.removeSource=function(t){var a=i.indexOf(t);-1!==a&&(i.splice(a,1),$(t).off(e,n),r.getDistances(),o(t),r.updateDisableHandlers())},this.removeTarget=function(e){var t=s.indexOf(e);-1!==t&&(s.splice(t,1),r.getDistances(),u(r,e,e,0),r.updateDisableHandlers())},this.remove=function(e){r.removeTarget(e),r.removeSource(e)},this.getSourceElements=function(){return i},this.getTargetElements=function(){return s},this.displayImage=function(e,t,o){l=!0,cornerstone.displayImage(e,t,o),l=!1},this.setViewport=function(e,t){l=!0,cornerstone.setViewport(e,t),l=!1},this.updateDisableHandlers=function(){$.unique(i.concat(s)).forEach(function(e){e.removeEventListener("CornerstoneElementDisabled",a),e.addEventListener("CornerstoneElementDisabled",a)})},this.destroy=function(){$.unique(i.concat(s)).forEach(function(e){r.remove(e)})}}Object.defineProperty(t,"__esModule",{value:!0}),t.Synchronizer=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){if(o!==t){var n=cornerstone.getViewport(t),a=cornerstone.getViewport(o);a.scale===n.scale&&a.translation.x===n.translation.x&&a.translation.y===n.translation.y||(a.scale=n.scale,a.translation.x=n.translation.x,a.translation.y=n.translation.y,e.setViewport(o,a))}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){if(o!==t){var n=getToolState(t,"stack"),a=n.data[0],r=getToolState(o,"stack"),i=r.data[0],s=a.currentImageIdIndex;if((s=Math.min(Math.max(s,0),i.imageIds.length-1))!==i.currentImageIdIndex){var l=loadHandlerManager.getStartLoadHandler(),c=loadHandlerManager.getEndLoadHandler(),u=loadHandlerManager.getErrorLoadingHandler();l&&l(o);var d;d=!0===i.preventCache?cornerstone.loadImage(i.imageIds[s]):cornerstone.loadAndCacheImage(i.imageIds[s]),d.then(function(t){var n=cornerstone.getViewport(o);i.currentImageIdIndex=s,e.displayImage(o,t,n),c&&c(o,t)},function(e){var t=i.imageIds[s];u&&u(o,t,e)})}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,a){if(o!==t){var r=cornerstone.getEnabledElement(t),i=metaData.get("imagePlane",r.image.imageId),s=i.imagePositionPatient,l=getToolState(o,"stack"),c=l.data[0],u=Number.MAX_VALUE,d=-1;if(a){var f=s.clone().add(a);if(c.imageIds.forEach(function(e,t){var o=metaData.get("imagePlane",e),n=o.imagePositionPatient,a=f.distanceToSquared(n);a<u&&(u=a,d=t)}),d!==c.currentImageIdIndex&&-1!==d){var g=loadHandlerManager.getStartLoadHandler(),m=loadHandlerManager.getEndLoadHandler(),v=loadHandlerManager.getErrorLoadingHandler();g&&g(o);var h;h=!0===c.preventCache?cornerstone.loadImage(c.imageIds[d]):cornerstone.loadAndCacheImage(c.imageIds[d]),h.then(function(t){var n=cornerstone.getViewport(o);c.currentImageIdIndex=d,e.displayImage(o,t,n),m&&m(o,t)},function(e){var t=c.imageIds[d];v&&v(o,t,e)})}}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){if(o!==t){var n=cornerstone.getEnabledElement(t).image,a=metaData.get("imagePlane",n.imageId),r=a.imagePositionPatient,i=getToolState(o,"stack"),s=i.data[0],l=Number.MAX_VALUE,c=-1;if($.each(s.imageIds,function(e,t){var o=metaData.get("imagePlane",t),n=o.imagePositionPatient,a=n.distanceToSquared(r);a<l&&(l=a,c=e)}),c!==s.currentImageIdIndex){var u=loadHandlerManager.getStartLoadHandler(),d=loadHandlerManager.getEndLoadHandler(),f=loadHandlerManager.getErrorLoadingHandler();if(u&&u(o),-1!==c){var g;g=!0===s.preventCache?cornerstone.loadImage(s.imageIds[c]):cornerstone.loadAndCacheImage(s.imageIds[c]),g.then(function(t){var n=cornerstone.getViewport(o);s.currentImageIdIndex=c,e.displayImage(o,t,n),d&&d(o,t)},function(e){var t=s.imageIds[c];f&&f(o,t,e)})}}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n){if(t!==o&&n&&n.direction){var a=getToolState(o,"stack"),r=a.data[0],i=r.currentImageIdIndex+n.direction;if(i=Math.min(Math.max(i,0),r.imageIds.length-1),r.currentImageIdIndex!==i){var s=loadHandlerManager.getStartLoadHandler(),l=loadHandlerManager.getEndLoadHandler(),c=loadHandlerManager.getErrorLoadingHandler();s&&s(o);var u;u=!0===r.preventCache?cornerstone.loadImage(r.imageIds[i]):cornerstone.loadAndCacheImage(r.imageIds[i]),u.then(function(t){var n=cornerstone.getViewport(o);r.currentImageIdIndex=i,e.displayImage(o,t,n),l&&l(o,t)},function(e){var t=r.imageIds[i];c&&c(o,t,e)})}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){o!==t&&cornerstone.updateImage(o)}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){if(o!==t){var n=cornerstone.getViewport(t),a=cornerstone.getViewport(o);a.voi.windowWidth===n.voi.windowWidth&&a.voi.windowCenter===n.voi.windowCenter&&a.invert===n.invert||(a.voi.windowWidth=n.voi.windowWidth,a.voi.windowCenter=n.voi.windowCenter,a.invert=n.invert,e.setViewport(o,a))}}},function(e,t,o){"use strict";!function(e,t,o){function n(e,o,n){var a=getToolState(e,"timeSeries");if(void 0!==a&&void 0!==a.data&&0!==a.data.length){var r=a.data[0],i=r.stacks[r.currentStackIndex],s=i.currentImageIdIndex,l=r.currentStackIndex+o;if(n?(l>=r.stacks.length&&(l=0),l<0&&(l=r.stacks.length-1)):(l=Math.min(r.stacks.length-1,l),l=Math.max(0,l)),l!==r.currentStackIndex){var c=t.getViewport(e),u=r.stacks[l],d=loadHandlerManager.getStartLoadHandler(),f=loadHandlerManager.getEndLoadHandler(),g=loadHandlerManager.getErrorLoadingHandler();d&&d(e);var m;m=!0===u.preventCache?t.loadImage(u.imageIds[s]):t.loadAndCacheImage(u.imageIds[s]),m.then(function(o){r.currentImageIdIndex!==s&&(u.currentImageIdIndex=s,r.currentStackIndex=l,t.displayImage(e,o,c),f&&f(e,o))},function(t){var o=u.imageIds[s];g&&g(e,o,t)})}}}n=n}($,cornerstone)},function(e,t,o){"use strict";function n(e){var t=[];e.timeSeries.stacks.forEach(function(o){var n;n=!0===o.preventCache?cornerstone.loadImage(o.imageIds[e.imageIdIndex]):cornerstone.loadAndCacheImage(o.imageIds[e.imageIdIndex]),n.then(function(o){var n=Math.round(e.handles.end.x)+Math.round(e.handles.end.y)*o.width,a=o.getPixelData()[n];t.push(a)})}),e.lineSample.set(t)}function a(e){var t=getToolState(e.element,"timeSeries");if(void 0!==t&&void 0!==t.data&&0!==t.data.length){var o=t.data[0],a={timeSeries:o,lineSample:new LineSampleMeasurement,imageIdIndex:o.stacks[o.currentStackIndex].currentImageIdIndex,visible:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}};return n(a),MeasurementManager.add(a),a}}function r(e){var t=e.detail,o=getToolState(e.currentTarget,i);if(o){var n=t.canvasContext.canvas.getContext("2d");cornerstone.setToPixelCoordinateSystem(t.enabledElement,n);for(var a=0;a<o.data.length;a++){n.save();var r=o.data[a];n.beginPath(),drawHandles(n,t,r.handles,"white"),n.stroke();var s=setContextToDisplayFontSize(t.enabledElement,t.canvasContext,15);n.font=s.fontSize+"px Arial";var l=Math.round(r.handles.end.x),c=Math.round(r.handles.end.y),u=r.handles.end.x+3,d=r.handles.end.y-3;n.fillStyle="white",n.fillText(l+","+c,u,d),n.restore()}}}Object.defineProperty(t,"__esModule",{value:!0});var i="probe4D",s=mouseButtonTool({createNewMeasurement:a,onImageRendered:r,toolType:i});t.default=s},function(e,t,o){"use strict";function n(e,t){if(void 0===e)throw"playClip: element must not be undefined";void 0===t&&(t=30);var o=getToolState(e,"timeSeries");if(void 0!==o&&void 0!==o.data&&0!==o.data.length){var n,a=getToolState(e,r);void 0===a||0===a.data.length?(n={intervalId:void 0,framesPerSecond:t,lastFrameTimeStamp:void 0,frameRate:0},addToolState(e,r,n)):(n=a.data[0],n.framesPerSecond=t),void 0===n.intervalId&&(n.intervalId=setInterval(function(){n.framesPerSecond>0?incrementTimePoint(e,1,!0):incrementTimePoint(e,-1,!0)},1e3/Math.abs(n.framesPerSecond)))}}function a(e){var t,o=getToolState(e,r);void 0!==o&&0!==o.data.length&&(t=o.data[0],clearInterval(t.intervalId),t.intervalId=void 0)}Object.defineProperty(t,"__esModule",{value:!0});var r="timeSeriesPlayer",i={start:n,stop:a};t.default=i},function(e,t,o){"use strict";function n(e,t){$(t.element).off("CornerstoneToolsMouseDrag",r),$(t.element).off("CornerstoneToolsMouseUp",n),$(t.element).off("CornerstoneToolsMouseClick",n)}function a(e,t){if(isMouseButtonEnabled(t.which,e.data.mouseButtonMask)){var o={deltaY:0,options:e.data.options};return $(t.element).on("CornerstoneToolsMouseDrag",o,r),$(t.element).on("CornerstoneToolsMouseUp",n),$(t.element).on("CornerstoneToolsMouseClick",n),e.stopImmediatePropagation(),!1}}function r(e,t){e.data.deltaY+=t.deltaPoints.page.y;var o=getToolState(t.element,"timeSeries");if(void 0!==o&&void 0!==o.data&&0!==o.data.length){var n=o.data[0],a=$(t.element).height()/n.stacks.length;if(void 0!==e.data.options&&void 0!==e.data.options.timeSeriesScrollSpeed&&(a=e.data.options.timeSeriesScrollSpeed),e.data.deltaY>=a||e.data.deltaY<=-a){var r=Math.round(e.data.deltaY/a),i=e.data.deltaY%a;incrementTimePoint(t.element,r),e.data.deltaY=i}return!1}}function i(e,t){var o=-t.direction;incrementTimePoint(t.element,o)}function s(e){var t=e.originalEvent.detail,o={deltaY:0};o.deltaY+=t.deltaPoints.page.y;var n=getToolState(t.element,"stack");if(void 0!==n&&void 0!==n.data&&0!==n.data.length){if(o.deltaY>=3||o.deltaY<=-3){var a=o.deltaY/3,r=o.deltaY%3;setTimePoint(o.element,a),o.deltaY=r}return!1}}Object.defineProperty(t,"__esModule",{value:!0});var l=simpleMouseButtonTool(a),c=mouseWheelTool(i),u=touchDragTool(s);t.timeSeriesScroll=l,t.timeSeriesScrollWheel=c,t.timeSeriesScrollTouchDrag=u},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var o=0,n=0,a=0,r=0,i=t.top;i<t.top+t.height;i++)for(var s=t.left;s<t.left+t.width;s++){var l={x:s,y:i};pointInEllipse(t,l)&&(o+=e[r],n+=e[r]*e[r],a++),r++}if(0===a)return{count:a,mean:0,variance:0,stdDev:0};var c=o/a,u=n/a-c*c;return{count:a,mean:c,variance:u,stdDev:Math.sqrt(u)}}},function(e,t,o){"use strict";function n(e){return parseFloat("."+e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(dicomParser){var o=cornerstone.metaData.get("patientStudyModule",e.imageId),a=cornerstone.metaData.get("generalSeriesModule",e.imageId);if(o&&a){if("PT"===a.modality){var r=t*e.slope+e.intercept,i=o.patientWeight;if(i){var s=cornerstone.metaData.get("petIsotopeModule",e.imageId);if(s){var l=s.radiopharmaceuticalInfo,c=l.radiopharmaceuticalStartTime,u=l.radionuclideTotalDose,d=l.radionuclideHalfLife,f=a.seriesTime;if(c&&u&&d&&f){var g=n(f.fractionalSeconds||0)+f.seconds+60*f.minutes+60*f.hours*60,m=n(c.fractionalSeconds)+c.seconds+60*c.minutes+60*c.hours*60,v=g-m;return r*i/(u*Math.exp(-v*Math.log(2)/d))*1e3}}}}}}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{page:cornerstoneMath.point.copy(e.page),image:cornerstoneMath.point.copy(e.image),client:cornerstoneMath.point.copy(e.client),canvas:cornerstoneMath.point.copy(e.canvas)}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,a){var r=Math.atan2(o.y-t.y,o.x-t.x);e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(o.x,o.y),e.strokeStyle=n,e.lineWidth=a,e.stroke(),e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(o.x-10*Math.cos(r-Math.PI/7),o.y-10*Math.sin(r-Math.PI/7)),e.lineTo(o.x-10*Math.cos(r+Math.PI/7),o.y-10*Math.sin(r+Math.PI/7)),e.lineTo(o.x,o.y),e.lineTo(o.x-10*Math.cos(r-Math.PI/7),o.y-10*Math.sin(r-Math.PI/7)),e.strokeStyle=n,e.lineWidth=a,e.stroke(),e.fillStyle=n,e.fill()}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n){e.beginPath(),e.strokeStyle=o,e.lineWidth=n,e.arc(t.x,t.y,6,0,2*Math.PI),e.stroke()}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,a){var r=n/2*.5522848,i=a/2*.5522848,s=t+n,l=o+a,c=t+n/2,u=o+a/2;e.beginPath(),e.moveTo(t,u),e.bezierCurveTo(t,u-i,c-r,o,c,o),e.bezierCurveTo(c+r,o,s,u-i,s,u),e.bezierCurveTo(s,u+i,c+r,l,c,l),e.bezierCurveTo(c-r,l,t,u+i,t,u),e.closePath(),e.stroke()}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,a){if(!e)throw"getRGBPixels: parameter element must not be undefined";t=Math.round(t),o=Math.round(o);var r,i,s,l=cornerstone.getEnabledElement(e),c=[],u=0,d=l.image.getPixelData();if(l.image.color)for(i=0;i<a;i++)for(s=0;s<n;s++){r=4*((i+o)*l.image.columns+(s+t));var f=d[r],g=d[r+1],m=d[r+2],v=d[r+3];c[u++]=f,c[u++]=g,c[u++]=m,c[u++]=v}return c}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,!1}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o=e.width/2,n=e.height/2;if(o<=0||n<=0)return!1;var a={x:e.left+o,y:e.top+n},r={x:t.x-a.x,y:t.y-a.y};return r.x*r.x/(o*o)+r.y*r.y/(n*n)<=1}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o=(0,r.getToolState)(e,"stack");if(o&&o.data&&o.data.length){var n=o.data[0],i=n.currentImageIdIndex+t;i=Math.min(n.imageIds.length-1,i),i=Math.max(0,i),(0,a.default)(e,i)}};var n=o(21),a=function(e){return e&&e.__esModule?e:{default:e}}(n),r=o(0)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){return cornerstone.setToPixelCoordinateSystem(e,t,.1),{fontSize:o/e.viewport.scale/.1,lineHeight:o/e.viewport.scale/.1,fontScale:.1}}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.zoomTouchDrag=t.zoomTouchPinch=t.zoomWheel=t.zoom=t.wwwcRegionTouch=t.wwwcRegion=t.wwwcTouchDrag=t.wwwc=t.touchTool=t.touchPinchTool=t.touchDragTool=t.textMarkerTouch=t.textMarker=t.simpleMouseButtonTool=t.simpleAngleTouch=t.simpleAngle=t.seedAnnotateTouch=t.seedAnnotate=t.saveAs=t.rotateTouch=t.rotateTouchDrag=t.rotate=t.rectangleRoiTouch=t.rectangleRoi=t.probeTouch=t.probe=t.panMultiTouch=t.panTouchDrag=t.pan=t.orientationMarkers=t.multiTouchDragTool=t.mouseWheelTool=t.mouseButtonTool=t.mouseButtonRectangleTool=t.magnifyTouchDrag=t.magnify=t.lengthTouch=t.length=t.keyboardTool=t.imageStats=t.highlightTouch=t.highlight=t.freehand=void 0,t.ellipticalRoiTouch=t.ellipticalRoi=t.dragProbeTouch=t.dragProbe=t.doubleTapZoom=t.doubleTapTool=t.displayTool=t.crosshairsTouch=t.crosshairs=t.arrowAnnotateTouch=t.arrowAnnotate=t.angleTouch=t.angle=t.touchInput=t.preventGhostClick=t.mouseWheelInput=t.mouseInput=t.keyboardInput=t.touchMoveHandle=t.touchMoveAllHandles=t.moveNewHandleTouch=t.moveNewHandle=t.moveHandle=t.moveAllHandles=t.handleActivator=t.getHandleNearImagePoint=t.drawHandles=t.anyHandlesOutsideImage=t.stopClip=t.playClip=t.scrollIndicator=t.stackPrefetch=t.stackScrollMultiTouch=t.stackScrollTouchDrag=t.stackScrollWheel=t.stackScroll=t.stackScrollKeyboard=t.appState=t.globalFrameOfReferenceSpecificToolStateManager=t.newFrameOfReferenceSpecificToolStateManager=t.globalImageIdSpecificToolStateManager=t.newImageIdSpecificToolStateManager=t.loadHandlerManager=t.addStackStateManager=t.newStackSpecificToolStateManager=t.stackSpecificStateManager=t.textStyle=t.newTimeSeriesSpecificToolStateManager=t.addTimeSeriesStateManager=t.toolColors=t.toolCoordinates=t.getElementToolStateManager=t.setElementToolStateManager=t.clearToolState=t.removeToolState=t.getToolState=t.addToolState=t.toolStyle=t.panZoomSynchronizer=t.stackImageIndexSynchronizer=t.stackImagePositionOffsetSynchronizer=t.stackImagePositionSynchronizer=t.stackScrollSynchronizer=t.Synchronizer=t.updateImageSynchronizer=t.wwwcSynchronizer=t.timeSeriesScrollTouchDrag=t.timeSeriesScrollWheel=t.timeSeriesScroll=t.timeSeriesPlayer=t.incrementTimePoint=t.probeTool4D=t.calculateEllipseStatistics=t.calculateSUV=t.copyPoints=t.drawArrow=t.drawCircle=t.drawEllipse=t.drawTextBox=t.getLuminance=t.isMobileDevice=t.getBrowserInfo=t.getMaxSimultaneousRequests=t.getDefaultSimultaneousRequests=t.getRGBPixels=t.isMouseButtonEnabled=t.pauseEvent=t.pointInEllipse=t.pointInsideBoundingBox=t.planePlaneIntersection=t.imagePointToPatientPoint=t.projectPatientPointToImagePlane=t.roundToDecimal=t.scroll=t.scrollToIndex=t.setContextToDisplayFontSize=t.requestPoolManager=t.orientation=t.referenceLines=t.metaData=void 0;var n=o(12);Object.defineProperty(t,"metaData",{enumerable:!0,get:function(){return n.metaData}});var a=o(66);Object.defineProperty(t,"referenceLines",{enumerable:!0,get:function(){return a.referenceLines}});var r=o(13);Object.defineProperty(t,"orientation",{enumerable:!0,get:function(){return r.orientation}});var i=o(102);Object.defineProperty(t,"setContextToDisplayFontSize",{enumerable:!0,get:function(){return i.setContextToDisplayFontSize}});var s=o(21);Object.defineProperty(t,"scrollToIndex",{enumerable:!0,get:function(){return s.scrollToIndex}});var l=o(101);Object.defineProperty(t,"scroll",{enumerable:!0,get:function(){return l.scroll}});var c=o(20);Object.defineProperty(t,"roundToDecimal",{enumerable:!0,get:function(){return c.roundToDecimal}});var u=o(19);Object.defineProperty(t,"projectPatientPointToImagePlane",{enumerable:!0,get:function(){return u.projectPatientPointToImagePlane}}),Object.defineProperty(t,"imagePointToPatientPoint",{enumerable:!0,get:function(){return u.imagePointToPatientPoint}}),Object.defineProperty(t,"planePlaneIntersection",{enumerable:!0,get:function(){return u.planePlaneIntersection}});var d=o(18);Object.defineProperty(t,"pointInsideBoundingBox",{enumerable:!0,get:function(){return d.pointInsideBoundingBox}});var f=o(100);Object.defineProperty(t,"pointInEllipse",{enumerable:!0,get:function(){return f.pointInEllipse}});var g=o(99);Object.defineProperty(t,"pauseEvent",{enumerable:!0,get:function(){return g.pauseEvent}});var m=o(4);Object.defineProperty(t,"isMouseButtonEnabled",{enumerable:!0,get:function(){return m.isMouseButtonEnabled}});var v=o(98);Object.defineProperty(t,"getRGBPixels",{enumerable:!0,get:function(){return v.getRGBPixels}});var h=o(17);Object.defineProperty(t,"getDefaultSimultaneousRequests",{enumerable:!0,get:function(){return h.getDefaultSimultaneousRequests}}),Object.defineProperty(t,"getMaxSimultaneousRequests",{enumerable:!0,get:function(){return h.getMaxSimultaneousRequests}}),Object.defineProperty(t,"getBrowserInfo",{enumerable:!0,get:function(){return h.getBrowserInfo}}),Object.defineProperty(t,"isMobileDevice",{enumerable:!0,get:function(){return h.isMobileDevice}});var p=o(16);Object.defineProperty(t,"getLuminance",{enumerable:!0,get:function(){return p.getLuminance}});var T=o(3);Object.defineProperty(t,"drawTextBox",{enumerable:!0,get:function(){return T.drawTextBox}});var y=o(97);Object.defineProperty(t,"drawEllipse",{enumerable:!0,get:function(){return y.drawEllipse}});var C=o(96);Object.defineProperty(t,"drawCircle",{enumerable:!0,get:function(){return C.drawCircle}});var x=o(95);Object.defineProperty(t,"drawArrow",{enumerable:!0,get:function(){return x.drawArrow}});var M=o(94);Object.defineProperty(t,"copyPoints",{enumerable:!0,get:function(){return M.copyPoints}});var b=o(93);Object.defineProperty(t,"calculateSUV",{enumerable:!0,get:function(){return b.calculateSUV}});var P=o(92);Object.defineProperty(t,"calculateEllipseStatistics",{enumerable:!0,get:function(){return P.calculateEllipseStatistics}});var w=o(89);Object.defineProperty(t,"probeTool4D",{enumerable:!0,get:function(){return w.probeTool4D}});var S=o(88);Object.defineProperty(t,"incrementTimePoint",{enumerable:!0,get:function(){return S.incrementTimePoint}});var I=o(90);Object.defineProperty(t,"timeSeriesPlayer",{enumerable:!0,get:function(){return I.timeSeriesPlayer}});var k=o(91);Object.defineProperty(t,"timeSeriesScroll",{enumerable:!0,get:function(){return k.timeSeriesScroll}}),Object.defineProperty(t,"timeSeriesScrollWheel",{enumerable:!0,get:function(){return k.timeSeriesScrollWheel}}),Object.defineProperty(t,"timeSeriesScrollTouchDrag",{enumerable:!0,get:function(){return k.timeSeriesScrollTouchDrag}});var $=o(87);Object.defineProperty(t,"wwwcSynchronizer",{enumerable:!0,get:function(){return $.wwwcSynchronizer}});var O=o(86);Object.defineProperty(t,"updateImageSynchronizer",{enumerable:!0,get:function(){return O.updateImageSynchronizer}});var D=o(80);Object.defineProperty(t,"Synchronizer",{enumerable:!0,get:function(){return D.Synchronizer}});var E=o(85);Object.defineProperty(t,"stackScrollSynchronizer",{enumerable:!0,get:function(){return E.stackScrollSynchronizer}});var j=o(84);Object.defineProperty(t,"stackImagePositionSynchronizer",{enumerable:!0,get:function(){return j.stackImagePositionSynchronizer}});var _=o(83);Object.defineProperty(t,"stackImagePositionOffsetSynchronizer",{enumerable:!0,get:function(){return _.stackImagePositionOffsetSynchronizer}});var B=o(82);Object.defineProperty(t,"stackImageIndexSynchronizer",{enumerable:!0,get:function(){return B.stackImageIndexSynchronizer}});var R=o(81);Object.defineProperty(t,"panZoomSynchronizer",{enumerable:!0,get:function(){return R.panZoomSynchronizer}});var H=o(15);Object.defineProperty(t,"toolStyle",{enumerable:!0,get:function(){return H.toolStyle}});var A=o(0);Object.defineProperty(t,"addToolState",{enumerable:!0,get:function(){return A.addToolState}}),Object.defineProperty(t,"getToolState",{enumerable:!0,get:function(){return A.getToolState}}),Object.defineProperty(t,"removeToolState",{enumerable:!0,get:function(){return A.removeToolState}}),Object.defineProperty(t,"clearToolState",{enumerable:!0,get:function(){return A.clearToolState}}),Object.defineProperty(t,"setElementToolStateManager",{enumerable:!0,get:function(){return A.setElementToolStateManager}}),Object.defineProperty(t,"getElementToolStateManager",{enumerable:!0,get:function(){return A.getElementToolStateManager}});var L=o(79);Object.defineProperty(t,"toolCoordinates",{enumerable:!0,get:function(){return L.toolCoordinates}});var N=o(1);Object.defineProperty(t,"toolColors",{enumerable:!0,get:function(){return N.toolColors}});var V=o(78);Object.defineProperty(t,"addTimeSeriesStateManager",{enumerable:!0,get:function(){return V.addTimeSeriesStateManager}}),Object.defineProperty(t,"newTimeSeriesSpecificToolStateManager",{enumerable:!0,get:function(){return V.newTimeSeriesSpecificToolStateManager}});var W=o(14);Object.defineProperty(t,"textStyle",{enumerable:!0,get:function(){return W.textStyle}});var z=o(77);Object.defineProperty(t,"stackSpecificStateManager",{enumerable:!0,get:function(){return z.stackSpecificStateManager}}),Object.defineProperty(t,"newStackSpecificToolStateManager",{enumerable:!0,get:function(){return z.newStackSpecificToolStateManager}}),Object.defineProperty(t,"addStackStateManager",{enumerable:!0,get:function(){return z.addStackStateManager}});var Y=o(76);Object.defineProperty(t,"loadHandlerManager",{enumerable:!0,get:function(){return Y.loadHandlerManager}});var F=o(75);Object.defineProperty(t,"newImageIdSpecificToolStateManager",{enumerable:!0,get:function(){return F.newImageIdSpecificToolStateManager}}),Object.defineProperty(t,"globalImageIdSpecificToolStateManager",{enumerable:!0,get:function(){return F.globalImageIdSpecificToolStateManager}});var U=o(74);Object.defineProperty(t,"newFrameOfReferenceSpecificToolStateManager",{enumerable:!0,get:function(){return U.newFrameOfReferenceSpecificToolStateManager}}),Object.defineProperty(t,"globalFrameOfReferenceSpecificToolStateManager",{enumerable:!0,get:function(){return U.globalFrameOfReferenceSpecificToolStateManager}});var X=o(73);Object.defineProperty(t,"appState",{enumerable:!0,get:function(){return X.appState}});var q=o(72);Object.defineProperty(t,"stackScrollKeyboard",{enumerable:!0,get:function(){return q.stackScrollKeyboard}});var G=o(71);Object.defineProperty(t,"stackScroll",{enumerable:!0,get:function(){return G.stackScroll}}),Object.defineProperty(t,"stackScrollWheel",{enumerable:!0,get:function(){return G.stackScrollWheel}}),Object.defineProperty(t,"stackScrollTouchDrag",{enumerable:!0,get:function(){return G.stackScrollTouchDrag}}),Object.defineProperty(t,"stackScrollMultiTouch",{enumerable:!0,get:function(){return G.stackScrollMultiTouch}});var K=o(70);Object.defineProperty(t,"stackPrefetch",{enumerable:!0,get:function(){return K.stackPrefetch}});var Z=o(69);Object.defineProperty(t,"scrollIndicator",{enumerable:!0,get:function(){return Z.scrollIndicator}});var J=o(68);Object.defineProperty(t,"playClip",{enumerable:!0,get:function(){return J.playClip}}),Object.defineProperty(t,"stopClip",{enumerable:!0,get:function(){return J.stopClip}});var Q=o(11);Object.defineProperty(t,"anyHandlesOutsideImage",{enumerable:!0,get:function(){return Q.anyHandlesOutsideImage}});var ee=o(57);Object.defineProperty(t,"drawHandles",{enumerable:!0,get:function(){return ee.drawHandles}});var te=o(58);Object.defineProperty(t,"getHandleNearImagePoint",{enumerable:!0,get:function(){return te.getHandleNearImagePoint}});var oe=o(59);Object.defineProperty(t,"handleActivator",{enumerable:!0,get:function(){return oe.handleActivator}});var ne=o(60);Object.defineProperty(t,"moveAllHandles",{enumerable:!0,get:function(){return ne.moveAllHandles}});var ae=o(61);Object.defineProperty(t,"moveHandle",{enumerable:!0,get:function(){return ae.moveHandle}});var re=o(62);Object.defineProperty(t,"moveNewHandle",{enumerable:!0,get:function(){return re.moveNewHandle}});var ie=o(63);Object.defineProperty(t,"moveNewHandleTouch",{enumerable:!0,get:function(){return ie.moveNewHandleTouch}});var se=o(64);Object.defineProperty(t,"touchMoveAllHandles",{enumerable:!0,get:function(){return se.touchMoveAllHandles}});var le=o(65);Object.defineProperty(t,"touchMoveHandle",{enumerable:!0,get:function(){return le.touchMoveHandle}});var ce=o(52);Object.defineProperty(t,"keyboardInput",{enumerable:!0,get:function(){return ce.keyboardInput}});var ue=o(53);Object.defineProperty(t,"mouseInput",{enumerable:!0,get:function(){return ue.mouseInput}});var de=o(54);Object.defineProperty(t,"mouseWheelInput",{enumerable:!0,get:function(){return de.mouseWheelInput}});var fe=o(55);Object.defineProperty(t,"preventGhostClick",{enumerable:!0,get:function(){return fe.preventGhostClick}});var ge=o(56);Object.defineProperty(t,"touchInput",{enumerable:!0,get:function(){return ge.touchInput}});var me=o(24);Object.defineProperty(t,"angle",{enumerable:!0,get:function(){return me.angle}}),Object.defineProperty(t,"angleTouch",{enumerable:!0,get:function(){return me.angleTouch}});var ve=o(25);Object.defineProperty(t,"arrowAnnotate",{enumerable:!0,get:function(){return ve.arrowAnnotate}}),Object.defineProperty(t,"arrowAnnotateTouch",{enumerable:!0,get:function(){return ve.arrowAnnotateTouch}});var he=o(26);Object.defineProperty(t,"crosshairs",{enumerable:!0,get:function(){return he.crosshairs}}),Object.defineProperty(t,"crosshairsTouch",{enumerable:!0,get:function(){return he.crosshairsTouch}});var pe=o(5);Object.defineProperty(t,"displayTool",{enumerable:!0,get:function(){return pe.displayTool}});var Te=o(27);Object.defineProperty(t,"doubleTapTool",{enumerable:!0,get:function(){return Te.doubleTapTool}});var ye=o(28);Object.defineProperty(t,"doubleTapZoom",{enumerable:!0,get:function(){return ye.doubleTapZoom}});var Ce=o(29);Object.defineProperty(t,"dragProbe",{enumerable:!0,get:function(){return Ce.dragProbe}}),Object.defineProperty(t,"dragProbeTouch",{enumerable:!0,get:function(){return Ce.dragProbeTouch}});var xe=o(30);Object.defineProperty(t,"ellipticalRoi",{enumerable:!0,get:function(){return xe.ellipticalRoi}}),Object.defineProperty(t,"ellipticalRoiTouch",{enumerable:!0,get:function(){return xe.ellipticalRoiTouch}});var Me=o(31);Object.defineProperty(t,"freehand",{enumerable:!0,get:function(){return Me.freehand}});var be=o(32);Object.defineProperty(t,"highlight",{enumerable:!0,get:function(){return be.highlight}}),Object.defineProperty(t,"highlightTouch",{enumerable:!0,get:function(){return be.highlightTouch}});var Pe=o(33);Object.defineProperty(t,"imageStats",{enumerable:!0,get:function(){return Pe.imageStats}}),Object.defineProperty(t,"keyboardTool",{enumerable:!0,get:function(){return Pe.keyboardTool}});var we=o(34);Object.defineProperty(t,"length",{enumerable:!0,get:function(){return we.length}}),Object.defineProperty(t,"lengthTouch",{enumerable:!0,get:function(){return we.lengthTouch}});var Se=o(35);Object.defineProperty(t,"magnify",{enumerable:!0,get:function(){return Se.magnify}}),Object.defineProperty(t,"magnifyTouchDrag",{enumerable:!0,get:function(){return Se.magnifyTouchDrag}});var Ie=o(36);Object.defineProperty(t,"mouseButtonRectangleTool",{enumerable:!0,get:function(){return Ie.mouseButtonRectangleTool}});var ke=o(2);Object.defineProperty(t,"mouseButtonTool",{enumerable:!0,get:function(){return ke.mouseButtonTool}});var $e=o(6);Object.defineProperty(t,"mouseWheelTool",{enumerable:!0,get:function(){return $e.mouseWheelTool}});var Oe=o(37);Object.defineProperty(t,"multiTouchDragTool",{enumerable:!0,get:function(){return Oe.multiTouchDragTool}});var De=o(38);Object.defineProperty(t,"orientationMarkers",{enumerable:!0,get:function(){return De.orientationMarkers}});var Ee=o(39);Object.defineProperty(t,"pan",{enumerable:!0,get:function(){return Ee.pan}}),Object.defineProperty(t,"panTouchDrag",{enumerable:!0,get:function(){return Ee.panTouchDrag}});var je=o(40);Object.defineProperty(t,"panMultiTouch",{enumerable:!0,get:function(){return je.panMultiTouch}});var _e=o(41);Object.defineProperty(t,"probe",{enumerable:!0,get:function(){return _e.probe}}),Object.defineProperty(t,"probeTouch",{enumerable:!0,get:function(){return _e.probeTouch}});var Be=o(42);Object.defineProperty(t,"rectangleRoi",{enumerable:!0,get:function(){return Be.rectangleRoi}}),Object.defineProperty(t,"rectangleRoiTouch",{enumerable:!0,get:function(){return Be.rectangleRoiTouch}});var Re=o(43);Object.defineProperty(t,"rotate",{enumerable:!0,get:function(){return Re.rotate}}),Object.defineProperty(t,"rotateTouchDrag",{enumerable:!0,get:function(){return Re.rotateTouchDrag}});var He=o(44);Object.defineProperty(t,"rotateTouch",{enumerable:!0,get:function(){return He.rotateTouch}});var Ae=o(45);Object.defineProperty(t,"saveAs",{enumerable:!0,get:function(){return Ae.saveAs}});var Le=o(46);Object.defineProperty(t,"seedAnnotate",{enumerable:!0,get:function(){return Le.seedAnnotate}}),Object.defineProperty(t,"seedAnnotateTouch",{enumerable:!0,get:function(){return Le.seedAnnotateTouch}});var Ne=o(47);Object.defineProperty(t,"simpleAngle",{enumerable:!0,get:function(){return Ne.simpleAngle}}),Object.defineProperty(t,"simpleAngleTouch",{enumerable:!0,get:function(){return Ne.simpleAngleTouch}});var Ve=o(7);Object.defineProperty(t,"simpleMouseButtonTool",{enumerable:!0,get:function(){return Ve.simpleMouseButtonTool}});var We=o(48);Object.defineProperty(t,"textMarker",{enumerable:!0,get:function(){return We.textMarker}}),Object.defineProperty(t,"textMarkerTouch",{enumerable:!0,get:function(){return We.textMarkerTouch}});var ze=o(8);Object.defineProperty(t,"touchDragTool",{enumerable:!0,get:function(){return ze.touchDragTool}});var Ye=o(9);Object.defineProperty(t,"touchPinchTool",{enumerable:!0,get:function(){return Ye.touchPinchTool}});var Fe=o(10);Object.defineProperty(t,"touchTool",{enumerable:!0,get:function(){return Fe.touchTool}});var Ue=o(49);Object.defineProperty(t,"wwwc",{enumerable:!0,get:function(){return Ue.wwwc}}),Object.defineProperty(t,"wwwcTouchDrag",{enumerable:!0,get:function(){return Ue.wwwcTouchDrag}});var Xe=o(50);Object.defineProperty(t,"wwwcRegion",{enumerable:!0,get:function(){return Xe.wwwcRegion}}),Object.defineProperty(t,"wwwcRegionTouch",{enumerable:!0,get:function(){return Xe.wwwcRegionTouch}});var qe=o(51);Object.defineProperty(t,"zoom",{enumerable:!0,get:function(){return qe.zoom}}),Object.defineProperty(t,"zoomWheel",{enumerable:!0,get:function(){return qe.zoomWheel}}),Object.defineProperty(t,"zoomTouchPinch",{enumerable:!0,get:function(){return qe.zoomTouchPinch}}),Object.defineProperty(t,"zoomTouchDrag",{enumerable:!0,get:function(){return qe.zoomTouchDrag}});var Ge=o(67),Ke=function(e){return e&&e.__esModule?e:{default:e}}(Ge);t.requestPoolManager=Ke.default},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t="",o=e.x<0?"R":"L",n=e.y<0?"A":"P",a=e.z<0?"F":"H",r=new cornerstoneMath.Vector3(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z)),i=0;i<3;i++)if(r.x>1e-4&&r.x>r.y&&r.x>r.z)t+=o,r.x=0;else if(r.y>1e-4&&r.y>r.x&&r.y>r.z)t+=n,r.y=0;else{if(!(r.z>1e-4&&r.z>r.x&&r.z>r.y))break;t+=a,r.z=0}return t}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.replace("H","f");return t=t.replace("F","h"),t=t.replace("R","l"),t=t.replace("L","r"),t=t.replace("A","p"),t=t.replace("P","a"),t=t.toUpperCase()}},function(e,t,o){"use strict";function n(e){var t=e.detail,o=(0,i.getToolState)(e.currentTarget,c);if(void 0!==o){var n=o.data[0].synchronizationContext,a=n.getSourceElements(),r=o.data[0].renderer,s=t.canvasContext.canvas.getContext("2d");cornerstone.setToPixelCoordinateSystem(t.enabledElement,s),$.each(a,function(o,n){n!==e.currentTarget&&r(s,t,e.currentTarget,n)})}}function a(e,t,o){o=o||l.default,(0,i.addToolState)(e,c,{synchronizationContext:t,renderer:o}),e.addEventListener("CornerstoneImageRendered",n),cornerstone.updateImage(e)}function r(e){e.removeEventListener("CornerstoneImageRendered",n),cornerstone.updateImage(e)}Object.defineProperty(t,"__esModule",{value:!0});var i=o(0),s=o(23),l=function(e){return e&&e.__esModule?e:{default:e}}(s),c="referenceLines",u={enable:a,disable:r};t.default=u}]);
//# sourceMappingURL=cornerstoneTools.min.js.map