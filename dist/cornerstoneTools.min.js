/*! cornerstone-tools - 0.9.1 - 2017-10-18 | (c) 2017 Chris Hafey | https://github.com/chafey/cornerstoneTools */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("cornerstone-math"),require("hammerjs"),require("jquery")):"function"==typeof define&&define.amd?define("cornerstoneTools",["cornerstone-math","hammerjs","jquery"],t):"object"==typeof exports?exports.cornerstoneTools=t(require("cornerstone-math"),require("hammerjs"),require("jquery")):e.cornerstoneTools=t(e.cornerstoneMath,e.Hammer,e.$)}(this,function(e,t,o){return function(e){function t(n){if(o[n])return o[n].exports;var a=o[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var o={};return t.m=e,t.c=o,t.i=function(e){return e},t.d=function(e,o,n){t.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=107)}([function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.external=t.cornerstoneMath=t.Hammer=t.$=void 0;var a=o(116),r=n(a),i=o(115),l=n(i),s=o(114),u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t.default=e,t}(s),c=void 0,d={set cornerstone(e){c=e},get cornerstone(){return c}};t.$=r.default,t.Hammer=l.default,t.cornerstoneMath=u,t.external=d},function(e,t,o){"use strict";function n(e){var t=u.external.cornerstone.getEnabledElement(e);return void 0===t.toolStateManager&&(t.toolStateManager=c.globalImageIdSpecificToolStateManager),t.toolStateManager}function a(e,t,o){n(e).add(e,t,o);var a={toolType:t,element:e,measurementData:o};(0,u.$)(e).trigger("CornerstoneToolsMeasurementAdded",a)}function r(e,t){return n(e).get(e,t)}function i(e,t,o){for(var a=n(e),r=a.get(e,t),i=-1,l=0;l<r.data.length;l++)r.data[l]===o&&(i=l);if(-1!==i){r.data.splice(i,1);var s={toolType:t,element:e,measurementData:o};(0,u.$)(e).trigger("CornerstoneToolsMeasurementRemoved",s)}}function l(e,t){var o=n(e),a=o.get(e,t);void 0!==a&&(a.data=[])}function s(e,t){u.external.cornerstone.getEnabledElement(e).toolStateManager=t}Object.defineProperty(t,"__esModule",{value:!0}),t.getElementToolStateManager=t.setElementToolStateManager=t.clearToolState=t.removeToolState=t.getToolState=t.addToolState=void 0;var u=o(0),c=o(15);t.addToolState=a,t.getToolState=r,t.removeToolState=i,t.clearToolState=l,t.setElementToolStateManager=s,t.getElementToolStateManager=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return 0!=(t&1<<e-1)}},function(e,t,o){"use strict";function n(e){f=e}function a(){return f}function r(e){c=e}function i(){return c}function l(e){d=e}function s(){return d}function u(e){return e?d:c}Object.defineProperty(t,"__esModule",{value:!0});var c="white",d="greenyellow",f="transparent",g={setFillColor:n,getFillColor:a,setToolColor:r,getToolColor:i,setActiveColor:l,getActiveColor:s,getColorIfActive:u};t.default=g},function(e,t,o){"use strict";function n(e){l=e}function a(){return l}function r(e){s=e}function i(){return s}Object.defineProperty(t,"__esModule",{value:!0});var l=1,s=2,u={setToolWidth:n,getToolWidth:a,setActiveWidth:r,getActiveWidth:i};t.default=u},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,r,i){"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);var l=a.default.getFont(),s=a.default.getFontSize(),u=a.default.getBackgroundColor();e.save(),e.font=l,e.textBaseline="top",e.strokeStyle=r;var c=0;t.forEach(function(t){var o=e.measureText(t).width;c=Math.max(c,o)}),e.fillStyle=u;var d={width:c+10,height:5+t.length*(s+5)};return i&&i.centering&&!0===i.centering.x&&(o-=d.width/2),i&&i.centering&&!0===i.centering.y&&(n-=d.height/2),d.left=o,d.top=n,i&&!0===i.debug&&(e.fillStyle="#FF0000"),e.fillRect(d.left,d.top,d.width,d.height),t.forEach(function(t,a){e.fillStyle=r,e.fillText(t,o+5,n+5+a*(s+5))}),e.restore(),d};var n=o(13),a=function(e){return e&&e.__esModule?e:{default:e}}(n)},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(t){var i=a.external.cornerstone,l=t.element,s=e.createNewMeasurement(t);if(s){var u={mouseButtonMask:t.which};(0,y.addToolState)(t.element,e.toolType,s),(0,a.$)(l).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||n),(0,a.$)(l).off("CornerstoneToolsMouseDown",e.mouseDownCallback||r),(0,a.$)(l).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||o),e.mouseDoubleClickCallback&&(0,a.$)(l).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),i.updateImage(l);var c=void 0;c=1===Object.keys(s.handles).length?f.default:m.default;var d=void 0;d=!(!e.options||void 0===e.options.preventHandleOutsideImage)&&e.options.preventHandleOutsideImage,c(t,e.toolType,s,s.handles.end,function(){s.active=!1,s.invalidated=!0,(0,T.default)(t,s.handles)&&(0,y.removeToolState)(l,e.toolType,s),(0,a.$)(l).on("CornerstoneToolsMouseMove",u,e.mouseMoveCallback||n),(0,a.$)(l).on("CornerstoneToolsMouseDown",u,e.mouseDownCallback||r),(0,a.$)(l).on("CornerstoneToolsMouseDownActivate",u,e.mouseDownActivateCallback||o),e.mouseDoubleClickCallback&&(0,a.$)(l).on("CornerstoneToolsMouseDoubleClick",u,e.mouseDoubleClickCallback),i.updateImage(l)},d)}}function o(o,n){if((0,x.default)(n.which,o.data.mouseButtonMask))return e.addNewMeasurement?e.addNewMeasurement(n):t(n),!1}function n(t,o){if(i.default.setCoords(o),0===o.which){var n=(0,y.getToolState)(o.element,e.toolType);if(n){for(var r=!1,l=0;l<n.data.length;l++){var s=o.currentPoints.canvas,u=n.data[l];!0===(0,c.default)(o.element,u.handles,s)&&(r=!0),(e.pointNearTool(o.element,u,s)&&!u.active||!e.pointNearTool(o.element,u,s)&&u.active)&&(u.active=!u.active,r=!0)}!0===r&&a.external.cornerstone.updateImage(o.element)}}}function r(t,o){function r(){i.invalidated=!0,(0,T.default)(o,i.handles)&&(0,y.removeToolState)(l,e.toolType,i),a.external.cornerstone.updateImage(l),(0,a.$)(l).on("CornerstoneToolsMouseMove",o,e.mouseMoveCallback||n)}var i=void 0,l=o.element;if((0,x.default)(o.which,t.data.mouseButtonMask)){var u=o.startPoints.canvas,c=(0,y.getToolState)(t.currentTarget,e.toolType);if(c){var d=void 0,g=void 0;for(g=!(!e.options||void 0===e.options.preventHandleOutsideImage)&&e.options.preventHandleOutsideImage,d=0;d<c.data.length;d++){i=c.data[d];var m=(0,s.default)(l,i.handles,u,6);if(m)return(0,a.$)(l).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||n),i.active=!0,(0,f.default)(o,e.toolType,i,m,r,g),t.stopImmediatePropagation(),!1}if(e.pointNearTool){var v=e.options||{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1};for(d=0;d<c.data.length;d++)if(i=c.data[d],i.active=!1,e.pointNearTool(l,i,u))return i.active=!0,(0,a.$)(l).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||n),(0,h.default)(t,i,c,e.toolType,v,r),t.stopImmediatePropagation(),!1}}}}function l(t){(0,a.$)(t).off("CornerstoneImageRendered",e.onImageRendered),(0,a.$)(t).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||n),(0,a.$)(t).off("CornerstoneToolsMouseDown",e.mouseDownCallback||r),(0,a.$)(t).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||o),e.mouseDoubleClickCallback&&(0,a.$)(t).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),a.external.cornerstone.updateImage(t)}function u(t){(0,a.$)(t).off("CornerstoneImageRendered",e.onImageRendered),(0,a.$)(t).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||n),(0,a.$)(t).off("CornerstoneToolsMouseDown",e.mouseDownCallback||r),(0,a.$)(t).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||o),e.mouseDoubleClickCallback&&(0,a.$)(t).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),(0,a.$)(t).on("CornerstoneImageRendered",e.onImageRendered),a.external.cornerstone.updateImage(t)}function d(t,i){var l={mouseButtonMask:i};(0,a.$)(t).off("CornerstoneImageRendered",e.onImageRendered),(0,a.$)(t).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||n),(0,a.$)(t).off("CornerstoneToolsMouseDown",e.mouseDownCallback||r),(0,a.$)(t).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||o),(0,a.$)(t).on("CornerstoneImageRendered",e.onImageRendered),(0,a.$)(t).on("CornerstoneToolsMouseMove",l,e.mouseMoveCallback||n),(0,a.$)(t).on("CornerstoneToolsMouseDown",l,e.mouseDownCallback||r),(0,a.$)(t).on("CornerstoneToolsMouseDownActivate",l,e.mouseDownActivateCallback||o),e.mouseDoubleClickCallback&&((0,a.$)(t).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),(0,a.$)(t).on("CornerstoneToolsMouseDoubleClick",l,e.mouseDoubleClickCallback)),a.external.cornerstone.updateImage(t)}function g(t,i){var l={mouseButtonMask:i},s="CornerstoneToolsToolDeactivated",u={mouseButtonMask:i,toolType:e.toolType,type:s},c=a.$.Event(s,u);(0,a.$)(t).trigger(c,u),(0,a.$)(t).off("CornerstoneImageRendered",e.onImageRendered),(0,a.$)(t).off("CornerstoneToolsMouseMove",e.mouseMoveCallback||n),(0,a.$)(t).off("CornerstoneToolsMouseDown",e.mouseDownCallback||r),(0,a.$)(t).off("CornerstoneToolsMouseDownActivate",e.mouseDownActivateCallback||o),(0,a.$)(t).on("CornerstoneImageRendered",e.onImageRendered),(0,a.$)(t).on("CornerstoneToolsMouseMove",l,e.mouseMoveCallback||n),(0,a.$)(t).on("CornerstoneToolsMouseDown",l,e.mouseDownCallback||r),e.mouseDoubleClickCallback&&((0,a.$)(t).off("CornerstoneToolsMouseDoubleClick",e.mouseDoubleClickCallback),(0,a.$)(t).on("CornerstoneToolsMouseDoubleClick",l,e.mouseDoubleClickCallback)),a.external.cornerstone.updateImage(t)}function v(){return C}function p(e){C=e}var C={},b={enable:u,disable:l,activate:d,deactivate:g,getConfiguration:v,setConfiguration:p,mouseDownCallback:r,mouseMoveCallback:n,mouseDownActivateCallback:o};return e.pointNearTool&&(b.pointNearTool=e.pointNearTool),e.mouseDoubleClickCallback&&(b.mouseDoubleClickCallback=e.mouseDoubleClickCallback),e.addNewMeasurement&&(b.addNewMeasurement=e.addNewMeasurement),b};var a=o(0),r=o(28),i=n(r),l=o(14),s=n(l),u=o(25),c=n(u),d=o(20),f=n(d),g=o(21),m=n(g),v=o(26),h=n(v),p=o(11),T=n(p),C=o(2),x=n(C),y=o(1)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,a,l){e.strokeStyle=a,Object.keys(o).forEach(function(a){var s=o[a];if(!0!==s.drawnIndependently&&(!l||!0!==l.drawHandlesIfActive||s.active)){e.beginPath(),s.active?e.lineWidth=r.default.getActiveWidth():e.lineWidth=r.default.getToolWidth();var u=n.external.cornerstone.pixelToCanvas(t.element,s);e.arc(u.x,u.y,i,0,2*Math.PI),l&&l.fill&&(e.fillStyle=l.fill,e.fill()),e.stroke()}})};var n=o(0),a=o(4),r=function(e){return e&&e.__esModule?e:{default:e}}(a),i=6},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){Object.keys(e).forEach(function(t){e[t].active=!1})}function r(e){if(e)for(var t=0;t<e.data.length;t++){var o=e.data[t];o.active=!1,o.handles&&a(o.handles)}}function i(e){function t(t){var r=l.external.cornerstone,i=t.element,s=e.createNewMeasurement(t);if(s){if((0,T.addToolState)(i,e.toolType,s),1===Object.keys(s.handles).length&&"CornerstoneToolsTap"===t.type)return s.active=!1,s.handles.end.active=!1,s.handles.end.highlight=!1,s.invalidated=!0,(0,u.default)(t,s.handles)&&(0,T.removeToolState)(i,e.toolType,s),void r.updateImage(i);(0,l.$)(i).off("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||o),(0,l.$)(i).off("CornerstoneToolsTap",e.tapCallback||n),(0,l.$)(i).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),r.updateImage(i),(0,v.default)(t,e.toolType,s,s.handles.end,function(){s.active=!1,s.invalidated=!0,(0,u.default)(t,s.handles)&&(0,T.removeToolState)(i,e.toolType,s),(0,l.$)(i).on("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||o),(0,l.$)(i).on("CornerstoneToolsTap",e.tapCallback||n),(0,l.$)(i).on("CornerstoneToolsTouchStart",e.touchStartCallback||a),r.updateImage(i)})}}function o(o,n){return e.addNewMeasurement?e.addNewMeasurement(n):t(n),!1}function n(t,i){function s(){r(v),(0,u.default)(i,h.handles)&&(0,T.removeToolState)(f,e.toolType,h),c.updateImage(f),(0,l.$)(f).on("CornerstoneToolsTouchStart",e.touchStartCallback||a),(0,l.$)(f).on("CornerstoneToolsTap",e.tapCallback||n)}var c=l.external.cornerstone,f=i.element,m=i.currentPoints.canvas,v=(0,T.getToolState)(t.currentTarget,e.toolType),h=void 0,C=void 0;if(r(v),v)for(C=0;C<v.data.length;C++){h=v.data[C];var x=(0,d.default)(f,h.handles,m,25);if(x)return(0,l.$)(f).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),(0,l.$)(f).off("CornerstoneToolsTap",e.tapCallback||n),h.active=!0,x.active=!0,c.updateImage(f),(0,g.default)(t,e.toolType,h,x,s),t.stopImmediatePropagation(),!1}if(v&&e.pointNearTool)for(C=0;C<v.data.length;C++)if(h=v.data[C],e.pointNearTool(f,h,m))return(0,l.$)(f).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),(0,l.$)(f).off("CornerstoneToolsTap",e.tapCallback||n),h.active=!0,c.updateImage(f),(0,p.default)(t,h,v,e.toolType,!0,s),t.stopImmediatePropagation(),!1;return e.touchDownActivateCallback?e.touchDownActivateCallback(t,i):o(t,i),!1}function a(t,o){function r(t,r){if(f.active=!1,f.invalidated=!0,(0,u.default)(o,f.handles)&&(0,T.removeToolState)(o.element,e.toolType,f),i.updateImage(o.element),(0,l.$)(s).on("CornerstoneToolsTouchStart",e.touchStartCallback||a),(0,l.$)(s).on("CornerstoneToolsTap",e.tapCallback||n),e.pressCallback&&(0,l.$)(s).on("CornerstoneToolsTouchPress",e.pressCallback),t&&"CornerstoneToolsTouchPress"===t.type){var c=l.$.Event(t.type,r);(0,l.$)(s).trigger(c,r)}}var i=l.external.cornerstone,s=o.element,c=o.startPoints.canvas,f=void 0,m=(0,T.getToolState)(t.currentTarget,e.toolType),v=void 0;if(m){for(v=0;v<m.data.length;v++){f=m.data[v];var h=(0,d.default)(o.element,f.handles,c,28);if(h)return(0,l.$)(s).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),(0,l.$)(s).off("CornerstoneToolsTap",e.tapCallback||n),e.pressCallback&&(0,l.$)(s).off("CornerstoneToolsTouchPress",e.pressCallback),f.active=!0,(0,g.default)(t,e.toolType,f,h,r),t.stopImmediatePropagation(),!1}if(e.pointNearTool)for(v=0;v<m.data.length;v++)if(f=m.data[v],e.pointNearTool(o.element,f,c))return(0,l.$)(s).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),(0,l.$)(s).off("CornerstoneToolsTap",e.tapCallback||n),e.pressCallback&&(0,l.$)(s).off("CornerstoneToolsTouchPress",e.pressCallback),(0,p.default)(t,f,m,e.toolType,!0,r),t.stopImmediatePropagation(),!1}}function i(t){(0,l.$)(t).off("CornerstoneImageRendered",e.onImageRendered),(0,l.$)(t).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),(0,l.$)(t).off("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||o),(0,l.$)(t).off("CornerstoneToolsTap",e.tapCallback||n),e.doubleTapCallback&&(0,l.$)(t).off("CornerstoneToolsDoubleTap",e.doubleTapCallback),e.pressCallback&&(0,l.$)(t).off("CornerstoneToolsTouchPress",e.pressCallback),l.external.cornerstone.updateImage(t)}function s(t){(0,l.$)(t).off("CornerstoneImageRendered",e.onImageRendered),(0,l.$)(t).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),(0,l.$)(t).off("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||o),(0,l.$)(t).off("CornerstoneToolsTap",e.tapCallback||n),(0,l.$)(t).on("CornerstoneImageRendered",e.onImageRendered),e.doubleTapCallback&&(0,l.$)(t).off("CornerstoneToolsDoubleTap",e.doubleTapCallback),e.pressCallback&&(0,l.$)(t).off("CornerstoneToolsTouchPress",e.pressCallback),l.external.cornerstone.updateImage(t)}function c(t){(0,l.$)(t).off("CornerstoneImageRendered",e.onImageRendered),(0,l.$)(t).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),(0,l.$)(t).off("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||o),(0,l.$)(t).off("CornerstoneToolsTap",e.tapCallback||n),(0,l.$)(t).on("CornerstoneImageRendered",e.onImageRendered),(0,l.$)(t).on("CornerstoneToolsTouchStart",e.touchStartCallback||a),(0,l.$)(t).on("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||o),(0,l.$)(t).on("CornerstoneToolsTap",e.tapCallback||n),e.doubleTapCallback&&((0,l.$)(t).off("CornerstoneToolsDoubleTap",e.doubleTapCallback),(0,l.$)(t).on("CornerstoneToolsDoubleTap",e.doubleTapCallback)),e.pressCallback&&((0,l.$)(t).off("CornerstoneToolsTouchPress",e.pressCallback),(0,l.$)(t).on("CornerstoneToolsTouchPress",e.pressCallback)),l.external.cornerstone.updateImage(t)}function f(t){var r="CornerstoneToolsToolDeactivated",i={toolType:e.toolType,type:r},s=l.$.Event(r,i);(0,l.$)(t).trigger(s,i),(0,l.$)(t).off("CornerstoneImageRendered",e.onImageRendered),(0,l.$)(t).off("CornerstoneToolsTouchStart",e.touchStartCallback||a),(0,l.$)(t).off("CornerstoneToolsTouchStartActive",e.touchDownActivateCallback||o),(0,l.$)(t).off("CornerstoneToolsTap",e.tapCallback||n),(0,l.$)(t).on("CornerstoneImageRendered",e.onImageRendered),(0,l.$)(t).on("CornerstoneToolsTouchStart",e.touchStartCallback||a),e.doubleTapCallback&&(0,l.$)(t).off("CornerstoneToolsDoubleTap",e.doubleTapCallback),e.pressCallback&&(0,l.$)(t).off("CornerstoneToolsTouchPress",e.pressCallback),l.external.cornerstone.updateImage(t)}var m={enable:s,disable:i,activate:c,deactivate:f,touchStartCallback:e.touchStartCallback||a,touchDownActivateCallback:e.touchDownActivateCallback||o,tapCallback:e.tapCallback||n};return e.pointNearTool&&(m.pointNearTool=e.pointNearTool),e.doubleTapCallback&&(m.doubleTapCallback=e.doubleTapCallback),e.pressCallback&&(m.pressCallback=e.pressCallback),e.addNewMeasurement&&(m.addNewMeasurement=e.addNewMeasurement),m}Object.defineProperty(t,"__esModule",{value:!0});var l=o(0),s=o(11),u=n(s),c=o(14),d=n(c),f=o(43),g=n(f),m=o(22),v=n(m),h=o(42),p=n(h),T=o(1);t.default=i},function(e,t,o){"use strict";function n(e){u=e}function a(){return u}function r(e){c=e}function i(){return c}function l(e){d=e}function s(){return d}Object.defineProperty(t,"__esModule",{value:!0});var u=void 0,c=void 0,d=void 0,f={setStartLoadHandler:n,getStartLoadHandler:a,setEndLoadHandler:r,getEndLoadHandler:i,setErrorLoadingHandler:l,getErrorLoadingHandler:s};t.default=f},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o="CornerstoneToolsTouchDrag";return t&&!0===t.fireOnTouchStart&&(o+=" CornerstoneToolsTouchStart"),{activate:function(a){(0,n.$)(a).off(o,e),t&&t.eventData?(0,n.$)(a).on(o,t.eventData,e):(0,n.$)(a).on(o,e),t&&t.activateCallback&&t.activateCallback(a)},disable:function(a){(0,n.$)(a).off(o,e),t&&t.disableCallback&&t.disableCallback(a)},enable:function(a){(0,n.$)(a).off(o,e),t&&t.enableCallback&&t.enableCallback(a)},deactivate:function(a){(0,n.$)(a).off(o,e),t&&t.deactivateCallback&&t.deactivateCallback(a)}}};var n=o(0)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o=e.image,a={left:0,top:0,width:o.width,height:o.height},r=!1;return Object.keys(t).forEach(function(e){var o=t[e];!0!==o.allowedOutsideImage&&!1===n.cornerstoneMath.point.insideRect(o,a)&&(r=!0)}),r};var n=o(0)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={};return{activate:function(t,o,a){(0,n.$)(t).off("CornerstoneToolsMouseDownActivate",e);var r={mouseButtonMask:o,options:a};(0,n.$)(t).on("CornerstoneToolsMouseDownActivate",r,e)},disable:function(t){(0,n.$)(t).off("CornerstoneToolsMouseDownActivate",e)},enable:function(t){(0,n.$)(t).off("CornerstoneToolsMouseDownActivate",e)},deactivate:function(t){(0,n.$)(t).off("CornerstoneToolsMouseDownActivate",e)},getConfiguration:function(){return t},setConfiguration:function(e){t=e}}};var n=o(0)},function(e,t,o){"use strict";function n(e){c=e}function a(){return c}function r(e){u=e}function i(){return u}function l(e){d=e}function s(){return d}Object.defineProperty(t,"__esModule",{value:!0});var u=15,c=u+"px Arial",d="transparent",f={setFont:n,getFont:a,setFontSize:r,getFontSize:i,setBackgroundColor:l,getBackgroundColor:s};t.default=f},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,a){var i=void 0;if(t)return Object.keys(t).forEach(function(l){var s=t[l];if(s.hasOwnProperty("pointNearHandle")){if(s.pointNearHandle(e,s,o))return void(i=s)}else if(!0===s.hasBoundingBox){if((0,r.default)(s,o))return void(i=s)}else{var u=n.external.cornerstone.pixelToCanvas(e,s),c=n.cornerstoneMath.point.distance(u,o);if(c<=a)return void(i=s)}}),i};var n=o(0),a=o(17),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,o){"use strict";function n(){function e(e){return s[e]}function t(e,t){s[e]=t}function o(){return s}function n(e){s=e}function r(e,t,o){var n=a.external.cornerstone.getEnabledElement(e);n.image&&!1!==s.hasOwnProperty(n.image.imageId)||(s[n.image.imageId]={});var r=s[n.image.imageId];!1===r.hasOwnProperty(t)&&(r[t]={data:[]}),r[t].data.push(o)}function i(e,t){var o=a.external.cornerstone.getEnabledElement(e);if(o.image&&!1!==s.hasOwnProperty(o.image.imageId)){var n=s[o.image.imageId];if(!1!==n.hasOwnProperty(t)){return n[t]}}}function l(e){var t=a.external.cornerstone.getEnabledElement(e);t.image&&!1!==s.hasOwnProperty(t.image.imageId)&&delete s[t.image.imageId]}var s={};return{get:i,add:r,clear:l,saveImageIdToolState:e,restoreImageIdToolState:t,saveToolState:o,restoreToolState:n,toolState:s}}Object.defineProperty(t,"__esModule",{value:!0}),t.globalImageIdSpecificToolStateManager=t.newImageIdSpecificToolStateManager=void 0;var a=o(0),r=n();t.newImageIdSpecificToolStateManager=n,t.globalImageIdSpecificToolStateManager=r},function(e,t,o){"use strict";function n(e){return parseFloat("."+e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o=a.external.cornerstone,r=o.metaData.get("patientStudyModule",e.imageId),i=o.metaData.get("generalSeriesModule",e.imageId);if(r&&i){if("PT"===i.modality){var l=t*e.slope+e.intercept,s=r.patientWeight;if(s){var u=o.metaData.get("petIsotopeModule",e.imageId);if(u){var c=u.radiopharmaceuticalInfo,d=c.radiopharmaceuticalStartTime,f=c.radionuclideTotalDose,g=c.radionuclideHalfLife,m=i.seriesTime;if(d&&f&&g&&m){var v=n(m.fractionalSeconds||0)+m.seconds+60*m.minutes+60*m.hours*60,h=n(d.fractionalSeconds)+d.seconds+60*d.minutes+60*d.hours*60,p=v-h;return l*s/(f*Math.exp(-p*Math.log(2)/g))*1e3}}}}}};var a=o(0)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(e.boundingBox)return n.cornerstoneMath.point.insideRect(t,e.boundingBox)};var n=o(0)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={};return{disable:function(t){(0,n.$)(t).off("CornerstoneImageRendered",e)},enable:function(t){(0,n.$)(t).off("CornerstoneImageRendered",e),(0,n.$)(t).on("CornerstoneImageRendered",e),n.external.cornerstone.updateImage(t)},getConfiguration:function(){return t},setConfiguration:function(e){t=e}}};var n=o(0)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{activate:function(t){(0,n.$)(t).off("CornerstoneToolsMouseWheel",e);var o={};(0,n.$)(t).on("CornerstoneToolsMouseWheel",o,e)},disable:function(t){(0,n.$)(t).off("CornerstoneToolsMouseWheel",e)},enable:function(t){(0,n.$)(t).off("CornerstoneToolsMouseWheel",e)},deactivate:function(t){(0,n.$)(t).off("CornerstoneToolsMouseWheel",e)}}};var n=o(0)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,a,r,i){function l(e,r){!1===a.hasMoved&&(a.hasMoved=!0),a.active=!0,a.x=r.currentPoints.image.x+d.x,a.y=r.currentPoints.image.y+d.y,i&&(a.x=Math.max(a.x,0),a.x=Math.min(a.x,r.image.width),a.y=Math.max(a.y,0),a.y=Math.min(a.y,r.image.height)),u.updateImage(c);var l={toolType:t,element:c,measurementData:o};(0,n.$)(c).trigger("CornerstoneToolsMeasurementModified",l)}function s(){a.active=!1,(0,n.$)(c).off("CornerstoneToolsMouseDrag",l),(0,n.$)(c).off("CornerstoneToolsMouseUp",s),(0,n.$)(c).off("CornerstoneToolsMouseClick",s),u.updateImage(c),"function"==typeof r&&r()}var u=n.external.cornerstone,c=e.element,d={x:a.x-e.currentPoints.image.x,y:a.y-e.currentPoints.image.y};(0,n.$)(c).on("CornerstoneToolsMouseDrag",l),(0,n.$)(c).on("CornerstoneToolsMouseUp",s),(0,n.$)(c).on("CornerstoneToolsMouseClick",s)};var n=o(0)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,a,r,i){function l(e,r){a.active=!0,a.x=r.currentPoints.image.x,a.y=r.currentPoints.image.y,i&&(a.x=Math.max(a.x,0),a.x=Math.min(a.x,r.image.width),a.y=Math.max(a.y,0),a.y=Math.min(a.y,r.image.height)),f.updateImage(g);var l={toolType:t,element:g,measurementData:o};(0,n.$)(g).trigger("CornerstoneToolsMeasurementModified",l)}function s(e){(0,n.$)(g).off("CornerstoneToolsMouseMove",s),(0,n.$)(g).off("CornerstoneToolsMouseDrag",s),(0,n.$)(g).on("CornerstoneToolsMouseMove",l),(0,n.$)(g).on("CornerstoneToolsMouseDrag",l),(0,n.$)(g).on("CornerstoneToolsMouseClick",d),"CornerstoneToolsMouseDrag"===e.type&&(0,n.$)(g).on("CornerstoneToolsMouseUp",d)}function u(e,t){t.measurementData===o&&d()}function c(e,o){o.toolType===t&&((0,n.$)(g).off("CornerstoneToolsMouseMove",l),(0,n.$)(g).off("CornerstoneToolsMouseDrag",l),(0,n.$)(g).off("CornerstoneToolsMouseClick",d),(0,n.$)(g).off("CornerstoneToolsMouseUp",d),(0,n.$)(g).off("CornerstoneToolsMeasurementRemoved",u),(0,n.$)(g).off("CornerstoneToolsToolDeactivated",c),a.active=!1,f.updateImage(g))}function d(){(0,n.$)(g).off("CornerstoneToolsMouseMove",l),(0,n.$)(g).off("CornerstoneToolsMouseDrag",l),(0,n.$)(g).off("CornerstoneToolsMouseClick",d),(0,n.$)(g).off("CornerstoneToolsMouseUp",d),(0,n.$)(g).off("CornerstoneToolsMeasurementRemoved",u),(0,n.$)(g).off("CornerstoneToolsToolDeactivated",c),a.active=!1,f.updateImage(g),"function"==typeof r&&r()}var f=n.external.cornerstone,g=e.element;(0,n.$)(g).on("CornerstoneToolsMouseDrag",s),(0,n.$)(g).on("CornerstoneToolsMouseMove",s),(0,n.$)(g).on("CornerstoneToolsMeasurementRemoved",u),(0,n.$)(g).on("CornerstoneToolsToolDeactivated",c)};var n=o(0)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,a,r,i){function l(e,r){a.x=r.currentPoints.image.x+m.x,a.y=r.currentPoints.image.y+m.y,i&&(a.x=Math.max(a.x,0),a.x=Math.min(a.x,r.image.width),a.y=Math.max(a.y,0),a.y=Math.min(a.y,r.image.height)),d.updateImage(f);var l={toolType:t,element:f,measurementData:o};(0,n.$)(f).trigger("CornerstoneToolsMeasurementModified",l)}function s(e,t){if((0,n.$)(f).off("CornerstoneToolsTouchDrag",l),(0,n.$)(f).off("CornerstoneToolsTouchPinch",s),(0,n.$)(f).off("CornerstoneToolsTouchEnd",s),(0,n.$)(f).off("CornerstoneToolsTap",s),(0,n.$)(f).off("CornerstoneToolsTouchStart",u),(0,n.$)(f).off("CornerstoneToolsToolDeactivated",c),"CornerstoneToolsTouchPinch"===e.type||"CornerstoneToolsTouchPress"===e.type)return a.active=!1,d.updateImage(f),void r();a.active=!1,o.active=!1,a.x=t.currentPoints.image.x+m.x,a.y=t.currentPoints.image.y+m.y,i&&(a.x=Math.max(a.x,0),a.x=Math.min(a.x,t.image.width),a.y=Math.max(a.y,0),a.y=Math.min(a.y,t.image.height)),d.updateImage(f),"function"==typeof r&&r()}function u(e){return e.stopImmediatePropagation(),!1}function c(){(0,n.$)(f).off("CornerstoneToolsTouchDrag",l),(0,n.$)(f).off("CornerstoneToolsTouchPinch",s),(0,n.$)(f).off("CornerstoneToolsTouchEnd",s),(0,n.$)(f).off("CornerstoneToolsTap",s),(0,n.$)(f).off("CornerstoneToolsTouchStart",u),(0,n.$)(f).off("CornerstoneToolsToolDeactivated",c),a.active=!1,o.active=!1,a.x=e.currentPoints.image.x+m.x,a.y=e.currentPoints.image.y+m.y,i&&(a.x=Math.max(a.x,0),a.x=Math.min(a.x,e.image.width),a.y=Math.max(a.y,0),a.y=Math.min(a.y,e.image.height)),d.updateImage(f)}var d=n.external.cornerstone,f=e.element,g=d.pageToPixel(f,e.currentPoints.page.x,e.currentPoints.page.y+50),m={x:a.x-g.x,y:a.y-g.y};a.active=!0,o.active=!0,(0,n.$)(f).on("CornerstoneToolsTouchDrag",l),(0,n.$)(f).on("CornerstoneToolsTouchPinch",s),(0,n.$)(f).on("CornerstoneToolsTouchEnd",s),(0,n.$)(f).on("CornerstoneToolsTap",s),(0,n.$)(f).on("CornerstoneToolsTouchStart",u),(0,n.$)(f).on("CornerstoneToolsToolDeactivated",c)};var n=o(0)},function(e,t,o){"use strict";function n(){var e=navigator.userAgent,t=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],o=void 0;return/trident/i.test(t[1])?(o=/\brv[ :]+(\d+)/g.exec(e)||[],"IE "+(o[1]||"")):"Chrome"===t[1]&&null!==(o=e.match(/\b(OPR|Edge)\/(\d+)/))?o.slice(1).join(" ").replace("OPR","Opera"):(t=t[2]?[t[1],t[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(o=e.match(/version\/(\d+)/i))&&t.splice(1,1,o[1]),t.join(" "))}function a(e){s=e}function r(){return s||i()}function i(){var e=n(),t=e.split(" "),o=t[0],a=t[1],r=u[o];return r?r[a]?r[a]:r.default:u.default}function l(){return new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini").test(navigator.userAgent)}Object.defineProperty(t,"__esModule",{value:!0});var s=void 0,u={default:6,IE:{9:6,10:8,default:8},Firefox:{default:6},Opera:{10:8,11:6,12:6,default:6},Chrome:{default:6},Safari:{default:6}};t.getDefaultSimultaneousRequests=i,t.getMaxSimultaneousRequests=r,t.setMaxSimultaneousRequests=a,t.getBrowserInfo=n,t.isMobileDevice=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o={},a="CornerstoneToolsMultiTouchDrag";return t&&!0===t.fireOnTouchStart&&(a+=" CornerstoneToolsMultiTouchStart"),{activate:function(o){(0,n.$)(o).off(a,e),t&&t.eventData?(0,n.$)(o).on(a,t.eventData,e):(0,n.$)(o).on(a,e),t&&t.activateCallback&&t.activateCallback(o)},disable:function(o){(0,n.$)(o).off(a,e),t&&t.disableCallback&&t.disableCallback(o)},enable:function(o){(0,n.$)(o).off(a,e),t&&t.enableCallback&&t.enableCallback(o)},deactivate:function(o){(0,n.$)(o).off(a,e),t&&t.deactivateCallback&&t.deactivateCallback(o)},getConfiguration:function(){return o},setConfiguration:function(e){o=e}}};var n=o(0)},function(e,t,o){"use strict";function n(e){var t=void 0;return Object.keys(e).forEach(function(o){var n=e[o];if(!0===n.active)return void(t=n)}),t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,a){a||(a=6);var i=n(t),l=(0,r.default)(e,t,o,a);return i!==l&&(void 0!==l&&(l.active=!0),void 0!==i&&(i.active=!1),!0)};var a=o(14),r=function(e){return e&&e.__esModule?e:{default:e}}(a)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,a,l,s){function u(e,o){t.active=!0,Object.keys(t.handles).forEach(function(e){var n=t.handles[e];!0!==n.movesIndependently&&(n.x+=o.deltaPoints.image.x,n.y+=o.deltaPoints.image.y,!0===l.preventHandleOutsideImage&&(n.x=Math.max(n.x,0),n.x=Math.min(n.x,o.image.width),n.y=Math.max(n.y,0),n.y=Math.min(n.y,o.image.height)))}),d.updateImage(f);var r={toolType:a,element:f,measurementData:t};return(0,n.$)(f).trigger("CornerstoneToolsMeasurementModified",r),!1}function c(e,o){t.invalidated=!0,(0,n.$)(f).off("CornerstoneToolsMouseDrag",u),(0,n.$)(f).off("CornerstoneToolsMouseUp",c),(0,n.$)(f).off("CornerstoneToolsMouseClick",c),!0===l.deleteIfHandleOutsideImage&&(0,r.default)(o,t.handles)&&(0,i.removeToolState)(f,a,t),d.updateImage(f),"function"==typeof s&&s()}var d=n.external.cornerstone,f=e.element;return(0,n.$)(f).on("CornerstoneToolsMouseDrag",u),(0,n.$)(f).on("CornerstoneToolsMouseUp",c),(0,n.$)(f).on("CornerstoneToolsMouseClick",c),!0};var n=o(0),a=o(11),r=function(e){return e&&e.__esModule?e:{default:e}}(a),i=o(1)},function(e,t,o){"use strict";function n(e,t,o,n,a,r){if(!f.hasOwnProperty(o))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");if(e&&t){var i={type:o,imageId:t,preventCache:n,doneCallback:a,failCallback:r},l=c.external.cornerstone.imageCache.getImagePromise(t);if(l)return void l.then(function(e){a(e)},function(e){r(e)});f[o].push(i)}}function a(e){if(!f.hasOwnProperty(e))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");f[e]=[]}function r(){v&&setTimeout(function(){l()},h)}function i(e){var t=c.external.cornerstone,o=e.type;g[o]++,v=!0;var n=e.imageId,a=e.doneCallback,i=e.failCallback,l=t.imageCache.getImagePromise(n);if(l)return void l.then(function(e){g[o]--,a(e),r()},function(e){g[o]--,i(e),r()});var s=function(e){return"prefetch"===e.type?-5:"interactive"===e.type?0:"thumbnail"===e.type?5:void 0}(e),u=void 0;u=!0===e.preventCache?t.loadImage(n,{priority:s,type:e.type}):t.loadAndCacheImage(n,{priority:s,type:e.type}),u.then(function(e){g[o]--,a(e),r()},function(e){g[o]--,i(e),r()})}function l(){var e=(0,d.getMaxSimultaneousRequests)();m={interaction:Math.max(e,1),thumbnail:Math.max(e-2,1),prefetch:Math.max(e-1,1)};for(var t=g.interaction+g.thumbnail+g.prefetch,o=e-t,n=0;n<o;n++){var a=s();a&&i(a)}}function s(){return f.interaction.length&&g.interaction<m.interaction?f.interaction.shift():f.thumbnail.length&&g.thumbnail<m.thumbnail?f.thumbnail.shift():f.prefetch.length&&g.prefetch<m.prefetch?f.prefetch.shift():(f.interaction.length||f.thumbnail.length||f.prefetch.length||(v=!1),!1)}function u(){return f}Object.defineProperty(t,"__esModule",{value:!0});var c=o(0),d=o(23),f={interaction:[],thumbnail:[],prefetch:[]},g={interaction:0,thumbnail:0,prefetch:0},m={interaction:6,thumbnail:6,prefetch:5},v=!1,h=20;t.default={addRequest:n,clearRequestStack:a,startGrabbing:l,getRequestPool:u}},function(e,t,o){"use strict";function n(e){r=e.currentPoints.canvas}function a(){return r}Object.defineProperty(t,"__esModule",{value:!0});var r=void 0,i={setCoords:n,getCoords:a};t.default=i},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){var r=(0,a.getToolState)(e,"timeSeries");if(r&&r.data&&r.data.length){var l=n.external.cornerstone,s=r.data[0],u=s.stacks[s.currentStackIndex],c=u.currentImageIdIndex,d=s.currentStackIndex+t;if(o?(d>=s.stacks.length&&(d=0),d<0&&(d=s.stacks.length-1)):(d=Math.min(s.stacks.length-1,d),d=Math.max(0,d)),d!==s.currentStackIndex){var f=l.getViewport(e),g=s.stacks[d],m=i.default.getStartLoadHandler(),v=i.default.getEndLoadHandler(),h=i.default.getErrorLoadingHandler();m&&m(e);var p=void 0;p=!0===g.preventCache?l.loadImage(g.imageIds[c]):l.loadAndCacheImage(g.imageIds[c]),p.then(function(t){s.currentImageIdIndex!==c&&(g.currentImageIdIndex=c,s.currentStackIndex=d,l.displayImage(e,t,f),v&&v(e,t))},function(t){var o=g.imageIds[c];h&&h(e,o,t)})}}};var n=o(0),a=o(1),r=o(9),i=function(e){return e&&e.__esModule?e:{default:e}}(r)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{page:n.cornerstoneMath.point.copy(e.page),image:n.cornerstoneMath.point.copy(e.image),client:n.cornerstoneMath.point.copy(e.client),canvas:n.cornerstoneMath.point.copy(e.canvas)}};var n=o(0)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,a,r){if(!e)throw new Error("getRGBPixels: parameter element must not be undefined");t=Math.round(t),o=Math.round(o);var i=n.external.cornerstone.getEnabledElement(e),l=[],s=0,u=i.image.getPixelData(),c=void 0,d=void 0,f=void 0;if(i.image.color)for(d=0;d<r;d++)for(f=0;f<a;f++){c=4*((d+o)*i.image.columns+(f+t));var g=u[c],m=u[c+1],v=u[c+2],h=u[c+3];l[s++]=g,l[s++]=m,l[s++]=v,l[s++]=h}return l};var n=o(0)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1,!1}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o=e.width/2,n=e.height/2;if(o<=0||n<=0)return!1;var a={x:e.left+o,y:e.top+n},r={x:t.x-a.x,y:t.y-a.y};return r.x*r.x/(o*o)+r.y*r.y/(n*n)<=1}},function(e,t,o){"use strict";function n(e,t){var o=e.clone().sub(t.imagePositionPatient);return{x:t.rowCosines.dot(o)/t.columnPixelSpacing,y:t.columnCosines.dot(o)/t.rowPixelSpacing}}function a(e,t){var o=t.rowCosines.clone().multiplyScalar(e.x);o.multiplyScalar(t.columnPixelSpacing);var n=t.columnCosines.clone().multiplyScalar(e.y);n.multiplyScalar(t.rowPixelSpacing);var a=o.add(n);return a.add(t.imagePositionPatient),a}function r(e){var t=a({x:0,y:0},e),o=a({x:e.columns,y:0},e),n=a({x:0,y:e.rows},e),r=a({x:e.columns,y:e.rows},e);return{top:new s.cornerstoneMath.Line3(t,o),left:new s.cornerstoneMath.Line3(t,n),right:new s.cornerstoneMath.Line3(o,r),bottom:new s.cornerstoneMath.Line3(n,r)}}function i(e,t){var o=[];return Object.keys(t).forEach(function(n){var a=t[n],r=e.intersectLine(a);r&&o.push(r)}),o}function l(e,t){var o=e.rowCosines.clone().cross(e.columnCosines),n=new s.cornerstoneMath.Plane;n.setFromNormalAndCoplanarPoint(o,e.imagePositionPatient);var l=t.rowCosines.clone().cross(t.columnCosines),u=new s.cornerstoneMath.Plane;u.setFromNormalAndCoplanarPoint(l,t.imagePositionPatient);var c=u.clone().intersectPlane(n),d=c.origin,f=c.direction,g=a({x:t.columns,y:t.rows},t),m=t.imagePositionPatient.distanceTo(g),v=new s.cornerstoneMath.Line3;v.start=d,v.end=d.clone().add(f.multiplyScalar(m));var h=r(t),p=i(v,h);if(2===p.length)return{start:p[0],end:p[1]}}Object.defineProperty(t,"__esModule",{value:!0}),t.projectPatientPointToImagePlane=n,t.imagePointToPatientPoint=a,t.planePlaneIntersection=l;var s=o(0)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o=Math.pow(10,t);return Math.round(e*o)/o}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=(0,r.getToolState)(e,"stack");if(n&&n.data&&n.data.length){var i=n.data[0],l=i.currentImageIdIndex+t;if(o){l%=i.imageIds.length}else l=Math.min(i.imageIds.length-1,l),l=Math.max(0,l);(0,a.default)(e,l)}};var n=o(51),a=function(e){return e&&e.__esModule?e:{default:e}}(n),r=o(1)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{activate:function(t){(0,n.$)(t).off("CornerstoneToolsDoubleTap",e);var o={};(0,n.$)(t).on("CornerstoneToolsDoubleTap",o,e)},disable:function(t){(0,n.$)(t).off("CornerstoneToolsDoubleTap",e)},enable:function(t){(0,n.$)(t).off("CornerstoneToolsDoubleTap",e)},deactivate:function(t){(0,n.$)(t).off("CornerstoneToolsDoubleTap",e)}}};var n=o(0)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={};return{activate:function(t){(0,n.$)(t).off("CornerstoneToolsKeyDown",e),(0,n.$)(t).on("CornerstoneToolsKeyDown",e)},disable:function(t){(0,n.$)(t).off("CornerstoneToolsKeyDown",e)},enable:function(t){(0,n.$)(t).off("CornerstoneToolsKeyDown",e)},deactivate:function(t){(0,n.$)(t).off("CornerstoneToolsKeyDown",e)},getConfiguration:function(){return t},setConfiguration:function(e){t=e}}};var n=o(0)},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){function o(o){var n=e.createNewMeasurement(o);n&&((0,C.addToolState)(o.element,e.toolType,n),(0,a.$)(o.element).off("CornerstoneToolsMouseMove",r),(0,f.default)(o,e.toolType,n,n.handles.end,function(){n.active=!1,(0,h.default)(o,n.handles)&&(0,C.removeToolState)(o.element,e.toolType,n),(0,a.$)(o.element).on("CornerstoneToolsMouseMove",r)},t))}function n(e,t){if((0,T.default)(t.which,e.data.mouseButtonMask))return o(t),!1}function r(t,o){if(i.default.setCoords(o),0===o.which){var n=(0,C.getToolState)(o.element,e.toolType);if(void 0!==n){for(var r=!1,l=o.currentPoints.canvas,s=0;s<n.data.length;s++){var u=n.data[s];!0===(0,c.default)(o.element,u.handles,l)&&(r=!0),(e.pointInsideRect(o.element,u,l)&&!u.active||!e.pointInsideRect(o.element,u,l)&&u.active)&&(u.active=!u.active,r=!0)}!0===r&&a.external.cornerstone.updateImage(o.element)}}}function l(o,n){function i(){u.active=!1,(0,h.default)(n,u.handles)&&(0,C.removeToolState)(n.element,e.toolType,u),l.updateImage(n.element),(0,a.$)(n.element).on("CornerstoneToolsMouseMove",r)}var l=a.external.cornerstone,u=void 0;if((0,T.default)(n.which,o.data.mouseButtonMask)){var c=n.startPoints.canvas,d=(0,C.getToolState)(o.currentTarget,e.toolType),g=void 0;if(void 0!==d)for(g=0;g<d.data.length;g++){u=d.data[g];var v=(0,s.default)(n.element,u.handles,c,25);if(void 0!==v)return(0,a.$)(n.element).off("CornerstoneToolsMouseMove",r),u.active=!0,(0,f.default)(n,e.toolType,u,v,i,t),o.stopImmediatePropagation(),!1}var p={deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:t};if(void 0!==d&&void 0!==e.pointInsideRect)for(g=0;g<d.data.length;g++)if(u=d.data[g],e.pointInsideRect(n.element,u,c))return(0,a.$)(n.element).off("CornerstoneToolsMouseMove",r),(0,m.default)(o,u,d,e.toolType,p,i),(0,a.$)(n.element).on("CornerstoneToolsMouseMove",r),o.stopImmediatePropagation(),!1}}function u(t){(0,a.$)(t).off("CornerstoneImageRendered",e.onImageRendered),(0,a.$)(t).off("CornerstoneToolsMouseMove",r),(0,a.$)(t).off("CornerstoneToolsMouseDown",l),(0,a.$)(t).off("CornerstoneToolsMouseDownActivate",n),a.external.cornerstone.updateImage(t)}function d(t){(0,a.$)(t).off("CornerstoneImageRendered",e.onImageRendered),(0,a.$)(t).off("CornerstoneToolsMouseMove",r),(0,a.$)(t).off("CornerstoneToolsMouseDown",l),(0,a.$)(t).off("CornerstoneToolsMouseDownActivate",n),(0,a.$)(t).on("CornerstoneImageRendered",e.onImageRendered),a.external.cornerstone.updateImage(t)}function g(t,o){var i={mouseButtonMask:o};(0,a.$)(t).off("CornerstoneImageRendered",e.onImageRendered),(0,a.$)(t).off("CornerstoneToolsMouseMove",r),(0,a.$)(t).off("CornerstoneToolsMouseDown",l),(0,a.$)(t).off("CornerstoneToolsMouseDownActivate",n),(0,a.$)(t).on("CornerstoneImageRendered",e.onImageRendered),(0,a.$)(t).on("CornerstoneToolsMouseMove",i,r),(0,a.$)(t).on("CornerstoneToolsMouseDown",i,l),(0,a.$)(t).on("CornerstoneToolsMouseDownActivate",i,n),a.external.cornerstone.updateImage(t)}function v(t,o){var i={mouseButtonMask:o};(0,a.$)(t).off("CornerstoneImageRendered",e.onImageRendered),(0,a.$)(t).off("CornerstoneToolsMouseMove",r),(0,a.$)(t).off("CornerstoneToolsMouseDown",l),(0,a.$)(t).off("CornerstoneToolsMouseDownActivate",n),(0,a.$)(t).on("CornerstoneImageRendered",e.onImageRendered),(0,a.$)(t).on("CornerstoneToolsMouseMove",i,r),(0,a.$)(t).on("CornerstoneToolsMouseDown",i,l),a.external.cornerstone.updateImage(t)}return{enable:d,disable:u,activate:g,deactivate:v}};var a=o(0),r=o(28),i=n(r),l=o(14),s=n(l),u=o(25),c=n(u),d=o(20),f=n(d),g=o(26),m=n(g),v=o(11),h=n(v),p=o(2),T=n(p),C=o(1)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return{activate:function(t){(0,n.$)(t).off("CornerstoneToolsTouchPinch",e);var o={};(0,n.$)(t).on("CornerstoneToolsTouchPinch",o,e)},disable:function(t){(0,n.$)(t).off("CornerstoneToolsTouchPinch",e)},enable:function(t){(0,n.$)(t).off("CornerstoneToolsTouchPinch",e)},deactivate:function(t){(0,n.$)(t).off("CornerstoneToolsTouchPinch",e)}}};var n=o(0)},function(e,t,o){"use strict";function n(e,t){var o=Date.now();if(e!==d){if(o-f<=u)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1;d=e}f=o}function a(e,t,o){var n=o?g:m;t.forEach(function(t){(0,s.$)(e).on(t,n)})}function r(e,t,o){var n=o?g:m;t.forEach(function(t){(0,s.$)(e).off(t,n)})}function i(e){r(e,v,c.mouse),r(e,h,c.touch)}function l(e){i(e),a(e,v,c.mouse),a(e,h,c.touch)}Object.defineProperty(t,"__esModule",{value:!0});var s=o(0),u=2e3,c={mouse:0,touch:1},d=void 0,f=void 0,g=n.bind(null,c.mouse),m=n.bind(null,c.touch),v=["mousedown","mouseup"],h=["touchstart","touchend"],p={enable:l,disable:i};t.default=p},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,a,l,s){function u(e,o){t.active=!0,Object.keys(t.handles).forEach(function(e){var n=t.handles[e];!0!==n.movesIndependently&&(n.x+=o.deltaPoints.image.x,n.y+=o.deltaPoints.image.y)}),f.updateImage(d);var r={toolType:a,element:d,measurementData:t};return(0,n.$)(d).trigger("CornerstoneToolsMeasurementModified",r),!1}function c(e,o){t.active=!1,t.invalidated=!1,(0,n.$)(d).off("CornerstoneToolsTouchDrag",u),(0,n.$)(d).off("CornerstoneToolsTouchPinch",c),(0,n.$)(d).off("CornerstoneToolsTouchPress",c),(0,n.$)(d).off("CornerstoneToolsTouchEnd",c),(0,n.$)(d).off("CornerstoneToolsDragEnd",c),(0,n.$)(d).off("CornerstoneToolsTap",c),!0===l&&(0,r.default)(o,t.handles)&&(0,i.removeToolState)(d,a,t),f.updateImage(d),"function"==typeof s&&s(e,o)}var d=e.element,f=n.external.cornerstone;return(0,n.$)(d).on("CornerstoneToolsTouchDrag",u),(0,n.$)(d).on("CornerstoneToolsTouchPinch",c),(0,n.$)(d).on("CornerstoneToolsTouchPress",c),(0,n.$)(d).on("CornerstoneToolsTouchEnd",c),(0,n.$)(d).on("CornerstoneToolsDragEnd",c),(0,n.$)(d).on("CornerstoneToolsTap",c),!0};var n=o(0),a=o(11),r=function(e){return e&&e.__esModule?e:{default:e}}(a),i=o(1)},function(e,t,o){"use strict";function n(e,t,o,r,i){if(o.value){var l=a.external.cornerstone,s=(new Date).getTime(),u=Math.abs(t.y-i.y),c=u/10;if(console.log("distanceRemaining: "+u),u<1)return t.y=i.y,void(o.value=!1);t.y>i.y?t.y-=c:t.y<i.y&&(t.y+=c),l.updateImage(r.element),l.requestAnimationFrame(function(){n(s,t,o,r,i)})}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,l,s){function u(e,n){r.value=!1,!1===l.hasMoved&&(l.hasMoved=!0),l.active=!0;var i=n.currentPoints,s={x:i.page.x,y:i.page.y+v};p=d.pageToPixel(f,s.x,s.y),l.x=p.x,l.y=p.y,d.updateImage(f);var u={toolType:t,element:f,measurementData:o};(0,a.$)(f).trigger("CornerstoneToolsMeasurementModified",u)}function c(t,n){r.value=!1,l.active=!1,(0,a.$)(f).off("CornerstoneToolsTouchDrag",u),(0,a.$)(f).off(i,c),d.updateImage(f),"CornerstoneToolsTouchPress"===t.type&&(n.handlePressed=o,l.x=e.currentPoints.image.x,l.y=e.currentPoints.image.y),"function"==typeof s&&s(t,n)}r.value=!0;var d=a.external.cornerstone,f=e.element,g=d.getEnabledElement(f),m=(new Date).getTime(),v=-57,h={x:e.currentPoints.page.x,y:e.currentPoints.page.y+v},p=d.pageToPixel(f,h.x,h.y);(0,a.$)(f).on("CornerstoneToolsTouchDrag",u),(0,a.$)(f).on(i,c),n(m,l,r,g,p)};var a=o(0),r={value:!1},i=["CornerstoneToolsTouchEnd","CornerstoneToolsDragEnd","CornerstoneToolsTouchPinch","CornerstoneToolsTouchPress","CornerstoneToolsTap"].join(" ")},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=o(110),r=n(a),i=o(111),l=n(i),s={getOrientationString:r.default,invertOrientationString:l.default};t.default=s},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){(0,u.$)(t.element).off("CornerstoneToolsMouseDrag",l),(0,u.$)(t.element).off("CornerstoneToolsMouseUp",a),(0,u.$)(t.element).off("CornerstoneToolsMouseClick",a)}function r(e,t){if((0,C.default)(t.which,e.data.mouseButtonMask)){var o={deltaY:0};return(0,u.$)(t.element).on("CornerstoneToolsMouseDrag",o,l),(0,u.$)(t.element).on("CornerstoneToolsMouseUp",a),(0,u.$)(t.element).on("CornerstoneToolsMouseClick",a),e.stopImmediatePropagation(),!1}}function i(e,t){var o=-t.direction,n=M.getConfiguration(),a=!1;n&&n.loop&&(a=n.loop),(0,y.default)(t.element,o,a)}function l(e,t){var o=t.element,n=(0,b.getToolState)(o,"stack");if(n&&n.data&&n.data.length){var a=n.data[0],r=M.getConfiguration(),i=(0,u.$)(o).height()/Math.max(a.imageIds.length,8);if(r&&r.stackScrollSpeed&&(i=r.stackScrollSpeed),e.data.deltaY=e.data.deltaY||0,e.data.deltaY+=t.deltaPoints.page.y,Math.abs(e.data.deltaY)>=i){var l=e.data.deltaY/i,s=Math.round(l),c=e.data.deltaY%i;e.data.deltaY=c,(0,y.default)(o,s)}return!1}}function s(e,t){var o=$.getConfiguration();o&&o.testPointers(t)&&l(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.stackScrollMultiTouch=t.stackScrollTouchDrag=t.stackScrollWheel=t.stackScroll=void 0;var u=o(0),c=o(10),d=n(c),f=o(24),g=n(f),m=o(12),v=n(m),h=o(19),p=n(h),T=o(2),C=n(T),x=o(36),y=n(x),b=o(1),M=(0,v.default)(r),P=(0,p.default)(i),w={eventData:{deltaY:0}},S=(0,d.default)(l,w),I={testPointers:function(e){return e.numPointers>=3}},$=(0,g.default)(s,w);$.setConfiguration(I),t.stackScroll=M,t.stackScrollWheel=P,t.stackScrollTouchDrag=S,t.stackScrollMultiTouch=$},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){for(var o=0,n=0,r=0,i=0,l=t.top;l<t.top+t.height;l++)for(var s=t.left;s<t.left+t.width;s++){var u={x:s,y:l};(0,a.default)(t,u)&&(o+=e[i],n+=e[i]*e[i],r++),i++}if(0===r)return{count:r,mean:0,variance:0,stdDev:0};var c=o/r,d=n/r-c*c;return{count:r,mean:c,variance:d,stdDev:Math.sqrt(d)}};var n=o(33),a=function(e){return e&&e.__esModule?e:{default:e}}(n)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,a){var r=Math.atan2(o.y-t.y,o.x-t.x);e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(o.x,o.y),e.strokeStyle=n,e.lineWidth=a,e.stroke(),e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(o.x-10*Math.cos(r-Math.PI/7),o.y-10*Math.sin(r-Math.PI/7)),e.lineTo(o.x-10*Math.cos(r+Math.PI/7),o.y-10*Math.sin(r+Math.PI/7)),e.lineTo(o.x,o.y),e.lineTo(o.x-10*Math.cos(r-Math.PI/7),o.y-10*Math.sin(r-Math.PI/7)),e.strokeStyle=n,e.lineWidth=a,e.stroke(),e.fillStyle=n,e.fill()}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n){e.beginPath(),e.strokeStyle=o,e.lineWidth=n,e.arc(t.x,t.y,6,0,2*Math.PI),e.stroke()}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n,a){var r=n/2*.5522848,i=a/2*.5522848,l=t+n,s=o+a,u=t+n/2,c=o+a/2;e.beginPath(),e.moveTo(t,c),e.bezierCurveTo(t,c-i,u-r,o,u,o),e.bezierCurveTo(u+r,o,l,c-i,l,c),e.bezierCurveTo(l,c+i,u+r,s,u,s),e.bezierCurveTo(u-r,s,t,c+i,t,c),e.closePath(),e.stroke()}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,a,r){if(!e)throw new Error("getLuminance: parameter element must not be undefined");t=Math.round(t),o=Math.round(o);var i=n.external.cornerstone.getEnabledElement(e),l=i.image,s=[],u=0,c=l.getPixelData(),d=void 0,f=void 0,g=void 0;if(l.color)for(f=0;f<r;f++)for(g=0;g<a;g++){d=4*((f+o)*l.columns+(g+t));var m=c[d],v=c[d+1],h=c[d+2];s[u++]=.2126*m+.7152*v+.0722*h}else for(f=0;f<r;f++)for(g=0;g<a;g++)d=(f+o)*l.columns+(g+t),s[u++]=c[d]*l.slope+l.intercept;return s};var n=o(0)},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){function o(o){if(g.currentImageIdIndex===t){try{s.getEnabledElement(e)}catch(e){return}d?(d.currentImageIdIndex=t,d.render(e,i.data)):s.displayImage(e,o),v&&v(e,o)}}function n(o){var n=g.imageIds[t];h&&h(e,n,o)}var i=(0,r.getToolState)(e,"stack");if(i&&i.data&&i.data.length){var s=a.external.cornerstone,d=void 0;if(i.data.length>1){var f=(0,r.getToolState)(e,"stackRenderer");f&&f.data&&f.data.length&&(d=f.data[0])}var g=i.data[0];t<0&&(t+=g.imageIds.length);var m=u.default.getStartLoadHandler(),v=u.default.getEndLoadHandler(),h=u.default.getErrorLoadingHandler();if(t!==g.currentImageIdIndex){m&&m(e);var p={newImageIdIndex:t,direction:t-g.currentImageIdIndex};g.currentImageIdIndex=t;var T=g.imageIds[t],C=c.stackScroll.getConfiguration();if(C&&!0===C.retryLoadOnScroll){var x=s.imageCache.getImagePromise(T);x&&"rejected"===x.state()&&s.imageCache.removeImagePromise(T)}var y=Boolean(g.preventCache),b=void 0;b=y?s.loadImage(T):s.loadAndCacheImage(T),b.then(o,n),l.default.startGrabbing(),(0,a.$)(e).trigger("CornerstoneStackScroll",p)}}};var a=o(0),r=o(1),i=o(27),l=n(i),s=o(9),u=n(s),c=o(45)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){return n.external.cornerstone.setToPixelCoordinateSystem(e,t,.1),{fontSize:o/e.viewport.scale/.1,lineHeight:o/e.viewport.scale/.1,fontScale:.1}};var n=o(0)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var o=(0,n.planePlaneIntersection)(e,t);if(o)return{start:(0,n.projectPatientPointToImagePlane)(o.start,e),end:(0,n.projectPatientPointToImagePlane)(o.end,e)}};var n=o(34)},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,n){var r=a.external.cornerstone,l=r.getEnabledElement(o).image,u=r.getEnabledElement(n).image;if(l&&u){var d=r.metaData.get("imagePlane",l.imageId),f=r.metaData.get("imagePlane",u.imageId);if(d&&f&&d.rowCosines&&d.columnCosines&&d.imagePositionPatient&&f.rowCosines&&f.columnCosines&&f.imagePositionPatient&&d.frameOfReferenceUID===f.frameOfReferenceUID){var g=d.rowCosines.clone().cross(d.columnCosines),m=f.rowCosines.clone().cross(f.columnCosines),v=g.angleTo(m);if(!((v=Math.abs(v))<.5)){var h=(0,i.default)(d,f);if(h){var p=r.pixelToCanvas(t.element,h.start),T=r.pixelToCanvas(t.element,h.end),C=s.default.getActiveColor(),x=c.default.getToolWidth();e.setTransform(1,0,0,1,0,0),e.save(),e.beginPath(),e.strokeStyle=C,e.lineWidth=x,e.moveTo(p.x,p.y),e.lineTo(T.x,T.y),e.stroke(),e.restore()}}}}};var a=o(0),r=o(53),i=n(r),l=o(3),s=n(l),u=o(4),c=n(u)},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x-20,y:e.currentPoints.image.y+10,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x-20,y:e.currentPoints.image.y+10,highlight:!0,active:!1},end2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y+20,highlight:!0,active:!1}}}}function r(e,t,o){var n=l.external.cornerstone,a={start:n.pixelToCanvas(e,t.handles.start),end:n.pixelToCanvas(e,t.handles.end)},r=l.cornerstoneMath.lineSegment.distanceToPoint(a,o);return r<5||(a.start=n.pixelToCanvas(e,t.handles.start2),a.end=n.pixelToCanvas(e,t.handles.end2),(r=l.cornerstoneMath.lineSegment.distanceToPoint(a,o))<5)}function i(e,t){var o=(0,P.getToolState)(e.currentTarget,w);if(void 0!==o){var n=t.canvasContext.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0);for(var a=void 0,r=p.default.getToolWidth(),i=C.default.getFont(),s=S.getConfiguration(),u=l.external.cornerstone,c=0;c<o.data.length;c++){n.save(),s&&s.shadow&&(n.shadowColor=s.shadowColor||"#000000",n.shadowOffsetX=s.shadowOffsetX||1,n.shadowOffsetY=s.shadowOffsetY||1);var d=o.data[c];a=d.active?y.default.getActiveColor():y.default.getToolColor(),n.beginPath(),n.strokeStyle=a,n.lineWidth=r;var f=u.pixelToCanvas(t.element,d.handles.start),m=u.pixelToCanvas(t.element,d.handles.end);n.moveTo(f.x,f.y),n.lineTo(m.x,m.y),f=u.pixelToCanvas(t.element,d.handles.start2),m=u.pixelToCanvas(t.element,d.handles.end2),n.moveTo(f.x,f.y),n.lineTo(m.x,m.y),n.stroke(),(0,M.default)(n,t,d.handles),n.fillStyle=a;var h=(Math.ceil(d.handles.start.x)-Math.ceil(d.handles.end.x))*t.image.columnPixelSpacing,T=(Math.ceil(d.handles.start.y)-Math.ceil(d.handles.end.y))*t.image.rowPixelSpacing,x=(Math.ceil(d.handles.start2.x)-Math.ceil(d.handles.end2.x))*t.image.columnPixelSpacing,b=(Math.ceil(d.handles.start2.y)-Math.ceil(d.handles.end2.y))*t.image.rowPixelSpacing,I=Math.acos(Math.abs((h*x+T*b)/(Math.sqrt(h*h+T*T)*Math.sqrt(x*x+b*b))));I*=180/Math.PI;var $=(0,v.default)(I,2),k=$.toString()+String.fromCharCode(parseInt("00B0",16)),O=(f.x+m.x)/2,D=(f.y+m.y)/2;n.font=i,(0,g.default)(n,k,O,D,a),n.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.angleTouch=t.angle=void 0;var l=o(0),s=o(6),u=n(s),c=o(8),d=n(c),f=o(5),g=n(f),m=o(35),v=n(m),h=o(4),p=n(h),T=o(13),C=n(T),x=o(3),y=n(x),b=o(7),M=n(b),P=o(1),w="angle",S=(0,u.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:w}),I=(0,d.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:w});t.angle=S,t.angleTouch=I},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){e(prompt("Enter your annotation:"))}function r(e,t,o){o(prompt("Change your annotation:"))}function i(e){function t(t){null===t?(0,V.removeToolState)(e.element,W,o):o.text=t,o.active=!1,n.updateImage(e.element),(0,g.$)(e.element).on("CornerstoneToolsMouseMove",a,Y.mouseMoveCallback),(0,g.$)(e.element).on("CornerstoneToolsMouseDown",a,Y.mouseDownCallback),(0,g.$)(e.element).on("CornerstoneToolsMouseDownActivate",a,Y.mouseDownActivateCallback),(0,g.$)(e.element).on("CornerstoneToolsMouseDoubleClick",a,Y.mouseDoubleClickCallback)}var o=l(e),n=g.external.cornerstone,a={mouseButtonMask:e.which};(0,V.addToolState)(e.element,W,o),(0,g.$)(e.element).off("CornerstoneToolsMouseMove",Y.mouseMoveCallback),(0,g.$)(e.element).off("CornerstoneToolsMouseDown",Y.mouseDownCallback),(0,g.$)(e.element).off("CornerstoneToolsMouseDownActivate",Y.mouseDownActivateCallback),(0,g.$)(e.element).off("CornerstoneToolsMouseDoubleClick",Y.mouseDoubleClickCallback),n.updateImage(e.element),(0,D.default)(e,W,o,o.handles.end,function(){(0,R.default)(e,o.handles)&&(0,V.removeToolState)(e.element,W,o);var a=Y.getConfiguration();void 0===o.text&&a.getTextCallback(t),n.updateImage(e.element)})}function l(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function s(e,t,o){var n=g.external.cornerstone,a={start:n.pixelToCanvas(e,t.handles.start),end:n.pixelToCanvas(e,t.handles.end)};return g.cornerstoneMath.lineSegment.distanceToPoint(a,o)<25}function u(e,t){var o=(0,V.getToolState)(e.currentTarget,W);if(o){var n=t.enabledElement,a=g.external.cornerstone,r=t.canvasContext.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0);for(var i=void 0,l=y.default.getToolWidth(),s=M.default.getFont(),u=Y.getConfiguration(),c=0;c<o.data.length;c++){r.save(),u&&u.shadow&&(r.shadowColor=u.shadowColor||"#000000",r.shadowOffsetX=u.shadowOffsetX||1,r.shadowOffsetY=u.shadowOffsetY||1);var d=o.data[c];i=d.active?w.default.getActiveColor():w.default.getToolColor();var f=a.pixelToCanvas(t.element,d.handles.start),m=a.pixelToCanvas(t.element,d.handles.end);u.arrowFirst?(0,k.default)(r,m,f,i,l):(0,k.default)(r,f,m,i,l);var v={drawHandlesIfActive:u&&u.drawHandlesOnHover};if(u.drawHandles&&(0,I.default)(r,t,d.handles,i,v),d.text&&""!==d.text){r.font=s;var h=r.measureText(d.text).width+10,p=M.default.getFontSize()+10,T=Math.max(h,p)/2+5;m.x<f.x&&(T=-T);var x=void 0;if(!d.handles.textBox.hasMoved){x=u.arrowFirst?{x:m.x-h/2+T,y:m.y-p/2}:{x:f.x-h/2-T,y:f.y-p/2};var b=a.internal.getTransform(n);b.invert();var P=b.transformPoint(x.x,x.y);d.handles.textBox.x=P.x,d.handles.textBox.y=P.y}x=a.pixelToCanvas(t.element,d.handles.textBox);var S=(0,C.default)(r,d.text,x.x,x.y,i);if(d.handles.textBox.boundingBox=S,d.handles.textBox.hasMoved){var $={start:{},end:{}},O={x:(f.x+m.x)/2,y:(f.y+m.y)/2},D=[f,m,O];$.end.x=x.x,$.end.y=x.y,$.start=g.cornerstoneMath.point.findClosestPoint(D,$.end);var _=[{x:S.left+S.width/2,y:S.top},{x:S.left,y:S.top+S.height/2},{x:S.left+S.width/2,y:S.top+S.height},{x:S.left+S.width,y:S.top+S.height/2}];$.end=g.cornerstoneMath.point.findClosestPoint(_,$.start),r.beginPath(),r.strokeStyle=i,r.lineWidth=l,r.setLineDash([2,3]),r.moveTo($.start.x,$.start.y),r.lineTo($.end.x,$.end.y),r.stroke()}}r.restore()}}}function c(e){function t(e){null===e?(0,V.removeToolState)(o,W,n):n.text=e,n.active=!1,a.updateImage(o),(0,g.$)(o).on("CornerstoneToolsTouchPress",F.pressCallback),(0,g.$)(o).on("CornerstoneToolsTouchStartActive",F.touchDownActivateCallback),(0,g.$)(o).on("CornerstoneToolsTap",F.tapCallback)}var o=e.element,n=l(e),a=g.external.cornerstone;(0,V.addToolState)(o,W,n),(0,g.$)(o).off("CornerstoneToolsTouchPress",F.pressCallback),(0,g.$)(o).off("CornerstoneToolsTouchStartActive",F.touchDownActivateCallback),(0,g.$)(o).off("CornerstoneToolsTap",F.tapCallback),a.updateImage(o),(0,j.default)(e,W,n,n.handles.end,function(){a.updateImage(o),(0,R.default)(e,n.handles)&&(0,V.removeToolState)(o,W,n);var r=Y.getConfiguration();void 0===n.text&&r.getTextCallback(t)})}function d(e,t){function o(e,t,o){!0===o?(0,V.removeToolState)(n,W,e):e.text=t,e.active=!1,a.updateImage(n)}var n=t.element,a=g.external.cornerstone,r=void 0;if(!e.data||!e.data.mouseButtonMask||(0,B.default)(t.which,e.data.mouseButtonMask)){var i=Y.getConfiguration(),l=t.currentPoints.canvas,u=(0,V.getToolState)(n,W);if(u)for(var c=0;c<u.data.length;c++)if(r=u.data[c],s(n,r,l)||(0,H.default)(r.handles.textBox,l))return r.active=!0,a.updateImage(n),i.changeTextCallback(r,t,o),e.stopImmediatePropagation(),!1}}function f(e,t){function o(e,t,o){console.log("pressCallback doneChangingTextCallback"),!0===o?(0,V.removeToolState)(n,W,e):e.text=t,e.active=!1,a.updateImage(n),(0,g.$)(n).on("CornerstoneToolsTouchStart",F.touchStartCallback),(0,g.$)(n).on("CornerstoneToolsTouchStartActive",F.touchDownActivateCallback),(0,g.$)(n).on("CornerstoneToolsTap",F.tapCallback)}var n=t.element,a=g.external.cornerstone,r=void 0;if(!e.data||!e.data.mouseButtonMask||(0,B.default)(t.which,e.data.mouseButtonMask)){var i=Y.getConfiguration(),l=t.currentPoints.canvas,u=(0,V.getToolState)(n,W);if(u){if(t.handlePressed)return(0,g.$)(n).off("CornerstoneToolsTouchStart",F.touchStartCallback),(0,g.$)(n).off("CornerstoneToolsTouchStartActive",F.touchDownActivateCallback),(0,g.$)(n).off("CornerstoneToolsTap",F.tapCallback),i.changeTextCallback(t.handlePressed,t,o),e.stopImmediatePropagation(),!1;for(var c=0;c<u.data.length;c++)if(r=u.data[c],s(n,r,l)||(0,H.default)(r.handles.textBox,l))return r.active=!0,a.updateImage(n),(0,g.$)(n).off("CornerstoneToolsTouchStart",F.touchStartCallback),(0,g.$)(n).off("CornerstoneToolsTouchStartActive",F.touchDownActivateCallback),(0,g.$)(n).off("CornerstoneToolsTap",F.tapCallback),i.changeTextCallback(r,t,o),e.stopImmediatePropagation(),!1;return!1}}}Object.defineProperty(t,"__esModule",{value:!0}),t.arrowAnnotateTouch=t.arrowAnnotate=void 0;var g=o(0),m=o(6),v=n(m),h=o(8),p=n(h),T=o(5),C=n(T),x=o(4),y=n(x),b=o(13),M=n(b),P=o(3),w=n(P),S=o(7),I=n(S),$=o(47),k=n($),O=o(21),D=n(O),_=o(22),j=n(_),E=o(11),R=n(E),A=o(2),B=n(A),N=o(17),H=n(N),V=o(1),W="arrowAnnotate",L={getTextCallback:a,changeTextCallback:r,drawHandles:!1,drawHandlesOnHover:!0,arrowFirst:!0},Y=(0,v.default)({addNewMeasurement:i,createNewMeasurement:l,onImageRendered:u,pointNearTool:s,toolType:W,mouseDoubleClickCallback:d});Y.setConfiguration(L);var F=(0,p.default)({addNewMeasurement:c,createNewMeasurement:l,onImageRendered:u,pointNearTool:s,toolType:W,pressCallback:f});t.arrowAnnotate=Y,t.arrowAnnotateTouch=F},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){e.stopImmediatePropagation();var o=(0,T.getToolState)(e.currentTarget,b);if(o){var n=v.external.cornerstone,a=e.currentTarget,r=n.getEnabledElement(a),i=r.image.imageId,l=n.metaData.get("imagePlane",i),s=t.currentPoints.image,u=(0,y.imagePointToPatientPoint)(s,l);o.data[0].synchronizationContext.getSourceElements().forEach(function(e){if(e!==a){var t=Number.MAX_VALUE,o=-1,r=(0,T.getToolState)(e,"stack");if(void 0!==r){var i=r.data[0];if(i.imageIds.forEach(function(e,a){var r=n.metaData.get("imagePlane",e),i=r.imagePositionPatient,l=r.rowCosines.clone(),s=r.columnCosines.clone(),c=s.clone().cross(l.clone()),d=Math.abs(c.clone().dot(i)-c.clone().dot(u));d<t&&(t=d,o=a)}),o!==i.currentImageIdIndex&&-1!==o&&void 0!==i.imageIds[o]){var l=p.default.getStartLoadHandler(),s=p.default.getEndLoadHandler(),c=p.default.getErrorLoadingHandler();l&&l(e);var d=void 0;d=!0===i.preventCache?n.loadImage(i.imageIds[o]):n.loadAndCacheImage(i.imageIds[o]),d.then(function(t){var a=n.getViewport(e);i.currentImageIdIndex=o,n.displayImage(e,t,a),s&&s(e,t)},function(t){var n=i.imageIds[o];c&&c(e,n,t)})}}}})}}function r(e,t){(0,v.$)(t.element).off("CornerstoneToolsMouseDrag",l),(0,v.$)(t.element).off("CornerstoneToolsMouseUp",r)}function i(e,t){if((0,x.default)(t.which,e.data.mouseButtonMask))return(0,v.$)(t.element).on("CornerstoneToolsMouseDrag",l),(0,v.$)(t.element).on("CornerstoneToolsMouseUp",r),a(e,t),!1}function l(e,t){return a(e,t),!1}function s(e,t,o){var n={mouseButtonMask:t};(0,T.clearToolState)(e,b),(0,T.addToolState)(e,b,{synchronizationContext:o}),(0,v.$)(e).off("CornerstoneToolsMouseDown",i),(0,v.$)(e).on("CornerstoneToolsMouseDown",n,i)}function u(e){(0,v.$)(e).off("CornerstoneToolsMouseDown",i)}function c(e,t){(0,v.$)(t.element).off("CornerstoneToolsTouchDrag",f),(0,v.$)(t.element).off("CornerstoneToolsDragEnd",c)}function d(e,t){return(0,v.$)(t.element).on("CornerstoneToolsTouchDrag",f),(0,v.$)(t.element).on("CornerstoneToolsDragEnd",c),a(e,t),!1}function f(e,t){return a(e,t),!1}function g(e,t){(0,T.clearToolState)(e,b),(0,T.addToolState)(e,b,{synchronizationContext:t}),(0,v.$)(e).off("CornerstoneToolsTouchStart",d),(0,v.$)(e).on("CornerstoneToolsTouchStart",d)}function m(e){(0,v.$)(e).off("CornerstoneToolsTouchStart",d)}Object.defineProperty(t,"__esModule",{value:!0}),t.crosshairsTouch=t.crosshairs=void 0;var v=o(0),h=o(9),p=n(h),T=o(1),C=o(2),x=n(C),y=o(34),b="crosshairs",M={activate:s,deactivate:u,enable:s,disable:u},P={activate:g,deactivate:m,enable:g,disable:m};t.crosshairs=M,t.crosshairsTouch=P},function(e,t,o){"use strict";function n(e){r.external.cornerstone.fitToWindow(e.element)}function a(e,t){return s.strategy(t),!1}Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),i=o(37),l=function(e){return e&&e.__esModule?e:{default:e}}(i),s=(0,l.default)(a);s.strategies={default:n},s.strategy=n,t.default=s},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=c.external.cornerstone,o=t.getEnabledElement(e.element),n=o.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0);var a=T.default.getActiveColor(),r=h.default.getFont(),i=h.default.getFontSize(),l=$.getConfiguration();n.save(),l&&l.shadow&&(n.shadowColor=l.shadowColor||"#000000",n.shadowOffsetX=l.shadowOffsetX||1,n.shadowOffsetY=l.shadowOffsetY||1);var s=Math.round(e.currentPoints.image.x),u=Math.round(e.currentPoints.image.y),d=void 0,f=void 0,g=void 0;if(!(s<0||u<0||s>=e.image.columns||u>=e.image.rows)){if(e.image.color)d=(0,b.default)(e.element,s,u,1,1),f=s+", "+u,g="R: "+d[0]+" G: "+d[1]+" B: "+d[2]+" A: "+d[3];else{d=t.getStoredPixels(e.element,s,u,1,1);var m=d[0],v=m*e.image.slope+e.image.intercept,p=(0,P.default)(e.image,m);f=s+", "+u,g="SP: "+m+" MO: "+parseFloat(v.toFixed(3)),p&&(g+=" SUV: "+parseFloat(p.toFixed(3)))}var C={x:e.currentPoints.image.x+3,y:e.currentPoints.image.y-3},y=t.pixelToCanvas(e.element,C);n.font=r,n.fillStyle=a,(0,x.default)(n,g,y.x,y.y+i+5,a),(0,x.default)(n,f,y.x,y.y,a),n.restore()}}function r(e){var t=c.external.cornerstone,o=e.element,n=t.getEnabledElement(o),a=n.image,r=n.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0);var i=T.default.getActiveColor(),l=h.default.getFont(),s=$.getConfiguration();r.save(),s&&s.shadow&&(r.shadowColor=s.shadowColor||"#000000",r.shadowOffsetX=s.shadowOffsetX||1,r.shadowOffsetY=s.shadowOffsetY||1);var u=t.metaData.get("generalSeriesModule",a.imageId),d=void 0;u&&(d=u.modality);var f=void 0;f=!0===e.isTouchEvent?t.pageToPixel(o,e.currentPoints.page.x,e.currentPoints.page.y-4*h.default.getFontSize()):t.pageToPixel(o,e.currentPoints.page.x,e.currentPoints.page.y-h.default.getFontSize()/2);var g=void 0,m="";if(!(f.x<0||f.y<0||f.x>=a.columns||f.y>=a.rows)){if(a.color)g=(0,b.default)(o,f.x,f.y,1,1),m="R: "+g[0]+" G: "+g[1]+" B: "+g[2];else{g=t.getStoredPixels(o,f.x,f.y,1,1);var v=g[0],p=v*e.image.slope+e.image.intercept,C=parseFloat(p.toFixed(2));if("CT"===d)m+="HU: "+C;else if("PT"===d){m+=C;var y=(0,P.default)(e.image,v);y&&(m+=" SUV: "+parseFloat(y.toFixed(2)))}else m+=C}var M=t.pixelToCanvas(o,f);r.font=l,r.fillStyle=i;var w=void 0,S=r.measureText(m).width;w=!0===e.isTouchEvent?{x:-S/2-5,y:-h.default.getFontSize()-10-12}:{x:12,y:-(h.default.getFontSize()+10)/2},r.beginPath(),r.strokeStyle=i,r.arc(M.x,M.y,6,0,2*Math.PI),r.stroke(),(0,x.default)(r,m,M.x+w.x,M.y+w.y,i),r.restore()}}function i(e,t){var o=t.element;(0,c.$)(o).off("CornerstoneImageRendered",s),(0,c.$)(o).off("CornerstoneToolsMouseDrag",u),(0,c.$)(o).off("CornerstoneToolsMouseUp",i),(0,c.$)(o).off("CornerstoneToolsMouseClick",i),c.external.cornerstone.updateImage(t.element)}function l(e,t){var o=t.element;if((0,S.default)(t.which,e.data.mouseButtonMask))return(0,c.$)(o).on("CornerstoneImageRendered",s),(0,c.$)(o).on("CornerstoneToolsMouseDrag",u),(0,c.$)(o).on("CornerstoneToolsMouseUp",i),(0,c.$)(o).on("CornerstoneToolsMouseClick",i),$.strategy(t),!1}function s(){I&&($.strategy(I),I=null)}function u(e,t){var o=t.element;return I=t,c.external.cornerstone.updateImage(o),!1}Object.defineProperty(t,"__esModule",{value:!0}),t.dragProbeTouch=t.dragProbe=void 0;var c=o(0),d=o(12),f=n(d),g=o(10),m=n(g),v=o(13),h=n(v),p=o(3),T=n(p),C=o(5),x=n(C),y=o(31),b=n(y),M=o(16),P=n(M),w=o(2),S=n(w),I=void 0,$=(0,f.default)(l);$.strategies={default:a,minimal:r},$.strategy=a;var k={fireOnTouchStart:!0},O=(0,m.default)(u,k);t.dragProbe=$,t.dragProbeTouch=O},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function r(e,t,o,n){var a=c.external.cornerstone,r=a.pixelToCanvas(e,t.handles.start),i=a.pixelToCanvas(e,t.handles.end),l={left:Math.min(r.x,i.x)+n/2,top:Math.min(r.y,i.y)+n/2,width:Math.abs(r.x-i.x)-n,height:Math.abs(r.y-i.y)-n},s={left:Math.min(r.x,i.x)-n/2,top:Math.min(r.y,i.y)-n/2,width:Math.abs(r.x-i.x)+n,height:Math.abs(r.y-i.y)+n},u=(0,S.default)(l,o);return!(!(0,S.default)(s,o)||u)}function i(e,t,o){return r(e,t,o,15)}function l(e,t,o){return r(e,t,o,25)}function s(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function u(e,t){var o=(0,D.getToolState)(e.currentTarget,_);if(o){var n=c.external.cornerstone,a=t.image,r=t.element,i=h.default.getToolWidth(),l=j.getConfiguration(),u=t.canvasContext.canvas.getContext("2d"),d=n.metaData.get("generalSeriesModule",a.imageId),f=void 0;d&&(f=d.modality),u.setTransform(1,0,0,1,0,0);for(var g=0;g<o.data.length;g++){u.save();var m=o.data[g];l&&l.shadow&&(u.shadowColor=l.shadowColor||"#000000",u.shadowOffsetX=l.shadowOffsetX||1,u.shadowOffsetY=l.shadowOffsetY||1);var v=T.default.getColorIfActive(m.active),p=n.pixelToCanvas(r,m.handles.start),C=n.pixelToCanvas(r,m.handles.end),y=Math.min(p.x,C.x),M=Math.min(p.y,C.y),w=Math.abs(p.x-C.x),S=Math.abs(p.y-C.y);if(u.beginPath(),u.strokeStyle=v,u.lineWidth=i,(0,P.default)(u,y,M,w,S),u.closePath(),l&&l.drawHandlesOnHover)if(!0===m.active)(0,x.default)(u,t,m.handles,v);else{var I={drawHandlesIfActive:!0};(0,x.default)(u,t,m.handles,v,I)}else(0,x.default)(u,t,m.handles,v);var k=void 0,E=void 0,R=void 0;if(!1===m.invalidated)E=m.meanStdDev,R=m.meanStdDevSUV,k=m.area;else{var A={left:Math.round(Math.min(m.handles.start.x,m.handles.end.x)),top:Math.round(Math.min(m.handles.start.y,m.handles.end.y)),width:Math.round(Math.abs(m.handles.start.x-m.handles.end.x)),height:Math.round(Math.abs(m.handles.start.y-m.handles.end.y))};if(!a.color){var B=n.getPixels(r,A.left,A.top,A.width,A.height);E=(0,$.default)(B,A),"PT"===f&&(R={mean:(0,O.default)(a,(E.mean-a.intercept)/a.slope),stdDev:(0,O.default)(a,(E.stdDev-a.intercept)/a.slope)}),E&&!isNaN(E.mean)&&(m.meanStdDev=E,m.meanStdDevSUV=R)}var N=a.columnPixelSpacing||1,H=a.rowPixelSpacing||1;k=Math.PI*(A.width*N/2)*(A.height*H/2),isNaN(k)||(m.area=k),m.invalidated=!1}var V=[];if(E&&void 0!==E.mean){var W="";"CT"===f&&(W=" HU");var L="Mean: "+s(E.mean.toFixed(2))+W,Y="StdDev: "+s(E.stdDev.toFixed(2))+W;if(R&&void 0!==R.mean){L+=" SUV: "+s(R.mean.toFixed(2)),Y+=" SUV: "+s(R.stdDev.toFixed(2))}V.push(L),V.push(Y)}if(k){var F=" mm"+String.fromCharCode(178);a.rowPixelSpacing&&a.columnPixelSpacing||(F=" pixels"+String.fromCharCode(178));var z="Area: "+s(k.toFixed(2))+F;V.push(z)}m.handles.textBox.hasMoved||(m.handles.textBox.x=Math.max(m.handles.start.x,m.handles.end.x),m.handles.textBox.y=(m.handles.start.y+m.handles.end.y)/2);var U=n.pixelToCanvas(r,m.handles.textBox),X={centering:{x:!1,y:!0}},q=(0,b.default)(u,V,U.x,U.y,v,X);if(m.handles.textBox.boundingBox=q,m.handles.textBox.hasMoved){var K={start:{},end:{x:U.x,y:U.y}},G=[{x:y+w/2,y:M},{x:y,y:M+S/2},{x:y+w/2,y:M+S},{x:y+w,y:M+S/2}];K.start=c.cornerstoneMath.point.findClosestPoint(G,K.end);var Z=[{x:q.left+q.width/2,y:q.top},{x:q.left,y:q.top+q.height/2},{x:q.left+q.width/2,y:q.top+q.height},{x:q.left+q.width,y:q.top+q.height/2}];K.end=c.cornerstoneMath.point.findClosestPoint(Z,K.start),u.beginPath(),u.strokeStyle=v,u.lineWidth=i,u.setLineDash([2,3]),u.moveTo(K.start.x,K.start.y),u.lineTo(K.end.x,K.end.y),u.stroke()}u.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.ellipticalRoiTouch=t.ellipticalRoi=void 0;var c=o(0),d=o(6),f=n(d),g=o(8),m=n(g),v=o(4),h=n(v),p=o(3),T=n(p),C=o(7),x=n(C),y=o(5),b=n(y),M=o(49),P=n(M),w=o(33),S=n(w),I=o(46),$=n(I),k=o(16),O=n(k),D=o(1),_="ellipticalRoi",j=(0,f.default)({createNewMeasurement:a,onImageRendered:u,pointNearTool:i,toolType:_}),E=(0,m.default)({createNewMeasurement:a,onImageRendered:u,pointNearTool:l,toolType:_});t.ellipticalRoi=j,t.ellipticalRoiTouch=E},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=(0,$.getToolState)(e.element,k);if(void 0!==t){var o=D.getConfiguration(),n=t.data[o.currentTool],a={x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,lines:[]};n.handles.length&&n.handles[o.currentHandle-1].lines.push(e.currentPoints.image),n.handles.push(a),o.currentHandle+=1,o.freehand=!1,C.external.cornerstone.updateImage(e.element)}}function r(e,t){var o=(0,$.getToolState)(e.element,k);if(void 0!==o){var n=o.data[t];if(void 0!==n.handles)for(var a=e.currentPoints.canvas,r=0;r<n.handles.length;r++){var i=C.external.cornerstone.pixelToCanvas(e.element,n.handles[r]);if(C.cornerstoneMath.point.distance(i,a)<5)return r}}}function i(e){var t=(0,$.getToolState)(e.element,k);if(t)for(var o=void 0,n=0;n<t.data.length;n++)if(void 0!==(o=r(e,n)))return{handleNearby:o,toolIndex:n}}function l(e,t){if((0,C.$)(t.element).off("CornerstoneToolsMouseUp",l),void 0!==(0,$.getToolState)(t.element,k)){var o=D.getConfiguration();t.event.shiftKey||(o.freehand=!1),C.external.cornerstone.updateImage(t.element)}}function s(e,t){var o=(0,$.getToolState)(t.element,k);if(o){var n=D.getConfiguration(),a=o.data[n.currentTool],i=Math.max(t.currentPoints.image.x,0);i=Math.min(i,t.image.width),n.mouseLocation.handles.start.x=i;var l=Math.max(t.currentPoints.image.y,0);l=Math.min(l,t.image.height),n.mouseLocation.handles.start.y=l;var s=n.currentHandle;if(n.modifying&&(a.active=!0,a.highlight=!0,a.handles[s].x=n.mouseLocation.handles.start.x,a.handles[s].y=n.mouseLocation.handles.start.y,s)){var u=a.handles[s-1].lines.length-1,c=a.handles[s-1].lines[u];c.x=n.mouseLocation.handles.start.x,c.y=n.mouseLocation.handles.start.y}if(n.freehand)a.handles[s-1].lines.push(t.currentPoints.image);else{var d=r(t,n.currentTool);void 0!==d&&d<a.handles.length-1&&(n.mouseLocation.handles.start.x=a.handles[d].x,n.mouseLocation.handles.start.y=a.handles[d].y)}C.external.cornerstone.updateImage(t.element)}}function u(e){(0,C.$)(e.element).on("CornerstoneToolsMouseMove",s),(0,C.$)(e.element).on("CornerstoneToolsMouseUp",l);var t={visible:!0,active:!0,handles:[]},o=D.getConfiguration();o.mouseLocation.handles.start.x=e.currentPoints.image.x,o.mouseLocation.handles.start.y=e.currentPoints.image.y,(0,$.addToolState)(e.element,k,t);var n=(0,$.getToolState)(e.element,k);o.currentTool=n.data.length-1}function c(e,t){var o=(0,$.getToolState)(e.element,k);if(o){var n=D.getConfiguration(),a=o.data[n.currentTool];a.active=!1,a.highlight=!1,void 0!==t&&a.handles[n.currentHandle-1].lines.push({x:a.handles[t].x,y:a.handles[t].y}),n.modifying&&(n.modifying=!1),n.currentHandle=0,n.currentTool=-1,(0,C.$)(e.element).off("CornerstoneToolsMouseMove",s),C.external.cornerstone.updateImage(e.element)}}function d(e,t){if((0,I.default)(t.which,e.data.mouseButtonMask)){var o=(0,$.getToolState)(t.element,k),n=void 0,d=void 0,f=D.getConfiguration(),g=f.currentTool;if(f.modifying)return void c(t);if(g<0){var m=i(t);m?(n=m.handleNearby,d=m.toolIndex,void 0!==n&&((0,C.$)(t.element).on("CornerstoneToolsMouseMove",s),(0,C.$)(t.element).on("CornerstoneToolsMouseUp",l),f.modifying=!0,f.currentHandle=n,f.currentTool=d)):(u(t),a(t))}else g>=0&&o.data[g].active&&(n=r(t,g),void 0!==n?c(t,n):t.event.shiftKey?f.freehand=!0:a(t));return!1}}function f(e,t){var o=(0,$.getToolState)(e.currentTarget,k);if(void 0!==o){var n=C.external.cornerstone,a=D.getConfiguration(),r=t.canvasContext.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0);for(var i=void 0,l=y.default.getToolWidth(),s=M.default.getFillColor(),u=0;u<o.data.length;u++){r.save();var c=o.data[u];c.active?(i=M.default.getActiveColor(),s=M.default.getFillColor()):(i=M.default.getToolColor(),s=M.default.getToolColor());var d=void 0;if(c.handles.length)for(var f=0;f<c.handles.length;f++){d=c.handles[f];var g=n.pixelToCanvas(t.element,d);r.beginPath(),r.strokeStyle=i,r.lineWidth=l,r.moveTo(g.x,g.y);for(var m=0;m<c.handles[f].lines.length;m++){var v=n.pixelToCanvas(t.element,c.handles[f].lines[m]);r.lineTo(v.x,v.y),r.stroke()}var h=n.pixelToCanvas(t.element,a.mouseLocation.handles.start);f===c.handles.length-1&&(!c.active||a.freehand||a.modifying||(r.lineTo(h.x,h.y),r.stroke()))}var p={fill:s};c.active&&(0,w.default)(r,t,a.mouseLocation.handles,i,p),(0,w.default)(r,t,c.handles,i,p),r.restore()}}}function g(e){(0,C.$)(e).off("CornerstoneToolsMouseDown",d),(0,C.$)(e).off("CornerstoneToolsMouseUp",l),(0,C.$)(e).off("CornerstoneToolsMouseMove",s),(0,C.$)(e).off("CornerstoneImageRendered",f),(0,C.$)(e).on("CornerstoneImageRendered",f),C.external.cornerstone.updateImage(e)}function m(e){(0,C.$)(e).off("CornerstoneToolsMouseDown",d),(0,C.$)(e).off("CornerstoneToolsMouseUp",l),(0,C.$)(e).off("CornerstoneToolsMouseMove",s),(0,C.$)(e).off("CornerstoneImageRendered",f),C.external.cornerstone.updateImage(e)}function v(e,t){var o={mouseButtonMask:t};(0,C.$)(e).off("CornerstoneToolsMouseDown",o,d),(0,C.$)(e).off("CornerstoneToolsMouseUp",l),(0,C.$)(e).off("CornerstoneToolsMouseMove",s),(0,C.$)(e).off("CornerstoneImageRendered",f),(0,C.$)(e).on("CornerstoneImageRendered",f),(0,C.$)(e).on("CornerstoneToolsMouseDown",o,d),C.external.cornerstone.updateImage(e)}function h(e){(0,C.$)(e).off("CornerstoneToolsMouseDown",d),(0,C.$)(e).off("CornerstoneToolsMouseUp",l),(0,C.$)(e).off("CornerstoneToolsMouseMove",s),(0,C.$)(e).off("CornerstoneImageRendered",f),(0,C.$)(e).on("CornerstoneImageRendered",f),C.external.cornerstone.updateImage(e)}function p(){return O}function T(e){O=e}Object.defineProperty(t,"__esModule",{value:!0}),t.freehand=void 0;var C=o(0),x=o(4),y=n(x),b=o(3),M=n(b),P=o(7),w=n(P),S=o(2),I=n(S),$=o(1),k="freehand",O={mouseLocation:{handles:{start:{highlight:!0,active:!0}}},freehand:!1,modifying:!1,currentHandle:0,currentTool:-1},D={enable:g,disable:m,activate:v,deactivate:h,getConfiguration:p,setConfiguration:T};t.freehand=D},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=(0,C.getToolState)(e.event.currentTarget,x);if(!(t&&t.data&&t.data.length>0)){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}}function r(e,t,o){var n=s.external.cornerstone,a=n.pixelToCanvas(e,t.handles.start),r=n.pixelToCanvas(e,t.handles.end),i={left:Math.min(a.x,r.x),top:Math.min(a.y,r.y),width:Math.abs(a.x-r.x),height:Math.abs(a.y-r.y)},l=!1;return o.x>=i.left&&o.x<=i.left+i.width&&o.y>=i.top&&o.y<=i.top+i.height&&(l=!0),l}function i(e,t,o){var n=s.external.cornerstone,a=n.pixelToCanvas(e,t.handles.start),r=n.pixelToCanvas(e,t.handles.end),i={left:Math.min(a.x,r.x),top:Math.min(a.y,r.y),width:Math.abs(a.x-r.x),height:Math.abs(a.y-r.y)};return s.cornerstoneMath.rect.distanceToPoint(i,o)<5}function l(e,t){var o=(0,C.getToolState)(e.currentTarget,x);if(void 0!==o){var n=s.external.cornerstone,a=t.canvasContext.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);var r=void 0,i=m.default.getToolWidth();a.save();var l=o.data[0];if(l){r=l.active?h.default.getActiveColor():h.default.getToolColor();var u=n.pixelToCanvas(t.element,l.handles.start),c=n.pixelToCanvas(t.element,l.handles.end),d={left:Math.min(u.x,c.x),top:Math.min(u.y,c.y),width:Math.abs(u.x-c.x),height:Math.abs(u.y-c.y)};a.beginPath(),a.strokeStyle="transparent",a.rect(0,0,a.canvas.clientWidth,a.canvas.clientHeight),a.rect(d.width+d.left,d.top,-d.width,d.height),a.stroke(),a.fillStyle="rgba(0,0,0,0.7)",a.fill(),a.closePath(),a.beginPath(),a.strokeStyle=r,a.lineWidth=i,a.setLineDash([4]),a.strokeRect(d.left,d.top,d.width,d.height),a.setLineDash([]),(0,T.default)(a,t,l.handles,r),a.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.highlightTouch=t.highlight=void 0;var s=o(0),u=o(39),c=n(u),d=o(8),f=n(d),g=o(4),m=n(g),v=o(3),h=n(v),p=o(7),T=n(p),C=o(1),x="highlight",y=(0,c.default)({createNewMeasurement:a,onImageRendered:l,pointNearTool:i,pointInsideRect:r,toolType:x},!0),b=(0,f.default)({createNewMeasurement:a,onImageRendered:l,pointNearTool:i,pointInsideRect:r,toolType:x},!0);t.highlight=y,t.highlightTouch=b},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var o=t.image,n=o.stats,a=t.canvasContext.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);var r=[];Object.keys(n).forEach(function(e){var t=e+" : "+n[e];r.push(t)}),(0,s.default)(a,r,0,0,"orange"),r.forEach(function(e){console.log(e)})}Object.defineProperty(t,"__esModule",{value:!0});var r=o(18),i=n(r),l=o(5),s=n(l),u=(0,i.default)(a);t.default=u},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function r(e,t,o){var n=l.external.cornerstone,a={start:n.pixelToCanvas(e,t.handles.start),end:n.pixelToCanvas(e,t.handles.end)};return l.cornerstoneMath.lineSegment.distanceToPoint(a,o)<25}function i(e,t){var o=(0,x.getToolState)(e.currentTarget,y);if(o){var n=l.external.cornerstone,a=t.canvasContext.canvas.getContext("2d"),r=t.image,i=t.element;a.setTransform(1,0,0,1,0,0);var s=v.default.getToolWidth(),u=b.getConfiguration(),c=n.metaData.get("imagePlane",r.imageId),d=void 0,f=void 0;c?(d=c.rowPixelSpacing||c.rowImagePixelSpacing,f=c.colPixelSpacing||c.colImagePixelSpacing):(d=r.rowPixelSpacing,f=r.columnPixelSpacing);for(var m=0;m<o.data.length;m++){a.save(),u&&u.shadow&&(a.shadowColor=u.shadowColor||"#000000",a.shadowOffsetX=u.shadowOffsetX||1,a.shadowOffsetY=u.shadowOffsetY||1);var h=o.data[m],T=p.default.getColorIfActive(h.active),M=n.pixelToCanvas(i,h.handles.start),P=n.pixelToCanvas(i,h.handles.end);a.beginPath(),a.strokeStyle=T,a.lineWidth=s,a.moveTo(M.x,M.y),a.lineTo(P.x,P.y),a.stroke();var w={drawHandlesIfActive:u&&u.drawHandlesOnHover};(0,C.default)(a,t,h.handles,T,w),a.fillStyle=T;var S=(h.handles.end.x-h.handles.start.x)*(d||1),I=(h.handles.end.y-h.handles.start.y)*(f||1),$=Math.sqrt(S*S+I*I);h.length=$;var k=" mm";d&&f||(k=" pixels");var O=""+$.toFixed(2)+k;if(!h.handles.textBox.hasMoved){var D={x:Math.max(h.handles.start.x,h.handles.end.x)};D.x===h.handles.start.x?D.y=h.handles.start.y:D.y=h.handles.end.y,h.handles.textBox.x=D.x,h.handles.textBox.y=D.y}var _=n.pixelToCanvas(t.element,h.handles.textBox);_.x+=10;var j={centering:{x:!1,y:!0}},E=(0,g.default)(a,O,_.x,_.y,T,j);if(h.handles.textBox.boundingBox=E,h.handles.textBox.hasMoved){var R={start:{},end:{}},A={x:(M.x+P.x)/2,y:(M.y+P.y)/2},B=[M,P,A];R.end.x=_.x,R.end.y=_.y,R.start=l.cornerstoneMath.point.findClosestPoint(B,R.end);var N=[{x:E.left+E.width/2,y:E.top},{x:E.left,y:E.top+E.height/2},{x:E.left+E.width/2,y:E.top+E.height},{x:E.left+E.width,y:E.top+E.height/2}];R.end=l.cornerstoneMath.point.findClosestPoint(N,R.start),a.beginPath(),a.strokeStyle=T,a.lineWidth=s,a.setLineDash([2,3]),a.moveTo(R.start.x,R.start.y),a.lineTo(R.end.x,R.end.y),a.stroke()}a.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.lengthTouch=t.length=void 0;var l=o(0),s=o(6),u=n(s),c=o(8),d=n(c),f=o(5),g=n(f),m=o(4),v=n(m),h=o(3),p=n(h),T=o(7),C=n(T),x=o(1),y="length",b=(0,u.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:y}),M=(0,d.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:y});t.length=b,t.lengthTouch=M},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var o=t.element;(0,T.$)(o).off("CornerstoneToolsMouseDrag",u),(0,T.$)(o).off("CornerstoneToolsMouseUp",a),(0,T.$)(o).off("CornerstoneToolsMouseClick",a),(0,T.$)(o).off("CornerstoneNewImage",l),r(t)}function r(e){(0,T.$)(e.element).find(".magnifyTool").hide(),document.body.style.cursor="default"}function i(e,t){var o=t.element;if((0,M.default)(t.which,e.data.mouseButtonMask))return(0,T.$)(o).on("CornerstoneToolsMouseDrag",t,u),(0,T.$)(o).on("CornerstoneToolsMouseUp",t,a),(0,T.$)(o).on("CornerstoneToolsMouseClick",t,a),S=t.currentPoints,(0,T.$)(o).on("CornerstoneNewImage",t,l),c(t),!1}function l(e,t){t.currentPoints=S,c(t)}function s(e,t){var o=t.element;(0,T.$)(t.element).off("CornerstoneToolsDragEnd",s),(0,T.$)(t.element).off("CornerstoneToolsTouchEnd",s),(0,T.$)(o).off("CornerstoneNewImage",l),r(t)}function u(e,t){return S=t.currentPoints,c(t),!0===t.isTouchEvent&&((0,T.$)(t.element).on("CornerstoneToolsDragEnd",s),(0,T.$)(t.element).on("CornerstoneToolsTouchEnd",s)),!1}function c(e){var t=(0,T.$)(e.element).find(".magnifyTool").get(0);t||d(e.element);var o=I.getConfiguration(),n=o.magnifySize,a=o.magnificationLevel,r=(0,T.$)(e.element).find("canvas").not(".magnifyTool").get(0);r.getContext("2d").setTransform(1,0,0,1,0,0);var i=t.getContext("2d");i.setTransform(1,0,0,1,0,0);var l=n/a,s=T.external.cornerstone.pixelToCanvas(e.element,e.currentPoints.image);!0===e.isTouchEvent&&(s.y-=1.25*l),s.x=Math.max(s.x,0),s.x=Math.min(s.x,r.width),s.y=Math.max(s.y,0),s.y=Math.min(s.y,r.height),i.clearRect(0,0,n,n),i.fillStyle="transparent",i.fillRect(0,0,n,n);var u={x:s.x-.5*l,y:s.y-.5*l};"Safari"===w&&(u.x=Math.max(u.x,0),u.y=Math.max(u.y,0)),u.x=Math.min(u.x,r.width),u.y=Math.min(u.y,r.height);var c={x:(r.width-u.x)*a,y:(r.height-u.y)*a};i.drawImage(r,u.x,u.y,r.width-u.x,r.height-u.y,0,0,c.x,c.y),t.style.top=s.y-.5*n+"px",t.style.left=s.x-.5*n+"px",t.style.display="block",document.body.style.cursor="none"}function d(e){if(0===(0,T.$)(e).find(".magnifyTool").length){var t=document.createElement("canvas");t.classList.add("magnifyTool");var o=I.getConfiguration();t.width=o.magnifySize,t.height=o.magnifySize,t.style.position="absolute",e.appendChild(t)}}function f(e){(0,T.$)(e).find(".magnifyTool").remove()}function g(e){(0,T.$)(e).off("CornerstoneToolsMouseDown",i),f(e)}function m(e){if(!w){var t=(0,y.getBrowserInfo)(),o=t.split(" ");w=o[0]}d(e)}function v(e,t){var o={mouseButtonMask:t};(0,T.$)(e).off("CornerstoneToolsMouseDown",i),(0,T.$)(e).on("CornerstoneToolsMouseDown",o,i),d(e)}function h(){return P}function p(e){P=e}Object.defineProperty(t,"__esModule",{value:!0}),t.magnifyTouchDrag=t.magnify=void 0;var T=o(0),C=o(10),x=n(C),y=o(23),b=o(2),M=n(b),P={magnifySize:100,magnificationLevel:2},w=void 0,S=void 0,I={enable:m,activate:v,deactivate:g,disable:g,getConfiguration:h,setConfiguration:p},$={fireOnTouchStart:!0,activateCallback:d,disableCallback:f},k=(0,x.default)(u,$);t.magnify=I,t.magnifyTouchDrag=k},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=l.external.cornerstone,o=t.getEnabledElement(e),n=t.metaData.get("imagePlane",o.image.imageId);if(n&&n.rowCosines&&n.columnCosines){var a=u.default.getOrientationString(n.rowCosines),r=u.default.getOrientationString(n.columnCosines),i=u.default.invertOrientationString(a);return{top:u.default.invertOrientationString(r),bottom:r,left:i,right:a}}}function r(e){var t=l.external.cornerstone,o=t.getEnabledElement(e),n=void 0;n={x:o.image.width/2,y:5};var a=t.pixelToCanvas(e,n);n={x:o.image.width/2,y:o.image.height-5};var r=t.pixelToCanvas(e,n);n={x:5,y:o.image.height/2};var i=t.pixelToCanvas(e,n);return n={x:o.image.width-10,y:o.image.height/2},{top:a,bottom:r,left:i,right:t.pixelToCanvas(e,n)}}function i(e,t){var o=t.element,n=a(o);if(n){var i=r(o,n),l=t.canvasContext.canvas.getContext("2d");l.setTransform(1,0,0,1,0,0);var s=g.default.getToolColor(),u={top:l.measureText(n.top).width,left:l.measureText(n.left).width,right:l.measureText(n.right).width,bottom:l.measureText(n.bottom).width};(0,v.default)(l,n.top,i.top.x-u.top/2,i.top.y,s),(0,v.default)(l,n.left,i.left.x-u.left/2,i.left.y,s);var c=h.getConfiguration();c&&c.drawAllMarkers&&((0,v.default)(l,n.right,i.right.x-u.right/2,i.right.y,s),(0,v.default)(l,n.bottom,i.bottom.x-u.bottom/2,i.bottom.y,s))}}Object.defineProperty(t,"__esModule",{value:!0});var l=o(0),s=o(44),u=n(s),c=o(18),d=n(c),f=o(3),g=n(f),m=o(5),v=n(m),h=(0,d.default)(i);t.default=h},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){(0,l.$)(t.element).off("CornerstoneToolsMouseDrag",i),(0,l.$)(t.element).off("CornerstoneToolsMouseUp",a),(0,l.$)(t.element).off("CornerstoneToolsMouseClick",a)}function r(e,t){if((0,g.default)(t.which,e.data.mouseButtonMask))return(0,l.$)(t.element).on("CornerstoneToolsMouseDrag",i),(0,l.$)(t.element).on("CornerstoneToolsMouseUp",a),(0,l.$)(t.element).on("CornerstoneToolsMouseClick",a),!1}function i(e,t){var o=t.viewport.scale,n=t.viewport.scale;return t.image.rowPixelSpacing<t.image.columnPixelSpacing?o*=t.image.columnPixelSpacing/t.image.rowPixelSpacing:t.image.columnPixelSpacing<t.image.rowPixelSpacing&&(n*=t.image.rowPixelSpacing/t.image.columnPixelSpacing),t.viewport.translation.x+=t.deltaPoints.page.x/o,t.viewport.translation.y+=t.deltaPoints.page.y/n,l.external.cornerstone.setViewport(t.element,t.viewport),!1}Object.defineProperty(t,"__esModule",{value:!0}),t.panTouchDrag=t.pan=void 0;var l=o(0),s=o(12),u=n(s),c=o(10),d=n(c),f=o(2),g=n(f),m=(0,u.default)(r),v=(0,d.default)(i);t.pan=m,t.panTouchDrag=v},function(e,t,o){"use strict";function n(e,t){var o=s.getConfiguration();if(o&&o.testPointers(t))return t.viewport.translation.x+=t.deltaPoints.page.x/t.viewport.scale,t.viewport.translation.y+=t.deltaPoints.page.y/t.viewport.scale,a.external.cornerstone.setViewport(t.element,t.viewport),!1}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),r=o(24),i=function(e){return e&&e.__esModule?e:{default:e}}(r),l={testPointers:function(e){return e.numPointers>=2}},s=(0,i.default)(n);s.setConfiguration(l),t.default=s},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}}}function r(e,t,o){var n=l.external.cornerstone.pixelToCanvas(e,t.handles.end);return l.cornerstoneMath.point.distance(n,o)<5}function i(e,t){var o=(0,P.getToolState)(e.currentTarget,w);if(o){var n=l.external.cornerstone,a=t.canvasContext.canvas.getContext("2d");a.setTransform(1,0,0,1,0,0);for(var r=void 0,i=v.default.getFont(),s=v.default.getFontSize(),u=0;u<o.data.length;u++){a.save();var c=o.data[u];r=c.active?g.default.getActiveColor():g.default.getToolColor(),(0,p.default)(a,t,c.handles,r);var d=Math.round(c.handles.end.x),f=Math.round(c.handles.end.y),m=void 0,h=void 0,T=void 0;if(d<0||f<0||d>=t.image.columns||f>=t.image.rows)return;if(t.image.color)h=d+", "+f,m=(0,y.default)(t.element,d,f,1,1),T="R: "+m[0]+" G: "+m[1]+" B: "+m[2];else{m=n.getStoredPixels(t.element,d,f,1,1);var x=m[0],b=x*t.image.slope+t.image.intercept,S=(0,M.default)(t.image,x);h=d+", "+f,T="SP: "+x+" MO: "+parseFloat(b.toFixed(3)),S&&(T+=" SUV: "+parseFloat(S.toFixed(3)))}var I={x:c.handles.end.x+3,y:c.handles.end.y-3},$=n.pixelToCanvas(t.element,I);a.font=i,a.fillStyle=r,(0,C.default)(a,T,$.x,$.y+s+5,r),(0,C.default)(a,h,$.x,$.y,r),a.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.probeTouch=t.probe=void 0;var l=o(0),s=o(6),u=n(s),c=o(8),d=n(c),f=o(3),g=n(f),m=o(13),v=n(m),h=o(7),p=n(h),T=o(5),C=n(T),x=o(31),y=n(x),b=o(16),M=n(b),P=o(1),w="probe",S=(0,u.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:w}),I=(0,d.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:w});t.probe=S,t.probeTouch=I},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function r(e,t,o){var n=u.external.cornerstone,a=n.pixelToCanvas(e,t.handles.start),r=n.pixelToCanvas(e,t.handles.end),i={left:Math.min(a.x,r.x),top:Math.min(a.y,r.y),width:Math.abs(a.x-r.x),height:Math.abs(a.y-r.y)};return u.cornerstoneMath.rect.distanceToPoint(i,o)<5}function i(e,t){for(var o=0,n=0,a=0,r=0,i=t.top;i<t.top+t.height;i++)for(var l=t.left;l<t.left+t.width;l++)o+=e[r],n+=e[r]*e[r],a++,r++;if(0===a)return{count:a,mean:0,variance:0,stdDev:0};var s=o/a,u=n/a-s*s;return{count:a,mean:s,variance:u,stdDev:Math.sqrt(u)}}function l(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}function s(e,t){var o=(0,P.getToolState)(e.currentTarget,w);if(o){var n=u.external.cornerstone,a=t.image,r=t.element,s=v.default.getToolWidth(),c=S.getConfiguration(),d=t.canvasContext.canvas.getContext("2d"),f=n.metaData.get("generalSeriesModule",a.imageId),g=void 0;f&&(g=f.modality),d.setTransform(1,0,0,1,0,0);for(var m=0;m<o.data.length;m++){d.save();var h=o.data[m];c&&c.shadow&&(d.shadowColor=c.shadowColor||"#000000",d.shadowOffsetX=c.shadowOffsetX||1,d.shadowOffsetY=c.shadowOffsetY||1);var T=p.default.getColorIfActive(h.active),x=n.pixelToCanvas(r,h.handles.start),b=n.pixelToCanvas(r,h.handles.end),I=Math.min(x.x,b.x),$=Math.min(x.y,b.y),k=Math.abs(x.x-b.x),O=Math.abs(x.y-b.y);if(d.beginPath(),d.strokeStyle=T,d.lineWidth=s,d.rect(I,$,k,O),d.stroke(),c&&c.drawHandlesOnHover)if(!0===h.active)(0,C.default)(d,t,h.handles,T);else{var D={drawHandlesIfActive:!0};(0,C.default)(d,t,h.handles,T,D)}else(0,C.default)(d,t,h.handles,T);var _=void 0,j=void 0,E=void 0;if(!1===h.invalidated)j=h.meanStdDev,E=h.meanStdDevSUV,_=h.area;else{var R={left:Math.min(h.handles.start.x,h.handles.end.x),top:Math.min(h.handles.start.y,h.handles.end.y),width:Math.abs(h.handles.start.x-h.handles.end.x),height:Math.abs(h.handles.start.y-h.handles.end.y)};if(!a.color){j=i(n.getPixels(r,R.left,R.top,R.width,R.height),R),"PT"===g&&(E={mean:(0,M.default)(a,(j.mean-a.intercept)/a.slope),stdDev:(0,M.default)(a,(j.stdDev-a.intercept)/a.slope)}),j&&!isNaN(j.mean)&&(h.meanStdDev=j,h.meanStdDevSUV=E)}_=R.width*(a.columnPixelSpacing||1)*(R.height*(a.rowPixelSpacing||1)),isNaN(_)||(h.area=_),h.invalidated=!1}var A=[];if(j&&j.mean){var B="";"CT"===g&&(B=" HU");var N="Mean: "+l(j.mean.toFixed(2))+B,H="StdDev: "+l(j.stdDev.toFixed(2))+B;if(E&&void 0!==E.mean){N+=" SUV: "+l(E.mean.toFixed(2)),H+=" SUV: "+l(E.stdDev.toFixed(2))}A.push(N),A.push(H)}if(_){var V=" mm"+String.fromCharCode(178);a.rowPixelSpacing&&a.columnPixelSpacing||(V=" pixels"+String.fromCharCode(178));var W="Area: "+l(_.toFixed(2))+V;A.push(W)}h.handles.textBox.hasMoved||(h.handles.textBox.x=Math.max(h.handles.start.x,h.handles.end.x),h.handles.textBox.y=(h.handles.start.y+h.handles.end.y)/2);var L=n.pixelToCanvas(r,h.handles.textBox),Y={centering:{x:!1,y:!0}},F=(0,y.default)(d,A,L.x,L.y,T,Y);if(h.handles.textBox.boundingBox=F,h.handles.textBox.hasMoved){var z={start:{},end:{x:L.x,y:L.y}},U=[{x:I+k/2,y:$},{x:I,y:$+O/2},{x:I+k/2,y:$+O},{x:I+k,y:$+O/2}];z.start=u.cornerstoneMath.point.findClosestPoint(U,z.end);var X=[{x:F.left+F.width/2,y:F.top},{x:F.left,y:F.top+F.height/2},{x:F.left+F.width/2,y:F.top+F.height},{x:F.left+F.width,y:F.top+F.height/2}];z.end=u.cornerstoneMath.point.findClosestPoint(X,z.start),d.beginPath(),d.strokeStyle=T,d.lineWidth=s,d.setLineDash([2,3]),d.moveTo(z.start.x,z.start.y),d.lineTo(z.end.x,z.end.y),d.stroke()}d.restore()}}}Object.defineProperty(t,"__esModule",{value:!0}),t.rectangleRoiTouch=t.rectangleRoi=void 0;var u=o(0),c=o(6),d=n(c),f=o(8),g=n(f),m=o(4),v=n(m),h=o(3),p=n(h),T=o(7),C=n(T),x=o(5),y=n(x),b=o(16),M=n(b),P=o(1),w="rectangleRoi",S=(0,d.default)({createNewMeasurement:a,onImageRendered:s,pointNearTool:r,toolType:w}),I=(0,g.default)({createNewMeasurement:a,onImageRendered:s,pointNearTool:r,toolType:w});t.rectangleRoi=S,t.rectangleRoiTouch=I},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=e.element.getBoundingClientRect(e.element),o={x:e.currentPoints.client.x,y:e.currentPoints.client.y},n=e.element.clientWidth,a=e.element.clientHeight,r={x:o.x-t.left-n/2,y:-1*(o.y-t.top-a/2)},i=Math.atan2(r.y,r.x),l=i*(180/Math.PI),s=-1*l+90;e.viewport.rotation=s,c.external.cornerstone.setViewport(e.element,e.viewport)}function r(e){e.viewport.rotation+=e.deltaPoints.page.x/e.viewport.scale,c.external.cornerstone.setViewport(e.element,e.viewport)}function i(e){e.viewport.rotation+=e.deltaPoints.page.y/e.viewport.scale,c.external.cornerstone.setViewport(e.element,e.viewport)}function l(e,t){(0,c.$)(t.element).off("CornerstoneToolsMouseDrag",u),(0,c.$)(t.element).off("CornerstoneToolsMouseUp",l),(0,c.$)(t.element).off("CornerstoneToolsMouseClick",l)}function s(e,t){if((0,h.default)(t.which,e.data.mouseButtonMask))return(0,c.$)(t.element).on("CornerstoneToolsMouseDrag",u),(0,c.$)(t.element).on("CornerstoneToolsMouseUp",l),(0,c.$)(t.element).on("CornerstoneToolsMouseClick",l),!1}function u(e,t){return p.strategy(t),c.external.cornerstone.setViewport(t.element,t.viewport),!1}Object.defineProperty(t,"__esModule",{value:!0}),t.rotateTouchDrag=t.rotate=void 0;var c=o(0),d=o(12),f=n(d),g=o(10),m=n(g),v=o(2),h=n(v),p=(0,f.default)(s);p.strategies={default:a,horizontal:r,vertical:i},p.strategy=a;var T=(0,m.default)(u);t.rotate=p,t.rotateTouchDrag=T},function(e,t,o){"use strict";function n(e,t){return t.viewport.rotation+=t.rotation,i.external.cornerstone.setViewport(t.element,t.viewport),!1}function a(e){(0,i.$)(e).off("CornerstoneToolsTouchRotate",n)}function r(e){(0,i.$)(e).off("CornerstoneToolsTouchRotate",n),(0,i.$)(e).on("CornerstoneToolsTouchRotate",n)}Object.defineProperty(t,"__esModule",{value:!0});var i=o(0),l={activate:r,disable:a};t.default=l},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){o=o||"image/png";var a=(0,n.$)(e).find("canvas").get(0),r=document.createElement("a");if(r.download=t,r.href=a.toDataURL(o),document.createEvent){var i=document.createEvent("MouseEvents");i.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(i)}else r.fireEvent&&r.fireEvent("onclick")};var n=o(0)},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){e(prompt("Enter your annotation:"))}function r(e,t,o){o(prompt("Change your annotation:"))}function i(e){function t(e){null===e?(0,N.removeToolState)(n,H,r):r.text=e,r.active=!1,o.updateImage(n)}var o=g.external.cornerstone,n=e.element,a=W.getConfiguration(),r=l(e);(0,N.addToolState)(n,H,r),o.updateImage(n),(0,k.default)(e,H,r,r.handles.end,function(){(0,I.default)(e,r.handles)&&(0,N.removeToolState)(n,H,r),void 0===r.text&&a.getTextCallback(t),o.updateImage(n)})}function l(e){return{visible:!0,active:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function s(e,t,o){if(t.handles.end){var n=g.external.cornerstone.pixelToCanvas(e,t.handles.end);return g.cornerstoneMath.point.distance(n,o)<25}}function u(e,t){var o=(0,N.getToolState)(e.currentTarget,H);if(o){var n=g.external.cornerstone,a=t.enabledElement,r=t.canvasContext.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0);for(var i=t.canvasContext.canvas.width,l=void 0,s=M.default.getToolWidth(),u=y.default.getFont(),c=W.getConfiguration(),d=0;d<o.data.length;d++){r.save(),c&&c.shadow&&(r.shadowColor=c.shadowColor||"#000000",r.shadowOffsetX=c.shadowOffsetX||1,r.shadowOffsetY=c.shadowOffsetY||1);var f=o.data[d];l=f.active?w.default.getActiveColor():w.default.getToolColor();var m=n.pixelToCanvas(t.element,f.handles.end);(0,j.default)(r,m,l,s);var v={drawHandlesIfActive:c&&c.drawHandlesOnHover};if(c.drawHandles&&(0,D.default)(r,t,m,l,v),f.text&&""!==f.text){r.font=u;var h="";h=c.showCoordinates?f.text+" x: "+Math.round(f.handles.end.x)+" y: "+Math.round(f.handles.end.y):f.text;var p=r.measureText(h).width+10,T=y.default.getFontSize()+10,x=Math.max(p,T)/2+5;m.x>i/2&&(x=-x);var b=void 0;if(!f.handles.textBox.hasMoved){b={x:m.x-p/2+x,y:m.y-T/2};var P=n.internal.getTransform(a);P.invert();var S=P.transformPoint(b.x,b.y);f.handles.textBox.x=S.x,f.handles.textBox.y=S.y}b=n.pixelToCanvas(t.element,f.handles.textBox);var I=(0,C.default)(r,h,b.x,b.y,l);if(f.handles.textBox.boundingBox=I,f.handles.textBox.hasMoved){var $={start:{},end:{}};$.end.x=b.x,$.end.y=b.y,$.start=m;var k=[{x:I.left+I.width/2,y:I.top},{x:I.left,y:I.top+I.height/2},{x:I.left+I.width/2,y:I.top+I.height},{x:I.left+I.width,y:I.top+I.height/2}];$.end=g.cornerstoneMath.point.findClosestPoint(k,$.start),r.beginPath(),r.strokeStyle=l,r.lineWidth=s,r.setLineDash([2,3]),r.moveTo($.start.x,$.start.y),r.lineTo($.end.x,$.end.y),r.stroke()}}r.restore()}}}function c(e){function t(e){null===e?(0,N.removeToolState)(n,H,r):r.text=e,r.active=!1,o.updateImage(n)}var o=g.external.cornerstone,n=e.element,a=W.getConfiguration(),r=l(e);(0,N.addToolState)(n,H,r),o.updateImage(n),(0,k.default)(e,H,r,r.handles.end,function(){(0,I.default)(e,r.handles)&&(0,N.removeToolState)(n,H,r),void 0===r.text&&a.getTextCallback(t),o.updateImage(n)})}function d(e,t){function o(e,t,o){!0===o?(0,N.removeToolState)(a,H,e):e.text=t,e.active=!1,n.updateImage(a)}var n=g.external.cornerstone,a=t.element,r=void 0;if(!e.data||!e.data.mouseButtonMask||(0,R.default)(t.which,e.data.mouseButtonMask)){var i=W.getConfiguration(),l=t.currentPoints.canvas,u=(0,N.getToolState)(a,H);if(u){for(var c=0;c<u.data.length;c++)if(r=u.data[c],s(a,r,l)||(0,B.default)(r.handles.textBox,l))return r.active=!0,n.updateImage(a),i.changeTextCallback(r,t,o),e.stopImmediatePropagation(),!1;return!1}}}function f(e,t){function o(e,t,o){console.log("pressCallback doneChangingTextCallback"),!0===o?(0,N.removeToolState)(a,H,e):e.text=t,e.active=!1,n.updateImage(a),(0,g.$)(a).on("CornerstoneToolsTouchStart",L.touchStartCallback),(0,g.$)(a).on("CornerstoneToolsTouchStartActive",L.touchDownActivateCallback),(0,g.$)(a).on("CornerstoneToolsTap",L.tapCallback)}var n=g.external.cornerstone,a=t.element,r=void 0;if(e.data&&e.data.mouseButtonMask&&!(0,R.default)(t.which,e.data.mouseButtonMask))return!1;var i=W.getConfiguration(),l=t.currentPoints.canvas,u=(0,N.getToolState)(a,H);if(!u)return!1;if(t.handlePressed)return(0,g.$)(a).off("CornerstoneToolsTouchStart",L.touchStartCallback),(0,g.$)(a).off("CornerstoneToolsTouchStartActive",L.touchDownActivateCallback),(0,g.$)(a).off("CornerstoneToolsTap",L.tapCallback),i.changeTextCallback(t.handlePressed,t,o),e.stopImmediatePropagation(),!1;for(var c=0;c<u.data.length;c++)if(r=u.data[c],s(a,r,l)||(0,B.default)(r.handles.textBox,l))return r.active=!0,n.updateImage(a),(0,g.$)(a).off("CornerstoneToolsTouchStart",L.touchStartCallback),(0,g.$)(a).off("CornerstoneToolsTouchStartActive",L.touchDownActivateCallback),(0,g.$)(a).off("CornerstoneToolsTap",L.tapCallback),i.changeTextCallback(r,t,o),e.stopImmediatePropagation(),!1;return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.seedAnnotateTouch=t.seedAnnotate=void 0;var g=o(0),m=o(6),v=n(m),h=o(8),p=n(h),T=o(5),C=n(T),x=o(13),y=n(x),b=o(4),M=n(b),P=o(3),w=n(P),S=o(11),I=n(S),$=o(20),k=n($),O=o(7),D=n(O),_=o(48),j=n(_),E=o(2),R=n(E),A=o(17),B=n(A),N=o(1),H="seedAnnotate",V={getTextCallback:a,changeTextCallback:r,drawHandles:!1,drawHandlesOnHover:!0,currentLetter:"A",currentNumber:0,showCoordinates:!0,countUp:!0},W=(0,v.default)({addNewMeasurement:i,createNewMeasurement:l,onImageRendered:u,pointNearTool:s,toolType:H,mouseDoubleClickCallback:d});W.setConfiguration(V);var L=(0,p.default)({addNewMeasurement:c,createNewMeasurement:l,onImageRendered:u,pointNearTool:s,toolType:H,pressCallback:f});t.seedAnnotate=W,t.seedAnnotateTouch=L},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}function r(e,t,o){var n=c.external.cornerstone,a={start:n.pixelToCanvas(e,t.handles.start),end:n.pixelToCanvas(e,t.handles.middle)},r=c.cornerstoneMath.lineSegment.distanceToPoint(a,o);return r<25||(a.start=n.pixelToCanvas(e,t.handles.middle),a.end=n.pixelToCanvas(e,t.handles.end),(r=c.cornerstoneMath.lineSegment.distanceToPoint(a,o))<25)}function i(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function l(e,t){var o=(0,j.getToolState)(e.currentTarget,E);if(o){var n=c.external.cornerstone,a=t.enabledElement,r=t.canvasContext.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0);for(var l=void 0,s=x.default.getToolWidth(),u=T.default.getFont(),d=R.getConfiguration(),f=0;f<o.data.length;f++){r.save(),d&&d.shadow&&(r.shadowColor=d.shadowColor||"#000000",r.shadowOffsetX=d.shadowOffsetX||1,r.shadowOffsetY=d.shadowOffsetY||1);var g=o.data[f];l=g.active?b.default.getActiveColor():b.default.getToolColor();var v=n.pixelToCanvas(t.element,g.handles.start),p=n.pixelToCanvas(t.element,g.handles.middle),C=n.pixelToCanvas(t.element,g.handles.end);r.beginPath(),r.strokeStyle=l,r.lineWidth=s,r.moveTo(v.x,v.y),r.lineTo(p.x,p.y),r.lineTo(C.x,C.y),r.stroke();var y={drawHandlesIfActive:d&&d.drawHandlesOnHover};(0,O.default)(r,t,g.handles,l,y),r.fillStyle=l;var M=t.image.columnPixelSpacing||1,P=t.image.rowPixelSpacing||1,w="";t.image.rowPixelSpacing&&t.image.columnPixelSpacing||(w=" (isotropic)");var S={x:(Math.ceil(g.handles.middle.x)-Math.ceil(g.handles.start.x))*M,y:(Math.ceil(g.handles.middle.y)-Math.ceil(g.handles.start.y))*P},I={x:(Math.ceil(g.handles.end.x)-Math.ceil(g.handles.middle.x))*M,y:(Math.ceil(g.handles.end.y)-Math.ceil(g.handles.middle.y))*P},$={x:(Math.ceil(g.handles.end.x)-Math.ceil(g.handles.start.x))*M,y:(Math.ceil(g.handles.end.y)-Math.ceil(g.handles.start.y))*P},k=i(S),D=i(I),_=i($),A=Math.acos((Math.pow(k,2)+Math.pow(D,2)-Math.pow(_,2))/(2*k*D));A*=180/Math.PI;var B=(0,h.default)(A,2);if(B){var N=B.toString()+String.fromCharCode(parseInt("00B0",16))+w,H=void 0;if(g.handles.textBox.hasMoved)H=n.pixelToCanvas(t.element,g.handles.textBox);else{H={x:p.x,y:p.y},r.font=u;var V=r.measureText(N).width;p.x<v.x?H.x-=15+V+10:H.x+=15;var W=n.internal.getTransform(a);W.invert();var L=W.transformPoint(H.x,H.y);g.handles.textBox.x=L.x,g.handles.textBox.y=L.y}var Y={centering:{x:!1,y:!0}},F=(0,m.default)(r,N,H.x,H.y,l,Y);if(g.handles.textBox.boundingBox=F,g.handles.textBox.hasMoved){var z={start:{},end:{}},U=[v,C,p];z.end.x=H.x,z.end.y=H.y,z.start=c.cornerstoneMath.point.findClosestPoint(U,z.end);var X=[{x:F.left+F.width/2,y:F.top},{x:F.left,y:F.top+F.height/2},{x:F.left+F.width/2,y:F.top+F.height},{x:F.left+F.width,y:F.top+F.height/2}];z.end=c.cornerstoneMath.point.findClosestPoint(X,z.start),r.beginPath(),r.strokeStyle=l,r.lineWidth=s,r.setLineDash([2,3]),r.moveTo(z.start.x,z.start.y),r.lineTo(z.end.x,z.end.y),r.stroke()}}r.restore()}}}function s(e){var t=c.external.cornerstone,o=a(e),n=e.element,r={mouseButtonMask:e.which};(0,j.addToolState)(n,E,o),(0,c.$)(n).off("CornerstoneToolsMouseMove",R.mouseMoveCallback),(0,c.$)(n).off("CornerstoneToolsMouseDrag",R.mouseMoveCallback),(0,c.$)(n).off("CornerstoneToolsMouseDown",R.mouseDownCallback),(0,c.$)(n).off("CornerstoneToolsMouseDownActivate",R.mouseDownActivateCallback),t.updateImage(n),(0,S.default)(e,E,o,o.handles.middle,function(){if(o.active=!1,(0,P.default)(e,o.handles))return(0,j.removeToolState)(n,E,o),(0,c.$)(n).on("CornerstoneToolsMouseMove",R.mouseMoveCallback),(0,c.$)(n).on("CornerstoneToolsMouseDrag",R.mouseMoveCallback),(0,c.$)(n).on("CornerstoneToolsMouseDown",r,R.mouseDownCallback),(0,c.$)(n).on("CornerstoneToolsMouseDownActivate",r,R.mouseDownActivateCallback),void t.updateImage(n);o.handles.end.active=!0,t.updateImage(n),(0,S.default)(e,E,o,o.handles.end,function(){o.active=!1,(0,P.default)(e,o.handles)&&(0,j.removeToolState)(n,E,o),(0,c.$)(n).on("CornerstoneToolsMouseMove",R.mouseMoveCallback),(0,c.$)(n).on("CornerstoneToolsMouseDrag",R.mouseMoveCallback),(0,c.$)(n).on("CornerstoneToolsMouseDown",r,R.mouseDownCallback),(0,c.$)(n).on("CornerstoneToolsMouseDownActivate",r,R.mouseDownActivateCallback),t.updateImage(n)})})}function u(e){var t=c.external.cornerstone,o=a(e),n=e.element;(0,j.addToolState)(n,E,o),(0,c.$)(n).off("CornerstoneToolsTouchDrag",A.touchMoveCallback),(0,c.$)(n).off("CornerstoneToolsTouchStartActive",A.touchDownActivateCallback),(0,c.$)(n).off("CornerstoneToolsTouchStart",A.touchStartCallback),(0,c.$)(n).off("CornerstoneToolsTap",A.tapCallback),t.updateImage(n),(0,$.default)(e,E,o,o.handles.middle,function(){if((0,P.default)(e,o.handles))return(0,j.removeToolState)(n,E,o),(0,c.$)(n).on("CornerstoneToolsTouchDrag",A.touchMoveCallback),(0,c.$)(n).on("CornerstoneToolsTouchStart",A.touchStartCallback),(0,c.$)(n).on("CornerstoneToolsTouchStartActive",A.touchDownActivateCallback),(0,c.$)(n).on("CornerstoneToolsTap",A.tapCallback),void t.updateImage(n);(0,$.default)(e,E,o,o.handles.end,function(){(0,P.default)(e,o.handles)&&((0,j.removeToolState)(n,E,o),t.updateImage(n)),(0,c.$)(n).on("CornerstoneToolsTouchDrag",A.touchMoveCallback),(0,c.$)(n).on("CornerstoneToolsTouchStart",A.touchStartCallback),(0,c.$)(n).on("CornerstoneToolsTouchStartActive",A.touchDownActivateCallback),(0,c.$)(n).on("CornerstoneToolsTap",A.tapCallback)})})}Object.defineProperty(t,"__esModule",{value:!0}),t.simpleAngleTouch=t.simpleAngle=void 0;var c=o(0),d=o(6),f=n(d),g=o(5),m=n(g),v=o(35),h=n(v),p=o(13),T=n(p),C=o(4),x=n(C),y=o(3),b=n(y),M=o(11),P=n(M),w=o(21),S=n(w),I=o(22),$=n(I),k=o(7),O=n(k),D=o(8),_=n(D),j=o(1),E="simpleAngle",R=(0,f.default)({createNewMeasurement:a,addNewMeasurement:s,onImageRendered:l,pointNearTool:r,toolType:E}),A=(0,_.default)({createNewMeasurement:a,addNewMeasurement:u,onImageRendered:l,pointNearTool:r,toolType:E});t.simpleAngle=R,t.simpleAngleTouch=A},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=P.getConfiguration();if(t.current){var o={visible:!0,active:!0,text:t.current,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,hasBoundingBox:!0}}},n={left:0,top:0,width:e.image.width,height:e.image.height};if(u.cornerstoneMath.point.insideRect(o.handles.end,n)){var a=t.markers.indexOf(t.current);return t.ascending?(a+=1)>=t.markers.length&&(t.loop?a-=t.markers.length:a=-1):(a-=1)<0&&(t.loop?a+=t.markers.length:a=-1),t.current=t.markers[a],o}}}function r(e,t,o){if(t.handles.end.boundingBox){var n=u.cornerstoneMath.rect.distanceToPoint(t.handles.end.boundingBox,o),a=(0,v.default)(t.handles.end,o);return n<10||a}}function i(e,t){var o=(0,b.getToolState)(t.element,M);if(o){var n=t.canvasContext.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0);for(var a=P.getConfiguration(),r=0;r<o.data.length;r++){var i=o.data[r],l=p.default.getToolColor();i.active&&(l=p.default.getActiveColor()),n.save(),a&&a.shadow&&(n.shadowColor=a.shadowColor||"#000000",n.shadowOffsetX=a.shadowOffsetX||1,n.shadowOffsetY=a.shadowOffsetY||1),n.fillStyle=l;var s=n.measureText(i.text);i.textWidth=s.width+10;var c=u.external.cornerstone.pixelToCanvas(t.element,i.handles.end),d={centering:{x:!0,y:!0}},f=(0,y.default)(n,i.text,c.x,c.y-10,l,d);i.handles.end.boundingBox=f,n.restore()}}}function l(e,t){function o(t,o,r){!0===r?(0,b.removeToolState)(a,M,t):t.text=o,t.active=!1,n.updateImage(a);var i={mouseButtonMask:e.data.mouseButtonMask};(0,u.$)(a).on("CornerstoneToolsMouseMove",i,P.mouseMoveCallback),(0,u.$)(a).on("CornerstoneToolsMouseDown",i,P.mouseDownCallback),(0,u.$)(a).on("CornerstoneToolsMouseDownActivate",i,P.mouseDownActivateCallback),(0,u.$)(a).on("CornerstoneToolsMouseDoubleClick",i,P.mouseDoubleClickCallback)}var n=u.external.cornerstone,a=t.element,i=void 0;if(!e.data||!e.data.mouseButtonMask||(0,C.default)(t.which,e.data.mouseButtonMask)){var l=P.getConfiguration(),s=t.currentPoints.canvas,c=(0,b.getToolState)(a,M);if(c){for(var d=0;d<c.data.length;d++)if(i=c.data[d],r(a,i,s))return i.active=!0,n.updateImage(a),(0,u.$)(a).off("CornerstoneToolsMouseMove",P.mouseMoveCallback),(0,u.$)(a).off("CornerstoneToolsMouseDown",P.mouseDownCallback),(0,u.$)(a).off("CornerstoneToolsMouseDownActivate",P.mouseDownActivateCallback),(0,u.$)(a).off("CornerstoneToolsMouseDoubleClick",P.mouseDoubleClickCallback),l.changeTextCallback(i,t,o),e.stopImmediatePropagation(),!1;return!1}}}function s(e,t){function o(e,t,o){!0===o?(0,b.removeToolState)(a,M,e):e.text=t,e.active=!1,n.updateImage(a),(0,u.$)(a).on("CornerstoneToolsTouchDrag",w.touchMoveCallback),(0,u.$)(a).on("CornerstoneToolsTouchStartActive",w.touchDownActivateCallback),(0,u.$)(a).on("CornerstoneToolsTouchStart",w.touchStartCallback),(0,u.$)(a).on("CornerstoneToolsTap",w.tapCallback),(0,u.$)(a).on("CornerstoneToolsTouchPress",w.pressCallback)}var n=u.external.cornerstone,a=t.element,i=void 0,l=P.getConfiguration(),s=t.currentPoints.canvas,c=(0,b.getToolState)(a,M);if(!c)return!1;if(t.handlePressed)return t.handlePressed.active=!0,n.updateImage(a),(0,u.$)(a).off("CornerstoneToolsTouchDrag",w.touchMoveCallback),(0,u.$)(a).off("CornerstoneToolsTouchStartActive",w.touchDownActivateCallback),(0,u.$)(a).off("CornerstoneToolsTouchStart",w.touchStartCallback),(0,u.$)(a).off("CornerstoneToolsTap",w.tapCallback),(0,u.$)(a).off("CornerstoneToolsTouchPress",w.pressCallback),l.changeTextCallback(t.handlePressed,t,o),e.stopImmediatePropagation(),!1;for(var d=0;d<c.data.length;d++)if(i=c.data[d],r(a,i,s))return i.active=!0,n.updateImage(a),(0,u.$)(a).off("CornerstoneToolsTouchDrag",w.touchMoveCallback),(0,u.$)(a).off("CornerstoneToolsTouchStartActive",w.touchDownActivateCallback),(0,u.$)(a).off("CornerstoneToolsTouchStart",w.touchStartCallback),(0,u.$)(a).off("CornerstoneToolsTap",w.tapCallback),(0,u.$)(a).off("CornerstoneToolsTouchPress",w.pressCallback),l.changeTextCallback(i,t,o),e.stopImmediatePropagation(),!1;return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.textMarkerTouch=t.textMarker=void 0;var u=o(0),c=o(6),d=n(c),f=o(8),g=n(f),m=o(17),v=n(m),h=o(3),p=n(h),T=o(2),C=n(T),x=o(5),y=n(x),b=o(1),M="textMarker",P=(0,d.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:M,mouseDoubleClickCallback:l}),w=(0,g.default)({createNewMeasurement:a,onImageRendered:i,pointNearTool:r,toolType:M,pressCallback:s});t.textMarker=P,t.textMarkerTouch=w},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){(0,u.$)(t.element).off("CornerstoneToolsMouseDrag",l),(0,u.$)(t.element).off("CornerstoneToolsMouseUp",a),(0,u.$)(t.element).off("CornerstoneToolsMouseClick",a)}function r(e,t){if((0,v.default)(t.which,e.data.mouseButtonMask))return(0,u.$)(t.element).on("CornerstoneToolsMouseDrag",l),(0,u.$)(t.element).on("CornerstoneToolsMouseUp",a),(0,u.$)(t.element).on("CornerstoneToolsMouseClick",a),!1}function i(e){var t=e.image.maxPixelValue*e.image.slope+e.image.intercept,o=e.image.minPixelValue*e.image.slope+e.image.intercept,n=t-o,a=n/1024,r=e.deltaPoints.page.x*a,i=e.deltaPoints.page.y*a;e.viewport.voi.windowWidth+=r,e.viewport.voi.windowCenter+=i}function l(e,t){return h.strategy(t),u.external.cornerstone.setViewport(t.element,t.viewport),!1}function s(e,t){e.stopImmediatePropagation();var o=t,n=o.image.maxPixelValue*o.image.slope+o.image.intercept,a=o.image.minPixelValue*o.image.slope+o.image.intercept,r=n-a,i=r/1024,l=o.deltaPoints.page.x*i,s=o.deltaPoints.page.y*i,c=h.getConfiguration();c.orientation?0===c.orientation?(o.viewport.voi.windowWidth+=l,o.viewport.voi.windowCenter+=s):(o.viewport.voi.windowWidth+=s,o.viewport.voi.windowCenter+=l):(o.viewport.voi.windowWidth+=l,o.viewport.voi.windowCenter+=s),u.external.cornerstone.setViewport(o.element,o.viewport)}Object.defineProperty(t,"__esModule",{value:!0}),t.wwwcTouchDrag=t.wwwc=void 0;var u=o(0),c=o(12),d=n(c),f=o(10),g=n(f),m=o(2),v=n(m),h=(0,d.default)(r);h.strategies={default:i},h.strategy=i;var p=(0,g.default)(s);t.wwwc=h,t.wwwcTouchDrag=p},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t,o){var n=e.length;if(n<2)return{min:t,max:o,mean:(t+o)/2};for(var a=o,r=t,i=0,l=0;l<n;l++){var s=e[l];a=Math.min(a,s),r=Math.max(r,s),i+=s}return{min:a,max:r,mean:i/n}}function r(e,t){var o=(0,P.getToolState)(t.element,k);o&&o.data&&(o.data=[]),(0,C.$)(t.element).off("CornerstoneToolsMouseMove",d),(0,C.$)(t.element).off("CornerstoneToolsMouseDrag",d),(0,C.$)(t.element).off("CornerstoneToolsMouseUp",i),(0,C.$)(t.element).off("CornerstoneToolsMouseClick",i);var n={mouseButtonMask:D};(0,C.$)(t.element).on("CornerstoneToolsMouseDown",n,u)}function i(e,t){(0,C.$)(t.element).off("CornerstoneToolsMouseMove",d),(0,C.$)(t.element).off("CornerstoneToolsMouseDrag",d),(0,C.$)(t.element).off("CornerstoneToolsMouseUp",i),(0,C.$)(t.element).off("CornerstoneToolsMouseClick",i);var o={mouseButtonMask:D};(0,C.$)(t.element).on("CornerstoneToolsMouseDown",o,u);var n=(0,P.getToolState)(t.element,k);n&&n.data&&n.data.length&&(n.data[0].endPoint={x:t.currentPoints.image.x,y:t.currentPoints.image.y},l(t))}function l(e){var t=C.external.cornerstone,o=(0,P.getToolState)(e.element,k);if(o&&o.data&&o.data.length){var n=o.data[0].startPoint,r=o.data[0].endPoint,i=Math.abs(n.x-r.x),l=Math.abs(n.y-r.y),s=Math.min(n.x,r.x),u=Math.min(n.y,r.y);s=Math.max(s,0),s=Math.min(s,e.image.width),u=Math.max(u,0),u=Math.min(u,e.image.height),i=Math.floor(Math.min(i,Math.abs(e.image.width-s))),l=Math.floor(Math.min(l,Math.abs(e.image.height-u)));var c=(0,S.default)(e.element,s,u,i,l),d=a(c,e.image.minPixelValue,e.image.maxPixelValue),f=_.getConfiguration(),g=t.getViewport(e.element);void 0===f.minWindowWidth&&(f.minWindowWidth=10),g.voi.windowWidth=Math.max(Math.abs(d.max-d.min),f.minWindowWidth),g.voi.windowCenter=d.mean,t.setViewport(e.element,g),o.data=[],t.updateImage(e.element)}}function s(e,t){var o=t.element;(0,C.$)(o).off("CornerstoneToolsMouseMove"),(0,C.$)(o).off("CornerstoneToolsMouseDrag"),(0,C.$)(o).on("CornerstoneToolsMouseMove",d),(0,C.$)(o).on("CornerstoneToolsMouseDrag",d),(0,C.$)(o).on("CornerstoneToolsMouseClick",i),"CornerstoneToolsMouseDrag"===e.type&&(0,C.$)(o).on("CornerstoneToolsMouseUp",i)}function u(e,t){if((0,$.default)(t.which,e.data.mouseButtonMask))return(0,C.$)(t.element).on("CornerstoneToolsMouseDrag",t,s),(0,C.$)(t.element).on("CornerstoneToolsMouseMove",t,s),(0,C.$)(t.element).off("CornerstoneToolsMouseDown",u),c(t),!1}function c(e){var t=(0,P.getToolState)(e.element,k);t&&t.data&&(t.data=[]);var o={startPoint:{x:e.currentPoints.image.x,y:e.currentPoints.image.y}};(0,P.addToolState)(e.element,k,o)}function d(e,t){var o=(0,P.getToolState)(t.element,k);if(o&&o.data&&o.data.length){var n={x:t.currentPoints.image.x,y:t.currentPoints.image.y};o.data[0].endPoint=n,C.external.cornerstone.updateImage(t.element)}}function f(e,t){var o=C.external.cornerstone,n=(0,P.getToolState)(t.element,k);if(n&&n.data&&n.data.length){var a=n.data[0].startPoint,r=n.data[0].endPoint;if(a&&r){var i=(0,C.$)(t.element).find("canvas").get(0),l=i.getContext("2d");l.setTransform(1,0,0,1,0,0);var s=M.default.getActiveColor(),u=o.pixelToCanvas(t.element,a),c=o.pixelToCanvas(t.element,r),d=Math.min(u.x,c.x),f=Math.min(u.y,c.y),g=Math.abs(u.x-c.x),m=Math.abs(u.y-c.y),v=y.default.getToolWidth(),h=_.getConfiguration();l.save(),h&&h.shadow&&(l.shadowColor=h.shadowColor||"#000000",l.shadowOffsetX=h.shadowOffsetX||1,l.shadowOffsetY=h.shadowOffsetY||1),l.beginPath(),l.strokeStyle=s,l.lineWidth=v,l.rect(d,f,g,m),l.stroke(),l.restore()}}}function g(e){(0,C.$)(e).off("CornerstoneToolsMouseDown",u),(0,C.$)(e).off("CornerstoneToolsMouseUp",i),(0,C.$)(e).off("CornerstoneToolsMouseClick",i),(0,C.$)(e).off("CornerstoneToolsMouseDrag",d),(0,C.$)(e).off("CornerstoneToolsMouseMove",d),(0,C.$)(e).off("CornerstoneImageRendered",f),(0,C.$)(e).off("CornerstoneNewImage",r),C.external.cornerstone.updateImage(e)}function m(e,t){var o={mouseButtonMask:t};if(D=t,!(0,P.getToolState)(e,k)){var n=[];(0,P.addToolState)(e,k,n)}(0,C.$)(e).off("CornerstoneToolsMouseDown",u),(0,C.$)(e).off("CornerstoneToolsMouseUp",i),(0,C.$)(e).off("CornerstoneToolsMouseClick",i),(0,C.$)(e).off("CornerstoneToolsMouseDrag",d),(0,C.$)(e).off("CornerstoneToolsMouseMove",d),(0,C.$)(e).off("CornerstoneImageRendered",f),(0,C.$)(e).off("CornerstoneNewImage",r),(0,C.$)(e).on("CornerstoneToolsMouseDown",o,u),(0,C.$)(e).on("CornerstoneImageRendered",f),(0,C.$)(e).on("CornerstoneNewImage",r),C.external.cornerstone.updateImage(e)}function v(e){(0,C.$)(e).off("CornerstoneToolsTouchDrag",d),(0,C.$)(e).off("CornerstoneToolsTouchStart",c),(0,C.$)(e).off("CornerstoneToolsDragEnd",l),(0,C.$)(e).off("CornerstoneImageRendered",f)}function h(e){if(!(0,P.getToolState)(e,k)){var t=[];(0,P.addToolState)(e,k,t)}(0,C.$)(e).off("CornerstoneToolsTouchDrag",d),(0,C.$)(e).off("CornerstoneToolsTouchStart",c),(0,C.$)(e).off("CornerstoneToolsDragEnd",l),(0,C.$)(e).off("CornerstoneImageRendered",f),(0,C.$)(e).on("CornerstoneToolsTouchDrag",d),(0,C.$)(e).on("CornerstoneToolsTouchStart",c),(0,C.$)(e).on("CornerstoneToolsDragEnd",l),(0,C.$)(e).on("CornerstoneImageRendered",f)}function p(){return O}function T(e){O=e}Object.defineProperty(t,"__esModule",{value:!0}),t.wwwcRegionTouch=t.wwwcRegion=void 0;var C=o(0),x=o(4),y=n(x),b=o(3),M=n(b),P=o(1),w=o(50),S=n(w),I=o(2),$=n(I),k="wwwcRegion",O={minWindowWidth:10},D=void 0,_={activate:m,deactivate:g,disable:g,setConfiguration:T,getConfiguration:p},j={activate:h,deactivate:v,disable:v};t.wwwcRegion=_,t.wwwcRegionTouch=j},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var o=I.getConfiguration(),n=Math.log(e.scale)/Math.log(1.7),a=n+t,r=Math.pow(1.7,a);return o.maxScale&&r>o.maxScale?e.scale=o.maxScale:o.minScale&&r<o.minScale?e.scale=o.minScale:e.scale=r,e}function r(e,t,o){return e.x=Math.max(e.x,0),e.y=Math.max(e.y,0),e.x=Math.min(e.x,t),e.y=Math.min(e.y,o),e}function i(e,t){if(t.hflip&&(e.x*=-1),t.vflip&&(e.y*=-1),0!==t.rotation){var o=t.rotation*Math.PI/180,n=Math.cos(o),a=Math.sin(o),r=e.x*n-e.y*a,i=e.x*a+e.y*n;e.x=r,e.y=i}return e}function l(e,t){var o=v.external.cornerstone,n=e.element,r=a(e.viewport,t);o.setViewport(n,r);var l=o.pageToPixel(n,e.startPoints.page.x,e.startPoints.page.y),s={x:e.startPoints.image.x-l.x,y:e.startPoints.image.y-l.y};s=i(s,r),r.translation.x-=s.x,r.translation.y-=s.y,o.setViewport(n,r)}function s(e,t){var o=e.element,n=e.image,l=I.getConfiguration(),s=a(e.viewport,t),u={x:0,y:0};if(t<0)s.scale<3&&(Math.abs(s.translation.x)<.01?s.translation.x=0:u.x=s.translation.x/8,Math.abs(s.translation.y)<.01?s.translation.y=0:u.y=s.translation.y/8);else{l&&l.preventZoomOutsideImage&&(S.image=r(S.image,n.width,n.height));var c={x:n.width/2-S.image.x,y:n.height/2-S.image.y};c=i(c,s);var d={x:s.translation.x-c.x,y:s.translation.y-c.y};Math.abs(d.x)<.01?s.translation.x=c.x:u.x=d.x/8,Math.abs(d.y)<.01?s.translation.y=c.y:u.y=d.y/8}s.translation.x-=u.x,s.translation.y-=u.y,v.external.cornerstone.setViewport(o,s)}function u(e,t){var o=e.element,n=a(e.viewport,t);v.external.cornerstone.setViewport(o,n)}function c(e,t){(0,v.$)(t.element).off("CornerstoneToolsMouseDrag",f),(0,v.$)(t.element).off("CornerstoneToolsMouseUp",c),(0,v.$)(t.element).off("CornerstoneToolsMouseClick",c)}function d(e,t){if((0,C.default)(t.which,e.data.mouseButtonMask))return S=t.startPoints,(0,v.$)(t.element).on("CornerstoneToolsMouseDrag",f),(0,v.$)(t.element).on("CornerstoneToolsMouseUp",c),(0,v.$)(t.element).on("CornerstoneToolsMouseClick",c),!1}function f(e,t){if(!t.deltaPoints.page.y)return!1;var o=t.deltaPoints.page.y/100;return I.strategy(t,o),!1}function g(e,t){var o=-t.direction/4,n=I.getConfiguration();n&&n.invert&&(o*=-1);var r=a(t.viewport,o);v.external.cornerstone.setViewport(t.element,r)}function m(e,t){var o=v.external.cornerstone,n=I.getConfiguration(),a=t.viewport,r=t.element;a.scale+=t.scaleChange*a.scale,n.maxScale&&a.scale>n.maxScale?a.scale=n.maxScale:n.minScale&&a.scale<n.minScale&&(a.scale=n.minScale),o.setViewport(r,a);var l=o.pageToPixel(r,t.startPoints.page.x,t.startPoints.page.y),s={x:t.startPoints.image.x-l.x,y:t.startPoints.image.y-l.y};s=i(s,a),a.translation.x-=s.x,a.translation.y-=s.y,o.setViewport(r,a)}Object.defineProperty(t,"__esModule",{value:!0}),t.zoomTouchDrag=t.zoomTouchPinch=t.zoomWheel=t.zoom=void 0;var v=o(0),h=o(12),p=n(h),T=o(2),C=n(T),x=o(19),y=n(x),b=o(40),M=n(b),P=o(10),w=n(P),S=void 0,I=(0,p.default)(d);I.strategies={default:l,translate:s,zoomToCenter:u},I.strategy=l;var $=(0,y.default)(g),k=(0,M.default)(m),O=(0,w.default)(f);t.zoom=I,t.zoomWheel=$,t.zoomTouchPinch=k,t.zoomTouchDrag=O},function(e,t,o){"use strict";function n(e){var t=l.external.cornerstone,o=e.currentTarget,n={event:window.event||e,element:o,viewport:t.getViewport(o),image:t.getEnabledElement(o).image,currentPoints:{page:{x:s,y:u},image:t.pageToPixel(o,s,u)},keyCode:e.keyCode,which:e.which};n.currentPoints.canvas=t.pixelToCanvas(o,n.currentPoints.image);var a={keydown:"CornerstoneToolsKeyDown",keypress:"CornerstoneToolsKeyPress",keyup:"CornerstoneToolsKeyUp"};(0,l.$)(o).trigger(a[e.type],n)}function a(e){s=e.pageX||e.originalEvent.pageX,u=e.pageY||e.originalEvent.pageY}function r(e){i(e),(0,l.$)(e).on(c,n),(0,l.$)(e).on("mousemove",a)}function i(e){(0,l.$)(e).off(c,n),(0,l.$)(e).off("mousemove",a)}Object.defineProperty(t,"__esModule",{value:!0});var l=o(0),s=void 0,u=void 0,c="keydown keypress keyup",d={enable:r,disable:i};t.default=d},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return"number"!=typeof e.buttons?e.which:0===e.buttons?0:e.buttons%2==1?1:e.buttons%4==2?3:e.buttons%8==4?2:0}function r(){p=!1}function i(e){(0,f.$)(e.element).trigger("CornerstoneToolsMouseDownActivate",e)}function l(e){var t=f.external.cornerstone,o=e.currentTarget,n="CornerstoneToolsMouseDoubleClick",r={page:f.cornerstoneMath.point.pageToPoint(e),image:t.pageToPixel(o,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=t.pixelToCanvas(o,r.image);var i=(0,m.default)(r),l={event:e,which:a(e),viewport:t.getViewport(o),image:t.getEnabledElement(o).image,element:o,startPoints:r,lastPoints:i,currentPoints:r,deltaPoints:{x:0,y:0},type:n},s=f.$.Event(n,l);(0,f.$)(l.element).trigger(s,l)}function s(e){function t(e){var t={page:f.cornerstoneMath.point.pageToPoint(e),image:n.pageToPixel(l,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};t.canvas=n.pixelToCanvas(l,t.image);var o={page:f.cornerstoneMath.point.subtract(t.page,c.page),image:f.cornerstoneMath.point.subtract(t.image,c.image),client:f.cornerstoneMath.point.subtract(t.client,c.client),canvas:f.cornerstoneMath.point.subtract(t.canvas,c.canvas)},a={which:v,viewport:n.getViewport(l),image:n.getEnabledElement(l).image,element:l,startPoints:s,lastPoints:c,currentPoints:t,deltaPoints:o,type:"CornerstoneToolsMouseDrag",ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey};return(0,f.$)(a.element).trigger("CornerstoneToolsMouseDrag",a),c=(0,m.default)(t),(0,h.default)(e)}function o(e){clearTimeout(T);var a="CornerstoneToolsMouseUp";p&&(a="CornerstoneToolsMouseClick");var r={page:f.cornerstoneMath.point.pageToPoint(e),image:n.pageToPixel(l,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=n.pixelToCanvas(l,r.image);var i={page:f.cornerstoneMath.point.subtract(r.page,c.page),image:f.cornerstoneMath.point.subtract(r.image,c.image),client:f.cornerstoneMath.point.subtract(r.client,c.client),canvas:f.cornerstoneMath.point.subtract(r.canvas,c.canvas)},d={event:e,which:v,viewport:n.getViewport(l),image:n.getEnabledElement(l).image,element:l,startPoints:s,lastPoints:c,currentPoints:r,deltaPoints:i,type:a},g=f.$.Event(a,d);(0,f.$)(d.element).trigger(g,d),(0,f.$)(document).off("mousemove",t),(0,f.$)(document).off("mouseup",o),(0,f.$)(d.element).on("mousemove",u),p=!0}T=setTimeout(r,C);var n=f.external.cornerstone,l=e.currentTarget;(0,f.$)(l).off("mousemove",u);var s={page:f.cornerstoneMath.point.pageToPoint(e),image:n.pageToPixel(l,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};s.canvas=n.pixelToCanvas(l,s.image);var c=(0,m.default)(s),d={event:e,which:a(e),viewport:n.getViewport(l),image:n.getEnabledElement(l).image,element:l,startPoints:s,lastPoints:c,currentPoints:s,deltaPoints:{x:0,y:0},type:"CornerstoneToolsMouseDown"},g=f.$.Event("CornerstoneToolsMouseDown",d);if((0,f.$)(d.element).trigger(g,d),!1===g.isImmediatePropagationStopped()&&!0===i(d))return(0,h.default)(e);var v=a(e);return(0,f.$)(document).on("mousemove",t),(0,f.$)(document).on("mouseup",o),(0,h.default)(e)}function u(e){var t=f.external.cornerstone,o=e.currentTarget,n={page:f.cornerstoneMath.point.pageToPoint(e),image:t.pageToPixel(o,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};n.canvas=t.pixelToCanvas(o,n.image);var r=(0,m.default)(n),i=a(e),l={page:f.cornerstoneMath.point.pageToPoint(e),image:t.pageToPixel(o,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};l.canvas=t.pixelToCanvas(o,l.image);var s={page:f.cornerstoneMath.point.subtract(l.page,r.page),image:f.cornerstoneMath.point.subtract(l.image,r.image),client:f.cornerstoneMath.point.subtract(l.client,r.client),canvas:f.cornerstoneMath.point.subtract(l.canvas,r.canvas)},u={which:i,viewport:t.getViewport(o),image:t.getEnabledElement(o).image,element:o,startPoints:n,lastPoints:r,currentPoints:l,deltaPoints:s,type:"CornerstoneToolsMouseMove"};(0,f.$)(o).trigger("CornerstoneToolsMouseMove",u),r=(0,m.default)(l)}function c(e){(0,f.$)(e).off("mousedown",s),(0,f.$)(e).off("mousemove",u),(0,f.$)(e).off("dblclick",l)}function d(e){c(e),(0,f.$)(e).on("mousedown",s),(0,f.$)(e).on("mousemove",u),(0,f.$)(e).on("dblclick",l)}Object.defineProperty(t,"__esModule",{value:!0});var f=o(0),g=o(30),m=n(g),v=o(32),h=n(v),p=!0,T=void 0,C=200,x={enable:d,disable:c};t.default=x},function(e,t,o){"use strict";function n(e){if(!("mousewheel"===e.originalEvent.type&&0===e.originalEvent.wheelDeltaY||"DOMMouseScroll"===e.originalEvent.type&&1===e.originalEvent.axis)){e.preventDefault();var t=i.external.cornerstone,o=e.currentTarget,n=void 0,a=void 0;void 0!==e.pageX&&void 0!==e.pageY?(n=e.pageX,a=e.pageY):e.originalEvent&&void 0!==e.originalEvent.pageX&&void 0!==e.originalEvent.pageY?(n=e.originalEvent.pageX,a=e.originalEvent.pageY):(n=e.x,a=e.y);var r=t.pageToPixel(o,n,a);e=window.event||e;var l=void 0;l=e.originalEvent&&e.originalEvent.wheelDelta?-e.originalEvent.wheelDelta:e.originalEvent&&e.originalEvent.deltaY?-e.originalEvent.deltaY:e.originalEvent&&e.originalEvent.detail?-e.originalEvent.detail:e.wheelDelta;var s=l<0?-1:1,u={element:o,viewport:t.getViewport(o),image:t.getEnabledElement(o).image,direction:s,pageX:n,pageY:a,imageX:r.x,imageY:r.y};(0,i.$)(o).trigger("CornerstoneToolsMouseWheel",u)}}function a(e){r(e),(0,i.$)(e).on(l,n)}function r(e){(0,i.$)(e).unbind(l,n)}Object.defineProperty(t,"__esModule",{value:!0});var i=o(0),l="mousewheel DOMMouseScroll",s={enable:a,disable:r};t.default=s},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=l.external.cornerstone,o=e.currentTarget||e.srcEvent.currentTarget,n=void 0,a=void 0,r=void 0,i=void 0,s=void 0,c=void 0;switch(e.preventDefault(),(e.pointers&&e.pointers.length>1||e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches.length>1)&&(w=!1,clearTimeout(x)),e.type){case"tap":w=!1,clearTimeout(x),v={page:l.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:t.pageToPixel(o,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},v.canvas=t.pixelToCanvas(o,v.image),a="CornerstoneToolsTap",T={event:e,viewport:t.getViewport(o),image:t.getEnabledElement(o).image,element:o,currentPoints:v,type:a,isTouchEvent:!0},n=l.$.Event(a,T),(0,l.$)(o).trigger(n,T);break;case"doubletap":w=!1,clearTimeout(x),v={page:l.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:t.pageToPixel(o,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},v.canvas=t.pixelToCanvas(o,v.image),a="CornerstoneToolsDoubleTap",T={event:e,viewport:t.getViewport(o),image:t.getEnabledElement(o).image,element:o,currentPoints:v,type:a,isTouchEvent:!0},n=l.$.Event(a,T),(0,l.$)(o).trigger(n,T);break;case"pinchstart":w=!1,clearTimeout(x),b=1;break;case"pinchmove":if(w=!1,clearTimeout(x),!0===P){b=e.scale,P=!1;break}r=(e.scale-b)/b,m={page:e.center,image:t.pageToPixel(o,e.center.x,e.center.y)},m.canvas=t.pixelToCanvas(o,m.image),a="CornerstoneToolsTouchPinch",T={event:e,startPoints:m,viewport:t.getViewport(o),image:t.getEnabledElement(o).image,element:o,direction:e.scale<1?1:-1,scaleChange:r,type:a,isTouchEvent:!0},n=l.$.Event(a,T),(0,l.$)(o).trigger(n,T),b=e.scale;break;case"touchstart":b=1,clearTimeout(x),clearTimeout(C),C=setTimeout(function(){m={page:l.cornerstoneMath.point.pageToPoint(e.originalEvent.touches[0]),image:t.pageToPixel(o,e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY),client:{x:e.originalEvent.touches[0].clientX,y:e.originalEvent.touches[0].clientY}},m.canvas=t.pixelToCanvas(o,m.image),a="CornerstoneToolsTouchStart",e.originalEvent.touches.length>1&&(a="CornerstoneToolsMultiTouchStart"),T={event:e,viewport:t.getViewport(o),image:t.getEnabledElement(o).image,element:o,startPoints:m,currentPoints:m,type:a,isTouchEvent:!0},n=l.$.Event(a,T),(0,l.$)(o).trigger(n,T),!1===n.isImmediatePropagationStopped()&&(a="CornerstoneToolsTouchStartActive",e.originalEvent.touches.length>1&&(a="CornerstoneToolsMultiTouchStartActive"),T.type=a,(0,l.$)(o).trigger(a,T)),h=(0,u.default)(m)},50),w=!0,y=0,x=setTimeout(function(){w&&(v={page:l.cornerstoneMath.point.pageToPoint(e.originalEvent.touches[0]),image:t.pageToPixel(o,e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY),client:{x:e.originalEvent.touches[0].clientX,y:e.originalEvent.touches[0].clientY}},v.canvas=t.pixelToCanvas(o,m.image),a="CornerstoneToolsTouchPress",T={event:e,viewport:t.getViewport(o),image:t.getEnabledElement(o).image,element:o,currentPoints:v,type:a,isTouchEvent:!0},n=l.$.Event(a,T),(0,l.$)(o).trigger(n,T))},I);break;case"touchend":b=1,w=!1,clearTimeout(x),setTimeout(function(){m={page:l.cornerstoneMath.point.pageToPoint(e.originalEvent.changedTouches[0]),image:t.pageToPixel(o,e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY),client:{x:e.originalEvent.changedTouches[0].clientX,y:e.originalEvent.changedTouches[0].clientY}},m.canvas=t.pixelToCanvas(o,m.image),a="CornerstoneToolsTouchEnd",T={event:e,viewport:t.getViewport(o),image:t.getEnabledElement(o).image,element:o,startPoints:m,currentPoints:m,type:a,isTouchEvent:!0},n=l.$.Event(a,T),(0,l.$)(o).trigger(n,T)},50);break;case"panmove":i={x:e.deltaX-S.x,y:e.deltaY-S.y},S={x:e.deltaX,y:e.deltaY},v={page:{x:h.page.x+i.x,y:h.page.y+i.y},image:t.pageToPixel(o,h.page.x+i.x,h.page.y+i.y),client:{x:h.client.x+i.x,y:h.client.y+i.y}},v.canvas=t.pixelToCanvas(o,v.image),p={page:l.cornerstoneMath.point.subtract(v.page,h.page),image:l.cornerstoneMath.point.subtract(v.image,h.image),client:l.cornerstoneMath.point.subtract(v.client,h.client),canvas:l.cornerstoneMath.point.subtract(v.canvas,h.canvas)},y+=Math.sqrt(p.page.x*p.page.x+p.page.y*p.page.y),y>$&&(w=!1,clearTimeout(x)),a="CornerstoneToolsTouchDrag",e.pointers.length>1&&(a="CornerstoneToolsMultiTouchDrag"),T={viewport:t.getViewport(o),image:t.getEnabledElement(o).image,element:o,startPoints:m,lastPoints:h,currentPoints:v,deltaPoints:p,numPointers:e.pointers.length,type:a,isTouchEvent:!0},n=l.$.Event(a,T),(0,l.$)(o).trigger(n,T),h=(0,u.default)(v);break;case"panstart":S={x:e.deltaX,y:e.deltaY},v={page:l.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:t.pageToPixel(o,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},v.canvas=t.pixelToCanvas(o,v.image),h=(0,u.default)(v);break;case"panend":return w=!1,(clearTimeout(x),h)?(v={page:l.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:t.pageToPixel(o,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}},v.canvas=t.pixelToCanvas(o,v.image),p={page:l.cornerstoneMath.point.subtract(v.page,h.page),image:l.cornerstoneMath.point.subtract(v.image,h.image),client:l.cornerstoneMath.point.subtract(v.client,h.client),canvas:l.cornerstoneMath.point.subtract(v.canvas,h.canvas)},a="CornerstoneToolsDragEnd",T={event:e.srcEvent,viewport:t.getViewport(o),image:t.getEnabledElement(o).image,element:o,startPoints:m,lastPoints:h,currentPoints:v,deltaPoints:p,type:a,isTouchEvent:!0},n=l.$.Event(a,T),(0,l.$)(o).trigger(n,T),s=e.pointers.length-e.changedPointers.length,2===s&&(P=!0),(0,d.default)(e)):!1;case"rotatemove":w=!1,clearTimeout(x),c=e.rotation-M,M=e.rotation,a="CornerstoneToolsTouchRotate",T={event:e.srcEvent,viewport:t.getViewport(o),image:t.getEnabledElement(o).image,element:o,rotation:c,type:a},n=l.$.Event(a,T),(0,l.$)(o).trigger(n,T)}return!1}function r(e){i(e);var t={inputClass:l.Hammer.SUPPORT_POINTER_EVENTS?l.Hammer.PointerEventInput:l.Hammer.TouchInput},o=new l.Hammer.Manager(e,t),n={pointers:0,direction:l.Hammer.DIRECTION_ALL,threshold:0},r=new l.Hammer.Pan(n),s=new l.Hammer.Pinch({threshold:0}),u=new l.Hammer.Rotate({threshold:0});s.recognizeWith(r),s.recognizeWith(u),u.recognizeWith(r);var c=new l.Hammer.Tap({event:"doubletap",taps:2,interval:1500,threshold:50,posThreshold:50});c.recognizeWith(r),o.add([c,r,u,s]),o.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",a),g.default.enable(e),(0,l.$)(e).on("touchstart touchend",a),(0,l.$)(e).data("hammer",o)}function i(e){g.default.disable(e),(0,l.$)(e).off("touchstart touchend",a);var t=(0,l.$)(e).data("hammer");t&&t.off("tap doubletap panstart panmove panend pinchmove rotatemove",a)}Object.defineProperty(t,"__esModule",{value:!0});var l=o(0),s=o(30),u=n(s),c=o(32),d=n(c),f=o(41),g=n(f),m=void 0,v=void 0,h=void 0,p=void 0,T=void 0,C=void 0,x=void 0,y=void 0,b=1,M=0,P=!1,w=!1,S=void 0,I=700,$=5,k={enable:r,disable:i};t.default=k},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return{visible:!0,active:!0,imageData:e}}function r(e){var t=$.getConfiguration(),o=h.external.cornerstone.getEnabledElement(e.element),n=o.canvas.getContext("2d");n.setTransform(1,0,0,1,0,0),i(n,e.currentPoints.canvas,t.radius*o.viewport.scale,t.dragColor),w.push({x:Math.round(e.currentPoints.image.x),y:Math.round(e.currentPoints.image.y)}),S=e.currentPoints.canvas}function i(e,t,o,n){e.save(),e.beginPath(),e.arc(t.x,t.y,o,0,2*Math.PI,!0),e.strokeStyle=n,e.fillStyle=n,e.stroke(),e.fill(),e.restore()}function l(e,t,o){e.save(),e.beginPath(),e.arc(t.x,t.y,o,0,2*Math.PI,!0),e.clip(),e.clearRect(t.x-o-1,t.y-o-1,2*o+2,2*o+2),e.restore()}function s(e){h.external.cornerstone.updateImage(e.currentTarget,!0)}function u(e,t){S=t.currentPoints.canvas,h.external.cornerstone.updateImage(t.element)}function c(e,t){S=t.currentPoints.canvas,h.external.cornerstone.updateImage(t.element,!0),(0,h.$)(t.element).off("CornerstoneToolsMouseDrag",u),(0,h.$)(t.element).off("CornerstoneToolsMouseDrag",d),(0,h.$)(t.element).off("CornerstoneToolsMouseUp",c),(0,h.$)(t.element).off("CornerstoneToolsMouseClick",c)}function d(e,t){return $.strategy(t),!1}function f(e,t){if((0,y.default)(t.which,e.data.mouseButtonMask))return(0,h.$)(t.element).on("CornerstoneToolsMouseDrag",d),(0,h.$)(t.element).on("CornerstoneToolsMouseUp",c),(0,h.$)(t.element).on("CornerstoneToolsMouseClick",c),$.strategy(t),!1;(0,h.$)(t.element).on("CornerstoneToolsMouseDrag",u),(0,h.$)(t.element).on("CornerstoneToolsMouseUp",c)}function g(e,t){var o=$.getConfiguration(),n=h.external.cornerstone.getEnabledElement(t.element),a=n.canvas.getContext("2d");if(a.setTransform(1,0,0,1,0,0),S){var r=o.radius*n.viewport.scale;i(a,S,r,o.hoverColor)}}function m(e,t){return function(){var o=$.getConfiguration(),n=o.draw,r=o.radius,s=o.overlayColor,u=t.width,c=t.height,d=t.getContext("2d"),f=(0,p.getToolState)(e,b);if(f){var g=f.data[f.data.length-1];d.putImageData(g.imageData,0,0)}1===n?w.forEach(function(e){i(d,e,r,s)}):w.forEach(function(e){l(d,e,r)}),w=[];var m=d.getImageData(0,0,u,c),v=a(m);return(0,p.addToolState)(e,b,v),m.data}}function v(e,t){(0,h.$)(e).off("CornerstoneImageRendered",g),(0,h.$)(e).on("CornerstoneImageRendered",g);var o=h.external.cornerstone,n={mouseButtonMask:t};(0,h.$)(e).off("CornerstoneToolsMouseDownActivate",f),(0,h.$)(e).on("CornerstoneToolsMouseDownActivate",n,f),(0,h.$)(e).off("CornerstoneToolsMouseMove",u),(0,h.$)(e).on("CornerstoneToolsMouseMove",u),(0,h.$)(e).off("CornerstoneNewImage",s),(0,h.$)(e).on("CornerstoneNewImage",s);var a=o.getEnabledElement(e),r=document.createElement("canvas");r.width=a.image.width,r.height=a.image.height;var i=r.getContext("2d"),l=r.width,c=r.height;i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,l,c);var d={minPixelValue:0,maxPixelValue:255,slope:1,intercept:0,windowCenter:127,windowWidth:256,getPixelData:m(e,r),rgba:!0,rows:a.image.height,columns:a.image.width,height:a.image.height,width:a.image.width,color:!0,invert:!1,columnPixelSpacing:1,rowPixelSpacing:1,sizeInBytes:a.image.width*a.image.height*4},v=void 0;I&&(v=o.getLayer(e,I)),v||(I=o.addLayer(e,d)),M[e.id]=r,o.updateImage(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.brush=void 0;var h=o(0),p=o(1),T=o(6),C=n(T),x=o(2),y=n(x),b="brush",M={},P={draw:1,radius:10,hoverColor:"green",dragColor:"yellow",overlayColor:"red"},w=[],S=void 0,I=void 0,$=(0,C.default)({mouseMoveCallback:u,mouseDownActivateCallback:f,onImageRendered:g});$.activate=v,$.setConfiguration(P),$.strategies={default:r},$.strategy=r,t.brush=$},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=o(53),r=n(a),i=o(112),l=n(i),s=o(54),u=n(s),c={calculateReferenceLine:r.default,tool:l.default,renderActiveReferenceLine:u.default};t.default=c},function(e,t,o){"use strict";function n(e,t){var o=void 0,n=void 0,a=void 0,r=0,i=e.length,l=[];for(l.isTimeVarying=!1,("number"!=typeof t||t<=0)&&(t=1),o=1;o<i;o++)a=Number(e[o])/t|0,l.push(a),1===o?n=a:a!==n&&(l.isTimeVarying=!0),r+=a;return l.length>0&&(a=l.isTimeVarying?r/l.length|0:l[0],l.push(a)),l}function a(e){var t=e.intervalId;void 0!==t&&(e.intervalId=void 0,e.usingFrameTimeVector?clearTimeout(t):clearInterval(t))}function r(e){var t={element:e},o=s.$.Event("CornerstoneToolsClipStopped",t);(0,s.$)(e).trigger(o,t)}function i(e,t){var o=void 0,i=void 0;if(void 0===e)throw new Error("playClip: element must not be undefined");var l=(0,d.getToolState)(e,"stack");if(l&&l.data&&l.data.length){var u=s.external.cornerstone,g=void 0;if(l.data.length>1){var m=(0,d.getToolState)(e,"stackRenderer");m&&m.data&&m.data.length&&(g=m.data[0])}var v=l.data[0],h=(0,d.getToolState)(e,f);h&&h.data&&h.data.length?(o=h.data[0],a(o)):(o={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,frameRate:0,frameTimeVector:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,speed:1,reverse:!1,loop:!0},(0,d.addToolState)(e,f,o)),(t<0||t>0)&&(o.framesPerSecond=Number(t),o.reverse=o.framesPerSecond<0,o.ignoreFrameTimeVector=!0),!0!==o.ignoreFrameTimeVector&&o.frameTimeVector&&o.frameTimeVector.length===v.imageIds.length&&(i=n(o.frameTimeVector,o.speed));var p=function(){var t=void 0,n=void 0,i=void 0,s=void 0,d=v.currentImageIdIndex,f=v.imageIds.length;if(o.reverse?d--:d++,!o.loop&&(d<0||d>=f))return a(o),void r(e);d>=f&&(d=0),d<0&&(d=f-1),d!==v.currentImageIdIndex&&(n=c.default.getStartLoadHandler(),i=c.default.getEndLoadHandler(),s=c.default.getErrorLoadingHandler(),n&&n(e),t=!0===v.preventCache?u.loadImage(v.imageIds[d]):u.loadAndCacheImage(v.imageIds[d]),t.then(function(t){try{v.currentImageIdIndex=d,g?(g.currentImageIdIndex=d,g.render(e,l.data)):u.displayImage(e,t),i&&i(e,t)}catch(e){return}},function(t){var o=v.imageIds[d];s&&s(e,o,t)}))};i&&i.length>0&&i.isTimeVarying?(o.usingFrameTimeVector=!0,o.intervalId=setTimeout(function e(){o.intervalId=setTimeout(e,i[v.currentImageIdIndex]),p()},0)):(o.usingFrameTimeVector=!1,o.intervalId=setInterval(p,1e3/Math.abs(o.framesPerSecond)))}}function l(e){var t=(0,d.getToolState)(e,f);t&&t.data&&t.data.length&&a(t.data[0])}Object.defineProperty(t,"__esModule",{value:!0}),t.stopClip=t.playClip=void 0;var s=o(0),u=o(9),c=function(e){return e&&e.__esModule?e:{default:e}}(u),d=o(1),f="playClip";t.playClip=i,t.stopClip=l},function(e,t,o){"use strict";function n(e,t){var o=t.element,n=t.enabledElement.canvas.width,a=t.enabledElement.canvas.height;if(!n||!a)return!1;var r=t.enabledElement.canvas.getContext("2d");r.setTransform(1,0,0,1,0,0),r.save();var s=u.getConfiguration();r.fillStyle=s.backgroundColor,"horizontal"===s.orientation?r.fillRect(0,a-l,n,l):r.fillRect(0,0,l,a);var c=(0,i.getToolState)(o,"stack");if(c&&c.data&&c.data.length){var d=c.data[0].imageIds,f=c.data[0].currentImageIdIndex,g=n/d.length,m=a/d.length,v=g*f,h=m*f;r.fillStyle=s.fillColor,"horizontal"===s.orientation?r.fillRect(v,a-l,g,l):r.fillRect(0,h,l,m),r.restore()}}Object.defineProperty(t,"__esModule",{value:!0});var a=o(18),r=function(e){return e&&e.__esModule?e:{default:e}}(a),i=o(1),l=6,s={backgroundColor:"rgb(19, 63, 141)",fillColor:"white",orientation:"horizontal"},u=(0,r.default)(n);u.setConfiguration(s),t.default=u},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){e=Math.round(e)||0,t=Math.round(t)||0;var o=[],n=t-e+1;if(n<=0)return o;for(;n--;)o[n]=t--;return o}function r(e,t){var o=[],n=[];return e.forEach(function(e){e<t?o.push(e):e>t&&n.push(e)}),{low:e.indexOf(w(o)),high:e.indexOf(S(n))}}function i(e){function t(e){var t=s.indicesToRequest.indexOf(e);t>-1&&s.indicesToRequest.splice(t,1)}function o(e){t(i.imageIds.indexOf(e.imageId))}function n(t){console.log("prefetch errored: "+t),f&&f(e,c,t,"stackPrefetch")}var a=(0,T.getToolState)(e,"stack");if(a&&a.data&&a.data.length){var i=a.data[0],l=(0,T.getToolState)(e,x);if(l){var s=l.data[0]||{};if(s.indicesToRequest&&s.indicesToRequest.length||(s.enabled=!1),!1!==s.enabled){l.data[0].indicesToRequest.sort(function(e,t){return e-t});if(s.indicesToRequest.slice().forEach(function(e){var o=i.imageIds[e];if(o){var n=g.external.cornerstone.imageCache.getImagePromise(o);n&&"resolved"===n.state()&&t(e)}}),s.indicesToRequest.length){v.default.clearRequestStack(y);for(var u=r(s.indicesToRequest,i.currentImageIdIndex),c=void 0,d=void 0,f=p.default.getErrorLoadingHandler(),m=u.low,h=u.high;m>0||h<s.indicesToRequest.length;)m>=0&&(d=s.indicesToRequest[m--],c=i.imageIds[d],v.default.addRequest(e,c,y,!1,o,n)),h<s.indicesToRequest.length&&(d=s.indicesToRequest[h++],c=i.imageIds[d],v.default.addRequest(e,c,y,!1,o,n));v.default.startGrabbing()}}}}}function l(e,t){var o=e.data.element,n=void 0;try{n=(0,T.getToolState)(o,"stack")}catch(e){return}if(n&&n.data&&n.data.length){var a=n.data[0],r=a.imageIds.indexOf(t.imageId);if(!(r<0)){var i=(0,T.getToolState)(o,x);i&&i.data&&i.data.length&&i.data[0].indicesToRequest.push(r)}}}function s(e){clearTimeout(M),M=setTimeout(function(){var t=e.target;try{i(t)}catch(e){return}},P)}function u(e){var t=g.external.cornerstone;(0,T.getToolState)(e,x).data=[];var o=(0,T.getToolState)(e,"stack");if(o&&o.data&&o.data.length){var n=o.data[0];if(!0===n.preventCache)return void console.warn("A stack that should not be cached was given the stackPrefetch");var r={indicesToRequest:a(0,n.imageIds.length-1),enabled:!0,direction:1},u=r.indicesToRequest.indexOf(n.currentImageIdIndex);r.indicesToRequest.splice(u,1),(0,T.addToolState)(e,x,r),i(e),(0,g.$)(e).off("CornerstoneNewImage",s),(0,g.$)(e).on("CornerstoneNewImage",s),(0,g.$)(t.events).off("CornerstoneImageCachePromiseRemoved",l),(0,g.$)(t.events).on("CornerstoneImageCachePromiseRemoved",{element:e},l)}}function c(e){clearTimeout(M),(0,g.$)(e).off("CornerstoneNewImage",s),(0,g.$)(g.external.cornerstone.events).off("CornerstoneImageCachePromiseRemoved",l);var t=(0,T.getToolState)(e,x);t&&t.data.length&&(t.data[0].enabled=!1,v.default.clearRequestStack(y))}function d(){return b}function f(e){b=e,e.maxSimultaneousRequests&&(0,C.setMaxSimultaneousRequests)(e.maxSimultaneousRequests)}Object.defineProperty(t,"__esModule",{value:!0});var g=o(0),m=o(27),v=n(m),h=o(9),p=n(h),T=o(1),C=o(23),x="stackPrefetch",y="prefetch",b={},M=void 0,P=300,w=function(e){return Math.max.apply(null,e)},S=function(e){return Math.min.apply(null,e)},I={enable:u,disable:c,getConfiguration:d,setConfiguration:f};t.default=I},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(113),a=function(e){return e&&e.__esModule?e:{default:e}}(n),r={};r.FusionRenderer=a.default,t.default=r},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var o=t.keyCode;if(o===u.UP||o===u.DOWN){var n=1;o===u.DOWN&&(n=-1),(0,i.default)(t.element,n)}}Object.defineProperty(t,"__esModule",{value:!0});var r=o(36),i=n(r),l=o(38),s=n(l),u={UP:38,DOWN:40},c=(0,s.default)(a);t.default=c},function(e,t,o){"use strict";function n(e){var t={imageIdToolState:i.globalImageIdSpecificToolStateManager.saveToolState(),elementToolState:{},elementViewport:{}};return e.forEach(function(e){var o=(0,l.getElementToolStateManager)(e);o!==i.globalImageIdSpecificToolStateManager&&(t.elementToolState[e.id]=o.saveToolState(),t.elementViewport[e.id]=r.external.cornerstone.getViewport(e))}),t}function a(e){if(e.hasOwnProperty("imageIdToolState")&&e.hasOwnProperty("elementToolState")&&e.hasOwnProperty("elementViewport")){var t=r.external.cornerstone;return i.globalImageIdSpecificToolStateManager.restoreToolState(e.imageIdToolState),Object.keys(e.elementViewport).forEach(function(o){var n=document.getElementById(o);if(n&&e.elementToolState.hasOwnProperty(o)){var a=(0,l.getElementToolStateManager)(n);if(a!==i.globalImageIdSpecificToolStateManager){a.restoreToolState(e.elementToolState[o]);var r=e.elementViewport[o];t.setViewport(n,r),t.updateImage(n)}}}),e}}Object.defineProperty(t,"__esModule",{value:!0});var r=o(0),i=o(15),l=o(1),s={save:n,restore:a};t.default=s},function(e,t,o){"use strict";function n(){function e(e,t,o){!1===n.hasOwnProperty(e)&&(n[e]={});var a=n[e];!1===a.hasOwnProperty(t)&&(a[t]={data:[]}),a[t].data.push(o)}function t(e,t){if(!1!==n.hasOwnProperty(e)){var o=n[e];if(!1!==o.hasOwnProperty(t)){return o[t]}}}function o(e,t,o){if(!1!==n.hasOwnProperty(e)){var a=n[e];if(!1!==a.hasOwnProperty(t)){for(var r=a[t],i=-1,l=0;l<r.data.length;l++)r.data[l]===o&&(i=l);-1!==i&&r.data.splice(i,1)}}}var n={};return{get:t,add:e,remove:o}}Object.defineProperty(t,"__esModule",{value:!0});var a=n();t.newFrameOfReferenceSpecificToolStateManager=n,t.globalFrameOfReferenceSpecificToolStateManager=a},function(e,t,o){"use strict";function n(e,t){function o(){return i}function n(e){i=e}function a(o,n,a){if(!(e.indexOf(n)>=0))return t.add(o,n,a);!1===i.hasOwnProperty(n)&&(i[n]={data:[]}),i[n].data.push(a)}function r(o,n){return e.indexOf(n)>=0?(!1===i.hasOwnProperty(n)&&(i[n]={data:[]}),i[n]):t.get(o,n)}var i={};return{get:r,add:a,saveToolState:o,restoreToolState:n,toolState:i}}function a(e,t){var o=(0,i.getElementToolStateManager)(e);o||(o=r.globalImageIdSpecificToolStateManager);var a=["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs","stackRenderer"];t&&(a=a.concat(t));var s=n(a,o);l.push(s),(0,i.setElementToolStateManager)(e,s)}Object.defineProperty(t,"__esModule",{value:!0}),t.addStackStateManager=t.newStackSpecificToolStateManager=t.stackSpecificStateManager=void 0;var r=o(15),i=o(1),l=[],s={newStackSpecificToolStateManager:n,addStackStateManager:a};t.stackSpecificStateManager=s,t.newStackSpecificToolStateManager=n,t.addStackStateManager=a},function(e,t,o){"use strict";function n(e,t){function o(o,n,r){if(!(e.indexOf(n)>=0))return t.add(o,n,r);!1===a.hasOwnProperty(n)&&(a[n]={data:[]}),a[n].data.push(r)}function n(o,n){return e.indexOf(n)>=0?(!1===a.hasOwnProperty(n)&&(a[n]={data:[]}),a[n]):t.get(o,n)}var a={};return{get:n,add:o}}function a(e,t){t=t||["timeSeries"];var o=(0,i.getElementToolStateManager)(e);void 0===o&&(o=r.globalImageIdSpecificToolStateManager);var a=n(t,o);l.push(a),(0,i.setElementToolStateManager)(e,a)}Object.defineProperty(t,"__esModule",{value:!0}),t.newTimeSeriesSpecificToolStateManager=t.addTimeSeriesStateManager=void 0;var r=o(15),i=o(1),l=[];t.addTimeSeriesStateManager=a,t.newTimeSeriesSpecificToolStateManager=n},function(e,t,o){"use strict";function n(e,t){function o(e,t){s.length&&u.length&&(c=!0,u.forEach(function(o){var n=u.indexOf(o);if(-1!==n){var a=d.imageIds.targetElements[n],r=s.indexOf(e);if(-1!==r){var i=d.imageIds.sourceElements[r],c=void 0;i===a?c=0:void 0!==d.distances[i]&&(c=d.distances[i][a]),f(l,e,o,t,c)}}}),c=!1)}function n(e,t){!0!==c&&o(e.currentTarget,t)}function r(e,t){var o=t.element;l.remove(o)}var i=a.external.cornerstone,l=this,s=[],u=[],c=!1,d={},f=t;this.setHandler=function(e){f=e},this.getHandler=function(){return f},this.getDistances=function(){s.length&&u.length&&(d.distances={},d.imageIds={sourceElements:[],targetElements:[]},s.forEach(function(e){var t=i.getEnabledElement(e);if(t&&t.image){var o=t.image.imageId,n=i.metaData.get("imagePlane",o);if(n&&n.imagePositionPatient){var a=n.imagePositionPatient;d.hasOwnProperty(t)||(d.distances[o]={},d.imageIds.sourceElements.push(o),u.forEach(function(t){var n=i.getEnabledElement(t);if(n&&n.image){var r=n.image.imageId;if(d.imageIds.targetElements.push(r),e!==t&&o!==r&&!d.distances[o].hasOwnProperty(r)){var l=i.metaData.get("imagePlane",r);if(l&&l.imagePositionPatient){var s=l.imagePositionPatient;d.distances[o][r]=s.clone().sub(a)}}}}),Object.keys(d.distances[o]).length||delete d.distances[o])}}}))},this.addSource=function(t){-1===s.indexOf(t)&&(s.push(t),(0,a.$)(t).on(e,n),l.getDistances(),l.updateDisableHandlers())},this.addTarget=function(e){-1===u.indexOf(e)&&(u.push(e),l.getDistances(),f(l,e,e,0),l.updateDisableHandlers())},this.add=function(e){l.addSource(e),l.addTarget(e)},this.removeSource=function(t){var r=s.indexOf(t);-1!==r&&(s.splice(r,1),(0,a.$)(t).off(e,n),l.getDistances(),o(t),l.updateDisableHandlers())},this.removeTarget=function(e){var t=u.indexOf(e);-1!==t&&(u.splice(t,1),l.getDistances(),f(l,e,e,0),l.updateDisableHandlers())},this.remove=function(e){l.removeTarget(e),l.removeSource(e)},this.getSourceElements=function(){return s},this.getTargetElements=function(){return u},this.displayImage=function(e,t,o){c=!0,i.displayImage(e,t,o),c=!1},this.setViewport=function(e,t){c=!0,i.setViewport(e,t),c=!1},this.updateDisableHandlers=function(){a.$.unique(s.concat(u)).forEach(function(e){(0,a.$)(e).off("CornerstoneElementDisabled",r),(0,a.$)(e).on("CornerstoneElementDisabled",r)})},this.destroy=function(){a.$.unique(s.concat(u)).forEach(function(e){l.remove(e)})}}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0);t.default=n},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){if(o!==t){var a=n.external.cornerstone,r=a.getViewport(t),i=a.getViewport(o);i.scale===r.scale&&i.translation.x===r.translation.x&&i.translation.y===r.translation.y||(i.scale=r.scale,i.translation.x=r.translation.x,i.translation.y=r.translation.y,e.setViewport(o,i))}};var n=o(0)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){if(o!==t){var r=n.external.cornerstone,l=(0,a.getToolState)(t,"stack"),s=l.data[0],u=(0,a.getToolState)(o,"stack"),c=u.data[0],d=s.currentImageIdIndex;if((d=Math.min(Math.max(d,0),c.imageIds.length-1))!==c.currentImageIdIndex){var f=i.default.getStartLoadHandler(),g=i.default.getEndLoadHandler(),m=i.default.getErrorLoadingHandler();f&&f(o);var v=void 0;v=!0===c.preventCache?r.loadImage(c.imageIds[d]):r.loadAndCacheImage(c.imageIds[d]),v.then(function(t){var n=r.getViewport(o);c.currentImageIdIndex=d,e.displayImage(o,t,n),g&&g(o,t)},function(e){var t=c.imageIds[d];m&&m(o,t,e)})}}};var n=o(0),a=o(1),r=o(9),i=function(e){return e&&e.__esModule?e:{default:e}}(r)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,r,l){if(o!==t){var s=n.external.cornerstone,u=s.getEnabledElement(t),c=s.metaData.get("imagePlane",u.image.imageId),d=c.imagePositionPatient,f=(0,a.getToolState)(o,"stack"),g=f.data[0],m=Number.MAX_VALUE,v=-1;if(l){var h=d.clone().add(l);if(g.imageIds.forEach(function(e,t){var o=s.metaData.get("imagePlane",e),n=o.imagePositionPatient,a=h.distanceToSquared(n);a<m&&(m=a,v=t)}),v!==g.currentImageIdIndex&&-1!==v){var p=i.default.getStartLoadHandler(),T=i.default.getEndLoadHandler(),C=i.default.getErrorLoadingHandler();p&&p(o);var x=void 0;x=!0===g.preventCache?s.loadImage(g.imageIds[v]):s.loadAndCacheImage(g.imageIds[v]),x.then(function(t){var n=s.getViewport(o);g.currentImageIdIndex=v,e.displayImage(o,t,n),T&&T(o,t)},function(e){var t=g.imageIds[v];C&&C(o,t,e)})}}}};var n=o(0),a=o(1),r=o(9),i=function(e){return e&&e.__esModule?e:{default:e}}(r)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){if(o!==t){var r=n.external.cornerstone,l=r.getEnabledElement(t).image,s=r.metaData.get("imagePlane",l.imageId),u=s.imagePositionPatient,c=(0,a.getToolState)(o,"stack"),d=c.data[0],f=Number.MAX_VALUE,g=-1;if(n.$.each(d.imageIds,function(e,t){var o=r.metaData.get("imagePlane",t),n=o.imagePositionPatient,a=n.distanceToSquared(u);a<f&&(f=a,g=e)}),g!==d.currentImageIdIndex){var m=i.default.getStartLoadHandler(),v=i.default.getEndLoadHandler(),h=i.default.getErrorLoadingHandler();if(m&&m(o),-1!==g){var p=void 0;p=!0===d.preventCache?r.loadImage(d.imageIds[g]):r.loadAndCacheImage(d.imageIds[g]),p.then(function(t){var n=r.getViewport(o);d.currentImageIdIndex=g,e.displayImage(o,t,n),v&&v(o,t)},function(e){var t=d.imageIds[g];h&&h(o,t,e)})}}}};var n=o(0),a=o(1),r=o(9),i=function(e){return e&&e.__esModule?e:{default:e}}(r)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o,r){if(t!==o&&r&&r.direction){var l=n.external.cornerstone,s=(0,a.getToolState)(o,"stack"),u=s.data[0],c=u.currentImageIdIndex+r.direction;if(c=Math.min(Math.max(c,0),u.imageIds.length-1),u.currentImageIdIndex!==c){var d=i.default.getStartLoadHandler(),f=i.default.getEndLoadHandler(),g=i.default.getErrorLoadingHandler();d&&d(o);var m=void 0;m=!0===u.preventCache?l.loadImage(u.imageIds[c]):l.loadAndCacheImage(u.imageIds[c]),m.then(function(t){var n=l.getViewport(o);u.currentImageIdIndex=c,e.displayImage(o,t,n),f&&f(o,t)},function(e){var t=u.imageIds[c];g&&g(o,t,e)})}}};var n=o(0),a=o(1),r=o(9),i=function(e){return e&&e.__esModule?e:{default:e}}(r)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){o!==t&&n.external.cornerstone.updateImage(o)};var n=o(0)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,o){if(o!==t){var a=n.external.cornerstone,r=a.getViewport(t),i=a.getViewport(o);i.voi.windowWidth===r.voi.windowWidth&&i.voi.windowCenter===r.voi.windowCenter&&i.invert===r.invert||(i.voi.windowWidth=r.voi.windowWidth,i.voi.windowCenter=r.voi.windowCenter,i.invert=r.invert,e.setViewport(o,i))}};var n=o(0)},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=l.external.cornerstone,o=[];e.timeSeries.stacks.forEach(function(n){var a=void 0;a=!0===n.preventCache?t.loadImage(n.imageIds[e.imageIdIndex]):t.loadAndCacheImage(n.imageIds[e.imageIdIndex]),a.then(function(t){var n=Math.round(e.handles.end.x)+Math.round(e.handles.end.y)*t.width,a=t.getPixelData()[n];o.push(a)})}),e.lineSample.set(o)}function r(e){var t=(0,m.getToolState)(e.element,"timeSeries");if(void 0!==t&&void 0!==t.data&&0!==t.data.length){var o=t.data[0],n={timeSeries:o,lineSample:new T.default,imageIdIndex:o.stacks[o.currentStackIndex].currentImageIdIndex,visible:!0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}};return a(n),h.default.add(n),n}}function i(e,t){var o=(0,m.getToolState)(e.currentTarget,C);if(o){var n=t.canvasContext.canvas.getContext("2d");l.external.cornerstone.setToPixelCoordinateSystem(t.enabledElement,n);for(var a=0;a<o.data.length;a++){n.save();var r=o.data[a];n.beginPath(),(0,d.default)(n,t,r.handles,"white"),n.stroke();var i=(0,g.default)(t.enabledElement,t.canvasContext,15);n.font=i.fontSize+"px Arial";var s=Math.round(r.handles.end.x),u=Math.round(r.handles.end.y),c=r.handles.end.x+3,f=r.handles.end.y-3;n.fillStyle="white",n.fillText(s+","+u,c,f),n.restore()}}}Object.defineProperty(t,"__esModule",{value:!0});var l=o(0),s=o(6),u=n(s),c=o(7),d=n(c),f=o(52),g=n(f),m=o(1),v=o(109),h=n(v),p=o(108),T=n(p),C="probe4D",x=(0,u.default)({createNewMeasurement:r,onImageRendered:i,toolType:C});t.default=x},function(e,t,o){"use strict";function n(e,t){if(void 0===e)throw new Error("playClip: element must not be undefined");void 0===t&&(t=30);var o=(0,r.getToolState)(e,"timeSeries");if(void 0!==o&&void 0!==o.data&&0!==o.data.length){var n=(0,r.getToolState)(e,s),a=void 0;void 0===n||0===n.data.length?(a={intervalId:void 0,framesPerSecond:t,lastFrameTimeStamp:void 0,frameRate:0},(0,r.addToolState)(e,s,a)):(a=n.data[0],a.framesPerSecond=t),void 0===a.intervalId&&(a.intervalId=setInterval(function(){a.framesPerSecond>0?(0,l.default)(e,1,!0):(0,l.default)(e,-1,!0)},1e3/Math.abs(a.framesPerSecond)))}}function a(e){var t=(0,r.getToolState)(e,s);if(t&&t.data&&t.data.length){var o=t.data[0];clearInterval(o.intervalId),o.intervalId=void 0}}Object.defineProperty(t,"__esModule",{value:!0});var r=o(1),i=o(29),l=function(e){return e&&e.__esModule?e:{default:e}}(i),s="timeSeriesPlayer",u={start:n,stop:a};t.default=u},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){(0,u.$)(t.element).off("CornerstoneToolsMouseDrag",i),(0,u.$)(t.element).off("CornerstoneToolsMouseUp",a),(0,u.$)(t.element).off("CornerstoneToolsMouseClick",a)}function r(e,t){if((0,C.default)(t.which,e.data.mouseButtonMask)){var o={deltaY:0,options:e.data.options};return(0,u.$)(t.element).on("CornerstoneToolsMouseDrag",o,i),(0,u.$)(t.element).on("CornerstoneToolsMouseUp",a),(0,u.$)(t.element).on("CornerstoneToolsMouseClick",a),e.stopImmediatePropagation(),!1}}function i(e,t){e.data.deltaY+=t.deltaPoints.page.y;var o=(0,x.getToolState)(t.element,"timeSeries");if(void 0!==o&&void 0!==o.data&&0!==o.data.length){var n=o.data[0],a=(0,u.$)(t.element).height()/n.stacks.length;if(void 0!==e.data.options&&void 0!==e.data.options.timeSeriesScrollSpeed&&(a=e.data.options.timeSeriesScrollSpeed),e.data.deltaY>=a||e.data.deltaY<=-a){var r=Math.round(e.data.deltaY/a),i=e.data.deltaY%a;(0,p.default)(t.element,r),e.data.deltaY=i}return!1}}function l(e,t){var o=-t.direction;(0,p.default)(t.element,o)}function s(e){var t=e.originalEvent.detail,o={deltaY:0};o.deltaY+=t.deltaPoints.page.y;var n=(0,x.getToolState)(t.element,"stack");if(void 0!==n&&void 0!==n.data&&0!==n.data.length){if(o.deltaY>=3||o.deltaY<=-3){var a=o.deltaY/3,r=o.deltaY%3;(0,p.default)(o.element,a),o.deltaY=r}return!1}}Object.defineProperty(t,"__esModule",{value:!0}),t.timeSeriesScrollTouchDrag=t.timeSeriesScrollWheel=t.timeSeriesScroll=void 0;var u=o(0),c=o(12),d=n(c),f=o(10),g=n(f),m=o(19),v=n(m),h=o(29),p=n(h),T=o(2),C=n(T),x=o(1),y=(0,d.default)(r),b=(0,v.default)(l),M=(0,g.default)(s);t.timeSeriesScroll=y,t.timeSeriesScrollWheel=b,t.timeSeriesScrollTouchDrag=M},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="0.9.1"},function(e,t,o){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0);Object.defineProperty(t,"external",{enumerable:!0,get:function(){return a.external}});var r=o(85);Object.defineProperty(t,"referenceLines",{enumerable:!0,get:function(){return n(r).default}});var i=o(44);Object.defineProperty(t,"orientation",{enumerable:!0,get:function(){return n(i).default}});var l=o(27);Object.defineProperty(t,"requestPoolManager",{enumerable:!0,get:function(){return n(l).default}});var s=o(52);Object.defineProperty(t,"setContextToDisplayFontSize",{enumerable:!0,get:function(){return n(s).default}});var u=o(51);Object.defineProperty(t,"scrollToIndex",{enumerable:!0,get:function(){return n(u).default}});var c=o(36);Object.defineProperty(t,"scroll",{enumerable:!0,get:function(){return n(c).default}});var d=o(35);Object.defineProperty(t,"roundToDecimal",{enumerable:!0,get:function(){return n(d).default}});var f=o(34);Object.defineProperty(t,"projectPatientPointToImagePlane",{enumerable:!0,get:function(){return f.projectPatientPointToImagePlane}}),Object.defineProperty(t,"imagePointToPatientPoint",{enumerable:!0,get:function(){return f.imagePointToPatientPoint}}),Object.defineProperty(t,"planePlaneIntersection",{enumerable:!0,get:function(){return f.planePlaneIntersection}});var g=o(17);Object.defineProperty(t,"pointInsideBoundingBox",{enumerable:!0,get:function(){return n(g).default}});var m=o(33);Object.defineProperty(t,"pointInEllipse",{enumerable:!0,get:function(){return n(m).default}});var v=o(32);Object.defineProperty(t,"pauseEvent",{enumerable:!0,get:function(){return n(v).default}});var h=o(2);Object.defineProperty(t,"isMouseButtonEnabled",{enumerable:!0,get:function(){return n(h).default}});var p=o(31);Object.defineProperty(t,"getRGBPixels",{enumerable:!0,get:function(){return n(p).default}});var T=o(23);Object.defineProperty(t,"getDefaultSimultaneousRequests",{enumerable:!0,get:function(){return T.getDefaultSimultaneousRequests}}),Object.defineProperty(t,"getMaxSimultaneousRequests",{enumerable:!0,get:function(){return T.getMaxSimultaneousRequests}}),Object.defineProperty(t,"getBrowserInfo",{enumerable:!0,get:function(){return T.getBrowserInfo}}),Object.defineProperty(t,"isMobileDevice",{enumerable:!0,get:function(){return T.isMobileDevice}});var C=o(50);Object.defineProperty(t,"getLuminance",{enumerable:!0,get:function(){return n(C).default}});var x=o(5);Object.defineProperty(t,"drawTextBox",{enumerable:!0,get:function(){return n(x).default}});var y=o(49);Object.defineProperty(t,"drawEllipse",{enumerable:!0,get:function(){return n(y).default}});var b=o(48);Object.defineProperty(t,"drawCircle",{enumerable:!0,get:function(){return n(b).default}});var M=o(47);Object.defineProperty(t,"drawArrow",{enumerable:!0,get:function(){return n(M).default}});var P=o(30);Object.defineProperty(t,"copyPoints",{enumerable:!0,get:function(){return n(P).default}});var w=o(16);Object.defineProperty(t,"calculateSUV",{enumerable:!0,get:function(){return n(w).default}});var S=o(46);Object.defineProperty(t,"calculateEllipseStatistics",{enumerable:!0,get:function(){return n(S).default}});var I=o(103);Object.defineProperty(t,"probeTool4D",{enumerable:!0,get:function(){return n(I).default}});var $=o(29);Object.defineProperty(t,"incrementTimePoint",{enumerable:!0,get:function(){return n($).default}});var k=o(104);Object.defineProperty(t,"timeSeriesPlayer",{enumerable:!0,get:function(){return n(k).default}});var O=o(105);Object.defineProperty(t,"timeSeriesScroll",{enumerable:!0,get:function(){return O.timeSeriesScroll}}),Object.defineProperty(t,"timeSeriesScrollWheel",{enumerable:!0,get:function(){return O.timeSeriesScrollWheel}}),Object.defineProperty(t,"timeSeriesScrollTouchDrag",{enumerable:!0,get:function(){return O.timeSeriesScrollTouchDrag}});var D=o(102);Object.defineProperty(t,"wwwcSynchronizer",{enumerable:!0,get:function(){return n(D).default}});var _=o(101);Object.defineProperty(t,"updateImageSynchronizer",{enumerable:!0,get:function(){return n(_).default}});var j=o(95);Object.defineProperty(t,"Synchronizer",{enumerable:!0,get:function(){return n(j).default}});var E=o(100);Object.defineProperty(t,"stackScrollSynchronizer",{enumerable:!0,get:function(){return n(E).default}});var R=o(99);Object.defineProperty(t,"stackImagePositionSynchronizer",{enumerable:!0,get:function(){return n(R).default}});var A=o(98);Object.defineProperty(t,"stackImagePositionOffsetSynchronizer",{enumerable:!0,get:function(){return n(A).default}});var B=o(97);Object.defineProperty(t,"stackImageIndexSynchronizer",{enumerable:!0,get:function(){return n(B).default}});var N=o(96);Object.defineProperty(t,"panZoomSynchronizer",{enumerable:!0,get:function(){return n(N).default}});var H=o(4);Object.defineProperty(t,"toolStyle",{enumerable:!0,get:function(){return n(H).default}});var V=o(1);Object.defineProperty(t,"addToolState",{enumerable:!0,get:function(){return V.addToolState}}),Object.defineProperty(t,"getToolState",{enumerable:!0,get:function(){return V.getToolState}}),Object.defineProperty(t,"removeToolState",{enumerable:!0,get:function(){return V.removeToolState}}),Object.defineProperty(t,"clearToolState",{enumerable:!0,get:function(){return V.clearToolState}}),Object.defineProperty(t,"setElementToolStateManager",{enumerable:!0,get:function(){return V.setElementToolStateManager}}),Object.defineProperty(t,"getElementToolStateManager",{enumerable:!0,get:function(){return V.getElementToolStateManager}});var W=o(28);Object.defineProperty(t,"toolCoordinates",{enumerable:!0,get:function(){return n(W).default}});var L=o(3);Object.defineProperty(t,"toolColors",{enumerable:!0,get:function(){return n(L).default}});var Y=o(94);Object.defineProperty(t,"addTimeSeriesStateManager",{enumerable:!0,get:function(){return Y.addTimeSeriesStateManager}}),Object.defineProperty(t,"newTimeSeriesSpecificToolStateManager",{enumerable:!0,get:function(){return Y.newTimeSeriesSpecificToolStateManager}});var F=o(13);Object.defineProperty(t,"textStyle",{enumerable:!0,get:function(){return n(F).default}});var z=o(93);Object.defineProperty(t,"stackSpecificStateManager",{enumerable:!0,get:function(){return z.stackSpecificStateManager}}),Object.defineProperty(t,"newStackSpecificToolStateManager",{enumerable:!0,get:function(){return z.newStackSpecificToolStateManager}}),Object.defineProperty(t,"addStackStateManager",{enumerable:!0,get:function(){return z.addStackStateManager}});var U=o(9);Object.defineProperty(t,"loadHandlerManager",{enumerable:!0,get:function(){return n(U).default}});var X=o(15);Object.defineProperty(t,"newImageIdSpecificToolStateManager",{enumerable:!0,get:function(){return X.newImageIdSpecificToolStateManager}}),Object.defineProperty(t,"globalImageIdSpecificToolStateManager",{enumerable:!0,get:function(){return X.globalImageIdSpecificToolStateManager}});var q=o(92);Object.defineProperty(t,"newFrameOfReferenceSpecificToolStateManager",{enumerable:!0,get:function(){return q.newFrameOfReferenceSpecificToolStateManager}}),Object.defineProperty(t,"globalFrameOfReferenceSpecificToolStateManager",{enumerable:!0,get:function(){return q.globalFrameOfReferenceSpecificToolStateManager}});var K=o(91);Object.defineProperty(t,"appState",{enumerable:!0,get:function(){return n(K).default}});var G=o(90);Object.defineProperty(t,"stackScrollKeyboard",{enumerable:!0,get:function(){return n(G).default}});var Z=o(45);Object.defineProperty(t,"stackScroll",{enumerable:!0,get:function(){return Z.stackScroll}}),Object.defineProperty(t,"stackScrollWheel",{enumerable:!0,get:function(){return Z.stackScrollWheel}}),Object.defineProperty(t,"stackScrollTouchDrag",{enumerable:!0,get:function(){return Z.stackScrollTouchDrag}}),Object.defineProperty(t,"stackScrollMultiTouch",{enumerable:!0,get:function(){return Z.stackScrollMultiTouch}});var J=o(88);Object.defineProperty(t,"stackPrefetch",{enumerable:!0,get:function(){return n(J).default}});var Q=o(87);Object.defineProperty(t,"scrollIndicator",{enumerable:!0,get:function(){return n(Q).default}});var ee=o(89);Object.defineProperty(t,"stackRenderers",{enumerable:!0,get:function(){return n(ee).default}});var te=o(86);Object.defineProperty(t,"playClip",{enumerable:!0,get:function(){return te.playClip}}),Object.defineProperty(t,"stopClip",{enumerable:!0,get:function(){return te.stopClip}});var oe=o(11);Object.defineProperty(t,"anyHandlesOutsideImage",{enumerable:!0,get:function(){return n(oe).default}});var ne=o(7);Object.defineProperty(t,"drawHandles",{enumerable:!0,get:function(){return n(ne).default}});var ae=o(14);Object.defineProperty(t,"getHandleNearImagePoint",{enumerable:!0,get:function(){return n(ae).default}});var re=o(25);Object.defineProperty(t,"handleActivator",{enumerable:!0,get:function(){return n(re).default}});var ie=o(26);Object.defineProperty(t,"moveAllHandles",{enumerable:!0,get:function(){return n(ie).default}});var le=o(20);Object.defineProperty(t,"moveHandle",{enumerable:!0,get:function(){return n(le).default}});var se=o(21);Object.defineProperty(t,"moveNewHandle",{enumerable:!0,get:function(){return n(se).default}});var ue=o(22);Object.defineProperty(t,"moveNewHandleTouch",{enumerable:!0,get:function(){return n(ue).default}});var ce=o(42);Object.defineProperty(t,"touchMoveAllHandles",{enumerable:!0,get:function(){return n(ce).default}});var de=o(43);Object.defineProperty(t,"touchMoveHandle",{enumerable:!0,get:function(){return n(de).default}});var fe=o(80);Object.defineProperty(t,"keyboardInput",{enumerable:!0,get:function(){return n(fe).default}});var ge=o(81);Object.defineProperty(t,"mouseInput",{enumerable:!0,get:function(){return n(ge).default}});var me=o(82);Object.defineProperty(t,"mouseWheelInput",{enumerable:!0,get:function(){return n(me).default}});var ve=o(41);Object.defineProperty(t,"preventGhostClick",{enumerable:!0,get:function(){return n(ve).default}});var he=o(83);Object.defineProperty(t,"touchInput",{enumerable:!0,get:function(){return n(he).default}});var pe=o(55);Object.defineProperty(t,"angle",{enumerable:!0,get:function(){return pe.angle}}),Object.defineProperty(t,"angleTouch",{enumerable:!0,get:function(){return pe.angleTouch}});var Te=o(56);Object.defineProperty(t,"arrowAnnotate",{enumerable:!0,get:function(){return Te.arrowAnnotate}}),Object.defineProperty(t,"arrowAnnotateTouch",{enumerable:!0,get:function(){return Te.arrowAnnotateTouch}});var Ce=o(57);Object.defineProperty(t,"crosshairs",{enumerable:!0,get:function(){return Ce.crosshairs}}),Object.defineProperty(t,"crosshairsTouch",{enumerable:!0,get:function(){return Ce.crosshairsTouch}});var xe=o(18);Object.defineProperty(t,"displayTool",{enumerable:!0,get:function(){return n(xe).default}});var ye=o(37);Object.defineProperty(t,"doubleTapTool",{enumerable:!0,get:function(){return n(ye).default}});var be=o(58);Object.defineProperty(t,"doubleTapZoom",{enumerable:!0,get:function(){return n(be).default}});var Me=o(59);Object.defineProperty(t,"dragProbe",{enumerable:!0,get:function(){return Me.dragProbe}}),Object.defineProperty(t,"dragProbeTouch",{enumerable:!0,get:function(){return Me.dragProbeTouch}});var Pe=o(60);Object.defineProperty(t,"ellipticalRoi",{enumerable:!0,get:function(){return Pe.ellipticalRoi}}),Object.defineProperty(t,"ellipticalRoiTouch",{enumerable:!0,get:function(){return Pe.ellipticalRoiTouch}});var we=o(61);Object.defineProperty(t,"freehand",{enumerable:!0,get:function(){return we.freehand}});var Se=o(62);Object.defineProperty(t,"highlight",{enumerable:!0,get:function(){return Se.highlight}}),Object.defineProperty(t,"highlightTouch",{enumerable:!0,get:function(){return Se.highlightTouch}});var Ie=o(63);Object.defineProperty(t,"imageStats",{enumerable:!0,get:function(){return n(Ie).default}});var $e=o(38);Object.defineProperty(t,"keyboardTool",{enumerable:!0,get:function(){return n($e).default}});var ke=o(64);Object.defineProperty(t,"length",{enumerable:!0,get:function(){return ke.length}}),Object.defineProperty(t,"lengthTouch",{enumerable:!0,get:function(){return ke.lengthTouch}});var Oe=o(65);Object.defineProperty(t,"magnify",{enumerable:!0,get:function(){return Oe.magnify}}),Object.defineProperty(t,"magnifyTouchDrag",{enumerable:!0,get:function(){return Oe.magnifyTouchDrag}});var De=o(39);Object.defineProperty(t,"mouseButtonRectangleTool",{enumerable:!0,get:function(){return n(De).default}});var _e=o(6);Object.defineProperty(t,"mouseButtonTool",{enumerable:!0,get:function(){return n(_e).default}});var je=o(19);Object.defineProperty(t,"mouseWheelTool",{enumerable:!0,get:function(){return n(je).default}});var Ee=o(24);Object.defineProperty(t,"multiTouchDragTool",{enumerable:!0,get:function(){return n(Ee).default}});var Re=o(66);Object.defineProperty(t,"orientationMarkers",{enumerable:!0,get:function(){return n(Re).default}});var Ae=o(67);Object.defineProperty(t,"pan",{enumerable:!0,get:function(){return Ae.pan}}),Object.defineProperty(t,"panTouchDrag",{enumerable:!0,get:function(){return Ae.panTouchDrag}});var Be=o(68);Object.defineProperty(t,"panMultiTouch",{enumerable:!0,get:function(){return n(Be).default}});var Ne=o(69);Object.defineProperty(t,"probe",{enumerable:!0,get:function(){return Ne.probe}}),Object.defineProperty(t,"probeTouch",{enumerable:!0,get:function(){return Ne.probeTouch}});var He=o(70);Object.defineProperty(t,"rectangleRoi",{enumerable:!0,get:function(){return He.rectangleRoi}}),Object.defineProperty(t,"rectangleRoiTouch",{enumerable:!0,get:function(){return He.rectangleRoiTouch}});var Ve=o(71);Object.defineProperty(t,"rotate",{enumerable:!0,get:function(){return Ve.rotate}}),Object.defineProperty(t,"rotateTouchDrag",{enumerable:!0,get:function(){return Ve.rotateTouchDrag}});var We=o(72);Object.defineProperty(t,"rotateTouch",{enumerable:!0,get:function(){return n(We).default}});var Le=o(73);Object.defineProperty(t,"saveAs",{enumerable:!0,get:function(){return n(Le).default}});var Ye=o(74);Object.defineProperty(t,"seedAnnotate",{enumerable:!0,get:function(){return Ye.seedAnnotate}}),Object.defineProperty(t,"seedAnnotateTouch",{enumerable:!0,get:function(){return Ye.seedAnnotateTouch}});var Fe=o(75);Object.defineProperty(t,"simpleAngle",{enumerable:!0,get:function(){return Fe.simpleAngle}}),Object.defineProperty(t,"simpleAngleTouch",{enumerable:!0,get:function(){return Fe.simpleAngleTouch}});var ze=o(12);Object.defineProperty(t,"simpleMouseButtonTool",{enumerable:!0,get:function(){return n(ze).default}});var Ue=o(76);Object.defineProperty(t,"textMarker",{enumerable:!0,get:function(){return Ue.textMarker}}),Object.defineProperty(t,"textMarkerTouch",{enumerable:!0,get:function(){return Ue.textMarkerTouch}});var Xe=o(10);Object.defineProperty(t,"touchDragTool",{enumerable:!0,get:function(){return n(Xe).default}});var qe=o(40);Object.defineProperty(t,"touchPinchTool",{enumerable:!0,get:function(){return n(qe).default}});var Ke=o(8);Object.defineProperty(t,"touchTool",{enumerable:!0,get:function(){return n(Ke).default}});var Ge=o(77);Object.defineProperty(t,"wwwc",{enumerable:!0,get:function(){return Ge.wwwc}}),Object.defineProperty(t,"wwwcTouchDrag",{enumerable:!0,get:function(){return Ge.wwwcTouchDrag}});var Ze=o(78);Object.defineProperty(t,"wwwcRegion",{enumerable:!0,get:function(){return Ze.wwwcRegion}}),Object.defineProperty(t,"wwwcRegionTouch",{enumerable:!0,get:function(){return Ze.wwwcRegionTouch}});var Je=o(79);Object.defineProperty(t,"zoom",{enumerable:!0,get:function(){return Je.zoom}}),Object.defineProperty(t,"zoomWheel",{enumerable:!0,get:function(){return Je.zoomWheel}}),Object.defineProperty(t,"zoomTouchPinch",{enumerable:!0,get:function(){return Je.zoomTouchPinch}}),Object.defineProperty(t,"zoomTouchDrag",{enumerable:!0,get:function(){return Je.zoomTouchDrag}});var Qe=o(84);Object.defineProperty(t,"brush",{enumerable:!0,get:function(){return Qe.brush}});var et=o(106);Object.defineProperty(t,"version",{enumerable:!0,get:function(){return n(et).default}})},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=this;e.samples=[],this.set=function(t){e.samples=t,(0,n.$)(e).trigger("CornerstoneLineSampleUpdated")}};var n=o(0)},function(e,t,o){"use strict";function n(){var e=this;e.measurements=[],this.add=function(t){var o=e.measurements.push(t),n={index:o,measurement:t};(0,a.$)(e).trigger("CornerstoneMeasurementAdded",n)},this.remove=function(t){var o=e.measurements[t];e.measurements.splice(t,1);var n={index:t,measurement:o};(0,a.$)(e).trigger("CornerstoneMeasurementRemoved",n)}}Object.defineProperty(t,"__esModule",{value:!0});var a=o(0),r=new n;t.default=r},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t="",o=e.x<0?"R":"L",a=e.y<0?"A":"P",r=e.z<0?"F":"H",i=new n.cornerstoneMath.Vector3(Math.abs(e.x),Math.abs(e.y),Math.abs(e.z)),l=0;l<3;l++)if(i.x>1e-4&&i.x>i.y&&i.x>i.z)t+=o,i.x=0;else if(i.y>1e-4&&i.y>i.x&&i.y>i.z)t+=a,i.y=0;else{if(!(i.z>1e-4&&i.z>i.x&&i.z>i.y))break;t+=r,i.z=0}return t};var n=o(0)},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.replace("H","f");return t=t.replace("F","h"),t=t.replace("R","l"),t=t.replace("L","r"),t=t.replace("A","p"),t=t.replace("P","a"),t=t.toUpperCase()}},function(e,t,o){"use strict";function n(e,t){var o=(0,l.getToolState)(e.currentTarget,c);if(void 0!==o){var n=o.data[0].synchronizationContext,a=n.getSourceElements(),r=o.data[0].renderer,s=t.canvasContext.canvas.getContext("2d");i.external.cornerstone.setToPixelCoordinateSystem(t.enabledElement,s),i.$.each(a,function(o,n){n!==e.currentTarget&&r(s,t,e.currentTarget,n)})}}function a(e,t,o){o=o||u.default,(0,l.addToolState)(e,c,{synchronizationContext:t,renderer:o}),(0,i.$)(e).on("CornerstoneImageRendered",n),i.external.cornerstone.updateImage(e)}function r(e){(0,i.$)(e).off("CornerstoneImageRendered",n),i.external.cornerstone.updateImage(e)}Object.defineProperty(t,"__esModule",{value:!0});var i=o(0),l=o(1),s=o(54),u=function(e){return e&&e.__esModule?e:{default:e}}(s),c="referenceLines",d={enable:a,disable:r};t.default=d},function(e,t,o){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),r=o(0),i=function(){function e(){n(this,e),this.currentImageIdIndex=0,this.layerIds=[],this.findImageFn=void 0}return a(e,[{key:"render",value:function(e,t){var o=this;if(!Number.isInteger(this.currentImageIdIndex))throw new Error("FusionRenderer: render - Image ID Index is not an integer");if(!this.findImageFn)throw new Error("No findImage function has been defined");var n=r.external.cornerstone,a=t[0],i=a.imageIds[this.currentImageIdIndex];n.loadAndCacheImage(i).then(function(r){if(o.layerIds&&o.layerIds[0]){var l=o.layerIds[0],s=n.getLayer(e,l);if(void 0===s)return;s.image=Object.assign({},r)}else{var u=n.addLayer(e,Object.assign({},r),a.options);o.layerIds.push(u)}n.displayImage(e,r),t.slice(1,t.length).forEach(function(t,a){var r=o.findImageFn(t.imageIds,i,1);r&&n.loadAndCacheImage(r).then(function(r){var i=a+1;if(o.layerIds&&o.layerIds[i]){var l=o.layerIds[i],s=n.getLayer(e,l);if(void 0===s)return;s.image=Object.assign({},r)}else{var u=n.addLayer(e,Object.assign({},r),t.options);o.layerIds.push(u)}n.updateImage(e,!0)})})})}}]),e}();t.default=i},function(t,o){t.exports=e},function(e,o){e.exports=t},function(e,t){e.exports=o}])});
//# sourceMappingURL=cornerstoneTools.min.js.map