/*! cornerstoneTools - v0.6.2 - 2015-08-05 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstoneTools */
"undefined"==typeof cornerstone&&(cornerstone={}),"undefined"==typeof cornerstoneTools&&(cornerstoneTools={referenceLines:{},orientation:{}}),function(a,b,c){"use strict";function d(c){if(!("mousewheel"===c.originalEvent.type&&0===c.originalEvent.wheelDeltaY||"DOMMouseScroll"===c.originalEvent.type&&1===c.originalEvent.axis)){var d=c.currentTarget,e=b.pageToPixel(d,c.pageX||c.originalEvent.pageX,c.pageY||c.originalEvent.pageY);c=window.event||c;var f=c.wheelDelta||-c.detail||-c.originalEvent.detail,g=Math.max(-1,Math.min(1,f)),h={element:d,viewport:b.getViewport(d),image:b.getEnabledElement(d).image,direction:g,pageX:c.pageX||c.originalEvent.pageX,pageY:c.pageY||c.originalEvent.pageY,imageX:e.x,imageY:e.y};a(d).trigger("CornerstoneToolsMouseWheel",h)}}function e(b){a(b).on(g,d)}function f(b){a(b).unbind(g,d)}var g="mousewheel DOMMouseScroll";c.mouseWheelInput={enable:e,disable:f}}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(){l=!1}function f(b){a(b.element).trigger("CornerstoneToolsMouseDownActivate",b)}function g(e){var f=e.currentTarget,g={page:c.point.pageToPoint(e),image:b.pageToPixel(f,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};g.canvas=b.pixelToCanvas(f,g.image);var h=d.copyPoints(g),i={event:e,which:e.which,viewport:b.getViewport(f),image:b.getEnabledElement(f).image,element:f,startPoints:g,lastPoints:h,currentPoints:g,deltaPoints:{x:0,y:0}},j=a.Event("CornerstoneToolsMouseDoubleClick",i);a(i.element).trigger(j,i)}function h(g){function h(e){var f={page:c.point.pageToPoint(e),image:b.pageToPixel(k,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};f.canvas=b.pixelToCanvas(k,f.image);var g={page:c.point.subtract(f.page,p.page),image:c.point.subtract(f.image,p.image),client:c.point.subtract(f.client,p.client),canvas:c.point.subtract(f.canvas,p.canvas)},h={which:s,viewport:b.getViewport(k),image:b.getEnabledElement(k).image,element:k,startPoints:o,lastPoints:p,currentPoints:f,deltaPoints:g};return a(q.element).trigger("CornerstoneToolsMouseDrag",h),p=d.copyPoints(f),d.pauseEvent(e)}function j(d){clearTimeout(m);var e="CornerstoneToolsMouseUp";l&&(e="CornerstoneToolsMouseClick");var f={page:c.point.pageToPoint(d),image:b.pageToPixel(k,d.pageX,d.pageY),client:{x:d.clientX,y:d.clientY}};f.canvas=b.pixelToCanvas(k,f.image);var g={page:c.point.subtract(f.page,p.page),image:c.point.subtract(f.image,p.image),client:c.point.subtract(f.client,p.client),canvas:c.point.subtract(f.canvas,p.canvas)},n={event:d,which:s,viewport:b.getViewport(k),image:b.getEnabledElement(k).image,element:k,startPoints:o,lastPoints:p,currentPoints:f,deltaPoints:g},r=a.Event(e,n);a(q.element).trigger(r,n),a(document).off("mousemove",h),a(document).off("mouseup",j),a(q.element).on("mousemove",i),l=!0}m=setTimeout(e,n);var k=g.currentTarget;a(k).off("mousemove",i);var o={page:c.point.pageToPoint(g),image:b.pageToPixel(k,g.pageX,g.pageY),client:{x:g.clientX,y:g.clientY}};o.canvas=b.pixelToCanvas(k,o.image);var p=d.copyPoints(o),q={event:g,which:g.which,viewport:b.getViewport(k),image:b.getEnabledElement(k).image,element:k,startPoints:o,lastPoints:p,currentPoints:o,deltaPoints:{x:0,y:0}},r=a.Event("CornerstoneToolsMouseDown",q);if(a(q.element).trigger(r,q),r.isImmediatePropagationStopped()===!1&&f(q)===!0)return d.pauseEvent(g);var s=g.which;return a(document).on("mousemove",h),a(document).on("mouseup",j),d.pauseEvent(g)}function i(e){var f=e.currentTarget,g={page:c.point.pageToPoint(e),image:b.pageToPixel(f,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};g.canvas=b.pixelToCanvas(f,g.image);var h=d.copyPoints(g),i=e.which,j={page:c.point.pageToPoint(e),image:b.pageToPixel(f,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};j.canvas=b.pixelToCanvas(f,j.image);var k={page:c.point.subtract(j.page,h.page),image:c.point.subtract(j.image,h.image),client:c.point.subtract(j.client,h.client),canvas:c.point.subtract(j.canvas,h.canvas)},l={which:i,viewport:b.getViewport(f),image:b.getEnabledElement(f).image,element:f,startPoints:g,lastPoints:h,currentPoints:j,deltaPoints:k};a(f).trigger("CornerstoneToolsMouseMove",l),h=d.copyPoints(j)}function j(b){a(b).off("mousedown",h),a(b).off("mousemove",i),a(b).off("dblclick",g)}function k(b){j(b),a(b).on("mousedown",h),a(b).on("mousemove",i),a(b).on("dblclick",g)}var l,m,n=200;d.mouseInput={enable:k,disable:j}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(b){a(b.element).trigger("CornerstoneToolsDragStartActive",b)}function f(f){var g,h,p=f.target.parentNode;switch(f.type){case"pinch":var q=n-f.scale;n=f.scale,m={event:f,viewport:b.getViewport(p),image:b.getEnabledElement(p).image,element:p,direction:0>q?1:-1},g=a.Event("CornerstoneToolsTouchPinch",m),a(p).trigger(g,m);break;case"panstart":i={page:c.point.pageToPoint(f.pointers[0]),image:b.pageToPixel(p,f.pointers[0].pageX,f.pointers[0].pageY),client:{x:f.pointers[0].clientX,y:f.pointers[0].clientY}},i.canvas=b.pixelToCanvas(p,i.image),m={event:f.srcEvent,viewport:b.getViewport(p),image:b.getEnabledElement(p).image,element:p,startPoints:i,lastPoints:k,currentPoints:i,deltaPoints:{x:0,y:0}},h=1===f.pointers.length?"CornerstoneToolsDragStart":"CornerstoneToolsMultiTouchDragStart",g=a.Event(h,m),a(m.element).trigger(g,m),k=d.copyPoints(i),g.isImmediatePropagationStopped()===!1&&e(m);break;case"panmove":j={page:c.point.pageToPoint(f.pointers[0]),image:b.pageToPixel(p,f.pointers[0].pageX,f.pointers[0].pageY),client:{x:f.pointers[0].clientX,y:f.pointers[0].clientY}},j.canvas=b.pixelToCanvas(p,j.image),l={page:c.point.subtract(j.page,k.page),image:c.point.subtract(j.image,k.image),client:c.point.subtract(j.client,k.client),canvas:c.point.subtract(j.canvas,k.canvas)},m={viewport:b.getViewport(p),image:b.getEnabledElement(p).image,element:p,startPoints:i,lastPoints:k,currentPoints:j,deltaPoints:l},h=1===f.pointers.length?"CornerstoneToolsTouchDrag":"CornerstoneToolsMultiTouchDrag",g=a.Event(h,m),a(p).trigger(g,m),k=d.copyPoints(j);break;case"panend":return j={page:c.point.pageToPoint(f.pointers[0]),image:b.pageToPixel(p,f.pointers[0].pageX,f.pointers[0].pageY),client:{x:f.pointers[0].clientX,y:f.pointers[0].clientY}},j.canvas=b.pixelToCanvas(p,j.image),l={page:c.point.subtract(j.page,k.page),image:c.point.subtract(j.image,k.image),client:c.point.subtract(j.client,k.client),canvas:c.point.subtract(j.canvas,k.canvas)},m={event:f.srcEvent,viewport:b.getViewport(p),image:b.getEnabledElement(p).image,element:p,startPoints:i,lastPoints:k,currentPoints:j,deltaPoints:l},h=1===f.pointers.length?"CornerstoneToolsDragEnd":"CornerstoneToolsMultiTouchDragEnd",g=a.Event(h,m),a(p).trigger(g,m),d.pauseEvent(f);case"rotate":var r=f.rotation-o;o=f.rotation,m={event:f.srcEvent,viewport:b.getViewport(p),image:b.getEnabledElement(p).image,element:p,rotation:r},g=a.Event("CornerstoneToolsTouchRotate",m),a(p).trigger(g,m)}}function g(b){var c={transform_always_block:!0,transform_min_scale:.01,drag_block_horizontal:!0,drag_block_vertical:!0,drag_min_distance:0},d=new Hammer(b,{inputClass:Hammer.SUPPORT_POINTER_EVENTS?Hammer.PointerEventInput:Hammer.TouchInput});d.set(c);var e={threshold:0,pointers:0,direction:Hammer.DIRECTION_ALL},g=new Hammer.Pan(e),h=new Hammer.Pinch({threshold:.25}),i=new Hammer.Rotate({threshold:.05});h.recognizeWith(g),h.recognizeWith(i),d.add([g,h,i]),d.on("panstart panmove panend pinch rotate",f),a(b).data("hammer",d)}function h(b){var c=a(b).data("hammer");c.off("panstart panmove panend pinch rotate",f)}var i,j,k,l,m,n=1,o=0;d.touchInput={enable:g,disable:h}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(b){var c={},d={activate:function(c,d,e){a(c).off("CornerstoneToolsMouseDownActivate",b);var f={mouseButtonMask:d,options:e};a(c).on("CornerstoneToolsMouseDownActivate",f,b)},disable:function(c){a(c).off("CornerstoneToolsMouseDownActivate",b)},enable:function(c){a(c).off("CornerstoneToolsMouseDownActivate",b)},deactivate:function(c){a(c).off("CornerstoneToolsMouseDownActivate",b)},getConfiguration:function(){return c},setConfiguration:function(a){c=a}};return d}c.simpleMouseButtonTool=d}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(c){function e(e){var i=c.createNewMeasurement(e),j={mouseButtonMask:e.which};d.addToolState(e.element,c.toolType,i),a(e.element).off("CornerstoneToolsMouseMove",g),a(e.element).off("CornerstoneToolsMouseDown",h),a(e.element).off("CornerstoneToolsMouseDownActivate",f),b.updateImage(e.element),d.moveNewHandle(e,i.handles.end,function(){i.active=!1,i.invalidated=!0,d.anyHandlesOutsideImage(e,i.handles)&&d.removeToolState(e.element,c.toolType,i),a(e.element).on("CornerstoneToolsMouseMove",j,g),a(e.element).on("CornerstoneToolsMouseDown",j,h),a(e.element).on("CornerstoneToolsMouseDownActivate",j,f),b.updateImage(e.element)})}function f(a,b){return d.isMouseButtonEnabled(b.which,a.data.mouseButtonMask)?(e(b),!1):void 0}function g(a,e){if(d.toolCoordinates.setCoords(e),0===e.which){var f=d.getToolState(e.element,c.toolType);if(void 0!==f){for(var g=!1,h=0;h<f.data.length;h++){var i=e.currentPoints.canvas,j=f.data[h];d.handleActivator(e.element,j.handles,i)===!0&&(g=!0),(c.pointNearTool(e.element,j,i)&&!j.active||!c.pointNearTool(e.element,j,i)&&j.active)&&(j.active=!j.active,g=!0)}g===!0&&b.updateImage(e.element)}}}function h(e,f){function h(){i.active=!1,i.invalidated=!0,d.anyHandlesOutsideImage(f,i.handles)&&d.removeToolState(f.element,c.toolType,i),b.updateImage(f.element),a(f.element).on("CornerstoneToolsMouseMove",f,g)}var i;if(d.isMouseButtonEnabled(f.which,e.data.mouseButtonMask)){var j,k=f.startPoints.canvas,l=d.getToolState(e.currentTarget,c.toolType);if(void 0!==l)for(j=0;j<l.data.length;j++){i=l.data[j];var m=d.getHandleNearImagePoint(f.element,i,k);if(void 0!==m)return a(f.element).off("CornerstoneToolsMouseMove",g),i.active=!0,d.moveHandle(f,m,h),e.stopImmediatePropagation(),!1}if(void 0!==l&&void 0!==c.pointNearTool)for(j=0;j<l.data.length;j++)if(i=l.data[j],c.pointNearTool(f.element,i,k))return a(f.element).off("CornerstoneToolsMouseMove",g),d.moveAllHandles(e,i,l,!0),a(f.element).on("CornerstoneToolsMouseMove",f,g),e.stopImmediatePropagation(),!1}}function i(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",g),a(d).off("CornerstoneToolsMouseDown",h),a(d).off("CornerstoneToolsMouseDownActivate",f),b.updateImage(d)}function j(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",g),a(d).off("CornerstoneToolsMouseDown",h),a(d).off("CornerstoneToolsMouseDownActivate",f),a(d).on("CornerstoneImageRendered",c.onImageRendered),b.updateImage(d)}function k(d,e){var i={mouseButtonMask:e};a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",g),a(d).off("CornerstoneToolsMouseDown",h),a(d).off("CornerstoneToolsMouseDownActivate",f),a(d).on("CornerstoneImageRendered",c.onImageRendered),a(d).on("CornerstoneToolsMouseMove",i,g),a(d).on("CornerstoneToolsMouseDown",i,h),a(d).on("CornerstoneToolsMouseDownActivate",i,f),b.updateImage(d)}function l(d,e){var i={mouseButtonMask:e};a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",g),a(d).off("CornerstoneToolsMouseDown",h),a(d).off("CornerstoneToolsMouseDownActivate",f),a(d).on("CornerstoneImageRendered",c.onImageRendered),a(d).on("CornerstoneToolsMouseMove",i,g),a(d).on("CornerstoneToolsMouseDown",i,h),b.updateImage(d)}function m(){return o}function n(a){o=a}var o={},p={enable:j,disable:i,activate:k,deactivate:l,getConfiguration:m,setConfiguration:n};return c.pointNearTool&&(p.pointNearTool=c.pointNearTool),p}d.mouseButtonTool=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(c,e){function f(b){var f=c.createNewMeasurement(b);f&&(d.addToolState(b.element,c.toolType,f),a(b.element).off("CornerstoneToolsMouseMove",h),d.moveHandle(b,f.handles.end,function(){f.active=!1,d.anyHandlesOutsideImage(b,f.handles)&&d.removeToolState(b.element,c.toolType,f),a(b.element).on("CornerstoneToolsMouseMove",h)},e))}function g(a,b){return d.isMouseButtonEnabled(b.which,a.data.mouseButtonMask)?(f(b),!1):void 0}function h(a,e){if(d.toolCoordinates.setCoords(e),0===e.which){var f=d.getToolState(e.element,c.toolType);if(void 0!==f){for(var g=!1,h=e.currentPoints.canvas,i=0;i<f.data.length;i++){var j=f.data[i];d.handleActivator(e.element,j.handles,h)===!0&&(g=!0),(c.pointInsideRect(e.element,j,h)&&!j.active||!c.pointInsideRect(e.element,j,h)&&j.active)&&(j.active=!j.active,g=!0)}g===!0&&b.updateImage(e.element)}}}function i(f,g){function i(){j.active=!1,d.anyHandlesOutsideImage(g,j.handles)&&d.removeToolState(g.element,c.toolType,j),b.updateImage(g.element),a(g.element).on("CornerstoneToolsMouseMove",h)}var j;if(d.isMouseButtonEnabled(g.which,f.data.mouseButtonMask)){var k,l=g.startPoints.canvas,m=d.getToolState(f.currentTarget,c.toolType);if(void 0!==m)for(k=0;k<m.data.length;k++){j=m.data[k];var n=d.getHandleNearImagePoint(g.element,j,l);if(void 0!==n)return a(g.element).off("CornerstoneToolsMouseMove",h),j.active=!0,d.moveHandle(g,n,i,e),f.stopImmediatePropagation(),!1}if(void 0!==m&&void 0!==c.pointInsideRect)for(k=0;k<m.data.length;k++)if(j=m.data[k],c.pointInsideRect(g.element,j,l))return a(g.element).off("CornerstoneToolsMouseMove",h),d.moveAllHandles(f,j,m,!1,e),a(g.element).on("CornerstoneToolsMouseMove",h),f.stopImmediatePropagation(),!1}}function j(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",h),a(d).off("CornerstoneToolsMouseDown",i),a(d).off("CornerstoneToolsMouseDownActivate",g),b.updateImage(d)}function k(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",h),a(d).off("CornerstoneToolsMouseDown",i),a(d).off("CornerstoneToolsMouseDownActivate",g),a(d).on("CornerstoneImageRendered",c.onImageRendered),b.updateImage(d)}function l(d,e){var f={mouseButtonMask:e};a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",h),a(d).off("CornerstoneToolsMouseDown",i),a(d).off("CornerstoneToolsMouseDownActivate",g),a(d).on("CornerstoneImageRendered",c.onImageRendered),a(d).on("CornerstoneToolsMouseMove",f,h),a(d).on("CornerstoneToolsMouseDown",f,i),a(d).on("CornerstoneToolsMouseDownActivate",f,g),b.updateImage(d)}function m(d,e){var f={mouseButtonMask:e};a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsMouseMove",h),a(d).off("CornerstoneToolsMouseDown",i),a(d).off("CornerstoneToolsMouseDownActivate",g),a(d).on("CornerstoneImageRendered",c.onImageRendered),a(d).on("CornerstoneToolsMouseMove",f,h),a(d).on("CornerstoneToolsMouseDown",f,i),b.updateImage(d)}var n={enable:k,disable:j,activate:l,deactivate:m};return n}d.mouseButtonRectangleTool=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(b){var c={activate:function(c){a(c).off("CornerstoneToolsMouseWheel",b);var d={};a(c).on("CornerstoneToolsMouseWheel",d,b)},disable:function(c){a(c).off("CornerstoneToolsMouseWheel",b)},enable:function(c){a(c).off("CornerstoneToolsMouseWheel",b)},deactivate:function(c){a(c).off("CornerstoneToolsMouseWheel",b)}};return c}c.mouseWheelTool=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b){var c={activate:function(c){a(c).off("CornerstoneToolsTouchDrag",b),a(c).on("CornerstoneToolsTouchDrag",b)},disable:function(c){a(c).off("CornerstoneToolsTouchDrag",b)},enable:function(c){a(c).off("CornerstoneToolsTouchDrag",b)},deactivate:function(c){a(c).off("CornerstoneToolsTouchDrag",b)}};return c}c.touchDragTool=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b){var c={activate:function(c){a(c).off("CornerstoneToolsTouchPinch",b);var d={};a(c).on("CornerstoneToolsTouchPinch",d,b)},disable:function(c){a(c).off("CornerstoneToolsTouchPinch",b)},enable:function(c){a(c).off("CornerstoneToolsTouchPinch",b)},deactivate:function(c){a(c).off("CornerstoneToolsTouchPinch",b)}};return c}c.touchPinchTool=d}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(c){function e(e){var f=c.createNewMeasurement(e);d.addToolState(e.element,c.toolType,f),a(e.element).off("CornerstoneToolsTouchDrag",g),d.touchMoveHandle(e,f.handles.end,function(){f.active=!1,f.invalidated=!0,d.anyHandlesOutsideImage(e,f.handles)&&d.removeToolState(e.element,c.toolType,f),a(e.element).on("CornerstoneToolsTouchDrag",g),b.updateImage(e.element)})}function f(a,b){return e(b),!1}function g(a,e){d.toolCoordinates.setCoords(e);var f=d.getToolState(e.element,c.toolType);if(void 0!==f){for(var g=!1,h=0;h<f.data.length;h++){var i=e.currentPoints.canvas,j=f.data[h];d.handleActivator(e.element,j.handles,i)===!0&&(g=!0)}g===!0&&b.updateImage(e.element)}}function h(e,f){function h(){i.active=!1,i.invalidated=!0,d.anyHandlesOutsideImage(f,i.handles)&&d.removeToolState(f.element,c.toolType,i),b.updateImage(f.element),a(f.element).on("CornerstoneToolsTouchDrag",g)}var i,j,k=f.startPoints.canvas,l=d.getToolState(e.currentTarget,c.toolType);if(void 0!==l)for(j=0;j<l.data.length;j++){i=l.data[j];var m=d.getHandleNearImagePoint(f.element,i,k);if(void 0!==m)return a(f.element).off("CornerstoneToolsTouchDrag",g),i.active=!0,d.touchMoveHandle(e,m,h),e.stopImmediatePropagation(),!1}if(void 0!==l&&void 0!==c.pointNearTool)for(j=0;j<l.data.length;j++)if(i=l.data[j],c.pointNearTool(f.element,i,k))return a(f.element).off("CornerstoneToolsTouchDrag",g),d.touchMoveAllHandles(e,i,l,!0),a(f.element).on("CornerstoneToolsTouchDrag",g),e.stopImmediatePropagation(),!1}function i(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsTouchDrag",g),a(d).off("CornerstoneToolsDragStart",h),a(d).off("CornerstoneToolsDragStartActive",f),b.updateImage(d)}function j(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsTouchDrag",g),a(d).off("CornerstoneToolsDragStart",h),a(d).off("CornerstoneToolsDragStartActive",f),a(d).on("CornerstoneImageRendered",c.onImageRendered),b.updateImage(d)}function k(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsTouchDrag",g),a(d).off("CornerstoneToolsDragStart",h),a(d).off("CornerstoneToolsDragStartActive",f),a(d).on("CornerstoneImageRendered",c.onImageRendered),a(d).on("CornerstoneToolsTouchDrag",g),a(d).on("CornerstoneToolsDragStart",h),a(d).on("CornerstoneToolsDragStartActive",f),b.updateImage(d)}function l(d){a(d).off("CornerstoneImageRendered",c.onImageRendered),a(d).off("CornerstoneToolsTouchDrag",g),a(d).off("CornerstoneToolsDragStart",h),a(d).off("CornerstoneToolsDragStartActive",f),a(d).on("CornerstoneImageRendered",c.onImageRendered),a(d).on("CornerstoneToolsTouchDrag",g),a(d).on("CornerstoneToolsDragStart",h),b.updateImage(d)}var m={enable:j,disable:i,activate:k,deactivate:l};return m}d.touchTool=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x-20,y:a.currentPoints.image.y+10,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0},start2:{x:a.currentPoints.image.x-20,y:a.currentPoints.image.y+10,highlight:!0,active:!1},end2:{x:a.currentPoints.image.x,y:a.currentPoints.image.y+20,highlight:!0,active:!1}}};return b}function f(a,d,e){var f={start:b.pixelToCanvas(a,d.handles.start),end:b.pixelToCanvas(a,d.handles.end)},g=c.lineSegment.distanceToPoint(f,e);return 5>g?!0:(f.start=b.pixelToCanvas(a,d.handles.start2),f.end=b.pixelToCanvas(a,d.handles.end2),g=c.lineSegment.distanceToPoint(f,e),5>g)}function g(a,c){var e=d.getToolState(a.currentTarget,h);if(void 0!==e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var g,i=d.toolStyle.getToolWidth(),j=d.textStyle.getFont(),k=d.angle.getConfiguration(),l=0;l<e.data.length;l++){f.save(),k&&k.shadow&&(f.shadowColor="#000000",f.shadowOffsetX=1,f.shadowOffsetY=1);var m=e.data[l];g=m.active?d.toolColors.getActiveColor():d.toolColors.getToolColor(),f.beginPath(),f.strokeStyle=g,f.lineWidth=i;var n=b.pixelToCanvas(c.element,m.handles.start),o=b.pixelToCanvas(c.element,m.handles.end);f.moveTo(n.x,n.y),f.lineTo(o.x,o.y),n=b.pixelToCanvas(c.element,m.handles.start2),o=b.pixelToCanvas(c.element,m.handles.end2),f.moveTo(n.x,n.y),f.lineTo(o.x,o.y),f.stroke(),d.drawHandles(f,c,m.handles),f.fillStyle=g;var p=(Math.ceil(m.handles.start.x)-Math.ceil(m.handles.end.x))*c.image.columnPixelSpacing,q=(Math.ceil(m.handles.start.y)-Math.ceil(m.handles.end.y))*c.image.rowPixelSpacing,r=(Math.ceil(m.handles.start2.x)-Math.ceil(m.handles.end2.x))*c.image.columnPixelSpacing,s=(Math.ceil(m.handles.start2.y)-Math.ceil(m.handles.end2.y))*c.image.rowPixelSpacing,t=Math.acos(Math.abs((p*r+q*s)/(Math.sqrt(p*p+q*q)*Math.sqrt(r*r+s*s))));t*=180/Math.PI;var u=d.roundToDecimal(t,2),v="00B0",w=u.toString()+String.fromCharCode(parseInt(v,16)),x=(n.x+o.x)/2,y=(n.y+o.y)/2;f.font=j,d.drawTextBox(f,w,x,y,g),f.restore()}}}var h="angle";d.angle=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:g,pointNearTool:f,toolType:h}),d.angleTouch=d.touchTool({createNewMeasurement:e,onImageRendered:g,pointNearTool:f,toolType:h})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){a(prompt("Enter your annotation:"))}function f(c){function e(a){null!==a?f.annotationText=a:d.removeToolState(c.element,C,f),b.updateImage(c.element)}var f=j(c),k={mouseButtonMask:c.which};d.addToolState(c.element,C,f),a(c.element).off("CornerstoneToolsMouseMove",h),a(c.element).off("CornerstoneToolsMouseDown",i),a(c.element).off("CornerstoneToolsMouseDownActivate",g),b.updateImage(c.element),d.moveNewHandle(c,f.handles.end,function(){f.active=!1,d.anyHandlesOutsideImage(c,f.handles)&&d.removeToolState(c.element,C,f);var j=d.arrowAnnotate.getConfiguration();void 0===f.annotationText&&j.getTextCallback(e),a(c.element).on("CornerstoneToolsMouseMove",k,h),a(c.element).on("CornerstoneToolsMouseDown",k,i),a(c.element).on("CornerstoneToolsMouseDownActivate",k,g),b.updateImage(c.element)})}function g(a,b){return d.isMouseButtonEnabled(b.which,a.data.mouseButtonMask)?(f(b),!1):void 0}function h(a,c){if(d.toolCoordinates.setCoords(c),0===c.which){var e=d.getToolState(c.element,C);if(void 0!==e){for(var f=!1,g=c.currentPoints.canvas,h=0;h<e.data.length;h++){var i=e.data[h];d.handleActivator(c.element,i.handles,g)===!0&&(f=!0),(k(c.element,i,g)&&!i.active||!k(c.element,i,g)&&i.active)&&(i.active=!i.active,f=!0)}return f===!0&&b.updateImage(c.element),!1}}}function i(c,e){function f(){g.active=!1,d.anyHandlesOutsideImage(e,g.handles)&&d.removeToolState(e.element,C,g),b.updateImage(e.element),a(e.element).on("CornerstoneToolsMouseMove",h)}var g;if(d.isMouseButtonEnabled(e.which,c.data.mouseButtonMask)){var i,j=e.startPoints.canvas,l=d.getToolState(c.currentTarget,C);if(void 0!==l)for(i=0;i<l.data.length;i++){g=l.data[i];var m=d.getHandleNearImagePoint(e.element,g,j);if(void 0!==m)return a(e.element).off("CornerstoneToolsMouseMove",h),g.active=!0,d.moveHandle(e,m,f),c.stopImmediatePropagation(),!1}if(void 0!==l&&void 0!==k)for(i=0;i<l.data.length;i++)if(g=l.data[i],k(e.element,g,j))return a(e.element).off("CornerstoneToolsMouseMove",h),d.moveAllHandles(c,g,l,!0),a(e.element).on("CornerstoneToolsMouseMove",h),c.stopImmediatePropagation(),!1;return!1}}function j(a){var b={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function k(a,d,e){var f={start:b.pixelToCanvas(a,d.handles.start),end:b.pixelToCanvas(a,d.handles.end)},g=c.lineSegment.distanceToPoint(f,e);return 25>g}function l(a,b,c,d,e){var f=10,g=Math.atan2(c.y-b.y,c.x-b.x);a.beginPath(),a.moveTo(b.x,b.y),a.lineTo(c.x,c.y),a.strokeStyle=d,a.lineWidth=e,a.stroke(),a.beginPath(),a.moveTo(c.x,c.y),a.lineTo(c.x-f*Math.cos(g-Math.PI/7),c.y-f*Math.sin(g-Math.PI/7)),a.lineTo(c.x-f*Math.cos(g+Math.PI/7),c.y-f*Math.sin(g+Math.PI/7)),a.lineTo(c.x,c.y),a.lineTo(c.x-f*Math.cos(g-Math.PI/7),c.y-f*Math.sin(g-Math.PI/7)),a.strokeStyle=d,a.lineWidth=e,a.stroke(),a.fillStyle=d,a.fill()}function m(a,c){var e=d.getToolState(a.currentTarget,C);if(void 0!==e){var f=d.arrowAnnotate.getConfiguration(),g=c.canvasContext.canvas.getContext("2d");g.setTransform(1,0,0,1,0,0);for(var h,i=d.toolStyle.getToolWidth(),j=d.textStyle.getFont(),k=0;k<e.data.length;k++){g.save();var m=e.data[k];h=m.active?d.toolColors.getActiveColor():d.toolColors.getToolColor();var n=b.pixelToCanvas(c.element,m.handles.start),o=b.pixelToCanvas(c.element,m.handles.end);if(f.arrowFirst?l(g,o,n,h,i):l(g,n,o,h,i),f.drawHandles?d.drawHandles(g,c,m.handles,h):f.drawHandlesOnHover&&m.handles.start.active?d.drawHandles(g,c,[m.handles.start],h):f.drawHandlesOnHover&&m.handles.end.active&&d.drawHandles(g,c,[m.handles.end],h),m.annotationText&&""!==m.annotationText){g.font=j;var p,q=13,r={x:q,y:q/2};p={x:o.x-n.x,y:o.y-n.y};var s;f.arrowFirst?(p.x<0&&(r.x=-r.x-g.measureText(m.annotationText).width),s={x:p.x+n.x+r.x,y:p.y+n.y+r.y}):(p.x>0&&(r.x=-r.x-g.measureText(m.annotationText).width),s={x:-p.x+o.x+r.x,y:-p.y+o.y+r.y}),d.drawTextBox(g,m.annotationText,s.x,s.y,h)}g.restore()}}}function n(c){a(c).off("CornerstoneImageRendered",m),a(c).off("CornerstoneToolsMouseMove",h),a(c).off("CornerstoneToolsMouseDown",i),a(c).off("CornerstoneToolsMouseDownActivate",g),b.updateImage(c)}function o(c){a(c).off("CornerstoneImageRendered",m),a(c).off("CornerstoneToolsMouseMove",h),a(c).off("CornerstoneToolsMouseDown",i),a(c).off("CornerstoneToolsMouseDownActivate",g),a(c).on("CornerstoneImageRendered",m),b.updateImage(c)}function p(c,d){var e={mouseButtonMask:d};a(c).off("CornerstoneImageRendered",m),a(c).off("CornerstoneToolsMouseMove",h),a(c).off("CornerstoneToolsMouseDown",i),a(c).off("CornerstoneToolsMouseDownActivate",g),a(c).on("CornerstoneImageRendered",m),a(c).on("CornerstoneToolsMouseMove",e,h),a(c).on("CornerstoneToolsMouseDown",e,i),a(c).on("CornerstoneToolsMouseDownActivate",e,g),b.updateImage(c)}function q(c,d){var e={mouseButtonMask:d};a(c).off("CornerstoneImageRendered",m),a(c).off("CornerstoneToolsMouseMove",h),a(c).off("CornerstoneToolsMouseDown",i),a(c).off("CornerstoneToolsMouseDownActivate",g),a(c).on("CornerstoneImageRendered",m),a(c).on("CornerstoneToolsMouseMove",e,h),a(c).on("CornerstoneToolsMouseDown",e,i),b.updateImage(c)}function r(c){function e(a){null!==a?f.annotationText=a:d.removeToolState(c.element,C,f),b.updateImage(c.element)}var f=j(c);d.addToolState(c.element,C,f),a(c.element).off("CornerstoneToolsTouchDrag",t),d.touchMoveHandle(c,f.handles.end,function(){d.anyHandlesOutsideImage(c,f.handles)&&d.removeToolState(c.element,C,f);var b=d.arrowAnnotate.getConfiguration();void 0===f.annotationText&&b.getTextCallback(e),a(c.element).on("CornerstoneToolsTouchDrag",t)})}function s(a,b){return r(b),!1}function t(a,c){d.toolCoordinates.setCoords(c);var e=d.getToolState(c.element,C);if(void 0!==e){for(var f=!1,g=0;g<e.data.length;g++){var h=c.currentPoints.canvas,i=e.data[g];d.handleActivator(c.element,i.handles,h)===!0&&(f=!0)}return f===!0&&b.updateImage(c.element),!1}}function u(a,d,e){var f;return Object.keys(d.handles).forEach(function(g){var h=d.handles[g],i=b.pixelToCanvas(a,h),j=c.point.distanceSquared(i,e);return 30>j?void(f=h):void 0}),f}function v(b,c){function e(){d.anyHandlesOutsideImage(c,f.handles)&&d.removeToolState(c.element,C,f),a(c.element).on("CornerstoneToolsTouchDrag",t)}var f,g,h=c.startPoints.canvas,i=d.getToolState(b.currentTarget,C);if(void 0!==i)for(g=0;g<i.data.length;g++){f=i.data[g];var j=u(c.element,f,h);if(void 0!==j)return a(c.element).off("CornerstoneToolsTouchDrag",t),d.touchMoveHandle(c,j,e),b.stopImmediatePropagation(),!1}if(void 0!==i&&void 0!==k)for(g=0;g<i.data.length;g++)if(f=i.data[g],k(c.element,f,h))return a(c.element).off("CornerstoneToolsTouchDrag",t),d.touchMoveAllHandles(b,f,i,!0),b.stopImmediatePropagation(),!1;return!1}function w(c){a(c).off("CornerstoneImageRendered",m),a(c).off("CornerstoneToolsTouchDrag",t),a(c).off("CornerstoneToolsDragStart",v),a(c).off("CornerstoneToolsDragStartActive",s),b.updateImage(c)}function x(c){a(c).off("CornerstoneImageRendered",m),a(c).off("CornerstoneToolsTouchDrag",t),a(c).off("CornerstoneToolsDragStart",v),a(c).off("CornerstoneToolsDragStartActive",s),a(c).on("CornerstoneImageRendered",m),b.updateImage(c)}function y(c){a(c).off("CornerstoneImageRendered",m),a(c).off("CornerstoneToolsTouchDrag",t),a(c).off("CornerstoneToolsDragStart",v),a(c).off("CornerstoneToolsDragStartActive",s),a(c).on("CornerstoneImageRendered",m),a(c).on("CornerstoneToolsTouchDrag",t),a(c).on("CornerstoneToolsDragStart",v),a(c).on("CornerstoneToolsDragStartActive",s),b.updateImage(c)}function z(c){a(c).off("CornerstoneImageRendered",m),a(c).off("CornerstoneToolsTouchDrag",t),a(c).off("CornerstoneToolsDragStart",v),a(c).off("CornerstoneToolsDragStartActive",s),a(c).on("CornerstoneImageRendered",m),a(c).on("CornerstoneToolsTouchDrag",t),a(c).on("CornerstoneToolsDragStart",v),b.updateImage(c)}function A(){return D}function B(a){D=a}var C="arrowAnnotate",D={getTextCallback:e,drawHandles:!1,drawHandlesOnHover:!0,arrowFirst:!0};d.arrowAnnotate={enable:o,disable:n,activate:p,deactivate:q,getConfiguration:A,setConfiguration:B,pointNearTool:k},d.arrowAnnotateTouch={enable:x,disable:w,activate:y,deactivate:z}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(d,e){var f=c.getToolState(d.currentTarget,j);if(f){var g=d.currentTarget,h=b.getEnabledElement(g),i=h.image.imageId,k=c.metaData.get("imagePlane",i),l=e.currentPoints.image,m=c.imagePointToPatientPoint(l,k),n=f.data[0].synchronizationContext,o=n.getSourceElements();a.each(o,function(d,e){if(e!==g){var f=Number.MAX_VALUE,h=-1,i=c.getToolState(e,"stack");if(void 0!==i){var j=i.data[0];if(a.each(j.imageIds,function(a,b){var d=c.metaData.get("imagePlane",b),e=d.imagePositionPatient,g=d.rowCosines.clone(),i=d.columnCosines.clone(),j=i.clone().cross(g.clone()),k=Math.abs(j.clone().dot(e)-j.clone().dot(m));f>k&&(f=k,h=a)}),h!==j.currentImageIdIndex&&-1!==h&&void 0!==j.imageIds[h]){var k=c.loadHandlerManager.getStartLoadHandler(),l=c.loadHandlerManager.getEndLoadHandler(),n=c.loadHandlerManager.getErrorLoadingHandler();k&&k(e),b.loadAndCacheImage(j.imageIds[h]).then(function(a){var c=b.getViewport(e);j.currentImageIdIndex=h,b.displayImage(e,a,c),l&&l(e)},function(a){var b=j.imageIds[h];n&&n(e,b,a)})}}}})}}function e(b,c){a(c.element).off("CornerstoneToolsMouseDrag",g),a(c.element).off("CornerstoneToolsMouseUp",e)}function f(b,f){return c.isMouseButtonEnabled(f.which,b.data.mouseButtonMask)?(a(f.element).on("CornerstoneToolsMouseDrag",g),a(f.element).on("CornerstoneToolsMouseUp",e),d(b,f),!1):void 0}function g(a,b){return d(a,b),!1}function h(b,d,e){var g={mouseButtonMask:d};c.addToolState(b,j,{synchronizationContext:e}),a(b).off("CornerstoneToolsMouseDown",f),a(b).on("CornerstoneToolsMouseDown",g,f)}function i(b){a(b).off("CornerstoneToolsMouseDown",f)}var j="crosshairs";c.crosshairs={enable:h,disable:i}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(c){var d={},e={disable:function(b){a(b).off("CornerstoneImageRendered",c)},enable:function(d){a(d).off("CornerstoneImageRendered",c),a(d).on("CornerstoneImageRendered",c),b.updateImage(d)},getConfiguration:function(){return d},setConfiguration:function(a){d=a}};return e}c.displayTool=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){var d=b.getEnabledElement(a.element);b.updateImage(a.element);var e=d.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0);var f=c.toolColors.getActiveColor(),g=c.textStyle.getFont(),h=c.textStyle.getFontSize();e.save();var i=Math.round(a.currentPoints.image.x),j=Math.round(a.currentPoints.image.y),k=b.getStoredPixels(a.element,i,j,1,1),l=k[0],m=l*a.image.slope+a.image.intercept,n=c.calculateSUV(a.image,l),o={x:a.currentPoints.image.x+3,y:a.currentPoints.image.y-3},p=b.pixelToCanvas(a.element,o);
e.font=g,e.fillStyle=f;var q=""+i+","+j,r="SP: "+l+" MO: "+parseFloat(m.toFixed(3));n&&(r+=" SUV: "+parseFloat(n.toFixed(3))),c.drawTextBox(e,r,p.x,p.y+h+5,f),c.drawTextBox(e,q,p.x,p.y,f),e.restore()}function e(a){var d=b.getEnabledElement(a.element);b.updateImage(a.element);var e=d.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0);var f=c.toolColors.getActiveColor(),g=c.textStyle.getFont();e.save();var h=Math.round(a.currentPoints.image.x),i=Math.round(a.currentPoints.image.y),j=b.getStoredPixels(a.element,h,i,1,1),k=j[0]*a.image.slope+a.image.intercept;k=parseFloat(k.toFixed(3));var l={x:a.currentPoints.image.x+4,y:a.currentPoints.image.y-4},m=b.pixelToCanvas(a.element,l);e.font=g,e.fillStyle=f,c.drawTextBox(e,k,m.x,m.y,f),e.restore()}function f(c,d){a(d.element).off("CornerstoneToolsMouseDrag",h),a(d.element).off("CornerstoneToolsMouseUp",f),b.updateImage(d.element)}function g(b,d){return c.isMouseButtonEnabled(d.which,b.data.mouseButtonMask)?(a(d.element).on("CornerstoneToolsMouseDrag",h),a(d.element).on("CornerstoneToolsMouseUp",f),c.dragProbe.strategy(d),!1):void 0}function h(a,b){return c.dragProbe.strategy(b),!1}c.dragProbe=c.simpleMouseButtonTool(g),c.dragProbe.strategies={"default":d,minimal:e},c.dragProbe.strategy=d,c.dragProbeTouch=c.touchDragTool(h)}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b={visible:!0,active:!0,invalidated:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function f(a,d,e){var f=b.pixelToCanvas(a,d.handles.start),g=b.pixelToCanvas(a,d.handles.end),h={left:Math.min(f.x,g.x),top:Math.min(f.y,g.y),width:Math.abs(f.x-g.x),height:Math.abs(f.y-g.y)},i=c.rect.distanceToPoint(h,e);return 5>i}function g(a,b){var c=a.width/2,d=a.height/2;if(0>=c||0>=d)return!1;var e={x:a.left+c,y:a.top+d},f={x:b.x-e.x,y:b.y-e.y},g=f.x*f.y/(c*c)+f.y*f.y/(d*d)<=1;return g}function h(a,b){for(var c=0,d=0,e=0,f=0,h=b.top;h<b.top+b.height;h++)for(var i=b.left;i<b.left+b.width;i++)g(b,{x:i,y:h})===!0&&(c+=a[f],d+=a[f]*a[f],e++),f++;if(0===e)return{count:e,mean:0,variance:0,stdDev:0};var j=c/e,k=d/e-j*j;return{count:e,mean:j,variance:k,stdDev:Math.sqrt(k)}}function i(a,c){var e=d.getToolState(a.currentTarget,j);if(void 0!==e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var g,i=d.toolStyle.getToolWidth(),k=d.textStyle.getFont(),l=d.textStyle.getFontSize(),m=0;m<e.data.length;m++){f.save();var n=e.data[m];g=n.active?d.toolColors.getActiveColor():d.toolColors.getToolColor();var o=b.pixelToCanvas(c.element,n.handles.start),p=b.pixelToCanvas(c.element,n.handles.end),q=Math.abs(o.x-p.x),r=Math.abs(o.y-p.y),s=Math.min(o.x,p.x),t=Math.min(o.y,p.y),u=(o.x+p.x)/2,v=(o.y+p.y)/2;f.beginPath(),f.strokeStyle=g,f.lineWidth=i,d.drawEllipse(f,s,t,q,r),f.closePath(),d.drawHandles(f,c,n.handles),f.font=k;var w,x,y,z,A,B;if(n.invalidated){var C=Math.abs(n.handles.start.x-n.handles.end.x),D=Math.abs(n.handles.start.y-n.handles.end.y),E=Math.min(n.handles.start.x,n.handles.end.x),F=Math.min(n.handles.start.y,n.handles.end.y),G=b.getPixels(c.element,E,F,C,D),H={left:E,top:F,width:C,height:D};y=h(G,H),z=Math.PI*(C*c.image.columnPixelSpacing/2)*(D*c.image.rowPixelSpacing/2),n.invalidated=!1,isNaN(z)||(n.area=z),isNaN(y.mean)||isNaN(y.stdDev)||(n.meanStdDev=y)}else w=n.textX,x=n.textY,y=n.meanStdDev,z=n.area;if(void 0!==z)A="Area: "+z.toFixed(2)+" mm"+String.fromCharCode(178),B=f.measureText(A);else{var I="StdDev: "+y.stdDev.toFixed(2);B=f.measureText(I)}w=u<c.image.columns/2?u+q/2:u-q/2-B.width,x=v<c.image.rows/2?v+r/2:v-r/2,f.fillStyle=g,y&&(d.drawTextBox(f,"Mean: "+y.mean.toFixed(2),w,x-l-5,g),d.drawTextBox(f,"StdDev: "+y.stdDev.toFixed(2),w,x,g)),void 0===z||isNaN(z)||d.drawTextBox(f,A,w,x+l+5,g),f.restore()}}}var j="ellipticalRoi";d.ellipticalRoi=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:i,pointNearTool:f,toolType:j}),d.ellipticalRoiTouch=d.touchTool({createNewMeasurement:e,onImageRendered:i,pointNearTool:f,toolType:j})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var c=d.getToolState(a.element,t);if(void 0!==c){var e=d.freehand.getConfiguration(),f=c.data[e.currentTool],g={x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0,lines:[]};f.handles.length&&f.handles[e.currentHandle-1].lines.push(a.currentPoints.image),f.handles.push(g),e.currentHandle+=1,e.freehand=!1,b.updateImage(a.element)}}function f(a,e){var f=d.getToolState(a.element,t);if(void 0!==f){var g=f.data[e];if(void 0!==g.handles)for(var h=a.currentPoints.canvas,i=0;i<g.handles.length;i++){var j=b.pixelToCanvas(a.element,g.handles[i]);if(c.point.distance(j,h)<5)return i}}}function g(a){var b=d.getToolState(a.element,t);if(void 0!==b)for(var c,e=0;e<b.data.length;e++)if(c=f(a,e),void 0!==c)return{handleNearby:c,toolIndex:e}}function h(c,e){a(e.element).off("CornerstoneToolsMouseUp",h);var f=d.getToolState(e.element,t);if(void 0!==f){var g=d.freehand.getConfiguration();e.event.shiftKey||(g.freehand=!1),b.updateImage(e.element)}}function i(a,c){var e=d.getToolState(c.element,t);if(void 0!==e){var g=d.freehand.getConfiguration(),h=e.data[g.currentTool];g.mouseLocation.handles.start.x=c.currentPoints.image.x,g.mouseLocation.handles.start.y=c.currentPoints.image.y;var i=g.currentHandle;if(g.modifying&&(h.active=!0,h.highlight=!0,h.handles[i].x=g.mouseLocation.handles.start.x,h.handles[i].y=g.mouseLocation.handles.start.y,i)){var j=h.handles[i-1].lines.length-1,k=h.handles[i-1].lines[j];k.x=g.mouseLocation.handles.start.x,k.y=g.mouseLocation.handles.start.y}if(g.freehand)h.handles[i-1].lines.push(c.currentPoints.image);else{var l=f(c,g.currentTool);void 0!==l&&l<h.handles.length-1&&(g.mouseLocation.handles.start.x=h.handles[l].x,g.mouseLocation.handles.start.y=h.handles[l].y)}b.updateImage(c.element)}}function j(b){a(b.element).on("CornerstoneToolsMouseMove",i),a(b.element).on("CornerstoneToolsMouseUp",h);var c={visible:!0,active:!0,handles:[]},e=d.freehand.getConfiguration();e.mouseLocation.handles.start.x=b.currentPoints.image.x,e.mouseLocation.handles.start.y=b.currentPoints.image.y,d.addToolState(b.element,t,c);var f=d.getToolState(b.element,t);e.currentTool=f.data.length-1}function k(c,e){var f=d.getToolState(c.element,t);if(void 0!==f){var g=d.freehand.getConfiguration(),h=f.data[g.currentTool];h.active=!1,h.highlight=!1,void 0!==e&&h.handles[g.currentHandle-1].lines.push(h.handles[e]),g.modifying&&(g.modifying=!1),g.currentHandle=0,g.currentTool=-1,a(c.element).off("CornerstoneToolsMouseMove",i),b.updateImage(c.element)}}function l(b,c){if(d.isMouseButtonEnabled(c.which,b.data.mouseButtonMask)){var l,m,n=d.getToolState(c.element,t),o=d.freehand.getConfiguration(),p=o.currentTool;if(o.modifying)return void k(c);if(0>p){var q=g(c);q?(l=q.handleNearby,m=q.toolIndex,void 0!==l&&(a(c.element).on("CornerstoneToolsMouseMove",i),a(c.element).on("CornerstoneToolsMouseUp",h),o.modifying=!0,o.currentHandle=l,o.currentTool=m)):(j(c),e(c))}else p>=0&&n.data[p].active&&(l=f(c,p),void 0!==l?k(c,l):c.event.shiftKey?o.freehand=!0:e(c));return!1}}function m(a,c){var e=d.getToolState(a.currentTarget,t);if(void 0!==e){var f=d.freehand.getConfiguration(),g=c.canvasContext.canvas.getContext("2d");g.setTransform(1,0,0,1,0,0);for(var h,i=d.toolStyle.getToolWidth(),j=d.toolColors.getFillColor(),k=0;k<e.data.length;k++){g.save();var l=e.data[k];l.active?(h=d.toolColors.getActiveColor(),j=d.toolColors.getFillColor()):(h=d.toolColors.getToolColor(),j=d.toolColors.getToolColor());var m;if(l.handles.length)for(var n=0;n<l.handles.length;n++){m=l.handles[n];var o=b.pixelToCanvas(c.element,m);g.beginPath(),g.strokeStyle=h,g.lineWidth=i,g.moveTo(o.x,o.y);for(var p=0;p<l.handles[n].lines.length;p++){var q=b.pixelToCanvas(c.element,l.handles[n].lines[p]);g.lineTo(q.x,q.y),g.stroke()}var r=b.pixelToCanvas(c.element,f.mouseLocation.handles.start);n===l.handles.length-1&&(!l.active||f.freehand||f.modifying||(g.lineTo(r.x,r.y),g.stroke()))}l.active&&d.drawHandles(g,c,f.mouseLocation.handles,h,j),d.drawHandles(g,c,l.handles,h,j),g.restore()}}}function n(c){a(c).off("CornerstoneToolsMouseDown",l),a(c).off("CornerstoneToolsMouseUp",h),a(c).off("CornerstoneToolsMouseMove",i),a(c).off("CornerstoneImageRendered",m),a(c).on("CornerstoneImageRendered",m),b.updateImage(c)}function o(c){a(c).off("CornerstoneToolsMouseDown",l),a(c).off("CornerstoneToolsMouseUp",h),a(c).off("CornerstoneToolsMouseMove",i),a(c).off("CornerstoneImageRendered",m),b.updateImage(c)}function p(c,d){var e={mouseButtonMask:d};a(c).off("CornerstoneToolsMouseDown",e,l),a(c).off("CornerstoneToolsMouseUp",h),a(c).off("CornerstoneToolsMouseMove",i),a(c).off("CornerstoneImageRendered",m),a(c).on("CornerstoneImageRendered",m),a(c).on("CornerstoneToolsMouseDown",e,l),b.updateImage(c)}function q(c){a(c).off("CornerstoneToolsMouseDown",l),a(c).off("CornerstoneToolsMouseUp",h),a(c).off("CornerstoneToolsMouseMove",i),a(c).off("CornerstoneImageRendered",m),a(c).on("CornerstoneImageRendered",m),b.updateImage(c)}function r(){return u}function s(a){u=a}var t="freehand",u={mouseLocation:{handles:{start:{highlight:!0,active:!0}}},freehand:!1,modifying:!1,currentHandle:0,currentTool:-1};d.freehand={enable:n,disable:o,activate:p,deactivate:q,getConfiguration:r,setConfiguration:s}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b=d.getToolState(a.event.currentTarget,i);if(!(b&&b.data&&b.data.length>0)){var c={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return c}}function f(a,c,d){var e=b.pixelToCanvas(a,c.handles.start),f=b.pixelToCanvas(a,c.handles.end),g={left:Math.min(e.x,f.x),top:Math.min(e.y,f.y),width:Math.abs(e.x-f.x),height:Math.abs(e.y-f.y)},h=!1;return d.x>=g.left&&d.x<=g.left+g.width&&d.y>=g.top&&d.y<=g.top+g.height&&(h=!0),h}function g(a,d,e){var f=b.pixelToCanvas(a,d.handles.start),g=b.pixelToCanvas(a,d.handles.end),h={left:Math.min(f.x,g.x),top:Math.min(f.y,g.y),width:Math.abs(f.x-g.x),height:Math.abs(f.y-g.y)},i=c.rect.distanceToPoint(h,e);return 5>i}function h(a,c){var e=d.getToolState(a.currentTarget,i);if(void 0!==e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);var g,h=d.toolStyle.getToolWidth();f.save();var j=e.data[0];if(j){g=j.active?d.toolColors.getActiveColor():d.toolColors.getToolColor();var k=b.pixelToCanvas(c.element,j.handles.start),l=b.pixelToCanvas(c.element,j.handles.end),m={left:Math.min(k.x,l.x),top:Math.min(k.y,l.y),width:Math.abs(k.x-l.x),height:Math.abs(k.y-l.y)};f.beginPath(),f.strokeStyle="transparent",f.rect(0,0,f.canvas.clientWidth,f.canvas.clientHeight),f.rect(m.width+m.left,m.top,-m.width,m.height),f.stroke(),f.fillStyle="rgba(0,0,0,0.7)",f.fill(),f.closePath(),f.beginPath(),f.strokeStyle=g,f.lineWidth=h,f.setLineDash([4]),f.strokeRect(m.left,m.top,m.width,m.height),f.setLineDash([]),d.drawHandles(f,c,j.handles,g),f.restore()}}}var i="highlight",j=!0;d.highlight=d.mouseButtonRectangleTool({createNewMeasurement:e,onImageRendered:h,pointNearTool:g,pointInsideRect:f,toolType:i},j),d.highlightTouch=d.touchTool({createNewMeasurement:e,onImageRendered:h,pointNearTool:g,pointInsideRect:f,toolType:i},j)}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(b){var c={},d={activate:function(c){a(c).off("CornerstoneToolsKeyDown",b),a(c).on("CornerstoneToolsKeyDown",b)},disable:function(c){a(c).off("CornerstoneToolsKeyDown",b)},enable:function(c){a(c).off("CornerstoneToolsKeyDown",b)},deactivate:function(c){a(c).off("CornerstoneToolsKeyDown",b)},getConfiguration:function(){return c},setConfiguration:function(a){c=a}};return d}c.keyboardTool=d}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function f(a,d,e){var f={start:b.pixelToCanvas(a,d.handles.start),end:b.pixelToCanvas(a,d.handles.end)},g=c.lineSegment.distanceToPoint(f,e);return 25>g}function g(a,c){var e=d.getToolState(a.currentTarget,h);if(void 0!==e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var g,i=d.toolStyle.getToolWidth(),j=d.textStyle.getFont(),k=d.length.getConfiguration(),l=0;l<e.data.length;l++){f.save(),k&&k.shadow&&(f.shadowColor="#000000",f.shadowOffsetX=1,f.shadowOffsetY=1);var m=e.data[l];g=m.active?d.toolColors.getActiveColor():d.toolColors.getToolColor();var n=b.pixelToCanvas(c.element,m.handles.start),o=b.pixelToCanvas(c.element,m.handles.end);f.beginPath(),f.strokeStyle=g,f.lineWidth=i,f.moveTo(n.x,n.y),f.lineTo(o.x,o.y),f.stroke(),d.drawHandles(f,c,m.handles,g),f.fillStyle=g,f.font=j;var p=" mm";c.image.rowPixelSpacing&&c.image.columnPixelSpacing||(p=" pixels");var q=(m.handles.start.x-m.handles.end.x)*(c.image.columnPixelSpacing||1),r=(m.handles.start.y-m.handles.end.y)*(c.image.rowPixelSpacing||1),s=Math.sqrt(q*q+r*r),t=""+s.toFixed(2)+p,u={x:(n.x+o.x)/2+5,y:(n.y+o.y)/2};d.drawTextBox(f,t,u.x,u.y,g),f.restore()}}}var h="length";d.length=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:g,pointNearTool:f,toolType:h}),d.lengthTouch=d.touchTool({createNewMeasurement:e,onImageRendered:g,pointNearTool:f,toolType:h})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){a(c.element).off("CornerstoneToolsMouseDrag",g),a(c.element).off("CornerstoneToolsMouseUp",d),e(c)}function e(b){a(b.element).find(".magnifyTool").hide(),document.body.style.cursor="default"}function f(b,e){return c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask)?(a(e.element).on("CornerstoneToolsMouseDrag",e,g),a(e.element).on("CornerstoneToolsMouseUp",e,d),h(e),!1):void 0}function g(a,b){return h(b),!1}function h(d){var e=a(d.element).find(".magnifyTool").get(0);void 0===e&&i(d.element);var f=c.magnify.getConfiguration(),g=f.magnifySize,h=f.magnificationLevel,j=a(d.element).find("canvas").not(".magnifyTool").get(0),k=j.getContext("2d");k.setTransform(1,0,0,1,0,0);var l=e.getContext("2d");l.setTransform(1,0,0,1,0,0);var m=b.pixelToCanvas(d.element,d.currentPoints.image);m.x=Math.max(m.x,0),m.x=Math.min(m.x,j.width),m.y=Math.max(m.y,0),m.y=Math.min(m.y,j.height),l.clearRect(0,0,g,g),l.fillStyle="transparent",l.fillRect(0,0,g,g);var n=g*h,o=g/h,p={x:m.x-.5*o,y:m.y-.5*o};l.drawImage(j,p.x,p.y,g,g,0,0,n,n),e.style.top=m.y-.5*g+"px",e.style.left=m.x-.5*g+"px",e.style.display="block",document.body.style.cursor="none"}function i(b){if(0===a(b).find(".magnifyTool").length){var d=document.createElement("canvas");d.classList.add("magnifyTool");var e=c.magnify.getConfiguration();d.width=e.magnifySize,d.height=e.magnifySize,d.style.position="absolute",b.appendChild(d)}}function j(b){a(b).find(".magnifyTool").remove()}function k(b){a(b).off("CornerstoneToolsMouseDown",f),j(b)}function l(a){var b=c.magnify.getConfiguration(b);i(a)}function m(b,c){var d={mouseButtonMask:c};a(b).off("CornerstoneToolsMouseDown",f),a(b).on("CornerstoneToolsMouseDown",d,f),i(b)}function n(b){a(b).off("CornerstoneToolsTouchDrag",g),a(b).off("CornerstoneToolsDragStart",g),j(b)}function o(b){a(b).off("CornerstoneToolsTouchDrag",g),a(b).off("CornerstoneToolsDragStart",g),a(b).on("CornerstoneToolsTouchDrag",g),a(b).on("CornerstoneToolsDragStart",g),i(b)}function p(){return r}function q(a){r=a}var r={magnifySize:100,magnificationLevel:2};c.magnify={enable:l,activate:m,deactivate:k,disable:k,getConfiguration:p,setConfiguration:q},c.magnifyTouchDrag={enable:l,activate:o,deactivate:n,disable:n}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){var d=b.getEnabledElement(a),e=c.metaData.get("imagePlane",d.image.imageId);if(e&&e.rowCosines&&e.columnCosines){var f=c.orientation.getOrientationString(e.rowCosines),g=c.orientation.getOrientationString(e.columnCosines),h=c.orientation.invertOrientationString(f),i=c.orientation.invertOrientationString(g);return{top:i,bottom:g,left:h,right:f}}}function e(a){var c,d=b.getEnabledElement(a);c={x:d.image.width/2,y:5};var e=b.pixelToCanvas(a,c);c={x:d.image.width/2,y:d.image.height-5};var f=b.pixelToCanvas(a,c);c={x:5,y:d.image.height/2};var g=b.pixelToCanvas(a,c);c={x:d.image.width-10,y:d.image.height/2};var h=b.pixelToCanvas(a,c);return{top:e,bottom:f,left:g,right:h}}function f(a,b){var f=b.element,g=d(f);if(g){var h=e(f,g),i=b.canvasContext.canvas.getContext("2d");i.setTransform(1,0,0,1,0,0);var j=c.toolColors.getToolColor(),k={top:i.measureText(g.top).width,left:i.measureText(g.left).width,right:i.measureText(g.right).width,bottom:i.measureText(g.bottom).width};c.drawTextBox(i,g.top,h.top.x-k.top/2,h.top.y,j),c.drawTextBox(i,g.left,h.left.x-k.left/2,h.left.y,j);var l=c.orientationMarkers.getConfiguration();l&&l.drawAllMarkers&&(c.drawTextBox(i,g.right,h.right.x-k.right/2,h.right.y,j),c.drawTextBox(i,g.bottom,h.bottom.x-k.bottom/2,h.bottom.y,j))}}c.orientationMarkers=c.displayTool(f)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){a(c.element).off("CornerstoneToolsMouseDrag",f),a(c.element).off("CornerstoneToolsMouseUp",d)}function e(b,e){return c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask)?(a(e.element).on("CornerstoneToolsMouseDrag",f),a(e.element).on("CornerstoneToolsMouseUp",d),!1):void 0}function f(a,c){return c.viewport.translation.x+=c.deltaPoints.page.x/c.viewport.scale,c.viewport.translation.y+=c.deltaPoints.page.y/c.viewport.scale,b.setViewport(c.element,c.viewport),!1}function g(a,c){var d=c;return d.viewport.translation.x+=d.deltaPoints.page.x/d.viewport.scale,d.viewport.translation.y+=d.deltaPoints.page.y/d.viewport.scale,b.setViewport(d.element,d.viewport),!1}c.pan=c.simpleMouseButtonTool(e),c.panTouchDrag=c.touchDragTool(g)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,c){return c.viewport.translation.x+=c.deltaPoints.page.x/c.viewport.scale,c.viewport.translation.y+=c.deltaPoints.page.y/c.viewport.scale,b.setViewport(c.element,c.viewport),!1}function e(b){a(b).off("CornerstoneToolsMultiTouchDrag",d)}function f(b){a(b).off("CornerstoneToolsMultiTouchDrag",d),a(b).on("CornerstoneToolsMultiTouchDrag",d)}c.panMultiTouch={activate:f,disable:e}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){var b={visible:!0,active:!0,handles:{end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function e(a,c,d){var e=b.pixelToCanvas(a,c.handles.end);return cornerstoneMath.point.distance(e,d)<5}function f(a,d){var e=c.getToolState(a.currentTarget,g);if(void 0!==e){var f=d.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var h,i=c.textStyle.getFont(),j=c.textStyle.getFontSize(),k=0;k<e.data.length;k++){f.save();var l=e.data[k];h=l.active?c.toolColors.getActiveColor():c.toolColors.getToolColor(),c.drawHandles(f,d,l.handles,h);var m=Math.round(l.handles.end.x),n=Math.round(l.handles.end.y),o=b.getStoredPixels(d.element,m,n,1,1),p=o[0],q=p*d.image.slope+d.image.intercept,r=c.calculateSUV(d.image,p),s={x:l.handles.end.x+3,y:l.handles.end.y-3},t=b.pixelToCanvas(d.element,s);f.font=i,f.fillStyle=h;var u=""+m+", "+n,v="SP: "+p+" MO: "+parseFloat(q.toFixed(3));r&&(v+=" SUV: "+parseFloat(r.toFixed(3))),c.drawTextBox(f,v,t.x,t.y+j+5,h),c.drawTextBox(f,u,t.x,t.y,h),f.restore()}}}var g="probe";c.probe=c.mouseButtonTool({createNewMeasurement:d,onImageRendered:f,pointNearTool:e,toolType:g}),c.probeTouch=c.touchTool({createNewMeasurement:d,onImageRendered:f,pointNearTool:e,toolType:g})}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return b}function f(a,d,e){var f=b.pixelToCanvas(a,d.handles.start),g=b.pixelToCanvas(a,d.handles.end),h={left:Math.min(f.x,g.x),top:Math.min(f.y,g.y),width:Math.abs(f.x-g.x),height:Math.abs(f.y-g.y)},i=c.rect.distanceToPoint(h,e);return 5>i}function g(a,b){for(var c=0,d=0,e=0,f=0,g=b.top;g<b.top+b.height;g++)for(var h=b.left;h<b.left+b.width;h++)c+=a[f],d+=a[f]*a[f],e++,f++;if(0===e)return{count:e,mean:0,variance:0,stdDev:0};var i=c/e,j=d/e-i*i;return{count:e,mean:i,variance:j,stdDev:Math.sqrt(j)}}function h(a,c){var e=d.getToolState(a.currentTarget,i);if(void 0!==e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var h,j=d.toolStyle.getToolWidth(),k=d.textStyle.getFont(),l=d.textStyle.getFontSize(),m=0;m<e.data.length;m++){f.save();var n=e.data[m];h=n.active?d.toolColors.getActiveColor():d.toolColors.getToolColor();var o=b.pixelToCanvas(c.element,n.handles.start),p=b.pixelToCanvas(c.element,n.handles.end),q=Math.abs(o.x-p.x),r=Math.abs(o.y-p.y),s=Math.min(o.x,p.x),t=Math.min(o.y,p.y),u=(o.x+p.x)/2,v=(o.y+p.y)/2;f.beginPath(),f.strokeStyle=h,f.lineWidth=j,f.rect(s,t,q,r),f.stroke(),d.drawHandles(f,c,n.handles,h);var w=Math.abs(n.handles.start.x-n.handles.end.x),x=Math.abs(n.handles.start.y-n.handles.end.y),y=Math.min(n.handles.start.x,n.handles.end.x),z=Math.min(n.handles.start.y,n.handles.end.y),A=b.getPixels(c.element,y,z,w,x),B={left:y,top:z,width:w,height:x},C=g(A,B),D=w*c.image.columnPixelSpacing*x*c.image.rowPixelSpacing,E="Area: "+D.toFixed(2)+" mm^2";f.font=k;var F=f.measureText(D),G=u<c.image.columns/2?u+q/2:u-q/2-F.width,H=v<c.image.rows/2?v+r/2:v-r/2;f.fillStyle=h,d.drawTextBox(f,"Mean: "+C.mean.toFixed(2),G,H-l-5,h),d.drawTextBox(f,"StdDev: "+C.stdDev.toFixed(2),G,H,h),d.drawTextBox(f,E,G,H+l+5,h),f.restore()}}}var i="rectangleRoi";d.rectangleRoi=d.mouseButtonTool({createNewMeasurement:e,onImageRendered:h,pointNearTool:f,toolType:i}),d.rectangleRoiTouch=d.touchTool({createNewMeasurement:e,onImageRendered:h,pointNearTool:f,toolType:i})}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(a){var b=a.element.getBoundingClientRect(a.element),c={x:a.currentPoints.client.x,y:a.currentPoints.client.y},d=a.element.clientWidth,e=a.element.clientHeight,f={x:c.x-b.left-d/2,y:-1*(c.y-b.top-e/2)},g=Math.atan2(f.y,f.x),h=g*(180/Math.PI),i=-1*h+90;a.viewport.rotation=i}function e(a){a.viewport.rotation+=a.deltaPoints.page.x/a.viewport.scale}function f(a){a.viewport.rotation+=a.deltaPoints.page.y/a.viewport.scale}function g(b,c){a(c.element).off("CornerstoneToolsMouseDrag",i),a(c.element).off("CornerstoneToolsMouseUp",g)}function h(b,d){return c.isMouseButtonEnabled(d.which,b.data.mouseButtonMask)?(a(d.element).on("CornerstoneToolsMouseDrag",i),a(d.element).on("CornerstoneToolsMouseUp",g),!1):void 0}function i(a,d){return c.rotate.strategy(d),b.setViewport(d.element,d.viewport),a.stopPropagation(),!1}function j(a,d){return c.rotate.strategy(d),b.setViewport(d.element,d.viewport),!1}c.rotate=c.simpleMouseButtonTool(h),c.rotate.strategies={"default":d,horizontal:e,vertical:f},c.rotate.strategy=d,c.rotateTouchDrag=c.touchDragTool(j)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,c){return c.viewport.rotation+=c.rotation,b.setViewport(c.element,c.viewport),!1}function e(b){a(b).off("CornerstoneToolsTouchRotate",d)}function f(b){a(b).off("CornerstoneToolsTouchRotate",d),a(b).on("CornerstoneToolsTouchRotate",d)}c.rotateTouch={activate:f,disable:e}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){var d=a(b).find("canvas").get(0),e=document.createElement("a");if(e.download=c,e.href=d.toDataURL(),document.createEvent){var f=document.createEvent("MouseEvents");f.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(f)}else e.fireEvent&&e.fireEvent("onclick")}c.saveAs=d}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b={visible:!0,active:!0,handles:{start:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1},middle:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0},end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!1}}};return b}function f(a,d,e){var f={start:b.pixelToCanvas(a,d.handles.start),end:b.pixelToCanvas(a,d.handles.middle)},g=c.lineSegment.distanceToPoint(f,e);return 5>g?!0:(f.start=b.pixelToCanvas(a,d.handles.middle),f.end=b.pixelToCanvas(a,d.handles.end),g=c.lineSegment.distanceToPoint(f,e),5>g)}function g(a){return Math.sqrt(Math.pow(a.x,2)+Math.pow(a.y,2))}function h(a,c){var e=d.getToolState(a.currentTarget,s);if(void 0!==e){var f=c.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var h,i=d.toolStyle.getToolWidth(),j=d.textStyle.getFont(),k=0;k<e.data.length;k++){f.save();var l=e.data[k];h=l.active?d.toolColors.getActiveColor():d.toolColors.getToolColor(),f.beginPath(),f.strokeStyle=h,f.lineWidth=i;var m=b.pixelToCanvas(c.element,l.handles.start),n=b.pixelToCanvas(c.element,l.handles.middle);f.moveTo(m.x,m.y),f.lineTo(n.x,n.y);var o=b.pixelToCanvas(c.element,l.handles.end);f.lineTo(o.x,o.y),f.stroke(),d.drawHandles(f,c,l.handles),f.fillStyle=h;var p=c.image.columnPixelSpacing||1,q=c.image.rowPixelSpacing||1,r="";c.image.rowPixelSpacing&&c.image.columnPixelSpacing||(r=" (isotropic)");var t={x:(Math.ceil(l.handles.middle.x)-Math.ceil(l.handles.start.x))*p,y:(Math.ceil(l.handles.middle.y)-Math.ceil(l.handles.start.y))*q},u={x:(Math.ceil(l.handles.end.x)-Math.ceil(l.handles.middle.x))*p,y:(Math.ceil(l.handles.end.y)-Math.ceil(l.handles.middle.y))*q},v={x:(Math.ceil(l.handles.end.x)-Math.ceil(l.handles.start.x))*p,y:(Math.ceil(l.handles.end.y)-Math.ceil(l.handles.start.y))*q},w=g(t),x=g(u),y=g(v),z=Math.acos((Math.pow(w,2)+Math.pow(x,2)-Math.pow(y,2))/(2*w*x));z*=180/Math.PI;var A=d.roundToDecimal(z,2);if(A){var B="00B0",C=A.toString()+String.fromCharCode(parseInt(B,16))+r,D=15,E=n.x+D,F=n.y+D;f.font=j;var G=f.measureText(C).width;E=n.x-m.x<0?n.x-D-G-10:n.x+D,F=n.y,d.drawTextBox(f,C,E,F,h)}f.restore()}}}function i(c){var f=e(c),g={mouseButtonMask:c.which};d.addToolState(c.element,s,f),a(c.element).off("CornerstoneToolsMouseMove",k),a(c.element).off("CornerstoneToolsMouseDrag",k),a(c.element).off("CornerstoneToolsMouseDown",l),a(c.element).off("CornerstoneToolsMouseDownActivate",j),b.updateImage(c.element),d.moveNewHandle(c,f.handles.middle,function(){f.active=!1,d.anyHandlesOutsideImage(c,f.handles)&&d.removeToolState(c.element,s,f),f.handles.end.active=!0,b.updateImage(c.element),d.moveNewHandle(c,f.handles.end,function(){f.active=!1,d.anyHandlesOutsideImage(c,f.handles)&&d.removeToolState(c.element,s,f),a(c.element).on("CornerstoneToolsMouseMove",k),a(c.element).on("CornerstoneToolsMouseDrag",k),a(c.element).on("CornerstoneToolsMouseDown",g,l),a(c.element).on("CornerstoneToolsMouseDownActivate",g,j),b.updateImage(c.element)})})}function j(a,b){return d.isMouseButtonEnabled(b.which,a.data.mouseButtonMask)?(i(b),!1):void 0}function k(a,c){if(d.toolCoordinates.setCoords(c),0===c.which){var e=d.getToolState(c.element,s);if(void 0!==e){for(var g=!1,h=0;h<e.data.length;h++){var i=c.currentPoints.canvas,j=e.data[h];d.handleActivator(c.element,j.handles,i)===!0&&(g=!0),(f(c.element,j,i)&&!j.active||!f(c.element,j,i)&&j.active)&&(j.active=!j.active,g=!0)}g===!0&&b.updateImage(c.element)}}}function l(c,e){function g(){h.active=!1,d.anyHandlesOutsideImage(e,h.handles)&&d.removeToolState(e.element,s,h),b.updateImage(e.element),a(e.element).on("CornerstoneToolsMouseMove",k)}var h;if(d.isMouseButtonEnabled(e.which,c.data.mouseButtonMask)){var i,j=e.startPoints.canvas,l=d.getToolState(c.currentTarget,s);if(void 0!==l)for(i=0;i<l.data.length;i++){h=l.data[i];var m=d.getHandleNearImagePoint(e.element,h,j);if(void 0!==m)return a(e.element).off("CornerstoneToolsMouseMove",k),h.active=!0,d.moveHandle(e,m,g),c.stopImmediatePropagation(),!1}if(void 0!==l&&void 0!==f)for(i=0;i<l.data.length;i++)if(h=l.data[i],f(e.element,h,j))return a(e.element).off("CornerstoneToolsMouseMove",k),d.moveAllHandles(c,h,l,!0),a(e.element).on("CornerstoneToolsMouseMove",k),c.stopImmediatePropagation(),!1}}function m(c){a(c).off("CornerstoneImageRendered",h),a(c).off("CornerstoneToolsMouseMove",k),a(c).off("CornerstoneToolsMouseDown",l),a(c).off("CornerstoneToolsMouseDownActivate",j),b.updateImage(c)}function n(c){a(c).off("CornerstoneImageRendered",h),a(c).off("CornerstoneToolsMouseMove",k),a(c).off("CornerstoneToolsMouseDown",l),a(c).off("CornerstoneToolsMouseDownActivate",j),a(c).on("CornerstoneImageRendered",h),b.updateImage(c)}function o(c,d){var e={mouseButtonMask:d};a(c).off("CornerstoneImageRendered",h),a(c).off("CornerstoneToolsMouseMove",k),a(c).off("CornerstoneToolsMouseDown",l),a(c).off("CornerstoneToolsMouseDownActivate",j),a(c).on("CornerstoneImageRendered",h),a(c).on("CornerstoneToolsMouseMove",e,k),a(c).on("CornerstoneToolsMouseDown",e,l),a(c).on("CornerstoneToolsMouseDownActivate",e,j),b.updateImage(c)}function p(c,d){var e={mouseButtonMask:d};a(c).off("CornerstoneImageRendered",h),a(c).off("CornerstoneToolsMouseMove",k),a(c).off("CornerstoneToolsMouseDown",l),a(c).off("CornerstoneToolsMouseDownActivate",j),a(c).on("CornerstoneImageRendered",h),a(c).on("CornerstoneToolsMouseMove",e,k),a(c).on("CornerstoneToolsMouseDown",e,l),b.updateImage(c)}function q(){return t}function r(a){t=a}var s="simpleAngle",t={};d.simpleAngle={enable:n,disable:m,activate:o,deactivate:p,getConfiguration:q,setConfiguration:r,pointNearTool:f}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(a){var b=c.textMarker.getConfiguration();if(b.current){var d={visible:!0,active:!0,text:b.current,handles:{end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}},e=b.markers.indexOf(b.current);return b.ascending?(e+=1,e>=b.markers.length&&(b.loop?e-=b.markers.length:e=-1)):(e-=1,0>e&&(b.loop?e+=b.markers.length:e=-1)),b.current=b.markers[e],d}}function e(a,c,d){var e=b.pixelToCanvas(a,c.handles.end),f={left:e.x-c.textWidth/2,top:e.y,width:c.textWidth,height:c.textHeight},g=cornerstoneMath.rect.distanceToPoint(f,d);return 10>g}function f(a,d){var e=c.getToolState(d.element,r);if(e){var f=d.canvasContext.canvas.getContext("2d");f.setTransform(1,0,0,1,0,0);for(var g,h=c.textStyle.getFont(),i=c.textStyle.getFontSize(),j=0;j<e.data.length;j++){var k=e.data[j];g=k.active?c.toolColors.getActiveColor():c.toolColors.getToolColor(),f.save(),f.font=h,f.fillStyle=g;var l=f.measureText(k.text);k.textWidth=l.width,k.textHeight=i;var m={x:k.handles.end.x-k.textWidth/2,y:k.handles.end.y},n=b.pixelToCanvas(d.element,m);c.drawTextBox(f,k.text,n.x,n.y,g),f.restore()}}}function g(e){var f=d(e);if(f){var g={mouseButtonMask:e.which};c.addToolState(e.element,r,f),a(e.element).off("CornerstoneToolsMouseMove",j),a(e.element).off("CornerstoneToolsMouseDown",k),a(e.element).off("CornerstoneToolsMouseDownActivate",i),b.updateImage(e.element),c.moveNewHandle(e,f.handles.end,function(){f.active=!1,c.anyHandlesOutsideImage(e,f.handles)&&c.removeToolState(e.element,r,f),a(e.element).on("CornerstoneToolsMouseMove",g,j),a(e.element).on("CornerstoneToolsMouseDown",g,k),a(e.element).on("CornerstoneToolsMouseDownActivate",g,i),b.updateImage(e.element)})}}function h(a,d){function f(a,c){a.text=c,b.updateImage(d.element)}var g;if(c.isMouseButtonEnabled(d.which,a.data.mouseButtonMask)){var h,i=c.textMarker.getConfiguration(),j=d.startPoints.canvas,k=c.getToolState(a.currentTarget,r);if(k)for(h=0;h<k.data.length;h++)if(g=k.data[h],e(d.element,g,j))return i.changeTextCallback(g,f),a.stopImmediatePropagation(),!1;return!1}}function i(a,b){return c.isMouseButtonEnabled(b.which,a.data.mouseButtonMask)?(g(b),!1):void 0}function j(a,d){if(c.toolCoordinates.setCoords(d),0===d.which){var f=c.getToolState(d.element,r);if(void 0!==f){for(var g=d.startPoints.canvas,h=!1,i=0;i<f.data.length;i++){var j=f.data[i];
c.handleActivator(d.element,j.handles,g)===!0&&(h=!0),(e(d.element,j,g)&&!j.active||!e(d.element,j,g)&&j.active)&&(j.active=!j.active,h=!0)}h===!0&&b.updateImage(d.element)}}}function k(d,f){function g(){h.active=!1,c.anyHandlesOutsideImage(f,h.handles)&&c.removeToolState(f.element,r,h),b.updateImage(f.element),a(f.element).on("CornerstoneToolsMouseMove",j)}var h;if(c.isMouseButtonEnabled(f.which,d.data.mouseButtonMask)){var i,k=f.startPoints.canvas,l=c.getToolState(d.currentTarget,r);if(void 0!==l)for(i=0;i<l.data.length;i++){h=l.data[i];var m=c.getHandleNearImagePoint(f.element,h,k);if(void 0!==m)return h.active=!0,f.event.shiftKey?(c.removeToolState(f.element,r,h),b.updateImage(f.element),d.stopImmediatePropagation(),!1):(a(f.element).off("CornerstoneToolsMouseMove",j),c.moveHandle(f,m,g),d.stopImmediatePropagation(),!1)}if(void 0!==l&&void 0!==e)for(i=0;i<l.data.length;i++)if(h=l.data[i],e(f.element,h,k))return a(f.element).off("CornerstoneToolsMouseMove",j),c.moveAllHandles(d,h,l,!0),a(f.element).on("CornerstoneToolsMouseMove",j),d.stopImmediatePropagation(),!1}}function l(c){a(c).off("CornerstoneImageRendered",f),a(c).off("CornerstoneToolsMouseMove",j),a(c).off("CornerstoneToolsMouseDown",k),a(c).off("CornerstoneToolsMouseDownActivate",i),a(c).off("CornerstoneToolsMouseDoubleClick",h),b.updateImage(c)}function m(c){a(c).off("CornerstoneImageRendered",f),a(c).off("CornerstoneToolsMouseMove",j),a(c).off("CornerstoneToolsMouseDown",k),a(c).off("CornerstoneToolsMouseDownActivate",i),a(c).off("CornerstoneToolsMouseDoubleClick",h),a(c).on("CornerstoneImageRendered",f),b.updateImage(c)}function n(c,d){var e={mouseButtonMask:d};a(c).off("CornerstoneImageRendered",f),a(c).off("CornerstoneToolsMouseMove",j),a(c).off("CornerstoneToolsMouseDown",k),a(c).off("CornerstoneToolsMouseDownActivate",i),a(c).off("CornerstoneToolsMouseDoubleClick",h),a(c).on("CornerstoneImageRendered",f),a(c).on("CornerstoneToolsMouseMove",e,j),a(c).on("CornerstoneToolsMouseDown",e,k),a(c).on("CornerstoneToolsMouseDownActivate",e,i),a(c).on("CornerstoneToolsMouseDoubleClick",e,h),b.updateImage(c)}function o(c,d){var e={mouseButtonMask:d};a(c).off("CornerstoneImageRendered",f),a(c).off("CornerstoneToolsMouseMove",j),a(c).off("CornerstoneToolsMouseDown",k),a(c).off("CornerstoneToolsMouseDownActivate",i),a(c).off("CornerstoneToolsMouseDoubleClick",h),a(c).on("CornerstoneImageRendered",f),a(c).on("CornerstoneToolsMouseMove",e,j),a(c).on("CornerstoneToolsMouseDown",e,k),a(c).on("CornerstoneToolsMouseDoubleClick",e,h),b.updateImage(c)}function p(){return s}function q(a){s=a}var r="textMarker",s={};c.textMarker={enable:m,disable:l,activate:n,deactivate:o,getConfiguration:p,setConfiguration:q,pointNearTool:e}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){a(c.element).off("CornerstoneToolsMouseDrag",g),a(c.element).off("CornerstoneToolsMouseUp",d)}function e(b,e){return c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask)?(a(e.element).on("CornerstoneToolsMouseDrag",g),a(e.element).on("CornerstoneToolsMouseUp",d),!1):void 0}function f(a){var b=a.image.maxPixelValue-a.image.minPixelValue,c=b/1024,d=a.deltaPoints.page.x*c,e=a.deltaPoints.page.y*c;a.viewport.voi.windowWidth+=d,a.viewport.voi.windowCenter+=e}function g(a,d){return c.wwwc.strategy(d),b.setViewport(d.element,d.viewport),!1}function h(a,d){var e=d,f=e.image.maxPixelValue-e.image.minPixelValue,g=f/1024,h=e.deltaPoints.page.x*g,i=e.deltaPoints.page.y*g,j=c.wwwc.getConfiguration();j.orientation?0===j.orientation?(e.viewport.voi.windowWidth+=h,e.viewport.voi.windowCenter+=i):(e.viewport.voi.windowWidth+=i,e.viewport.voi.windowCenter+=h):(e.viewport.voi.windowWidth+=h,e.viewport.voi.windowCenter+=i),b.setViewport(e.element,e.viewport)}c.wwwc=c.simpleMouseButtonTool(e),c.wwwc.strategies={"default":f},c.wwwc.strategy=f,c.wwwcTouchDrag=c.touchDragTool(h)}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a,b,c){var d=a.length;if(2>d)return{min:b,max:c};for(var e=c,f=b,g=0;d>g;g++){var h=a[g];e=Math.min(e,h),f=Math.max(f,h)}return{min:e,max:f}}function f(b,c){a(c.element).off("CornerstoneToolsMouseMove",k),a(c.element).off("CornerstoneToolsMouseDrag",k),a(c.element).off("CornerstoneToolsMouseUp",f),a(c.element).off("CornerstoneToolsMouseClick",f);var e=d.getToolState(c.element,q);if(e&&e.data.length){var h={x:c.currentPoints.image.x,y:c.currentPoints.image.y};e.data[0].endPoint=h,g(c);var j={mouseButtonMask:c.which};a(c.element).on("CornerstoneToolsMouseDown",j,i)}}function g(a){var c=d.getToolState(a.element,q);if(void 0!==c&&c.data.length){var f=c.data[0].startPoint,g=c.data[0].endPoint,h=Math.abs(f.x-g.x),i=Math.abs(f.y-g.y),j=Math.min(f.x,g.x),k=Math.min(f.y,g.y);j=Math.max(j,0),j=Math.min(j,a.image.width),k=Math.max(k,0),k=Math.min(k,a.image.height),h=Math.floor(Math.min(h,Math.abs(a.image.width-j))),i=Math.floor(Math.min(i,Math.abs(a.image.height-k)));var l=b.getPixels(a.element,j,k,h,i),m=e(l,a.image.minPixelValue,a.image.maxPixelValue),n=b.getViewport(a.element);n.voi.windowWidth=Math.abs(m.max-m.min),n.voi.windowCenter=(m.max-m.min)/2,b.setViewport(a.element,n),c.data=[],b.updateImage(a.element)}}function h(b,c){var d=c.element;a(d).off("CornerstoneToolsMouseMove"),a(d).off("CornerstoneToolsMouseDrag"),a(d).on("CornerstoneToolsMouseMove",k),a(d).on("CornerstoneToolsMouseDrag",k),a(d).on("CornerstoneToolsMouseClick",f),"CornerstoneToolsMouseDrag"===b.type&&a(d).on("CornerstoneToolsMouseUp",f)}function i(b,c){return d.isMouseButtonEnabled(c.which,b.data.mouseButtonMask)?(a(c.element).on("CornerstoneToolsMouseDrag",c,h),a(c.element).on("CornerstoneToolsMouseMove",c,h),a(c.element).on("CornerstoneToolsMouseUp",f),a(c.element).off("CornerstoneToolsMouseDown"),j(c),!1):void 0}function j(a){var b=d.getToolState(a.element,q);b&&b.data&&(b.data=[]);var c={startPoint:{x:a.currentPoints.image.x,y:a.currentPoints.image.y}};d.addToolState(a.element,q,c)}function k(a,c){var e=d.getToolState(c.element,q);if(void 0!==e&&e.data.length){var f={x:c.currentPoints.image.x,y:c.currentPoints.image.y};e.data[0].endPoint=f,b.updateImage(c.element)}}function l(c,e){var f=d.getToolState(e.element,q);if(void 0!==f&&f.data.length){var g=f.data[0].startPoint,h=f.data[0].endPoint;if(g){var i=a(e.element).find("canvas").get(0),j=i.getContext("2d");j.setTransform(1,0,0,1,0,0);var k=d.toolColors.getActiveColor(),l=b.pixelToCanvas(e.element,g),m=b.pixelToCanvas(e.element,h),n=Math.min(l.x,m.x),o=Math.min(l.y,m.y),p=Math.abs(l.x-m.x),r=Math.abs(l.y-m.y),s=d.toolStyle.getToolWidth();j.save(),j.beginPath(),j.strokeStyle=k,j.lineWidth=s,j.rect(n,o,p,r),j.stroke(),j.restore()}}}function m(c){a(c).off("CornerstoneToolsMouseDown",i),a(c).off("CornerstoneImageRendered",l),b.updateImage(c)}function n(c,e){var g={mouseButtonMask:e},h=d.getToolState(c,q);if(!h){var j=[];d.addToolState(c,q,j)}a(c).off("CornerstoneToolsMouseDown",i),a(c).off("CornerstoneToolsMouseUp",f),a(c).off("CornerstoneToolsMouseDrag",k),a(c).off("CornerstoneImageRendered",l),a(c).on("CornerstoneToolsMouseDown",g,i),a(c).on("CornerstoneImageRendered",l),b.updateImage(c)}function o(b){a(b).off("CornerstoneToolsTouchDrag",k),a(b).off("CornerstoneToolsDragStart",j),a(b).off("CornerstoneToolsDragEnd",g),a(b).off("CornerstoneImageRendered",l)}function p(b){var c=d.getToolState(b,q);if(void 0===c){var e=[];d.addToolState(b,q,e)}a(b).off("CornerstoneToolsTouchDrag",k),a(b).off("CornerstoneToolsDragStart",j),a(b).off("CornerstoneToolsDragEnd",g),a(b).off("CornerstoneImageRendered",l),a(b).on("CornerstoneToolsTouchDrag",k),a(b).on("CornerstoneToolsDragStart",j),a(b).on("CornerstoneToolsDragEnd",g),a(b).on("CornerstoneImageRendered",l)}var q="wwwcRegion";d.wwwcRegion={activate:n,deactivate:m,disable:m},d.wwwcRegionTouch={activate:p,deactivate:o,disable:o}}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){if(0!==b.rotation){var c=b.rotation*Math.PI/180,d=Math.cos(c),e=Math.sin(c),f=a.x*d-a.y*e,g=a.x*e+a.y*d;a.x=f,a.y=g}return b.hflip&&(a.x*=-1),b.vflip&&(a.y*=-1),a}function e(a,d,e){var f,g=c.zoom.getConfiguration(),h=1.7,i=Math.log(d.scale)/Math.log(h);f=g.invert===!0?i-e:i+e;var j=Math.pow(h,f);d.scale=j,g.maxScale&&j>g.maxScale?d.scale=g.maxScale:g.minScale&&j<g.minScale&&(d.scale=g.minScale),b.setViewport(a,d)}function f(b,c){a(c.element).off("CornerstoneToolsMouseDrag",h),a(c.element).off("CornerstoneToolsMouseUp",f)}function g(b,d){return c.isMouseButtonEnabled(d.which,b.data.mouseButtonMask)?(a(d.element).on("CornerstoneToolsMouseDrag",h),a(d.element).on("CornerstoneToolsMouseUp",f),!1):void 0}function h(a,e){var f=e.deltaPoints.page.y/100;c.zoom.strategy(e.element,e.viewport,f);var g=b.pageToPixel(e.element,e.startPoints.page.x,e.startPoints.page.y),h={x:e.startPoints.image.x-g.x,y:e.startPoints.image.y-g.y};return h=d(h,e.viewport),e.viewport.translation.x-=h.x,e.viewport.translation.y-=h.y,b.setViewport(e.element,e.viewport),!1}function i(a,b){var d=-b.direction/4;c.zoom.strategy(b.element,b.viewport,d)}function j(a,d){var e=d.direction/4,f=d.viewport,g=c.zoom.getConfiguration(),h=1.7,i=Math.log(f.scale)/Math.log(h),j=i+e,k=Math.pow(h,j);f.scale=k,g.maxScale&&k>g.maxScale?f.scale=g.maxScale:g.minScale&&k<g.minScale&&(f.scale=g.minScale),b.setViewport(d.element,f)}function k(a,e){var f=e,g=f.deltaPoints.page.y/100;c.zoom.strategy(f.element,f.viewport,g);var h=b.pageToPixel(f.element,f.startPoints.page.x,f.startPoints.page.y),i={x:f.startPoints.image.x-h.x,y:f.startPoints.image.y-h.y};return i=d(i,f.viewport),f.viewport.translation.x-=i.x,f.viewport.translation.y-=i.y,b.setViewport(f.element,f.viewport),!1}c.zoom=c.simpleMouseButtonTool(g),c.zoom.strategies={"default":e},c.zoom.strategy=e,c.zoomWheel=c.mouseWheelTool(i),c.zoomTouchPinch=c.touchPinchTool(j),c.zoomTouchDrag=c.touchDragTool(k)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(c){var d=c.currentTarget,e=b.pageToPixel(d,h,i);c=window.event||c;var f={element:d,viewport:b.getViewport(d),image:b.getEnabledElement(d).image,pageX:h,pageY:i,imageX:e.x,imageY:e.y,keyCode:c.keyCode,which:c.which};"keydown"===c.type?a(d).trigger("CornerstoneToolsKeyDown",f):"keypress"===c.type?a(d).trigger("CornerstoneToolsKeyPress",f):"keyup"===c.type&&a(d).trigger("CornerstoneToolsKeyUp",f)}function e(a){h=a.pageX||a.originalEvent.pageX,i=a.pageY||a.originalEvent.pageY}function f(b){a(b).bind(j,d),a(b).on("mousemove",e)}function g(b){a(b).unbind(j,d)}var h,i,j="keydown keypress keyup";c.keyboardInput={enable:f,disable:g}}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a,b){var d=a.image,e={left:0,top:0,width:d.width,height:d.height},f=!1;return Object.keys(b).forEach(function(a){var d=b[a];c.point.insideRect(d,e)===!1&&(f=!0)}),f}d.anyHandlesOutsideImage=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b){"use strict";function c(c,e,f,g,h){c.strokeStyle=g,Object.keys(f).forEach(function(g){var i=f[g];if(i.active||i.highlight){c.beginPath(),c.lineWidth=i.active?b.toolStyle.getActiveWidth():b.toolStyle.getToolWidth();var j=a.pixelToCanvas(e.element,i);c.arc(j.x,j.y,d,0,2*Math.PI),h&&(c.fillStyle=h,c.fill()),c.stroke()}})}var d=6;b.drawHandles=c}(cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(a,d,e){var f;return Object.keys(d.handles).forEach(function(g){var h=d.handles[g],i=b.pixelToCanvas(a,h),j=c.point.distanceSquared(i,e);return 25>j?void(f=h):void 0}),f}d.getHandleNearImagePoint=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c,d){"use strict";function e(a,d,e){var f;return Object.keys(d).forEach(function(g){var h=d[g],i=b.pixelToCanvas(a,h),j=c.point.distance(i,e);return 36>=j?void(f=h):void 0}),f}function f(a){var b;return Object.keys(a).forEach(function(c){var d=a[c];return d.active===!0?void(b=d):void 0}),b}function g(a,b,c){var d=f(b),g=e(a,b,c);return d!==g?(void 0!==g&&(g.active=!0),void 0!==d&&(d.active=!1),!0):!1}d.handleActivator=g}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(c,d,e,f){function g(a,c){d.active=!0,d.x=c.currentPoints.image.x,d.y=c.currentPoints.image.y,f&&(d.x=Math.max(d.x,0),d.x=Math.min(d.x,c.image.width),d.y=Math.max(d.y,0),d.y=Math.min(d.y,c.image.height)),b.updateImage(i)}function h(){d.active=!1,a(i).off("CornerstoneToolsMouseDrag",g),a(i).off("CornerstoneToolsMouseUp",h),b.updateImage(i),e()}var i=c.element;a(i).on("CornerstoneToolsMouseDrag",g),a(i).on("CornerstoneToolsMouseUp",h)}c.moveHandle=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(c,d,e){function f(a,c){d.active=!0;var e=c;d.x=e.currentPoints.image.x,d.y=e.currentPoints.image.y,b.updateImage(h)}function g(){d.active=!1,a(h).off("CornerstoneToolsTouchDrag",f),a(h).off("CornerstoneToolsDragEnd",g),b.updateImage(h),e()}var h=c.element;a(h).on("CornerstoneToolsTouchDrag",f),a(h).on("CornerstoneToolsDragEnd",g)}c.touchMoveHandle=d}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(d,e,f,g,h){function i(a,c){return e.active=!0,Object.keys(e.handles).forEach(function(a){var b=e.handles[a];b.x+=c.deltaPoints.image.x,b.y+=c.deltaPoints.image.y,h&&(b.x=Math.max(b.x,0),b.x=Math.min(b.x,c.image.width),b.y=Math.max(b.y,0),b.y=Math.min(b.y,c.image.height))}),b.updateImage(l),!1}function j(d,h){if(e.active=!1,e.invalidated=!0,a(l).off("CornerstoneToolsMouseDrag",i),a(l).off("CornerstoneToolsMouseUp",j),g===!0){var k=h.image,m=!1,n={top:0,left:0,width:k.width,height:k.height};if(Object.keys(e.handles).forEach(function(a){var b=e.handles[a];return b.active=!1,c.point.insideRect(b,n)===!1?void(m=!0):void 0}),m){var o=-1;f.data.forEach(function(a,b){return a===e?void(o=b):void 0}),-1!==o&&f.data.splice(o,1)}}b.updateImage(l)}var k=d,l=k.element;return a(l).on("CornerstoneToolsMouseDrag",i),a(l).on("CornerstoneToolsMouseUp",j),!0}d.moveAllHandles=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b,c){"use strict";function d(c,d,e,f){function g(a,c){d.active=!0,d.x=c.currentPoints.image.x,d.y=c.currentPoints.image.y,f&&(d.x=Math.max(d.x,0),d.x=Math.min(d.x,c.image.width),d.y=Math.max(d.y,0),d.y=Math.min(d.y,c.image.height)),b.updateImage(j)}function h(b){a(j).off("CornerstoneToolsMouseMove"),a(j).off("CornerstoneToolsMouseDrag"),a(j).on("CornerstoneToolsMouseMove",g),a(j).on("CornerstoneToolsMouseDrag",g),a(j).on("CornerstoneToolsMouseClick",i),"CornerstoneToolsMouseDrag"===b.type&&a(j).on("CornerstoneToolsMouseUp",i)}function i(){a(j).off("CornerstoneToolsMouseMove",g),a(j).off("CornerstoneToolsMouseDrag",g),a(j).off("CornerstoneToolsMouseClick",i),a(j).off("CornerstoneToolsMouseUp",i),d.active=!1,b.updateImage(j),e()}var j=c.element;a(j).on("CornerstoneToolsMouseDrag",h),a(j).on("CornerstoneToolsMouseMove",h)}c.moveNewHandle=d}($,cornerstone,cornerstoneTools),function(a,b,c,d){"use strict";function e(d,e,f,g){function h(a,c){return e.active=!0,Object.keys(e.handles).forEach(function(a){var b=e.handles[a];b.x+=c.deltaPoints.image.x,b.y+=c.deltaPoints.image.y}),b.updateImage(j),!1}function i(d,k){if(e.active=!1,e.invalidated=!1,a(j).off("CornerstoneToolsTouchDrag",h),a(j).off("CornerstoneToolsDragEnd",i),g===!0){var l=k.image,m=!1,n={top:0,left:0,width:l.width,height:l.height};if(Object.keys(e.handles).forEach(function(a){var b=e.handles[a];return c.point.insideRect(b,n)===!1?void(m=!0):void 0}),m){for(var o=-1,p=0;p<f.data.length;p++)f.data[p]===e&&(o=p);-1!==o&&f.data.splice(o,1)}}b.updateImage(j)}var j=d.element;return a(j).on("CornerstoneToolsTouchDrag",h),a(j).on("CornerstoneToolsDragEnd",i),!0}d.touchMoveAllHandles=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a,b){"use strict";function c(){var b=this;b.samples=[],this.set=function(c){b.samples=c,a(b).trigger("CornerstoneLineSampleUpdated")}}b.LineSampleMeasurement=c}($,cornerstoneTools),function(a,b){"use strict";function c(){var b=this;b.measurements=[],this.add=function(c){var d=b.measurements.push(c),e={index:d,measurement:c};a(b).trigger("CornerstoneMeasurementAdded",e)},this.remove=function(c){var d=b.measurements[c];b.measurements.splice(c,1);var e={index:c,measurement:d};a(b).trigger("CornerstoneMeasurementRemoved",e)}}b.MeasurementManager=new c}($,cornerstoneTools),function(a,b,c){"use strict";function d(a){g.push(a)}function e(a){var b=g.indexOf(a);-1!==b&&g.splice(b,1)}function f(b,c){var d;return a.each(g,function(a,e){return d=e(b,c),void 0!==d?!0:void 0}),d}var g=[];c.metaData={addProvider:d,removeProvider:e,get:f}}($,cornerstone,cornerstoneTools),function(a,b){"use strict";function c(b){for(var c="",d=b.x<0?"R":"L",e=b.y<0?"A":"P",f=b.z<0?"F":"H",g=new a.Vector3(Math.abs(b.x),Math.abs(b.y),Math.abs(b.z)),h=0;3>h;h++)if(g.x>1e-4&&g.x>g.y&&g.x>g.z)c+=d,g.x=0;else if(g.y>1e-4&&g.y>g.x&&g.y>g.z)c+=e,g.y=0;else{if(!(g.z>1e-4&&g.z>g.x&&g.z>g.y))break;c+=f,g.z=0}return c}b.orientation.getOrientationString=c}(cornerstoneMath,cornerstoneTools),function(a){"use strict";function b(a){var b=a.replace("H","f");return b=b.replace("F","h"),b=b.replace("R","l"),b=b.replace("L","r"),b=b.replace("A","p"),b=b.replace("P","a"),b=b.toUpperCase()}a.orientation.invertOrientationString=b}(cornerstoneTools),function(a){"use strict";function b(b,c){var d=c.imagePositionPatient,e=a.projectPatientPointToImagePlane(d,b),f=a.imagePointToPatientPoint({x:c.columns,y:c.rows},c),g=a.projectPatientPointToImagePlane(f,b),h={start:{x:e.x,y:e.y},end:{x:g.x,y:g.y}};return h}a.referenceLines.calculateReferenceLine=b}(cornerstoneTools),function(a,b,c){"use strict";function d(d,e){var f=c.getToolState(d.currentTarget,g);if(void 0!==f){var h=f.data[0].synchronizationContext,i=h.getSourceElements(),j=f.data[0].renderer,k=e.canvasContext.canvas.getContext("2d");b.setToPixelCoordinateSystem(e.enabledElement,k),a.each(i,function(a,b){b!==d.currentTarget&&j(k,e,d.currentTarget,b)})}}function e(e,f,h){h=h||c.referenceLines.renderActiveReferenceLine,c.addToolState(e,g,{synchronizationContext:f,renderer:h}),a(e).on("CornerstoneImageRendered",d),b.updateImage(e)}function f(c){a(c).off("CornerstoneImageRendered",d),b.updateImage(c)}var g="referenceLines";c.referenceLines.tool={enable:e,disable:f}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d,e,f){var g=b.getEnabledElement(e).image,h=b.getEnabledElement(f).image;if(void 0!==g&&void 0!==h){var i=c.metaData.get("imagePlane",g.imageId),j=c.metaData.get("imagePlane",h.imageId);if(i.frameOfReferenceUID===j.frameOfReferenceUID){var k=i.rowCosines.clone().cross(i.columnCosines),l=j.rowCosines.clone().cross(j.columnCosines),m=k.angleTo(l);if(m=Math.abs(m),!(.5>m)){var n=c.referenceLines.calculateReferenceLine(i,j),o=b.pixelToCanvas(d.element,n.start),p=b.pixelToCanvas(d.element,n.end),q=c.toolColors.getActiveColor(),r=c.toolStyle.getToolWidth();a.setTransform(1,0,0,1,0,0),a.save(),a.beginPath(),a.strokeStyle=q,a.lineWidth=r,a.moveTo(o.x,o.y),a.lineTo(p.x,p.y),a.stroke(),a.restore()}}}}c.referenceLines.renderActiveReferenceLine=d}($,cornerstone,cornerstoneTools),function(a,b){"use strict";function c(){var a,b=navigator.userAgent,c=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(c[1])?(a=/\brv[ :]+(\d+)/g.exec(b)||[],"IE "+(a[1]||"")):"Chrome"===c[1]&&(a=b.match(/\b(OPR|Edge)\/(\d+)/),null!==a)?a.slice(1).join(" ").replace("OPR","Opera"):(c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(a=b.match(/version\/(\d+)/i))&&c.splice(1,1,a[1]),c.join(" "))}function d(){var a=b.stackPrefetch.getConfiguration();if(a.maxSimultaneousRequests)return a.maxSimultaneousRequests;var d=c(),f=d.split(" "),g=f[0],h=f[1],i=e[g];return i?i[h]?i[h]:i["default"]:e["default"]}var e={"default":6,IE:{9:6,10:8,"default":8},Firefox:{"default":6},Opera:{10:8,11:6,12:6,"default":6},Chrome:{"default":6},Safari:{"default":4}};b.getMaxSimultaneousRequests=d}(cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(d,e){if(void 0===d)throw"playClip: element must not be undefined";void 0===e&&(e=30);var g=c.getToolState(d,"stack");if(void 0!==g&&void 0!==g.data&&0!==g.data.length){var h,i=g.data[0],j=c.getToolState(d,f);void 0===j||0===j.data.length?(h={intervalId:void 0,framesPerSecond:e,lastFrameTimeStamp:void 0,frameRate:0,loop:!0},c.addToolState(d,f,h)):(h=j.data[0],h.framesPerSecond=e),void 0===h.intervalId&&(h.intervalId=setInterval(function(){var e=i.currentImageIdIndex;if(h.framesPerSecond>0?e++:e--,!h.loop&&(e>=i.imageIds.length||0>e)){var f={element:d},g=a.Event("CornerstoneToolsClipStopped",f);return a(d).trigger(g,f),clearInterval(h.intervalId),void(h.intervalId=void 0)}if(e>=i.imageIds.length&&(e=0),0>e&&(e=i.imageIds.length-1),e!==i.currentImageIdIndex){var j=c.loadHandlerManager.getStartLoadHandler(),k=c.loadHandlerManager.getEndLoadHandler(),l=c.loadHandlerManager.getErrorLoadingHandler();j&&j(d);var m=b.getViewport(d);b.loadAndCacheImage(i.imageIds[e]).then(function(a){i.currentImageIdIndex=e,b.displayImage(d,a,m),k&&k(d)},function(a){var b=i.imageIds[e];l&&l(d,b,a)})}},1e3/Math.abs(h.framesPerSecond)))}}function e(a){var b,d=c.getToolState(a,f);void 0!==d&&0!==d.data.length&&(b=d.data[0],clearInterval(b.intervalId),b.intervalId=void 0)}var f="playClip";c.playClip=d,c.stopClip=e}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){clearTimeout(n),n=setTimeout(function(){var b=c.getToolState(a,"stack");if(b&&b.data&&b.data.length){var d=c.getToolState(a,o);if(d&&d.data&&d.data.length){var e=d.data[0];e.indicesToRequest.length>0&&!e.enabled&&(console.log("Re-enabling prefetch"),e.enabled=!0,g(a))}}},50)}function e(a,b){a=a||0,b=b||0;var c=[],d=b-a+1;for(d=d>0?d:0;d--;)c[d]=b--;return c}function f(a,b){var c=[],d=[];return a.forEach(function(a){b>a?c.push(a):a>b&&d.push(a)}),{low:a.indexOf(q(c)),high:a.indexOf(r(d))}}function g(d){function e(a){var b=l.indicesToRequest.indexOf(a);b>-1&&l.indicesToRequest.splice(b,1)}function g(){var a,b=f(l.indicesToRequest,j.currentImageIdIndex);a=l.direction<0?l.indicesToRequest[b.low]:l.indicesToRequest[b.high];var c=j.imageIds[a];return e(a),c}function h(e){if(e&&a(d).find("canvas").length){try{b.getEnabledElement(d)}catch(f){return}var i=c.getToolState(d,o);if(i){var j=i.data[0];if(j.enabled){j.numCurrentRequests+=1;var k=b.imageCache.getImagePromise(e),l=c.loadHandlerManager.getErrorLoadingHandler();k&&k.then(function(){return console.log("Already in Cache: "+e),j.numCurrentRequests-=1,j.indicesToRequest.length?void setTimeout(function(){var a=g();a&&h(a)},1):void(j.enabled=!1)},function(a){l(d,e,a,"stackPrefetch")}),b.loadAndCacheImage(e).then(function(){j.numCurrentRequests-=1,j.indicesToRequest.length?setTimeout(function(){var a=g();a&&h(a)},1):j.enabled=!1},function(a){l(d,e,a,"stackPrefetch")})}}}}var i=c.getToolState(d,"stack");if(i&&i.data&&i.data.length){var j=i.data[0],k=c.getToolState(d,o);if(k){var l=k.data[0];if(0===l.indicesToRequest.length&&(l.enabled=!1),l.enabled!==!1){var m=l.indicesToRequest.slice();m.forEach(function(a){var c=j.imageIds[a];if(c){var d=b.imageCache.getImagePromise(c);void 0!==d&&"resolved"===d.state()&&e(a)}}),l.numCurrentRequests=0;for(var n=c.getMaxSimultaneousRequests(),p=0;n>p;p++)if(l.enabled&&l.indicesToRequest.length){var q=g();h(q)}}}}}function h(a){console.log("CornerstoneImageCacheFull full, stopping");var b=a.data.element,d=c.getToolState(b,o);d&&d.data.length&&(d.data[0].enabled=!1)}function i(a,b){var d=a.data.element,e=c.getToolState(d,"stack");if(void 0!==e&&void 0!==e.data&&0!==e.data.length){var f=e.data[0],g=f.imageIds.indexOf(b.imageId);if(g>-1){var h=c.getToolState(d,o);h.data[0].indicesToRequest.push(g)}}}function j(d){var f=c.getToolState(d,o);f=[];var j=c.getToolState(d,"stack");if(j&&j.data&&j.data.length){var k=j.data[0];f={indicesToRequest:e(0,k.imageIds.length-1),enabled:!0,deferredInProgress:[]};var l=f.indicesToRequest.indexOf(k.currentImageIdIndex);f.indicesToRequest.splice(l,1),c.addToolState(d,o,f),g(d),a(b).off("CornerstoneImageCacheFull",h),a(b).on("CornerstoneImageCacheFull",{element:d},h),a(b).off("CornerstoneImageCachePromiseRemoved",i),a(b).on("CornerstoneImageCachePromiseRemoved",{element:d},i)}}function k(d){a(b).off("CornerstoneImageCacheFull",h),a(b).off("CornerstoneImageCachePromiseRemoved",i);var e=c.getToolState(d,o);e&&e.data.length&&(e.data[0].enabled=!1,clearTimeout(n))}function l(){return p}function m(a){p=a}var n,o="stackPrefetch",p={},q=function(a){return Math.max.apply(null,a)},r=function(a){return Math.min.apply(null,a)};c.stackPrefetch={enable:j,disable:k,getConfiguration:l,setConfiguration:m,reenablePrefetch:d}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){a(c.element).off("CornerstoneToolsMouseDrag",f),a(c.element).off("CornerstoneToolsMouseUp",d)}function e(b,e){if(c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask)){var g={deltaY:0,options:b.data.options};return a(e.element).on("CornerstoneToolsMouseDrag",g,f),a(e.element).on("CornerstoneToolsMouseUp",d),b.stopImmediatePropagation(),!1}}function f(b,d){b.data.deltaY+=d.deltaPoints.page.y;var e=d.element,f=c.getToolState(d.element,"stack");if(void 0!==f&&void 0!==f.data&&0!==f.data.length){var g=f.data[0],h=a(d.element).height()/Math.max(g.imageIds.length,8);if(void 0!==b.data.options&&void 0!==b.data.options.stackScrollSpeed&&(h=b.data.options.stackScrollSpeed),b.data.deltaY>=h||b.data.deltaY<=-h){var i=b.data.deltaY/h,j=b.data.deltaY%h,k=Math.round(i);b.data.deltaY=j,c.scroll(e,k)}return!1}}function g(a,b){var d=-b.direction;c.scroll(b.element,d)}function h(a,b){var d=b.element;b.deltaY=b.deltaY||0,b.deltaY+=b.deltaPoints.page.y;var e=c.getToolState(b.element,"stack");if(void 0!==e&&void 0!==e.data&&0!==e.data.length){if(b.deltaY>=3||b.deltaY<=-3){var f=b.deltaY/3,g=b.deltaY%3,h=Math.round(f);b.deltaY=g,c.scroll(d,h)}return!1}}c.stackScroll=c.simpleMouseButtonTool(e),c.stackScrollWheel=c.mouseWheelTool(g),c.stackScrollTouchDrag=c.touchDragTool(h)}($,cornerstone,cornerstoneTools),function(a){"use strict";function b(b,d){var e=d.keyCode;if(e===c.UP||e===c.DOWN){var f=1;e===c.DOWN&&(f=-1),a.scroll(d.element,f)}}var c={UP:38,DOWN:40};a.stackScrollKeyboard=a.keyboardTool(b)}(cornerstoneTools),function(a,b,c){"use strict";function d(){function a(a,b,c){d.hasOwnProperty(a)===!1&&(d[a]={});var e=d[a];e.hasOwnProperty(b)===!1&&(e[b]={data:[]});var f=e[b];f.data.push(c)}function b(a,b){if(d.hasOwnProperty(a)!==!1){var c=d[a];if(c.hasOwnProperty(b)!==!1){var e=c[b];return e}}}function c(a,b,c){if(d.hasOwnProperty(a)!==!1){var e=d[a];if(e.hasOwnProperty(b)!==!1){for(var f=e[b],g=-1,h=0;h<f.data.length;h++)f.data[h]===c&&(g=h);-1!==g&&f.data.splice(g,1)}}}var d={},e={get:b,add:a,remove:c};return e}var e=d();c.newFrameOfReferenceSpecificToolStateManager=d,c.globalFrameOfReferenceSpecificToolStateManager=e}($,cornerstone,cornerstoneTools),function(a,b){"use strict";function c(){function b(b,c,d){var f=a.getEnabledElement(b);f.image&&e.hasOwnProperty(f.image.imageId)!==!1||(e[f.image.imageId]={});var g=e[f.image.imageId];g.hasOwnProperty(c)===!1&&(g[c]={data:[]});var h=g[c];h.data.push(d)}function c(b,c){var d=a.getEnabledElement(b);if(d.image&&e.hasOwnProperty(d.image.imageId)!==!1){var f=e[d.image.imageId];if(f.hasOwnProperty(c)!==!1){var g=f[c];return g}}}function d(b){var c=a.getEnabledElement(b);c.image&&e.hasOwnProperty(c.image.imageId)!==!1&&delete e[c.image.imageId]}var e={},f={get:c,add:b,clear:d,toolState:e};return f}var d=c();b.newImageIdSpecificToolStateManager=c,b.globalImageIdSpecificToolStateManager=d}(cornerstone,cornerstoneTools),function(a){"use strict";function b(){function a(a){g=a}function b(){return g}function c(a){h=a}function d(){return h}function e(a){i=a}function f(){return i}var g,h,i,j={setStartLoadHandler:a,getStartLoadHandler:b,setEndLoadHandler:c,getEndLoadHandler:d,setErrorLoadingHandler:e,getErrorLoadingHandler:f};return j}a.loadHandlerManager=b()}(cornerstoneTools),function(a,b){"use strict";function c(a,b){function c(c,d,f){if(!(a.indexOf(d)>=0))return b.add(c,d,f);e.hasOwnProperty(d)===!1&&(e[d]={data:[]});var g=e[d];g.data.push(f)}function d(c,d){if(a.indexOf(d)>=0){e.hasOwnProperty(d)===!1&&(e[d]={data:[]});var f=e[d];return f}return b.get(c,d)}var e={},f={get:d,add:c};return f}function d(a){var c=b.getElementToolStateManager(a);void 0===c&&(c=b.globalImageIdSpecificToolStateManager);var d=["stack","stackPrefetch","stackScroll","playClip","volume","slab","referenceLines","crosshairs"],f=b.newStackSpecificToolStateManager(d,c);e.push(f),b.setElementToolStateManager(a,f)}var e=[];b.newStackSpecificToolStateManager=c,b.addStackStateManager=d}(cornerstone,cornerstoneTools),function(a){"use strict";function b(){function a(a){h=a}function b(){return h}function c(a){g=a}function d(){return g}function e(a){i=a}function f(){return i}var g=15,h=g+"px Arial",i="transparent",j={setFont:a,getFont:b,setFontSize:c,getFontSize:d,setBackgroundColor:e,getBackgroundColor:f};return j}a.textStyle=b()}(cornerstoneTools),function(a,b){"use strict";function c(a,b){function c(c,d,f){if(!(a.indexOf(d)>=0))return b.add(c,d,f);e.hasOwnProperty(d)===!1&&(e[d]={data:[]});var g=e[d];g.data.push(f)}function d(c,d){if(a.indexOf(d)>=0){e.hasOwnProperty(d)===!1&&(e[d]={data:[]});var f=e[d];return f}return b.get(c,d)}var e={},f={get:d,add:c};return f}function d(a,c){c=c||["timeSeries"];var d=b.getElementToolStateManager(a);void 0===d&&(d=b.globalImageIdSpecificToolStateManager);var f=b.newTimeSeriesSpecificToolStateManager(c,d);e.push(f),b.setElementToolStateManager(a,f)}var e=[];b.newTimeSeriesSpecificToolStateManager=c,b.addTimeSeriesStateManager=d}(cornerstone,cornerstoneTools),function(a){"use strict";function b(){function a(a){i=a}function b(){return i}function c(a){g=a}function d(){return g}function e(a){h=a}function f(){return h}var g="white",h="greenyellow",i="transparent",j={setFillColor:a,getFillColor:b,setToolColor:c,getToolColor:d,setActiveColor:e,getActiveColor:f};return j}a.toolColors=b()}(cornerstoneTools),function(a){"use strict";function b(){function a(a){c=a.currentPoints.canvas}function b(){return c}var c="",d={setCoords:a,getCoords:b};return d}a.toolCoordinates=b()}(cornerstoneTools),function(a,b){"use strict";function c(c){var d=a.getEnabledElement(c);return void 0===d.toolStateManager&&(d.toolStateManager=b.globalImageIdSpecificToolStateManager),d.toolStateManager}function d(a,b,d){var e=c(a);e.add(a,b,d)}function e(a,b){var d=c(a);return d.get(a,b)}function f(a,b,d){for(var e=c(a),f=e.get(a,b),g=-1,h=0;h<f.data.length;h++)f.data[h]===d&&(g=h);-1!==g&&f.data.splice(g,1)}function g(a,b){var d=c(a),e=d.get(a,b);void 0!==e&&(e.data=[])}function h(b,c){var d=a.getEnabledElement(b);d.toolStateManager=c}b.addToolState=d,b.getToolState=e,b.removeToolState=f,b.clearToolState=g,b.setElementToolStateManager=h,b.getElementToolStateManager=c}(cornerstone,cornerstoneTools),function(a){"use strict";function b(){function a(a){e=a}function b(){return e}function c(a){f=a}function d(){return f}var e=1,f=2,g={setToolWidth:a,getToolWidth:b,setActiveWidth:c,getActiveWidth:d};return g}a.toolStyle=b()}(cornerstoneTools),function(a,b,c){"use strict";function d(a,c,d){if(d!==c){var e=b.getViewport(c),f=b.getViewport(d);(f.scale!==e.scale||f.translation.x!==e.translation.x||f.translation.y!==e.translation.y)&&(f.scale=e.scale,f.translation.x=e.translation.x,f.translation.y=e.translation.y,a.setViewport(d,f))}}c.panZoomSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d,e){if(e!==d){var f=c.getToolState(d,"stack"),g=f.data[0],h=c.getToolState(e,"stack"),i=h.data[0],j=g.currentImageIdIndex;if(j=Math.min(Math.max(j,0),i.imageIds.length-1),j!==i.currentImageIdIndex){var k=c.loadHandlerManager.getStartLoadHandler(),l=c.loadHandlerManager.getEndLoadHandler(),m=c.loadHandlerManager.getErrorLoadingHandler();k&&k(e),b.loadAndCacheImage(i.imageIds[j]).then(function(c){var d=b.getViewport(e);i.currentImageIdIndex=j,a.displayImage(e,c,d),l&&l(e)},function(a){var b=i.imageIds[j];m&&m(e,b,a)})}}}c.stackImageIndexSynchronizer=d
}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(d,e,f){if(f!==e){var g=b.getEnabledElement(e).image,h=c.metaData.get("imagePlane",g.imageId),i=h.imagePositionPatient,j=c.getToolState(f,"stack"),k=j.data[0],l=Number.MAX_VALUE,m=-1;if(a.each(k.imageIds,function(a,b){var d=c.metaData.get("imagePlane",b),e=d.imagePositionPatient,f=e.distanceToSquared(i);l>f&&(l=f,m=a)}),m!==k.currentImageIdIndex){var n=c.loadHandlerManager.getStartLoadHandler(),o=c.loadHandlerManager.getEndLoadHandler(),p=c.loadHandlerManager.getErrorLoadingHandler();n&&n(f),-1!==m&&b.loadAndCacheImage(k.imageIds[m]).then(function(a){var c=b.getViewport(f);k.currentImageIdIndex=m,d.displayImage(f,a,c),o&&o(f)},function(a){var b=k.imageIds[m];p&&p(f,b,a)})}}}c.stackImagePositionSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(c,d){function e(b){j=!0,a.each(i,function(a,c){d(g,b,c)}),j=!1}function f(a){j!==!0&&e(a.currentTarget)}var g=this,h=[],i=[],j=!1;this.addSource=function(b){var d=h.indexOf(b);-1===d&&(h.push(b),a(b).on(c,f),e(b))},this.addTarget=function(a){var b=i.indexOf(a);-1===b&&(i.push(a),d(g,a,a))},this.add=function(a){g.addSource(a),g.addTarget(a)},this.removeSource=function(b){var d=h.indexOf(b);-1!==d&&(h.splice(d,1),a(b).off(c,f),e(b))},this.removeTarget=function(a){var b=i.indexOf(a);-1!==b&&(i.splice(b,1),d(g,a,a))},this.remove=function(a){g.removeTarget(a),g.removeSource(a)},this.getSourceElements=function(){return h},this.displayImage=function(a,c,d){j=!0,b.displayImage(a,c,d),j=!1},this.setViewport=function(a,c){j=!0,b.setViewport(a,c),j=!1}}c.Synchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,c,d){d!==c&&b.updateImage(d)}c.updateImageSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,c,d){if(d!==c){var e=b.getViewport(c),f=b.getViewport(d);(f.voi.windowWidth!==e.voi.windowWidth||f.voi.windowCenter!==e.voi.windowCenter||f.invert!==e.invert)&&(f.voi.windowWidth=e.voi.windowWidth,f.voi.windowCenter=e.voi.windowCenter,f.invert=e.invert,a.setViewport(d,f))}}c.wwwcSynchronizer=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){var c=[];a.timeSeries.stacks.forEach(function(d){b.loadAndCacheImage(d.imageIds[a.imageIdIndex]).then(function(b){var d=Math.round(a.handles.end.x)+Math.round(a.handles.end.y)*b.width,e=b.getPixelData()[d];c.push(e)})}),a.lineSample.set(c)}function e(a){var b=c.getToolState(a.element,"timeSeries");if(void 0!==b&&void 0!==b.data&&0!==b.data.length){var e=b.data[0],f={timeSeries:e,lineSample:new c.LineSampleMeasurement,imageIdIndex:e.stacks[e.currentStackIndex].currentImageIdIndex,visible:!0,handles:{end:{x:a.currentPoints.image.x,y:a.currentPoints.image.y,highlight:!0,active:!0}}};return d(f),c.MeasurementManager.add(f),f}}function f(a,d){var e=c.getToolState(a.currentTarget,g);if(void 0!==e){var f=d.canvasContext.canvas.getContext("2d");b.setToPixelCoordinateSystem(d.enabledElement,f);for(var h="white",i=0;i<e.data.length;i++){f.save();var j=e.data[i];f.beginPath(),c.drawHandles(f,d,j.handles,h),f.stroke();var k=c.setContextToDisplayFontSize(d.enabledElement,d.canvasContext,15);f.font=""+k.fontSize+"px Arial";var l=Math.round(j.handles.end.x),m=Math.round(j.handles.end.y),n=j.handles.end.x+3,o=j.handles.end.y-3;f.fillStyle=h,f.fillText(""+l+","+m,n,o),f.restore()}}}var g="probe4D";c.probeTool4D=c.mouseButtonTool({createNewMeasurement:e,onImageRendered:f,toolType:g})}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,d,e){var f=c.getToolState(a,"timeSeries");if(void 0!==f&&void 0!==f.data&&0!==f.data.length){var g=f.data[0],h=g.stacks[g.currentStackIndex],i=h.currentImageIdIndex,j=g.currentStackIndex+d;if(e?(j>=g.stacks.length&&(j=0),0>j&&(j=g.stacks.length-1)):(j=Math.min(g.stacks.length-1,j),j=Math.max(0,j)),j!==g.currentStackIndex){var k=b.getViewport(a),l=g.stacks[j],m=c.loadHandlerManager.getStartLoadHandler(),n=c.loadHandlerManager.getEndLoadHandler(),o=c.loadHandlerManager.getErrorLoadingHandler();m&&m(a),b.loadAndCacheImage(l.imageIds[i]).then(function(c){g.currentImageIdIndex!==i&&(l.currentImageIdIndex=i,g.currentStackIndex=j,b.displayImage(a,c,k),n&&n(a))},function(b){var c=l.imageIds[i];o&&o(a,c,b)})}}}c.incrementTimePoint=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){if(void 0===a)throw"playClip: element must not be undefined";void 0===b&&(b=30);var d=c.getToolState(a,"timeSeries");if(void 0!==d&&void 0!==d.data&&0!==d.data.length){var e,g=c.getToolState(a,f);void 0===g||0===g.data.length?(e={intervalId:void 0,framesPerSecond:b,lastFrameTimeStamp:void 0,frameRate:0},c.addToolState(a,f,e)):(e=g.data[0],e.framesPerSecond=b),void 0===e.intervalId&&(e.intervalId=setInterval(function(){e.framesPerSecond>0?c.incrementTimePoint(a,1,!0):c.incrementTimePoint(a,-1,!0)},1e3/Math.abs(e.framesPerSecond)))}}function e(a){var b,d=c.getToolState(a,f);void 0!==d&&0!==d.data.length&&(b=d.data[0],clearInterval(b.intervalId),b.intervalId=void 0)}var f="timeSeriesPlayer";c.timeSeriesPlayer={start:d,stop:e}}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(b,c){a(c.element).off("CornerstoneToolsMouseDrag",f),a(c.element).off("CornerstoneToolsMouseUp",d)}function e(b,e){if(c.isMouseButtonEnabled(e.which,b.data.mouseButtonMask)){var g={deltaY:0,options:b.data.options};return a(e.element).on("CornerstoneToolsMouseDrag",g,f),a(e.element).on("CornerstoneToolsMouseUp",d),b.stopImmediatePropagation(),!1}}function f(b,d){b.data.deltaY+=d.deltaPoints.page.y;var e=c.getToolState(d.element,"timeSeries");if(void 0!==e&&void 0!==e.data&&0!==e.data.length){var f=e.data[0],g=a(d.element).height()/f.stacks.length;if(void 0!==b.data.options&&void 0!==b.data.options.timeSeriesScrollSpeed&&(g=b.data.options.timeSeriesScrollSpeed),b.data.deltaY>=g||b.data.deltaY<=-g){var h=Math.round(b.data.deltaY/g),i=b.data.deltaY%g;c.incrementTimePoint(d.element,h),b.data.deltaY=i}return!1}}function g(a,b){var d=-b.direction;c.incrementTimePoint(b.element,d)}function h(a){var b=a.originalEvent.detail,d={deltaY:0};d.deltaY+=b.deltaPoints.page.y;var e=c.getToolState(b.element,"stack");if(void 0!==e&&void 0!==e.data&&0!==e.data.length){if(d.deltaY>=3||d.deltaY<=-3){var f=d.deltaY/3,g=d.deltaY%3;c.setTimePoint(d.element,f),d.deltaY=g}return!1}}c.timeSeriesScroll=c.simpleMouseButtonTool(e),c.timeSeriesScrollWheel=c.mouseWheelTool(g),c.timeSeriesScrollTouchDrag=c.touchDragTool(h)}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c}c.roundToDecimal=d}($,cornerstone,cornerstoneTools),function(a){"use strict";function b(a,b){if(void 0===a.data)return void 0;if("PT"!==a.data.string("x00080060"))return void 0;var c=b*a.slope+a.intercept,d=a.data.floatString("x00101030");if(void 0===d)return void 0;var e=a.data.elements.x00540016;if(void 0===e)return void 0;e=e.items[0].dataSet;var f=e.time("x00181072"),g=e.floatString("x00181074"),h=e.floatString("x00181075"),i=a.data.time("x00080032");if(!(f&&g&&h&&i))return void 0;var j=i.fractionalSeconds+i.seconds+60*i.minutes+60*i.hours*60,k=f.fractionalSeconds+f.seconds+60*f.minutes+60*f.hours*60,l=j-k,m=g*Math.exp(-l*Math.log(2)/h),n=c*d/m*1e3;return n}a.calculateSUV=b}(cornerstoneTools),function(a,b,c,d){"use strict";function e(a){var b=c.point.copy(a.page),d=c.point.copy(a.image),e=c.point.copy(a.client),f=c.point.copy(a.canvas);return{page:b,image:d,client:e,canvas:f}}d.copyPoints=e}($,cornerstone,cornerstoneMath,cornerstoneTools),function(a){"use strict";function b(a,b,c,d,e){var f=.5522848,g=d/2*f,h=e/2*f,i=b+d,j=c+e,k=b+d/2,l=c+e/2;a.beginPath(),a.moveTo(b,l),a.bezierCurveTo(b,l-h,k-g,c,k,c),a.bezierCurveTo(k+g,c,i,l-h,i,l),a.bezierCurveTo(i,l+h,k+g,j,k,j),a.bezierCurveTo(k-g,j,b,l+h,b,l),a.closePath(),a.stroke()}a.drawEllipse=b}(cornerstoneTools),function(a){"use strict";function b(b,c,d,e,f){var g=5,h=a.textStyle.getFont(),i=a.textStyle.getFontSize(),j=a.textStyle.getBackgroundColor();b.save(),b.font=h;var k=b.measureText(c).width;b.textBaseline="top",b.fillStyle=j,b.fillRect(d,e-i,k+2*g,i+2*g),b.fillStyle=f,b.fillText(c,d+g,e-i+g),b.restore()}a.drawTextBox=b}(cornerstoneTools),function(a,b){"use strict";function c(a,b){var c=1<<a-1;return 0!==(b&c)}b.isMouseButtonEnabled=c}(cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a){return a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.returnValue=!1,!1}c.pauseEvent=d}($,cornerstone,cornerstoneTools),function(a,b,c){"use strict";function d(a,b){var c=a.clone().sub(b.imagePositionPatient),d=b.rowCosines.dot(c)/b.columnPixelSpacing,e=b.columnCosines.dot(c)/b.rowPixelSpacing;return{x:d,y:e}}function e(a,b){var c=b.rowCosines.clone().multiplyScalar(a.x);c.multiplyScalar(b.columnPixelSpacing);var d=b.columnCosines.clone().multiplyScalar(a.y);d.multiplyScalar(b.rowPixelSpacing);var e=c.add(d);return e.add(b.imagePositionPatient),e}c.projectPatientPointToImagePlane=d,c.imagePointToPatientPoint=e}($,cornerstone,cornerstoneTools),function(a,b){"use strict";function c(a,c){var d=b.getToolState(a,"stack");if(void 0!==d&&void 0!==d.data&&0!==d.data.length){var e=d.data[0],f=e.currentImageIdIndex+c;f=Math.min(e.imageIds.length-1,f),f=Math.max(0,f),b.scrollToIndex(a,f)}}b.scroll=c}(cornerstone,cornerstoneTools),function(a,b){"use strict";function c(c,d){var e=b.getToolState(c,"stack");if(void 0!==e&&void 0!==e.data&&0!==e.data.length){var f=e.data[0];if(0>d&&(d+=f.imageIds.length),d!==f.currentImageIdIndex){var g=b.loadHandlerManager.getStartLoadHandler(),h=b.loadHandlerManager.getEndLoadHandler(),i=b.loadHandlerManager.getErrorLoadingHandler();g&&g(c);var j,k=b.getToolState(c,"stackPrefetch"),l=!1;k&&k.data&&k.data.length&&k.data[0].enabled&&(j=k.data[0],l=!0,console.log("Pausing prefetching"),j.enabled=!1,j.direction=d-f.currentImageIdIndex),f.currentImageIdIndex=d;var m=a.getViewport(c),n=f.imageIds[d],o=b.stackScroll.getConfiguration();if(o&&o.retryLoadOnScroll===!0){var p=a.imageCache.getImagePromise(n);p&&"rejected"===p.state()&&a.imageCache.removeImagePromise(n)}a.loadAndCacheImage(n).then(function(e){f.currentImageIdIndex===d&&(a.displayImage(c,e,m),h&&h(c),l&&b.stackPrefetch.reenablePrefetch(c))},function(a){var b=f.imageIds[d];i&&i(c,b,a)})}}}b.scrollToIndex=c,b.loadHandlers={}}(cornerstone,cornerstoneTools),function(a,b){"use strict";function c(b,c,d){var e=.1;a.setToPixelCoordinateSystem(b,c,e);var f=d/b.viewport.scale/e,g=d/b.viewport.scale/e;return{fontSize:f,lineHeight:g,fontScale:e}}b.setContextToDisplayFontSize=c}(cornerstone,cornerstoneTools);